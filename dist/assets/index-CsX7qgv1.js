(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const bc="172",ha={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},oa={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},sg=0,of=1,og=2,Ld=1,lg=2,yr=3,Yr=0,xn=1,nr=2,Vr=0,da=1,lf=2,uf=3,cf=4,ug=5,mi=100,cg=101,fg=102,hg=103,dg=104,pg=200,vg=201,gg=202,mg=203,mu=204,yu=205,yg=206,xg=207,Eg=208,_g=209,bg=210,Tg=211,Sg=212,Mg=213,wg=214,xu=0,Eu=1,_u=2,Ea=3,bu=4,Tu=5,Su=6,Mu=7,Pd=0,Ag=1,Cg=2,Hr=0,Rg=1,Dg=2,Lg=3,Pg=4,Ng=5,Ig=6,Og=7,Nd=300,_a=301,ba=302,wu=303,Au=304,sl=306,Cu=1e3,Ei=1001,Ru=1002,qn=1003,Fg=1004,Hs=1005,Xn=1006,Al=1007,_i=1008,Ug=1008,br=1009,Id=1010,Od=1011,ps=1012,Tc=1013,Si=1014,xr=1015,Cs=1016,Sc=1017,Mc=1018,Ta=1020,Fd=35902,Ud=1021,Bd=1022,Yn=1023,kd=1024,zd=1025,pa=1026,Sa=1027,Gd=1028,wc=1029,Vd=1030,Ac=1031,Cc=1033,Ao=33776,Co=33777,Ro=33778,Do=33779,Du=35840,Lu=35841,Pu=35842,Nu=35843,Iu=36196,Ou=37492,Fu=37496,Uu=37808,Bu=37809,ku=37810,zu=37811,Gu=37812,Vu=37813,Hu=37814,Wu=37815,Xu=37816,Yu=37817,qu=37818,Ku=37819,$u=37820,Zu=37821,Lo=36492,Qu=36494,Ju=36495,Hd=36283,ju=36284,ec=36285,tc=36286,Bg=3200,kg=3201,zg=0,Gg=1,kr="",Nn="srgb",Ma="srgb-linear",Xo="linear",bt="srgb",ki=7680,ff=519,Vg=512,Hg=513,Wg=514,Wd=515,Xg=516,Yg=517,qg=518,Kg=519,hf=35044,df="300 es",Er=2e3,Yo=2001;class Ni{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const a=i.indexOf(t);a!==-1&&i.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let a=0,s=i.length;a<s;a++)i[a].call(this,e);e.target=null}}}const nn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let pf=1234567;const ls=Math.PI/180,vs=180/Math.PI;function La(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(nn[n&255]+nn[n>>8&255]+nn[n>>16&255]+nn[n>>24&255]+"-"+nn[e&255]+nn[e>>8&255]+"-"+nn[e>>16&15|64]+nn[e>>24&255]+"-"+nn[t&63|128]+nn[t>>8&255]+"-"+nn[t>>16&255]+nn[t>>24&255]+nn[r&255]+nn[r>>8&255]+nn[r>>16&255]+nn[r>>24&255]).toLowerCase()}function lt(n,e,t){return Math.max(e,Math.min(t,n))}function Rc(n,e){return(n%e+e)%e}function $g(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function Zg(n,e,t){return n!==e?(t-n)/(e-n):0}function us(n,e,t){return(1-t)*n+t*e}function Qg(n,e,t,r){return us(n,e,1-Math.exp(-t*r))}function Jg(n,e=1){return e-Math.abs(Rc(n,e*2)-e)}function jg(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function em(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function tm(n,e){return n+Math.floor(Math.random()*(e-n+1))}function nm(n,e){return n+Math.random()*(e-n)}function rm(n){return n*(.5-Math.random())}function im(n){n!==void 0&&(pf=n);let e=pf+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function am(n){return n*ls}function sm(n){return n*vs}function om(n){return(n&n-1)===0&&n!==0}function lm(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function um(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function cm(n,e,t,r,i){const a=Math.cos,s=Math.sin,o=a(t/2),l=s(t/2),u=a((e+r)/2),c=s((e+r)/2),f=a((e-r)/2),d=s((e-r)/2),h=a((r-e)/2),v=s((r-e)/2);switch(i){case"XYX":n.set(o*c,l*f,l*d,o*u);break;case"YZY":n.set(l*d,o*c,l*f,o*u);break;case"ZXZ":n.set(l*f,l*d,o*c,o*u);break;case"XZX":n.set(o*c,l*v,l*h,o*u);break;case"YXY":n.set(l*h,o*c,l*v,o*u);break;case"ZYZ":n.set(l*v,l*h,o*c,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function aa(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function fn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const fm={DEG2RAD:ls,RAD2DEG:vs,generateUUID:La,clamp:lt,euclideanModulo:Rc,mapLinear:$g,inverseLerp:Zg,lerp:us,damp:Qg,pingpong:Jg,smoothstep:jg,smootherstep:em,randInt:tm,randFloat:nm,randFloatSpread:rm,seededRandom:im,degToRad:am,radToDeg:sm,isPowerOfTwo:om,ceilPowerOfTwo:lm,floorPowerOfTwo:um,setQuaternionFromProperEuler:cm,normalize:fn,denormalize:aa};class ot{constructor(e=0,t=0){ot.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=lt(this.x,e.x,t.x),this.y=lt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=lt(this.x,e,t),this.y=lt(this.y,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(lt(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(lt(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),a=this.x-e.x,s=this.y-e.y;return this.x=a*r-s*i+e.x,this.y=a*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class nt{constructor(e,t,r,i,a,s,o,l,u){nt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,a,s,o,l,u)}set(e,t,r,i,a,s,o,l,u){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=a,c[5]=l,c[6]=r,c[7]=s,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,a=this.elements,s=r[0],o=r[3],l=r[6],u=r[1],c=r[4],f=r[7],d=r[2],h=r[5],v=r[8],m=i[0],g=i[3],p=i[6],x=i[1],y=i[4],E=i[7],M=i[2],w=i[5],b=i[8];return a[0]=s*m+o*x+l*M,a[3]=s*g+o*y+l*w,a[6]=s*p+o*E+l*b,a[1]=u*m+c*x+f*M,a[4]=u*g+c*y+f*w,a[7]=u*p+c*E+f*b,a[2]=d*m+h*x+v*M,a[5]=d*g+h*y+v*w,a[8]=d*p+h*E+v*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8];return t*s*c-t*o*u-r*a*c+r*o*l+i*a*u-i*s*l}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],f=c*s-o*u,d=o*l-c*a,h=u*a-s*l,v=t*f+r*d+i*h;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/v;return e[0]=f*m,e[1]=(i*u-c*r)*m,e[2]=(o*r-i*s)*m,e[3]=d*m,e[4]=(c*t-i*l)*m,e[5]=(i*a-o*t)*m,e[6]=h*m,e[7]=(r*l-u*t)*m,e[8]=(s*t-r*a)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,a,s,o){const l=Math.cos(a),u=Math.sin(a);return this.set(r*l,r*u,-r*(l*s+u*o)+s+e,-i*u,i*l,-i*(-u*s+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Cl.makeScale(e,t)),this}rotate(e){return this.premultiply(Cl.makeRotation(-e)),this}translate(e,t){return this.premultiply(Cl.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Cl=new nt;function Xd(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function qo(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function hm(){const n=qo("canvas");return n.style.display="block",n}const vf={};function sa(n){n in vf||(vf[n]=!0,console.warn(n))}function dm(n,e,t){return new Promise(function(r,i){function a(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(a,t);break;default:r()}}setTimeout(a,t)})}function pm(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function vm(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const gf=new nt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),mf=new nt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function gm(){const n={enabled:!0,workingColorSpace:Ma,spaces:{},convert:function(i,a,s){return this.enabled===!1||a===s||!a||!s||(this.spaces[a].transfer===bt&&(i.r=_r(i.r),i.g=_r(i.g),i.b=_r(i.b)),this.spaces[a].primaries!==this.spaces[s].primaries&&(i.applyMatrix3(this.spaces[a].toXYZ),i.applyMatrix3(this.spaces[s].fromXYZ)),this.spaces[s].transfer===bt&&(i.r=va(i.r),i.g=va(i.g),i.b=va(i.b))),i},fromWorkingColorSpace:function(i,a){return this.convert(i,this.workingColorSpace,a)},toWorkingColorSpace:function(i,a){return this.convert(i,a,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===kr?Xo:this.spaces[i].transfer},getLuminanceCoefficients:function(i,a=this.workingColorSpace){return i.fromArray(this.spaces[a].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,a,s){return i.copy(this.spaces[a].toXYZ).multiply(this.spaces[s].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],r=[.3127,.329];return n.define({[Ma]:{primaries:e,whitePoint:r,transfer:Xo,toXYZ:gf,fromXYZ:mf,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Nn},outputColorSpaceConfig:{drawingBufferColorSpace:Nn}},[Nn]:{primaries:e,whitePoint:r,transfer:bt,toXYZ:gf,fromXYZ:mf,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Nn}}}),n}const gt=gm();function _r(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function va(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let zi;class mm{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{zi===void 0&&(zi=qo("canvas")),zi.width=e.width,zi.height=e.height;const r=zi.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=zi}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=qo("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),a=i.data;for(let s=0;s<a.length;s++)a[s]=_r(a[s]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(_r(t[r]/255)*255):t[r]=_r(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ym=0;class Yd{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ym++}),this.uuid=La(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let a;if(Array.isArray(i)){a=[];for(let s=0,o=i.length;s<o;s++)i[s].isDataTexture?a.push(Rl(i[s].image)):a.push(Rl(i[s]))}else a=Rl(i);r.url=a}return t||(e.images[this.uuid]=r),r}}function Rl(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?mm.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let xm=0;class pn extends Ni{constructor(e=pn.DEFAULT_IMAGE,t=pn.DEFAULT_MAPPING,r=Ei,i=Ei,a=Xn,s=_i,o=Yn,l=br,u=pn.DEFAULT_ANISOTROPY,c=kr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:xm++}),this.uuid=La(),this.name="",this.source=new Yd(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=a,this.minFilter=s,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ot(0,0),this.repeat=new ot(1,1),this.center=new ot(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new nt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Nd)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Cu:e.x=e.x-Math.floor(e.x);break;case Ei:e.x=e.x<0?0:1;break;case Ru:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Cu:e.y=e.y-Math.floor(e.y);break;case Ei:e.y=e.y<0?0:1;break;case Ru:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}pn.DEFAULT_IMAGE=null;pn.DEFAULT_MAPPING=Nd;pn.DEFAULT_ANISOTROPY=1;class Ft{constructor(e=0,t=0,r=0,i=1){Ft.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,a=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i+s[12]*a,this.y=s[1]*t+s[5]*r+s[9]*i+s[13]*a,this.z=s[2]*t+s[6]*r+s[10]*i+s[14]*a,this.w=s[3]*t+s[7]*r+s[11]*i+s[15]*a,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,a;const l=e.elements,u=l[0],c=l[4],f=l[8],d=l[1],h=l[5],v=l[9],m=l[2],g=l[6],p=l[10];if(Math.abs(c-d)<.01&&Math.abs(f-m)<.01&&Math.abs(v-g)<.01){if(Math.abs(c+d)<.1&&Math.abs(f+m)<.1&&Math.abs(v+g)<.1&&Math.abs(u+h+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(u+1)/2,E=(h+1)/2,M=(p+1)/2,w=(c+d)/4,b=(f+m)/4,C=(v+g)/4;return y>E&&y>M?y<.01?(r=0,i=.707106781,a=.707106781):(r=Math.sqrt(y),i=w/r,a=b/r):E>M?E<.01?(r=.707106781,i=0,a=.707106781):(i=Math.sqrt(E),r=w/i,a=C/i):M<.01?(r=.707106781,i=.707106781,a=0):(a=Math.sqrt(M),r=b/a,i=C/a),this.set(r,i,a,t),this}let x=Math.sqrt((g-v)*(g-v)+(f-m)*(f-m)+(d-c)*(d-c));return Math.abs(x)<.001&&(x=1),this.x=(g-v)/x,this.y=(f-m)/x,this.z=(d-c)/x,this.w=Math.acos((u+h+p-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=lt(this.x,e.x,t.x),this.y=lt(this.y,e.y,t.y),this.z=lt(this.z,e.z,t.z),this.w=lt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=lt(this.x,e,t),this.y=lt(this.y,e,t),this.z=lt(this.z,e,t),this.w=lt(this.w,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(lt(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Em extends Ni{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ft(0,0,e,t),this.scissorTest=!1,this.viewport=new Ft(0,0,e,t);const i={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Xn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const a=new pn(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);a.flipY=!1,a.generateMipmaps=r.generateMipmaps,a.internalFormat=r.internalFormat,this.textures=[];const s=r.count;for(let o=0;o<s;o++)this.textures[o]=a.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,a=this.textures.length;i<a;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,i=e.textures.length;r<i;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0,this.textures[r].renderTarget=this;const t=Object.assign({},e.texture.image);return this.texture.source=new Yd(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Mi extends Em{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class qd extends pn{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=qn,this.minFilter=qn,this.wrapR=Ei,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class _m extends pn{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=qn,this.minFilter=qn,this.wrapR=Ei,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class wi{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,a,s,o){let l=r[i+0],u=r[i+1],c=r[i+2],f=r[i+3];const d=a[s+0],h=a[s+1],v=a[s+2],m=a[s+3];if(o===0){e[t+0]=l,e[t+1]=u,e[t+2]=c,e[t+3]=f;return}if(o===1){e[t+0]=d,e[t+1]=h,e[t+2]=v,e[t+3]=m;return}if(f!==m||l!==d||u!==h||c!==v){let g=1-o;const p=l*d+u*h+c*v+f*m,x=p>=0?1:-1,y=1-p*p;if(y>Number.EPSILON){const M=Math.sqrt(y),w=Math.atan2(M,p*x);g=Math.sin(g*w)/M,o=Math.sin(o*w)/M}const E=o*x;if(l=l*g+d*E,u=u*g+h*E,c=c*g+v*E,f=f*g+m*E,g===1-o){const M=1/Math.sqrt(l*l+u*u+c*c+f*f);l*=M,u*=M,c*=M,f*=M}}e[t]=l,e[t+1]=u,e[t+2]=c,e[t+3]=f}static multiplyQuaternionsFlat(e,t,r,i,a,s){const o=r[i],l=r[i+1],u=r[i+2],c=r[i+3],f=a[s],d=a[s+1],h=a[s+2],v=a[s+3];return e[t]=o*v+c*f+l*h-u*d,e[t+1]=l*v+c*d+u*f-o*h,e[t+2]=u*v+c*h+o*d-l*f,e[t+3]=c*v-o*f-l*d-u*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,a=e._z,s=e._order,o=Math.cos,l=Math.sin,u=o(r/2),c=o(i/2),f=o(a/2),d=l(r/2),h=l(i/2),v=l(a/2);switch(s){case"XYZ":this._x=d*c*f+u*h*v,this._y=u*h*f-d*c*v,this._z=u*c*v+d*h*f,this._w=u*c*f-d*h*v;break;case"YXZ":this._x=d*c*f+u*h*v,this._y=u*h*f-d*c*v,this._z=u*c*v-d*h*f,this._w=u*c*f+d*h*v;break;case"ZXY":this._x=d*c*f-u*h*v,this._y=u*h*f+d*c*v,this._z=u*c*v+d*h*f,this._w=u*c*f-d*h*v;break;case"ZYX":this._x=d*c*f-u*h*v,this._y=u*h*f+d*c*v,this._z=u*c*v-d*h*f,this._w=u*c*f+d*h*v;break;case"YZX":this._x=d*c*f+u*h*v,this._y=u*h*f+d*c*v,this._z=u*c*v-d*h*f,this._w=u*c*f-d*h*v;break;case"XZY":this._x=d*c*f-u*h*v,this._y=u*h*f-d*c*v,this._z=u*c*v+d*h*f,this._w=u*c*f+d*h*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],a=t[8],s=t[1],o=t[5],l=t[9],u=t[2],c=t[6],f=t[10],d=r+o+f;if(d>0){const h=.5/Math.sqrt(d+1);this._w=.25/h,this._x=(c-l)*h,this._y=(a-u)*h,this._z=(s-i)*h}else if(r>o&&r>f){const h=2*Math.sqrt(1+r-o-f);this._w=(c-l)/h,this._x=.25*h,this._y=(i+s)/h,this._z=(a+u)/h}else if(o>f){const h=2*Math.sqrt(1+o-r-f);this._w=(a-u)/h,this._x=(i+s)/h,this._y=.25*h,this._z=(l+c)/h}else{const h=2*Math.sqrt(1+f-r-o);this._w=(s-i)/h,this._x=(a+u)/h,this._y=(l+c)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(lt(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,a=e._z,s=e._w,o=t._x,l=t._y,u=t._z,c=t._w;return this._x=r*c+s*o+i*u-a*l,this._y=i*c+s*l+a*o-r*u,this._z=a*c+s*u+r*l-i*o,this._w=s*c-r*o-i*l-a*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,a=this._z,s=this._w;let o=s*e._w+r*e._x+i*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=r,this._y=i,this._z=a,this;const l=1-o*o;if(l<=Number.EPSILON){const h=1-t;return this._w=h*s+t*this._w,this._x=h*r+t*this._x,this._y=h*i+t*this._y,this._z=h*a+t*this._z,this.normalize(),this}const u=Math.sqrt(l),c=Math.atan2(u,o),f=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=s*f+this._w*d,this._x=r*f+this._x*d,this._y=i*f+this._y*d,this._z=a*f+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),a=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Te{constructor(e=0,t=0,r=0){Te.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(yf.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(yf.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[3]*r+a[6]*i,this.y=a[1]*t+a[4]*r+a[7]*i,this.z=a[2]*t+a[5]*r+a[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,a=e.elements,s=1/(a[3]*t+a[7]*r+a[11]*i+a[15]);return this.x=(a[0]*t+a[4]*r+a[8]*i+a[12])*s,this.y=(a[1]*t+a[5]*r+a[9]*i+a[13])*s,this.z=(a[2]*t+a[6]*r+a[10]*i+a[14])*s,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,a=e.x,s=e.y,o=e.z,l=e.w,u=2*(s*i-o*r),c=2*(o*t-a*i),f=2*(a*r-s*t);return this.x=t+l*u+s*f-o*c,this.y=r+l*c+o*u-a*f,this.z=i+l*f+a*c-s*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i,this.y=a[1]*t+a[5]*r+a[9]*i,this.z=a[2]*t+a[6]*r+a[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=lt(this.x,e.x,t.x),this.y=lt(this.y,e.y,t.y),this.z=lt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=lt(this.x,e,t),this.y=lt(this.y,e,t),this.z=lt(this.z,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(lt(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,a=e.z,s=t.x,o=t.y,l=t.z;return this.x=i*l-a*o,this.y=a*s-r*l,this.z=r*o-i*s,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Dl.copy(this).projectOnVector(e),this.sub(Dl)}reflect(e){return this.sub(Dl.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(lt(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Dl=new Te,yf=new wi;class Rs{constructor(e=new Te(1/0,1/0,1/0),t=new Te(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Bn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Bn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Bn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const a=r.getAttribute("position");if(t===!0&&a!==void 0&&e.isInstancedMesh!==!0)for(let s=0,o=a.count;s<o;s++)e.isMesh===!0?e.getVertexPosition(s,Bn):Bn.fromBufferAttribute(a,s),Bn.applyMatrix4(e.matrixWorld),this.expandByPoint(Bn);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Ws.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Ws.copy(r.boundingBox)),Ws.applyMatrix4(e.matrixWorld),this.union(Ws)}const i=e.children;for(let a=0,s=i.length;a<s;a++)this.expandByObject(i[a],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Bn),Bn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Xa),Xs.subVectors(this.max,Xa),Gi.subVectors(e.a,Xa),Vi.subVectors(e.b,Xa),Hi.subVectors(e.c,Xa),Dr.subVectors(Vi,Gi),Lr.subVectors(Hi,Vi),si.subVectors(Gi,Hi);let t=[0,-Dr.z,Dr.y,0,-Lr.z,Lr.y,0,-si.z,si.y,Dr.z,0,-Dr.x,Lr.z,0,-Lr.x,si.z,0,-si.x,-Dr.y,Dr.x,0,-Lr.y,Lr.x,0,-si.y,si.x,0];return!Ll(t,Gi,Vi,Hi,Xs)||(t=[1,0,0,0,1,0,0,0,1],!Ll(t,Gi,Vi,Hi,Xs))?!1:(Ys.crossVectors(Dr,Lr),t=[Ys.x,Ys.y,Ys.z],Ll(t,Gi,Vi,Hi,Xs))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Bn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Bn).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(hr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hr),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const hr=[new Te,new Te,new Te,new Te,new Te,new Te,new Te,new Te],Bn=new Te,Ws=new Rs,Gi=new Te,Vi=new Te,Hi=new Te,Dr=new Te,Lr=new Te,si=new Te,Xa=new Te,Xs=new Te,Ys=new Te,oi=new Te;function Ll(n,e,t,r,i){for(let a=0,s=n.length-3;a<=s;a+=3){oi.fromArray(n,a);const o=i.x*Math.abs(oi.x)+i.y*Math.abs(oi.y)+i.z*Math.abs(oi.z),l=e.dot(oi),u=t.dot(oi),c=r.dot(oi);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>o)return!1}return!0}const bm=new Rs,Ya=new Te,Pl=new Te;class Dc{constructor(e=new Te,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):bm.setFromPoints(e).getCenter(r);let i=0;for(let a=0,s=e.length;a<s;a++)i=Math.max(i,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ya.subVectors(e,this.center);const t=Ya.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(Ya,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Pl.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ya.copy(e.center).add(Pl)),this.expandByPoint(Ya.copy(e.center).sub(Pl))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const dr=new Te,Nl=new Te,qs=new Te,Pr=new Te,Il=new Te,Ks=new Te,Ol=new Te;class Kd{constructor(e=new Te,t=new Te(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,dr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=dr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(dr.copy(this.origin).addScaledVector(this.direction,t),dr.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){Nl.copy(e).add(t).multiplyScalar(.5),qs.copy(t).sub(e).normalize(),Pr.copy(this.origin).sub(Nl);const a=e.distanceTo(t)*.5,s=-this.direction.dot(qs),o=Pr.dot(this.direction),l=-Pr.dot(qs),u=Pr.lengthSq(),c=Math.abs(1-s*s);let f,d,h,v;if(c>0)if(f=s*l-o,d=s*o-l,v=a*c,f>=0)if(d>=-v)if(d<=v){const m=1/c;f*=m,d*=m,h=f*(f+s*d+2*o)+d*(s*f+d+2*l)+u}else d=a,f=Math.max(0,-(s*d+o)),h=-f*f+d*(d+2*l)+u;else d=-a,f=Math.max(0,-(s*d+o)),h=-f*f+d*(d+2*l)+u;else d<=-v?(f=Math.max(0,-(-s*a+o)),d=f>0?-a:Math.min(Math.max(-a,-l),a),h=-f*f+d*(d+2*l)+u):d<=v?(f=0,d=Math.min(Math.max(-a,-l),a),h=d*(d+2*l)+u):(f=Math.max(0,-(s*a+o)),d=f>0?a:Math.min(Math.max(-a,-l),a),h=-f*f+d*(d+2*l)+u);else d=s>0?-a:a,f=Math.max(0,-(s*d+o)),h=-f*f+d*(d+2*l)+u;return r&&r.copy(this.origin).addScaledVector(this.direction,f),i&&i.copy(Nl).addScaledVector(qs,d),h}intersectSphere(e,t){dr.subVectors(e.center,this.origin);const r=dr.dot(this.direction),i=dr.dot(dr)-r*r,a=e.radius*e.radius;if(i>a)return null;const s=Math.sqrt(a-i),o=r-s,l=r+s;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,a,s,o,l;const u=1/this.direction.x,c=1/this.direction.y,f=1/this.direction.z,d=this.origin;return u>=0?(r=(e.min.x-d.x)*u,i=(e.max.x-d.x)*u):(r=(e.max.x-d.x)*u,i=(e.min.x-d.x)*u),c>=0?(a=(e.min.y-d.y)*c,s=(e.max.y-d.y)*c):(a=(e.max.y-d.y)*c,s=(e.min.y-d.y)*c),r>s||a>i||((a>r||isNaN(r))&&(r=a),(s<i||isNaN(i))&&(i=s),f>=0?(o=(e.min.z-d.z)*f,l=(e.max.z-d.z)*f):(o=(e.max.z-d.z)*f,l=(e.min.z-d.z)*f),r>l||o>i)||((o>r||r!==r)&&(r=o),(l<i||i!==i)&&(i=l),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,dr)!==null}intersectTriangle(e,t,r,i,a){Il.subVectors(t,e),Ks.subVectors(r,e),Ol.crossVectors(Il,Ks);let s=this.direction.dot(Ol),o;if(s>0){if(i)return null;o=1}else if(s<0)o=-1,s=-s;else return null;Pr.subVectors(this.origin,e);const l=o*this.direction.dot(Ks.crossVectors(Pr,Ks));if(l<0)return null;const u=o*this.direction.dot(Il.cross(Pr));if(u<0||l+u>s)return null;const c=-o*Pr.dot(Ol);return c<0?null:this.at(c/s,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Bt{constructor(e,t,r,i,a,s,o,l,u,c,f,d,h,v,m,g){Bt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,a,s,o,l,u,c,f,d,h,v,m,g)}set(e,t,r,i,a,s,o,l,u,c,f,d,h,v,m,g){const p=this.elements;return p[0]=e,p[4]=t,p[8]=r,p[12]=i,p[1]=a,p[5]=s,p[9]=o,p[13]=l,p[2]=u,p[6]=c,p[10]=f,p[14]=d,p[3]=h,p[7]=v,p[11]=m,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Bt().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Wi.setFromMatrixColumn(e,0).length(),a=1/Wi.setFromMatrixColumn(e,1).length(),s=1/Wi.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,a=e.z,s=Math.cos(r),o=Math.sin(r),l=Math.cos(i),u=Math.sin(i),c=Math.cos(a),f=Math.sin(a);if(e.order==="XYZ"){const d=s*c,h=s*f,v=o*c,m=o*f;t[0]=l*c,t[4]=-l*f,t[8]=u,t[1]=h+v*u,t[5]=d-m*u,t[9]=-o*l,t[2]=m-d*u,t[6]=v+h*u,t[10]=s*l}else if(e.order==="YXZ"){const d=l*c,h=l*f,v=u*c,m=u*f;t[0]=d+m*o,t[4]=v*o-h,t[8]=s*u,t[1]=s*f,t[5]=s*c,t[9]=-o,t[2]=h*o-v,t[6]=m+d*o,t[10]=s*l}else if(e.order==="ZXY"){const d=l*c,h=l*f,v=u*c,m=u*f;t[0]=d-m*o,t[4]=-s*f,t[8]=v+h*o,t[1]=h+v*o,t[5]=s*c,t[9]=m-d*o,t[2]=-s*u,t[6]=o,t[10]=s*l}else if(e.order==="ZYX"){const d=s*c,h=s*f,v=o*c,m=o*f;t[0]=l*c,t[4]=v*u-h,t[8]=d*u+m,t[1]=l*f,t[5]=m*u+d,t[9]=h*u-v,t[2]=-u,t[6]=o*l,t[10]=s*l}else if(e.order==="YZX"){const d=s*l,h=s*u,v=o*l,m=o*u;t[0]=l*c,t[4]=m-d*f,t[8]=v*f+h,t[1]=f,t[5]=s*c,t[9]=-o*c,t[2]=-u*c,t[6]=h*f+v,t[10]=d-m*f}else if(e.order==="XZY"){const d=s*l,h=s*u,v=o*l,m=o*u;t[0]=l*c,t[4]=-f,t[8]=u*c,t[1]=d*f+m,t[5]=s*c,t[9]=h*f-v,t[2]=v*f-h,t[6]=o*c,t[10]=m*f+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Tm,e,Sm)}lookAt(e,t,r){const i=this.elements;return bn.subVectors(e,t),bn.lengthSq()===0&&(bn.z=1),bn.normalize(),Nr.crossVectors(r,bn),Nr.lengthSq()===0&&(Math.abs(r.z)===1?bn.x+=1e-4:bn.z+=1e-4,bn.normalize(),Nr.crossVectors(r,bn)),Nr.normalize(),$s.crossVectors(bn,Nr),i[0]=Nr.x,i[4]=$s.x,i[8]=bn.x,i[1]=Nr.y,i[5]=$s.y,i[9]=bn.y,i[2]=Nr.z,i[6]=$s.z,i[10]=bn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,a=this.elements,s=r[0],o=r[4],l=r[8],u=r[12],c=r[1],f=r[5],d=r[9],h=r[13],v=r[2],m=r[6],g=r[10],p=r[14],x=r[3],y=r[7],E=r[11],M=r[15],w=i[0],b=i[4],C=i[8],T=i[12],S=i[1],L=i[5],N=i[9],I=i[13],_=i[2],P=i[6],A=i[10],D=i[14],R=i[3],B=i[7],k=i[11],V=i[15];return a[0]=s*w+o*S+l*_+u*R,a[4]=s*b+o*L+l*P+u*B,a[8]=s*C+o*N+l*A+u*k,a[12]=s*T+o*I+l*D+u*V,a[1]=c*w+f*S+d*_+h*R,a[5]=c*b+f*L+d*P+h*B,a[9]=c*C+f*N+d*A+h*k,a[13]=c*T+f*I+d*D+h*V,a[2]=v*w+m*S+g*_+p*R,a[6]=v*b+m*L+g*P+p*B,a[10]=v*C+m*N+g*A+p*k,a[14]=v*T+m*I+g*D+p*V,a[3]=x*w+y*S+E*_+M*R,a[7]=x*b+y*L+E*P+M*B,a[11]=x*C+y*N+E*A+M*k,a[15]=x*T+y*I+E*D+M*V,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],a=e[12],s=e[1],o=e[5],l=e[9],u=e[13],c=e[2],f=e[6],d=e[10],h=e[14],v=e[3],m=e[7],g=e[11],p=e[15];return v*(+a*l*f-i*u*f-a*o*d+r*u*d+i*o*h-r*l*h)+m*(+t*l*h-t*u*d+a*s*d-i*s*h+i*u*c-a*l*c)+g*(+t*u*f-t*o*h-a*s*f+r*s*h+a*o*c-r*u*c)+p*(-i*o*c-t*l*f+t*o*d+i*s*f-r*s*d+r*l*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],f=e[9],d=e[10],h=e[11],v=e[12],m=e[13],g=e[14],p=e[15],x=f*g*u-m*d*u+m*l*h-o*g*h-f*l*p+o*d*p,y=v*d*u-c*g*u-v*l*h+s*g*h+c*l*p-s*d*p,E=c*m*u-v*f*u+v*o*h-s*m*h-c*o*p+s*f*p,M=v*f*l-c*m*l-v*o*d+s*m*d+c*o*g-s*f*g,w=t*x+r*y+i*E+a*M;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/w;return e[0]=x*b,e[1]=(m*d*a-f*g*a-m*i*h+r*g*h+f*i*p-r*d*p)*b,e[2]=(o*g*a-m*l*a+m*i*u-r*g*u-o*i*p+r*l*p)*b,e[3]=(f*l*a-o*d*a-f*i*u+r*d*u+o*i*h-r*l*h)*b,e[4]=y*b,e[5]=(c*g*a-v*d*a+v*i*h-t*g*h-c*i*p+t*d*p)*b,e[6]=(v*l*a-s*g*a-v*i*u+t*g*u+s*i*p-t*l*p)*b,e[7]=(s*d*a-c*l*a+c*i*u-t*d*u-s*i*h+t*l*h)*b,e[8]=E*b,e[9]=(v*f*a-c*m*a-v*r*h+t*m*h+c*r*p-t*f*p)*b,e[10]=(s*m*a-v*o*a+v*r*u-t*m*u-s*r*p+t*o*p)*b,e[11]=(c*o*a-s*f*a-c*r*u+t*f*u+s*r*h-t*o*h)*b,e[12]=M*b,e[13]=(c*m*i-v*f*i+v*r*d-t*m*d-c*r*g+t*f*g)*b,e[14]=(v*o*i-s*m*i-v*r*l+t*m*l+s*r*g-t*o*g)*b,e[15]=(s*f*i-c*o*i+c*r*l-t*f*l-s*r*d+t*o*d)*b,this}scale(e){const t=this.elements,r=e.x,i=e.y,a=e.z;return t[0]*=r,t[4]*=i,t[8]*=a,t[1]*=r,t[5]*=i,t[9]*=a,t[2]*=r,t[6]*=i,t[10]*=a,t[3]*=r,t[7]*=i,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),a=1-r,s=e.x,o=e.y,l=e.z,u=a*s,c=a*o;return this.set(u*s+r,u*o-i*l,u*l+i*o,0,u*o+i*l,c*o+r,c*l-i*s,0,u*l-i*o,c*l+i*s,a*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,a,s){return this.set(1,r,a,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,a=t._x,s=t._y,o=t._z,l=t._w,u=a+a,c=s+s,f=o+o,d=a*u,h=a*c,v=a*f,m=s*c,g=s*f,p=o*f,x=l*u,y=l*c,E=l*f,M=r.x,w=r.y,b=r.z;return i[0]=(1-(m+p))*M,i[1]=(h+E)*M,i[2]=(v-y)*M,i[3]=0,i[4]=(h-E)*w,i[5]=(1-(d+p))*w,i[6]=(g+x)*w,i[7]=0,i[8]=(v+y)*b,i[9]=(g-x)*b,i[10]=(1-(d+m))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let a=Wi.set(i[0],i[1],i[2]).length();const s=Wi.set(i[4],i[5],i[6]).length(),o=Wi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(a=-a),e.x=i[12],e.y=i[13],e.z=i[14],kn.copy(this);const u=1/a,c=1/s,f=1/o;return kn.elements[0]*=u,kn.elements[1]*=u,kn.elements[2]*=u,kn.elements[4]*=c,kn.elements[5]*=c,kn.elements[6]*=c,kn.elements[8]*=f,kn.elements[9]*=f,kn.elements[10]*=f,t.setFromRotationMatrix(kn),r.x=a,r.y=s,r.z=o,this}makePerspective(e,t,r,i,a,s,o=Er){const l=this.elements,u=2*a/(t-e),c=2*a/(r-i),f=(t+e)/(t-e),d=(r+i)/(r-i);let h,v;if(o===Er)h=-(s+a)/(s-a),v=-2*s*a/(s-a);else if(o===Yo)h=-s/(s-a),v=-s*a/(s-a);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=u,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=c,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=h,l[14]=v,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,i,a,s,o=Er){const l=this.elements,u=1/(t-e),c=1/(r-i),f=1/(s-a),d=(t+e)*u,h=(r+i)*c;let v,m;if(o===Er)v=(s+a)*f,m=-2*f;else if(o===Yo)v=a*f,m=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-h,l[2]=0,l[6]=0,l[10]=m,l[14]=-v,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Wi=new Te,kn=new Bt,Tm=new Te(0,0,0),Sm=new Te(1,1,1),Nr=new Te,$s=new Te,bn=new Te,xf=new Bt,Ef=new wi;class Tr{constructor(e=0,t=0,r=0,i=Tr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,a=i[0],s=i[4],o=i[8],l=i[1],u=i[5],c=i[9],f=i[2],d=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(lt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-lt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-f,a),this._z=0);break;case"ZXY":this._x=Math.asin(lt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,h),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-lt(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-s,u));break;case"YZX":this._z=Math.asin(lt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-f,a)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-lt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return xf.makeRotationFromQuaternion(e),this.setFromRotationMatrix(xf,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ef.setFromEuler(this),this.setFromQuaternion(Ef,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Tr.DEFAULT_ORDER="XYZ";class $d{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Mm=0;const _f=new Te,Xi=new wi,pr=new Bt,Zs=new Te,qa=new Te,wm=new Te,Am=new wi,bf=new Te(1,0,0),Tf=new Te(0,1,0),Sf=new Te(0,0,1),Mf={type:"added"},Cm={type:"removed"},Yi={type:"childadded",child:null},Fl={type:"childremoved",child:null};class wn extends Ni{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Mm++}),this.uuid=La(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=wn.DEFAULT_UP.clone();const e=new Te,t=new Tr,r=new wi,i=new Te(1,1,1);function a(){r.setFromEuler(t,!1)}function s(){t.setFromQuaternion(r,void 0,!1)}t._onChange(a),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Bt},normalMatrix:{value:new nt}}),this.matrix=new Bt,this.matrixWorld=new Bt,this.matrixAutoUpdate=wn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=wn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new $d,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Xi.setFromAxisAngle(e,t),this.quaternion.multiply(Xi),this}rotateOnWorldAxis(e,t){return Xi.setFromAxisAngle(e,t),this.quaternion.premultiply(Xi),this}rotateX(e){return this.rotateOnAxis(bf,e)}rotateY(e){return this.rotateOnAxis(Tf,e)}rotateZ(e){return this.rotateOnAxis(Sf,e)}translateOnAxis(e,t){return _f.copy(e).applyQuaternion(this.quaternion),this.position.add(_f.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(bf,e)}translateY(e){return this.translateOnAxis(Tf,e)}translateZ(e){return this.translateOnAxis(Sf,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(pr.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Zs.copy(e):Zs.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),qa.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pr.lookAt(qa,Zs,this.up):pr.lookAt(Zs,qa,this.up),this.quaternion.setFromRotationMatrix(pr),i&&(pr.extractRotation(i.matrixWorld),Xi.setFromRotationMatrix(pr),this.quaternion.premultiply(Xi.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Mf),Yi.child=e,this.dispatchEvent(Yi),Yi.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Cm),Fl.child=e,this.dispatchEvent(Fl),Fl.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),pr.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),pr.multiply(e.parent.matrixWorld)),e.applyMatrix4(pr),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Mf),Yi.child=e,this.dispatchEvent(Yi),Yi.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let a=0,s=i.length;a<s;a++)i[a].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qa,e,wm),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qa,Am,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let a=0,s=i.length;a<s;a++)i[a].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function a(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=a(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const f=l[u];a(e.shapes,f)}else a(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(a(e.materials,this.material[l]));i.material=o}else i.material=a(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];i.animations.push(a(e.animations,l))}}if(t){const o=s(e.geometries),l=s(e.materials),u=s(e.textures),c=s(e.images),f=s(e.shapes),d=s(e.skeletons),h=s(e.animations),v=s(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),c.length>0&&(r.images=c),f.length>0&&(r.shapes=f),d.length>0&&(r.skeletons=d),h.length>0&&(r.animations=h),v.length>0&&(r.nodes=v)}return r.object=i,r;function s(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}wn.DEFAULT_UP=new Te(0,1,0);wn.DEFAULT_MATRIX_AUTO_UPDATE=!0;wn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const zn=new Te,vr=new Te,Ul=new Te,gr=new Te,qi=new Te,Ki=new Te,wf=new Te,Bl=new Te,kl=new Te,zl=new Te,Gl=new Ft,Vl=new Ft,Hl=new Ft;class Wn{constructor(e=new Te,t=new Te,r=new Te){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),zn.subVectors(e,t),i.cross(zn);const a=i.lengthSq();return a>0?i.multiplyScalar(1/Math.sqrt(a)):i.set(0,0,0)}static getBarycoord(e,t,r,i,a){zn.subVectors(i,t),vr.subVectors(r,t),Ul.subVectors(e,t);const s=zn.dot(zn),o=zn.dot(vr),l=zn.dot(Ul),u=vr.dot(vr),c=vr.dot(Ul),f=s*u-o*o;if(f===0)return a.set(0,0,0),null;const d=1/f,h=(u*l-o*c)*d,v=(s*c-o*l)*d;return a.set(1-h-v,v,h)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,gr)===null?!1:gr.x>=0&&gr.y>=0&&gr.x+gr.y<=1}static getInterpolation(e,t,r,i,a,s,o,l){return this.getBarycoord(e,t,r,i,gr)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(a,gr.x),l.addScaledVector(s,gr.y),l.addScaledVector(o,gr.z),l)}static getInterpolatedAttribute(e,t,r,i,a,s){return Gl.setScalar(0),Vl.setScalar(0),Hl.setScalar(0),Gl.fromBufferAttribute(e,t),Vl.fromBufferAttribute(e,r),Hl.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(Gl,a.x),s.addScaledVector(Vl,a.y),s.addScaledVector(Hl,a.z),s}static isFrontFacing(e,t,r,i){return zn.subVectors(r,t),vr.subVectors(e,t),zn.cross(vr).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return zn.subVectors(this.c,this.b),vr.subVectors(this.a,this.b),zn.cross(vr).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Wn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Wn.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,a){return Wn.getInterpolation(e,this.a,this.b,this.c,t,r,i,a)}containsPoint(e){return Wn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Wn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,a=this.c;let s,o;qi.subVectors(i,r),Ki.subVectors(a,r),Bl.subVectors(e,r);const l=qi.dot(Bl),u=Ki.dot(Bl);if(l<=0&&u<=0)return t.copy(r);kl.subVectors(e,i);const c=qi.dot(kl),f=Ki.dot(kl);if(c>=0&&f<=c)return t.copy(i);const d=l*f-c*u;if(d<=0&&l>=0&&c<=0)return s=l/(l-c),t.copy(r).addScaledVector(qi,s);zl.subVectors(e,a);const h=qi.dot(zl),v=Ki.dot(zl);if(v>=0&&h<=v)return t.copy(a);const m=h*u-l*v;if(m<=0&&u>=0&&v<=0)return o=u/(u-v),t.copy(r).addScaledVector(Ki,o);const g=c*v-h*f;if(g<=0&&f-c>=0&&h-v>=0)return wf.subVectors(a,i),o=(f-c)/(f-c+(h-v)),t.copy(i).addScaledVector(wf,o);const p=1/(g+m+d);return s=m*p,o=d*p,t.copy(r).addScaledVector(qi,s).addScaledVector(Ki,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Zd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ir={h:0,s:0,l:0},Qs={h:0,s:0,l:0};function Wl(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class St{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Nn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,gt.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=gt.workingColorSpace){return this.r=e,this.g=t,this.b=r,gt.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=gt.workingColorSpace){if(e=Rc(e,1),t=lt(t,0,1),r=lt(r,0,1),t===0)this.r=this.g=this.b=r;else{const a=r<=.5?r*(1+t):r+t-r*t,s=2*r-a;this.r=Wl(s,a,e+1/3),this.g=Wl(s,a,e),this.b=Wl(s,a,e-1/3)}return gt.toWorkingColorSpace(this,i),this}setStyle(e,t=Nn){function r(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,t);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,t);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=i[1],s=a.length;if(s===3)return this.setRGB(parseInt(a.charAt(0),16)/15,parseInt(a.charAt(1),16)/15,parseInt(a.charAt(2),16)/15,t);if(s===6)return this.setHex(parseInt(a,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Nn){const r=Zd[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=_r(e.r),this.g=_r(e.g),this.b=_r(e.b),this}copyLinearToSRGB(e){return this.r=va(e.r),this.g=va(e.g),this.b=va(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Nn){return gt.fromWorkingColorSpace(rn.copy(this),e),Math.round(lt(rn.r*255,0,255))*65536+Math.round(lt(rn.g*255,0,255))*256+Math.round(lt(rn.b*255,0,255))}getHexString(e=Nn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=gt.workingColorSpace){gt.fromWorkingColorSpace(rn.copy(this),t);const r=rn.r,i=rn.g,a=rn.b,s=Math.max(r,i,a),o=Math.min(r,i,a);let l,u;const c=(o+s)/2;if(o===s)l=0,u=0;else{const f=s-o;switch(u=c<=.5?f/(s+o):f/(2-s-o),s){case r:l=(i-a)/f+(i<a?6:0);break;case i:l=(a-r)/f+2;break;case a:l=(r-i)/f+4;break}l/=6}return e.h=l,e.s=u,e.l=c,e}getRGB(e,t=gt.workingColorSpace){return gt.fromWorkingColorSpace(rn.copy(this),t),e.r=rn.r,e.g=rn.g,e.b=rn.b,e}getStyle(e=Nn){gt.fromWorkingColorSpace(rn.copy(this),e);const t=rn.r,r=rn.g,i=rn.b;return e!==Nn?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(Ir),this.setHSL(Ir.h+e,Ir.s+t,Ir.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(Ir),e.getHSL(Qs);const r=us(Ir.h,Qs.h,t),i=us(Ir.s,Qs.s,t),a=us(Ir.l,Qs.l,t);return this.setHSL(r,i,a),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,a=e.elements;return this.r=a[0]*t+a[3]*r+a[6]*i,this.g=a[1]*t+a[4]*r+a[7]*i,this.b=a[2]*t+a[5]*r+a[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const rn=new St;St.NAMES=Zd;let Rm=0;class ol extends Ni{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Rm++}),this.uuid=La(),this.name="",this.type="Material",this.blending=da,this.side=Yr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=mu,this.blendDst=yu,this.blendEquation=mi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new St(0,0,0),this.blendAlpha=0,this.depthFunc=Ea,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ff,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ki,this.stencilZFail=ki,this.stencilZPass=ki,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==da&&(r.blending=this.blending),this.side!==Yr&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==mu&&(r.blendSrc=this.blendSrc),this.blendDst!==yu&&(r.blendDst=this.blendDst),this.blendEquation!==mi&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Ea&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==ff&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ki&&(r.stencilFail=this.stencilFail),this.stencilZFail!==ki&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==ki&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(a){const s=[];for(const o in a){const l=a[o];delete l.metadata,s.push(l)}return s}if(t){const a=i(e.textures),s=i(e.images);a.length>0&&(r.textures=a),s.length>0&&(r.images=s)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let a=0;a!==i;++a)r[a]=t[a].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Lc extends ol{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new St(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Tr,this.combine=Pd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ut=new Te,Js=new ot;class sr{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=hf,this.updateRanges=[],this.gpuType=xr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,a=this.itemSize;i<a;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Js.fromBufferAttribute(this,t),Js.applyMatrix3(e),this.setXY(t,Js.x,Js.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)Ut.fromBufferAttribute(this,t),Ut.applyMatrix3(e),this.setXYZ(t,Ut.x,Ut.y,Ut.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Ut.fromBufferAttribute(this,t),Ut.applyMatrix4(e),this.setXYZ(t,Ut.x,Ut.y,Ut.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Ut.fromBufferAttribute(this,t),Ut.applyNormalMatrix(e),this.setXYZ(t,Ut.x,Ut.y,Ut.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Ut.fromBufferAttribute(this,t),Ut.transformDirection(e),this.setXYZ(t,Ut.x,Ut.y,Ut.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=aa(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=fn(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=aa(t,this.array)),t}setX(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=aa(t,this.array)),t}setY(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=aa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=aa(t,this.array)),t}setW(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),r=fn(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),r=fn(r,this.array),i=fn(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,a){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),r=fn(r,this.array),i=fn(i,this.array),a=fn(a,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==hf&&(e.usage=this.usage),e}}class Qd extends sr{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class Jd extends sr{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Ti extends sr{constructor(e,t,r){super(new Float32Array(e),t,r)}}let Dm=0;const Ln=new Bt,Xl=new wn,$i=new Te,Tn=new Rs,Ka=new Rs,qt=new Te;class Ii extends Ni{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Dm++}),this.uuid=La(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Xd(e)?Jd:Qd)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const a=new nt().getNormalMatrix(e);r.applyNormalMatrix(a),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ln.makeRotationFromQuaternion(e),this.applyMatrix4(Ln),this}rotateX(e){return Ln.makeRotationX(e),this.applyMatrix4(Ln),this}rotateY(e){return Ln.makeRotationY(e),this.applyMatrix4(Ln),this}rotateZ(e){return Ln.makeRotationZ(e),this.applyMatrix4(Ln),this}translate(e,t,r){return Ln.makeTranslation(e,t,r),this.applyMatrix4(Ln),this}scale(e,t,r){return Ln.makeScale(e,t,r),this.applyMatrix4(Ln),this}lookAt(e){return Xl.lookAt(e),Xl.updateMatrix(),this.applyMatrix4(Xl.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($i).negate(),this.translate($i.x,$i.y,$i.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const r=[];for(let i=0,a=e.length;i<a;i++){const s=e[i];r.push(s.x,s.y,s.z||0)}this.setAttribute("position",new Ti(r,3))}else{const r=Math.min(e.length,t.count);for(let i=0;i<r;i++){const a=e[i];t.setXYZ(i,a.x,a.y,a.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Rs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Te(-1/0,-1/0,-1/0),new Te(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const a=t[r];Tn.setFromBufferAttribute(a),this.morphTargetsRelative?(qt.addVectors(this.boundingBox.min,Tn.min),this.boundingBox.expandByPoint(qt),qt.addVectors(this.boundingBox.max,Tn.max),this.boundingBox.expandByPoint(qt)):(this.boundingBox.expandByPoint(Tn.min),this.boundingBox.expandByPoint(Tn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Te,1/0);return}if(e){const r=this.boundingSphere.center;if(Tn.setFromBufferAttribute(e),t)for(let a=0,s=t.length;a<s;a++){const o=t[a];Ka.setFromBufferAttribute(o),this.morphTargetsRelative?(qt.addVectors(Tn.min,Ka.min),Tn.expandByPoint(qt),qt.addVectors(Tn.max,Ka.max),Tn.expandByPoint(qt)):(Tn.expandByPoint(Ka.min),Tn.expandByPoint(Ka.max))}Tn.getCenter(r);let i=0;for(let a=0,s=e.count;a<s;a++)qt.fromBufferAttribute(e,a),i=Math.max(i,r.distanceToSquared(qt));if(t)for(let a=0,s=t.length;a<s;a++){const o=t[a],l=this.morphTargetsRelative;for(let u=0,c=o.count;u<c;u++)qt.fromBufferAttribute(o,u),l&&($i.fromBufferAttribute(e,u),qt.add($i)),i=Math.max(i,r.distanceToSquared(qt))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,a=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new sr(new Float32Array(4*r.count),4));const s=this.getAttribute("tangent"),o=[],l=[];for(let C=0;C<r.count;C++)o[C]=new Te,l[C]=new Te;const u=new Te,c=new Te,f=new Te,d=new ot,h=new ot,v=new ot,m=new Te,g=new Te;function p(C,T,S){u.fromBufferAttribute(r,C),c.fromBufferAttribute(r,T),f.fromBufferAttribute(r,S),d.fromBufferAttribute(a,C),h.fromBufferAttribute(a,T),v.fromBufferAttribute(a,S),c.sub(u),f.sub(u),h.sub(d),v.sub(d);const L=1/(h.x*v.y-v.x*h.y);isFinite(L)&&(m.copy(c).multiplyScalar(v.y).addScaledVector(f,-h.y).multiplyScalar(L),g.copy(f).multiplyScalar(h.x).addScaledVector(c,-v.x).multiplyScalar(L),o[C].add(m),o[T].add(m),o[S].add(m),l[C].add(g),l[T].add(g),l[S].add(g))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let C=0,T=x.length;C<T;++C){const S=x[C],L=S.start,N=S.count;for(let I=L,_=L+N;I<_;I+=3)p(e.getX(I+0),e.getX(I+1),e.getX(I+2))}const y=new Te,E=new Te,M=new Te,w=new Te;function b(C){M.fromBufferAttribute(i,C),w.copy(M);const T=o[C];y.copy(T),y.sub(M.multiplyScalar(M.dot(T))).normalize(),E.crossVectors(w,T);const L=E.dot(l[C])<0?-1:1;s.setXYZW(C,y.x,y.y,y.z,L)}for(let C=0,T=x.length;C<T;++C){const S=x[C],L=S.start,N=S.count;for(let I=L,_=L+N;I<_;I+=3)b(e.getX(I+0)),b(e.getX(I+1)),b(e.getX(I+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new sr(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let d=0,h=r.count;d<h;d++)r.setXYZ(d,0,0,0);const i=new Te,a=new Te,s=new Te,o=new Te,l=new Te,u=new Te,c=new Te,f=new Te;if(e)for(let d=0,h=e.count;d<h;d+=3){const v=e.getX(d+0),m=e.getX(d+1),g=e.getX(d+2);i.fromBufferAttribute(t,v),a.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),c.subVectors(s,a),f.subVectors(i,a),c.cross(f),o.fromBufferAttribute(r,v),l.fromBufferAttribute(r,m),u.fromBufferAttribute(r,g),o.add(c),l.add(c),u.add(c),r.setXYZ(v,o.x,o.y,o.z),r.setXYZ(m,l.x,l.y,l.z),r.setXYZ(g,u.x,u.y,u.z)}else for(let d=0,h=t.count;d<h;d+=3)i.fromBufferAttribute(t,d+0),a.fromBufferAttribute(t,d+1),s.fromBufferAttribute(t,d+2),c.subVectors(s,a),f.subVectors(i,a),c.cross(f),r.setXYZ(d+0,c.x,c.y,c.z),r.setXYZ(d+1,c.x,c.y,c.z),r.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)qt.fromBufferAttribute(e,t),qt.normalize(),e.setXYZ(t,qt.x,qt.y,qt.z)}toNonIndexed(){function e(o,l){const u=o.array,c=o.itemSize,f=o.normalized,d=new u.constructor(l.length*c);let h=0,v=0;for(let m=0,g=l.length;m<g;m++){o.isInterleavedBufferAttribute?h=l[m]*o.data.stride+o.offset:h=l[m]*c;for(let p=0;p<c;p++)d[v++]=u[h++]}return new sr(d,c,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ii,r=this.index.array,i=this.attributes;for(const o in i){const l=i[o],u=e(l,r);t.setAttribute(o,u)}const a=this.morphAttributes;for(const o in a){const l=[],u=a[o];for(let c=0,f=u.length;c<f;c++){const d=u[c],h=e(d,r);l.push(h)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,l=s.length;o<l;o++){const u=s[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const u=r[l];e.data.attributes[l]=u.toJSON(e.data)}const i={};let a=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],c=[];for(let f=0,d=u.length;f<d;f++){const h=u[f];c.push(h.toJSON(e.data))}c.length>0&&(i[l]=c,a=!0)}a&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const u in i){const c=i[u];this.setAttribute(u,c.clone(t))}const a=e.morphAttributes;for(const u in a){const c=[],f=a[u];for(let d=0,h=f.length;d<h;d++)c.push(f[d].clone(t));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let u=0,c=s.length;u<c;u++){const f=s[u];this.addGroup(f.start,f.count,f.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Af=new Bt,li=new Kd,js=new Dc,Cf=new Te,eo=new Te,to=new Te,no=new Te,Yl=new Te,ro=new Te,Rf=new Te,io=new Te;class rr extends wn{constructor(e=new Ii,t=new Lc){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=i.length;a<s;a++){const o=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,a=r.morphAttributes.position,s=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(a&&o){ro.set(0,0,0);for(let l=0,u=a.length;l<u;l++){const c=o[l],f=a[l];c!==0&&(Yl.fromBufferAttribute(f,e),s?ro.addScaledVector(Yl,c):ro.addScaledVector(Yl.sub(t),c))}t.add(ro)}return t}raycast(e,t){const r=this.geometry,i=this.material,a=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),js.copy(r.boundingSphere),js.applyMatrix4(a),li.copy(e.ray).recast(e.near),!(js.containsPoint(li.origin)===!1&&(li.intersectSphere(js,Cf)===null||li.origin.distanceToSquared(Cf)>(e.far-e.near)**2))&&(Af.copy(a).invert(),li.copy(e.ray).applyMatrix4(Af),!(r.boundingBox!==null&&li.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,li)))}_computeIntersections(e,t,r){let i;const a=this.geometry,s=this.material,o=a.index,l=a.attributes.position,u=a.attributes.uv,c=a.attributes.uv1,f=a.attributes.normal,d=a.groups,h=a.drawRange;if(o!==null)if(Array.isArray(s))for(let v=0,m=d.length;v<m;v++){const g=d[v],p=s[g.materialIndex],x=Math.max(g.start,h.start),y=Math.min(o.count,Math.min(g.start+g.count,h.start+h.count));for(let E=x,M=y;E<M;E+=3){const w=o.getX(E),b=o.getX(E+1),C=o.getX(E+2);i=ao(this,p,e,r,u,c,f,w,b,C),i&&(i.faceIndex=Math.floor(E/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const v=Math.max(0,h.start),m=Math.min(o.count,h.start+h.count);for(let g=v,p=m;g<p;g+=3){const x=o.getX(g),y=o.getX(g+1),E=o.getX(g+2);i=ao(this,s,e,r,u,c,f,x,y,E),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(s))for(let v=0,m=d.length;v<m;v++){const g=d[v],p=s[g.materialIndex],x=Math.max(g.start,h.start),y=Math.min(l.count,Math.min(g.start+g.count,h.start+h.count));for(let E=x,M=y;E<M;E+=3){const w=E,b=E+1,C=E+2;i=ao(this,p,e,r,u,c,f,w,b,C),i&&(i.faceIndex=Math.floor(E/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const v=Math.max(0,h.start),m=Math.min(l.count,h.start+h.count);for(let g=v,p=m;g<p;g+=3){const x=g,y=g+1,E=g+2;i=ao(this,s,e,r,u,c,f,x,y,E),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}}}function Lm(n,e,t,r,i,a,s,o){let l;if(e.side===xn?l=r.intersectTriangle(s,a,i,!0,o):l=r.intersectTriangle(i,a,s,e.side===Yr,o),l===null)return null;io.copy(o),io.applyMatrix4(n.matrixWorld);const u=t.ray.origin.distanceTo(io);return u<t.near||u>t.far?null:{distance:u,point:io.clone(),object:n}}function ao(n,e,t,r,i,a,s,o,l,u){n.getVertexPosition(o,eo),n.getVertexPosition(l,to),n.getVertexPosition(u,no);const c=Lm(n,e,t,r,eo,to,no,Rf);if(c){const f=new Te;Wn.getBarycoord(Rf,eo,to,no,f),i&&(c.uv=Wn.getInterpolatedAttribute(i,o,l,u,f,new ot)),a&&(c.uv1=Wn.getInterpolatedAttribute(a,o,l,u,f,new ot)),s&&(c.normal=Wn.getInterpolatedAttribute(s,o,l,u,f,new Te),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const d={a:o,b:l,c:u,normal:new Te,materialIndex:0};Wn.getNormal(eo,to,no,d.normal),c.face=d,c.barycoord=f}return c}class Ds extends Ii{constructor(e=1,t=1,r=1,i=1,a=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:a,depthSegments:s};const o=this;i=Math.floor(i),a=Math.floor(a),s=Math.floor(s);const l=[],u=[],c=[],f=[];let d=0,h=0;v("z","y","x",-1,-1,r,t,e,s,a,0),v("z","y","x",1,-1,r,t,-e,s,a,1),v("x","z","y",1,1,e,r,t,i,s,2),v("x","z","y",1,-1,e,r,-t,i,s,3),v("x","y","z",1,-1,e,t,r,i,a,4),v("x","y","z",-1,-1,e,t,-r,i,a,5),this.setIndex(l),this.setAttribute("position",new Ti(u,3)),this.setAttribute("normal",new Ti(c,3)),this.setAttribute("uv",new Ti(f,2));function v(m,g,p,x,y,E,M,w,b,C,T){const S=E/b,L=M/C,N=E/2,I=M/2,_=w/2,P=b+1,A=C+1;let D=0,R=0;const B=new Te;for(let k=0;k<A;k++){const V=k*L-I;for(let Y=0;Y<P;Y++){const Z=Y*S-N;B[m]=Z*x,B[g]=V*y,B[p]=_,u.push(B.x,B.y,B.z),B[m]=0,B[g]=0,B[p]=w>0?1:-1,c.push(B.x,B.y,B.z),f.push(Y/b),f.push(1-k/C),D+=1}}for(let k=0;k<C;k++)for(let V=0;V<b;V++){const Y=d+V+P*k,Z=d+V+P*(k+1),W=d+(V+1)+P*(k+1),K=d+(V+1)+P*k;l.push(Y,Z,K),l.push(Z,W,K),R+=6}o.addGroup(h,R,T),h+=R,d+=D}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ds(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function wa(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function hn(n){const e={};for(let t=0;t<n.length;t++){const r=wa(n[t]);for(const i in r)e[i]=r[i]}return e}function Pm(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function jd(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:gt.workingColorSpace}const Nm={clone:wa,merge:hn};var Im=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Om=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class qr extends ol{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Im,this.fragmentShader=Om,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=wa(e.uniforms),this.uniformsGroups=Pm(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class ep extends wn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Bt,this.projectionMatrix=new Bt,this.projectionMatrixInverse=new Bt,this.coordinateSystem=Er}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Or=new Te,Df=new ot,Lf=new ot;class Vn extends ep{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=vs*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(ls*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return vs*2*Math.atan(Math.tan(ls*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){Or.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Or.x,Or.y).multiplyScalar(-e/Or.z),Or.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Or.x,Or.y).multiplyScalar(-e/Or.z)}getViewSize(e,t){return this.getViewBounds(e,Df,Lf),t.subVectors(Lf,Df)}setViewOffset(e,t,r,i,a,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(ls*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,a=-.5*i;const s=this.view;if(this.view!==null&&this.view.enabled){const l=s.fullWidth,u=s.fullHeight;a+=s.offsetX*i/l,t-=s.offsetY*r/u,i*=s.width/l,r*=s.height/u}const o=this.filmOffset;o!==0&&(a+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Zi=-90,Qi=1;class Fm extends wn{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Vn(Zi,Qi,e,t);i.layers=this.layers,this.add(i);const a=new Vn(Zi,Qi,e,t);a.layers=this.layers,this.add(a);const s=new Vn(Zi,Qi,e,t);s.layers=this.layers,this.add(s);const o=new Vn(Zi,Qi,e,t);o.layers=this.layers,this.add(o);const l=new Vn(Zi,Qi,e,t);l.layers=this.layers,this.add(l);const u=new Vn(Zi,Qi,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,a,s,o,l]=t;for(const u of t)this.remove(u);if(e===Er)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Yo)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,s,o,l,u,c]=this.children,f=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),v=e.xr.enabled;e.xr.enabled=!1;const m=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,a),e.setRenderTarget(r,1,i),e.render(t,s),e.setRenderTarget(r,2,i),e.render(t,o),e.setRenderTarget(r,3,i),e.render(t,l),e.setRenderTarget(r,4,i),e.render(t,u),r.texture.generateMipmaps=m,e.setRenderTarget(r,5,i),e.render(t,c),e.setRenderTarget(f,d,h),e.xr.enabled=v,r.texture.needsPMREMUpdate=!0}}class tp extends pn{constructor(e,t,r,i,a,s,o,l,u,c){e=e!==void 0?e:[],t=t!==void 0?t:_a,super(e,t,r,i,a,s,o,l,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Um extends Mi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new tp(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Xn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Ds(5,5,5),a=new qr({name:"CubemapFromEquirect",uniforms:wa(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:xn,blending:Vr});a.uniforms.tEquirect.value=t;const s=new rr(i,a),o=t.minFilter;return t.minFilter===_i&&(t.minFilter=Xn),new Fm(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,r,i){const a=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,r,i);e.setRenderTarget(a)}}class Bm extends wn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Tr,this.environmentIntensity=1,this.environmentRotation=new Tr,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const ql=new Te,km=new Te,zm=new nt;class Br{constructor(e=new Te(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=ql.subVectors(r,t).cross(km.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(ql),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/i;return a<0||a>1?null:t.copy(e.start).addScaledVector(r,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||zm.getNormalMatrix(e),i=this.coplanarPoint(ql).applyMatrix4(e),a=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ui=new Dc,so=new Te;class np{constructor(e=new Br,t=new Br,r=new Br,i=new Br,a=new Br,s=new Br){this.planes=[e,t,r,i,a,s]}set(e,t,r,i,a,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(a),o[5].copy(s),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=Er){const r=this.planes,i=e.elements,a=i[0],s=i[1],o=i[2],l=i[3],u=i[4],c=i[5],f=i[6],d=i[7],h=i[8],v=i[9],m=i[10],g=i[11],p=i[12],x=i[13],y=i[14],E=i[15];if(r[0].setComponents(l-a,d-u,g-h,E-p).normalize(),r[1].setComponents(l+a,d+u,g+h,E+p).normalize(),r[2].setComponents(l+s,d+c,g+v,E+x).normalize(),r[3].setComponents(l-s,d-c,g-v,E-x).normalize(),r[4].setComponents(l-o,d-f,g-m,E-y).normalize(),t===Er)r[5].setComponents(l+o,d+f,g+m,E+y).normalize();else if(t===Yo)r[5].setComponents(o,f,m,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ui.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ui.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ui)}intersectsSprite(e){return ui.center.set(0,0,0),ui.radius=.7071067811865476,ui.applyMatrix4(e.matrixWorld),this.intersectsSphere(ui)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(so.x=i.normal.x>0?e.max.x:e.min.x,so.y=i.normal.y>0?e.max.y:e.min.y,so.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(so)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class oo extends wn{constructor(){super(),this.isGroup=!0,this.type="Group"}}class Gm extends pn{constructor(e,t,r,i,a,s,o,l,u){super(e,t,r,i,a,s,o,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class rp extends pn{constructor(e,t,r,i,a,s,o,l,u,c=pa){if(c!==pa&&c!==Sa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&c===pa&&(r=Si),r===void 0&&c===Sa&&(r=Ta),super(null,i,a,s,o,l,c,r,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:qn,this.minFilter=l!==void 0?l:qn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Ls extends Ii{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const a=e/2,s=t/2,o=Math.floor(r),l=Math.floor(i),u=o+1,c=l+1,f=e/o,d=t/l,h=[],v=[],m=[],g=[];for(let p=0;p<c;p++){const x=p*d-s;for(let y=0;y<u;y++){const E=y*f-a;v.push(E,-x,0),m.push(0,0,1),g.push(y/o),g.push(1-p/l)}}for(let p=0;p<l;p++)for(let x=0;x<o;x++){const y=x+u*p,E=x+u*(p+1),M=x+1+u*(p+1),w=x+1+u*p;h.push(y,E,w),h.push(E,M,w)}this.setIndex(h),this.setAttribute("position",new Ti(v,3)),this.setAttribute("normal",new Ti(m,3)),this.setAttribute("uv",new Ti(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ls(e.width,e.height,e.widthSegments,e.heightSegments)}}class Vm extends ol{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Bg,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Hm extends ol{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class ip extends ep{constructor(e=-1,t=1,r=1,i=-1,a=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=a,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,a,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let a=r-e,s=r+e,o=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=u*this.view.offsetX,s=a+u*this.view.width,o-=c*this.view.offsetY,l=o-c*this.view.height}this.projectionMatrix.makeOrthographic(a,s,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class Wm extends Vn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Pf{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=lt(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(lt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Xm extends Ni{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function Nf(n,e,t,r){const i=Ym(r);switch(t){case Ud:return n*e;case kd:return n*e;case zd:return n*e*2;case Gd:return n*e/i.components*i.byteLength;case wc:return n*e/i.components*i.byteLength;case Vd:return n*e*2/i.components*i.byteLength;case Ac:return n*e*2/i.components*i.byteLength;case Bd:return n*e*3/i.components*i.byteLength;case Yn:return n*e*4/i.components*i.byteLength;case Cc:return n*e*4/i.components*i.byteLength;case Ao:case Co:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Ro:case Do:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Lu:case Nu:return Math.max(n,16)*Math.max(e,8)/4;case Du:case Pu:return Math.max(n,8)*Math.max(e,8)/2;case Iu:case Ou:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Fu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Uu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Bu:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case ku:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case zu:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case Gu:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case Vu:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Hu:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case Wu:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case Xu:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case Yu:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case qu:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case Ku:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case $u:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case Zu:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Lo:case Qu:case Ju:return Math.ceil(n/4)*Math.ceil(e/4)*16;case Hd:case ju:return Math.ceil(n/4)*Math.ceil(e/4)*8;case ec:case tc:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Ym(n){switch(n){case br:case Id:return{byteLength:1,components:1};case ps:case Od:case Cs:return{byteLength:2,components:1};case Sc:case Mc:return{byteLength:2,components:4};case Si:case Tc:case xr:return{byteLength:4,components:1};case Fd:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:bc}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=bc);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function ap(){let n=null,e=!1,t=null,r=null;function i(a,s){t(a,s),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(a){t=a},setContext:function(a){n=a}}}function qm(n){const e=new WeakMap;function t(o,l){const u=o.array,c=o.usage,f=u.byteLength,d=n.createBuffer();n.bindBuffer(l,d),n.bufferData(l,u,c),o.onUploadCallback();let h;if(u instanceof Float32Array)h=n.FLOAT;else if(u instanceof Uint16Array)o.isFloat16BufferAttribute?h=n.HALF_FLOAT:h=n.UNSIGNED_SHORT;else if(u instanceof Int16Array)h=n.SHORT;else if(u instanceof Uint32Array)h=n.UNSIGNED_INT;else if(u instanceof Int32Array)h=n.INT;else if(u instanceof Int8Array)h=n.BYTE;else if(u instanceof Uint8Array)h=n.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)h=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:d,type:h,bytesPerElement:u.BYTES_PER_ELEMENT,version:o.version,size:f}}function r(o,l,u){const c=l.array,f=l.updateRanges;if(n.bindBuffer(u,o),f.length===0)n.bufferSubData(u,0,c);else{f.sort((h,v)=>h.start-v.start);let d=0;for(let h=1;h<f.length;h++){const v=f[d],m=f[h];m.start<=v.start+v.count+1?v.count=Math.max(v.count,m.start+m.count-v.start):(++d,f[d]=m)}f.length=d+1;for(let h=0,v=f.length;h<v;h++){const m=f[h];n.bufferSubData(u,m.start*c.BYTES_PER_ELEMENT,c,m.start,m.count)}l.clearUpdateRanges()}l.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function a(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(n.deleteBuffer(l.buffer),e.delete(o))}function s(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const c=e.get(o);(!c||c.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const u=e.get(o);if(u===void 0)e.set(o,t(o,l));else if(u.version<o.version){if(u.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(u.buffer,o,l),u.version=o.version}}return{get:i,remove:a,update:s}}var Km=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,$m=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Zm=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Qm=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Jm=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,jm=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ey=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ty=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ny=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,ry=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,iy=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,ay=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,sy=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,oy=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,ly=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,uy=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,cy=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,fy=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,hy=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,dy=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,py=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,vy=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,gy=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,my=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,yy=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,xy=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Ey=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,_y=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,by=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ty=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Sy="gl_FragColor = linearToOutputTexel( gl_FragColor );",My=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,wy=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Ay=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Cy=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ry=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Dy=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Ly=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Py=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ny=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Iy=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Oy=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Fy=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Uy=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,By=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,ky=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,zy=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Gy=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Vy=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Hy=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Wy=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Xy=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Yy=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,qy=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Ky=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,$y=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Zy=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Qy=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Jy=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,jy=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,e0=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,t0=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,n0=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,r0=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,i0=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,a0=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,s0=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,o0=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,l0=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,u0=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,c0=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,f0=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,h0=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,d0=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,p0=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,v0=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,g0=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,m0=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,y0=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,x0=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,E0=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,_0=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,b0=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,T0=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,S0=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,M0=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,w0=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,A0=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,C0=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,R0=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,D0=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,L0=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,P0=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,N0=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,I0=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,O0=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,F0=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,U0=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,B0=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,k0=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,z0=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,G0=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,V0=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,H0=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,W0=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,X0=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Y0=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const q0=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,K0=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,$0=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Z0=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Q0=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,J0=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,j0=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,ex=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,tx=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,nx=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,rx=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,ix=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ax=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sx=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ox=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,lx=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ux=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,cx=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fx=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,hx=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dx=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,px=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vx=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gx=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mx=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,yx=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xx=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ex=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_x=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,bx=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Tx=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Sx=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Mx=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,wx=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,rt={alphahash_fragment:Km,alphahash_pars_fragment:$m,alphamap_fragment:Zm,alphamap_pars_fragment:Qm,alphatest_fragment:Jm,alphatest_pars_fragment:jm,aomap_fragment:ey,aomap_pars_fragment:ty,batching_pars_vertex:ny,batching_vertex:ry,begin_vertex:iy,beginnormal_vertex:ay,bsdfs:sy,iridescence_fragment:oy,bumpmap_pars_fragment:ly,clipping_planes_fragment:uy,clipping_planes_pars_fragment:cy,clipping_planes_pars_vertex:fy,clipping_planes_vertex:hy,color_fragment:dy,color_pars_fragment:py,color_pars_vertex:vy,color_vertex:gy,common:my,cube_uv_reflection_fragment:yy,defaultnormal_vertex:xy,displacementmap_pars_vertex:Ey,displacementmap_vertex:_y,emissivemap_fragment:by,emissivemap_pars_fragment:Ty,colorspace_fragment:Sy,colorspace_pars_fragment:My,envmap_fragment:wy,envmap_common_pars_fragment:Ay,envmap_pars_fragment:Cy,envmap_pars_vertex:Ry,envmap_physical_pars_fragment:zy,envmap_vertex:Dy,fog_vertex:Ly,fog_pars_vertex:Py,fog_fragment:Ny,fog_pars_fragment:Iy,gradientmap_pars_fragment:Oy,lightmap_pars_fragment:Fy,lights_lambert_fragment:Uy,lights_lambert_pars_fragment:By,lights_pars_begin:ky,lights_toon_fragment:Gy,lights_toon_pars_fragment:Vy,lights_phong_fragment:Hy,lights_phong_pars_fragment:Wy,lights_physical_fragment:Xy,lights_physical_pars_fragment:Yy,lights_fragment_begin:qy,lights_fragment_maps:Ky,lights_fragment_end:$y,logdepthbuf_fragment:Zy,logdepthbuf_pars_fragment:Qy,logdepthbuf_pars_vertex:Jy,logdepthbuf_vertex:jy,map_fragment:e0,map_pars_fragment:t0,map_particle_fragment:n0,map_particle_pars_fragment:r0,metalnessmap_fragment:i0,metalnessmap_pars_fragment:a0,morphinstance_vertex:s0,morphcolor_vertex:o0,morphnormal_vertex:l0,morphtarget_pars_vertex:u0,morphtarget_vertex:c0,normal_fragment_begin:f0,normal_fragment_maps:h0,normal_pars_fragment:d0,normal_pars_vertex:p0,normal_vertex:v0,normalmap_pars_fragment:g0,clearcoat_normal_fragment_begin:m0,clearcoat_normal_fragment_maps:y0,clearcoat_pars_fragment:x0,iridescence_pars_fragment:E0,opaque_fragment:_0,packing:b0,premultiplied_alpha_fragment:T0,project_vertex:S0,dithering_fragment:M0,dithering_pars_fragment:w0,roughnessmap_fragment:A0,roughnessmap_pars_fragment:C0,shadowmap_pars_fragment:R0,shadowmap_pars_vertex:D0,shadowmap_vertex:L0,shadowmask_pars_fragment:P0,skinbase_vertex:N0,skinning_pars_vertex:I0,skinning_vertex:O0,skinnormal_vertex:F0,specularmap_fragment:U0,specularmap_pars_fragment:B0,tonemapping_fragment:k0,tonemapping_pars_fragment:z0,transmission_fragment:G0,transmission_pars_fragment:V0,uv_pars_fragment:H0,uv_pars_vertex:W0,uv_vertex:X0,worldpos_vertex:Y0,background_vert:q0,background_frag:K0,backgroundCube_vert:$0,backgroundCube_frag:Z0,cube_vert:Q0,cube_frag:J0,depth_vert:j0,depth_frag:ex,distanceRGBA_vert:tx,distanceRGBA_frag:nx,equirect_vert:rx,equirect_frag:ix,linedashed_vert:ax,linedashed_frag:sx,meshbasic_vert:ox,meshbasic_frag:lx,meshlambert_vert:ux,meshlambert_frag:cx,meshmatcap_vert:fx,meshmatcap_frag:hx,meshnormal_vert:dx,meshnormal_frag:px,meshphong_vert:vx,meshphong_frag:gx,meshphysical_vert:mx,meshphysical_frag:yx,meshtoon_vert:xx,meshtoon_frag:Ex,points_vert:_x,points_frag:bx,shadow_vert:Tx,shadow_frag:Sx,sprite_vert:Mx,sprite_frag:wx},Ve={common:{diffuse:{value:new St(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new nt},alphaMap:{value:null},alphaMapTransform:{value:new nt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new nt}},envmap:{envMap:{value:null},envMapRotation:{value:new nt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new nt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new nt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new nt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new nt},normalScale:{value:new ot(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new nt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new nt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new nt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new nt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new St(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new St(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new nt},alphaTest:{value:0},uvTransform:{value:new nt}},sprite:{diffuse:{value:new St(16777215)},opacity:{value:1},center:{value:new ot(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new nt},alphaMap:{value:null},alphaMapTransform:{value:new nt},alphaTest:{value:0}}},tr={basic:{uniforms:hn([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.fog]),vertexShader:rt.meshbasic_vert,fragmentShader:rt.meshbasic_frag},lambert:{uniforms:hn([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,Ve.lights,{emissive:{value:new St(0)}}]),vertexShader:rt.meshlambert_vert,fragmentShader:rt.meshlambert_frag},phong:{uniforms:hn([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,Ve.lights,{emissive:{value:new St(0)},specular:{value:new St(1118481)},shininess:{value:30}}]),vertexShader:rt.meshphong_vert,fragmentShader:rt.meshphong_frag},standard:{uniforms:hn([Ve.common,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.roughnessmap,Ve.metalnessmap,Ve.fog,Ve.lights,{emissive:{value:new St(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:rt.meshphysical_vert,fragmentShader:rt.meshphysical_frag},toon:{uniforms:hn([Ve.common,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.gradientmap,Ve.fog,Ve.lights,{emissive:{value:new St(0)}}]),vertexShader:rt.meshtoon_vert,fragmentShader:rt.meshtoon_frag},matcap:{uniforms:hn([Ve.common,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,{matcap:{value:null}}]),vertexShader:rt.meshmatcap_vert,fragmentShader:rt.meshmatcap_frag},points:{uniforms:hn([Ve.points,Ve.fog]),vertexShader:rt.points_vert,fragmentShader:rt.points_frag},dashed:{uniforms:hn([Ve.common,Ve.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:rt.linedashed_vert,fragmentShader:rt.linedashed_frag},depth:{uniforms:hn([Ve.common,Ve.displacementmap]),vertexShader:rt.depth_vert,fragmentShader:rt.depth_frag},normal:{uniforms:hn([Ve.common,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,{opacity:{value:1}}]),vertexShader:rt.meshnormal_vert,fragmentShader:rt.meshnormal_frag},sprite:{uniforms:hn([Ve.sprite,Ve.fog]),vertexShader:rt.sprite_vert,fragmentShader:rt.sprite_frag},background:{uniforms:{uvTransform:{value:new nt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:rt.background_vert,fragmentShader:rt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new nt}},vertexShader:rt.backgroundCube_vert,fragmentShader:rt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:rt.cube_vert,fragmentShader:rt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:rt.equirect_vert,fragmentShader:rt.equirect_frag},distanceRGBA:{uniforms:hn([Ve.common,Ve.displacementmap,{referencePosition:{value:new Te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:rt.distanceRGBA_vert,fragmentShader:rt.distanceRGBA_frag},shadow:{uniforms:hn([Ve.lights,Ve.fog,{color:{value:new St(0)},opacity:{value:1}}]),vertexShader:rt.shadow_vert,fragmentShader:rt.shadow_frag}};tr.physical={uniforms:hn([tr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new nt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new nt},clearcoatNormalScale:{value:new ot(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new nt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new nt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new nt},sheen:{value:0},sheenColor:{value:new St(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new nt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new nt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new nt},transmissionSamplerSize:{value:new ot},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new nt},attenuationDistance:{value:0},attenuationColor:{value:new St(0)},specularColor:{value:new St(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new nt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new nt},anisotropyVector:{value:new ot},anisotropyMap:{value:null},anisotropyMapTransform:{value:new nt}}]),vertexShader:rt.meshphysical_vert,fragmentShader:rt.meshphysical_frag};const lo={r:0,b:0,g:0},ci=new Tr,Ax=new Bt;function Cx(n,e,t,r,i,a,s){const o=new St(0);let l=a===!0?0:1,u,c,f=null,d=0,h=null;function v(y){let E=y.isScene===!0?y.background:null;return E&&E.isTexture&&(E=(y.backgroundBlurriness>0?t:e).get(E)),E}function m(y){let E=!1;const M=v(y);M===null?p(o,l):M&&M.isColor&&(p(M,1),E=!0);const w=n.xr.getEnvironmentBlendMode();w==="additive"?r.buffers.color.setClear(0,0,0,1,s):w==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,s),(n.autoClear||E)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function g(y,E){const M=v(E);M&&(M.isCubeTexture||M.mapping===sl)?(c===void 0&&(c=new rr(new Ds(1,1,1),new qr({name:"BackgroundCubeMaterial",uniforms:wa(tr.backgroundCube.uniforms),vertexShader:tr.backgroundCube.vertexShader,fragmentShader:tr.backgroundCube.fragmentShader,side:xn,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(w,b,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),ci.copy(E.backgroundRotation),ci.x*=-1,ci.y*=-1,ci.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(ci.y*=-1,ci.z*=-1),c.material.uniforms.envMap.value=M,c.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Ax.makeRotationFromEuler(ci)),c.material.toneMapped=gt.getTransfer(M.colorSpace)!==bt,(f!==M||d!==M.version||h!==n.toneMapping)&&(c.material.needsUpdate=!0,f=M,d=M.version,h=n.toneMapping),c.layers.enableAll(),y.unshift(c,c.geometry,c.material,0,0,null)):M&&M.isTexture&&(u===void 0&&(u=new rr(new Ls(2,2),new qr({name:"BackgroundMaterial",uniforms:wa(tr.background.uniforms),vertexShader:tr.background.vertexShader,fragmentShader:tr.background.fragmentShader,side:Yr,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=M,u.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,u.material.toneMapped=gt.getTransfer(M.colorSpace)!==bt,M.matrixAutoUpdate===!0&&M.updateMatrix(),u.material.uniforms.uvTransform.value.copy(M.matrix),(f!==M||d!==M.version||h!==n.toneMapping)&&(u.material.needsUpdate=!0,f=M,d=M.version,h=n.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null))}function p(y,E){y.getRGB(lo,jd(n)),r.buffers.color.setClear(lo.r,lo.g,lo.b,E,s)}function x(){c!==void 0&&(c.geometry.dispose(),c.material.dispose()),u!==void 0&&(u.geometry.dispose(),u.material.dispose())}return{getClearColor:function(){return o},setClearColor:function(y,E=1){o.set(y),l=E,p(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(y){l=y,p(o,l)},render:m,addToRenderList:g,dispose:x}}function Rx(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=d(null);let a=i,s=!1;function o(S,L,N,I,_){let P=!1;const A=f(I,N,L);a!==A&&(a=A,u(a.object)),P=h(S,I,N,_),P&&v(S,I,N,_),_!==null&&e.update(_,n.ELEMENT_ARRAY_BUFFER),(P||s)&&(s=!1,E(S,L,N,I),_!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(_).buffer))}function l(){return n.createVertexArray()}function u(S){return n.bindVertexArray(S)}function c(S){return n.deleteVertexArray(S)}function f(S,L,N){const I=N.wireframe===!0;let _=r[S.id];_===void 0&&(_={},r[S.id]=_);let P=_[L.id];P===void 0&&(P={},_[L.id]=P);let A=P[I];return A===void 0&&(A=d(l()),P[I]=A),A}function d(S){const L=[],N=[],I=[];for(let _=0;_<t;_++)L[_]=0,N[_]=0,I[_]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:N,attributeDivisors:I,object:S,attributes:{},index:null}}function h(S,L,N,I){const _=a.attributes,P=L.attributes;let A=0;const D=N.getAttributes();for(const R in D)if(D[R].location>=0){const k=_[R];let V=P[R];if(V===void 0&&(R==="instanceMatrix"&&S.instanceMatrix&&(V=S.instanceMatrix),R==="instanceColor"&&S.instanceColor&&(V=S.instanceColor)),k===void 0||k.attribute!==V||V&&k.data!==V.data)return!0;A++}return a.attributesNum!==A||a.index!==I}function v(S,L,N,I){const _={},P=L.attributes;let A=0;const D=N.getAttributes();for(const R in D)if(D[R].location>=0){let k=P[R];k===void 0&&(R==="instanceMatrix"&&S.instanceMatrix&&(k=S.instanceMatrix),R==="instanceColor"&&S.instanceColor&&(k=S.instanceColor));const V={};V.attribute=k,k&&k.data&&(V.data=k.data),_[R]=V,A++}a.attributes=_,a.attributesNum=A,a.index=I}function m(){const S=a.newAttributes;for(let L=0,N=S.length;L<N;L++)S[L]=0}function g(S){p(S,0)}function p(S,L){const N=a.newAttributes,I=a.enabledAttributes,_=a.attributeDivisors;N[S]=1,I[S]===0&&(n.enableVertexAttribArray(S),I[S]=1),_[S]!==L&&(n.vertexAttribDivisor(S,L),_[S]=L)}function x(){const S=a.newAttributes,L=a.enabledAttributes;for(let N=0,I=L.length;N<I;N++)L[N]!==S[N]&&(n.disableVertexAttribArray(N),L[N]=0)}function y(S,L,N,I,_,P,A){A===!0?n.vertexAttribIPointer(S,L,N,_,P):n.vertexAttribPointer(S,L,N,I,_,P)}function E(S,L,N,I){m();const _=I.attributes,P=N.getAttributes(),A=L.defaultAttributeValues;for(const D in P){const R=P[D];if(R.location>=0){let B=_[D];if(B===void 0&&(D==="instanceMatrix"&&S.instanceMatrix&&(B=S.instanceMatrix),D==="instanceColor"&&S.instanceColor&&(B=S.instanceColor)),B!==void 0){const k=B.normalized,V=B.itemSize,Y=e.get(B);if(Y===void 0)continue;const Z=Y.buffer,W=Y.type,K=Y.bytesPerElement,Q=W===n.INT||W===n.UNSIGNED_INT||B.gpuType===Tc;if(B.isInterleavedBufferAttribute){const ne=B.data,ie=ne.stride,H=B.offset;if(ne.isInstancedInterleavedBuffer){for(let X=0;X<R.locationSize;X++)p(R.location+X,ne.meshPerAttribute);S.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=ne.meshPerAttribute*ne.count)}else for(let X=0;X<R.locationSize;X++)g(R.location+X);n.bindBuffer(n.ARRAY_BUFFER,Z);for(let X=0;X<R.locationSize;X++)y(R.location+X,V/R.locationSize,W,k,ie*K,(H+V/R.locationSize*X)*K,Q)}else{if(B.isInstancedBufferAttribute){for(let ne=0;ne<R.locationSize;ne++)p(R.location+ne,B.meshPerAttribute);S.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=B.meshPerAttribute*B.count)}else for(let ne=0;ne<R.locationSize;ne++)g(R.location+ne);n.bindBuffer(n.ARRAY_BUFFER,Z);for(let ne=0;ne<R.locationSize;ne++)y(R.location+ne,V/R.locationSize,W,k,V*K,V/R.locationSize*ne*K,Q)}}else if(A!==void 0){const k=A[D];if(k!==void 0)switch(k.length){case 2:n.vertexAttrib2fv(R.location,k);break;case 3:n.vertexAttrib3fv(R.location,k);break;case 4:n.vertexAttrib4fv(R.location,k);break;default:n.vertexAttrib1fv(R.location,k)}}}}x()}function M(){C();for(const S in r){const L=r[S];for(const N in L){const I=L[N];for(const _ in I)c(I[_].object),delete I[_];delete L[N]}delete r[S]}}function w(S){if(r[S.id]===void 0)return;const L=r[S.id];for(const N in L){const I=L[N];for(const _ in I)c(I[_].object),delete I[_];delete L[N]}delete r[S.id]}function b(S){for(const L in r){const N=r[L];if(N[S.id]===void 0)continue;const I=N[S.id];for(const _ in I)c(I[_].object),delete I[_];delete N[S.id]}}function C(){T(),s=!0,a!==i&&(a=i,u(a.object))}function T(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:C,resetDefaultState:T,dispose:M,releaseStatesOfGeometry:w,releaseStatesOfProgram:b,initAttributes:m,enableAttribute:g,disableUnusedAttributes:x}}function Dx(n,e,t){let r;function i(u){r=u}function a(u,c){n.drawArrays(r,u,c),t.update(c,r,1)}function s(u,c,f){f!==0&&(n.drawArraysInstanced(r,u,c,f),t.update(c,r,f))}function o(u,c,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,u,0,c,0,f);let h=0;for(let v=0;v<f;v++)h+=c[v];t.update(h,r,1)}function l(u,c,f,d){if(f===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let v=0;v<u.length;v++)s(u[v],c[v],d[v]);else{h.multiDrawArraysInstancedWEBGL(r,u,0,c,0,d,0,f);let v=0;for(let m=0;m<f;m++)v+=c[m]*d[m];t.update(v,r,1)}}this.setMode=i,this.render=a,this.renderInstances=s,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function Lx(n,e,t,r){let i;function a(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const b=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(b){return!(b!==Yn&&r.convert(b)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(b){const C=b===Cs&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(b!==br&&r.convert(b)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&b!==xr&&!C)}function l(b){if(b==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";b="mediump"}return b==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const c=l(u);c!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",c,"instead."),u=c);const f=t.logarithmicDepthBuffer===!0,d=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),h=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),v=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),p=n.getParameter(n.MAX_VERTEX_ATTRIBS),x=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),y=n.getParameter(n.MAX_VARYING_VECTORS),E=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),M=v>0,w=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:a,getMaxPrecision:l,textureFormatReadable:s,textureTypeReadable:o,precision:u,logarithmicDepthBuffer:f,reverseDepthBuffer:d,maxTextures:h,maxVertexTextures:v,maxTextureSize:m,maxCubemapSize:g,maxAttributes:p,maxVertexUniforms:x,maxVaryings:y,maxFragmentUniforms:E,vertexTextures:M,maxSamples:w}}function Px(n){const e=this;let t=null,r=0,i=!1,a=!1;const s=new Br,o=new nt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,d){const h=f.length!==0||d||r!==0||i;return i=d,r=f.length,h},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(f,d){t=c(f,d,0)},this.setState=function(f,d,h){const v=f.clippingPlanes,m=f.clipIntersection,g=f.clipShadows,p=n.get(f);if(!i||v===null||v.length===0||a&&!g)a?c(null):u();else{const x=a?0:r,y=x*4;let E=p.clippingState||null;l.value=E,E=c(v,d,y,h);for(let M=0;M!==y;++M)E[M]=t[M];p.clippingState=E,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=x}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(f,d,h,v){const m=f!==null?f.length:0;let g=null;if(m!==0){if(g=l.value,v!==!0||g===null){const p=h+m*4,x=d.matrixWorldInverse;o.getNormalMatrix(x),(g===null||g.length<p)&&(g=new Float32Array(p));for(let y=0,E=h;y!==m;++y,E+=4)s.copy(f[y]).applyMatrix4(x,o),s.normal.toArray(g,E),g[E+3]=s.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,g}}function Nx(n){let e=new WeakMap;function t(s,o){return o===wu?s.mapping=_a:o===Au&&(s.mapping=ba),s}function r(s){if(s&&s.isTexture){const o=s.mapping;if(o===wu||o===Au)if(e.has(s)){const l=e.get(s).texture;return t(l,s.mapping)}else{const l=s.image;if(l&&l.height>0){const u=new Um(l.height);return u.fromEquirectangularTexture(n,s),e.set(s,u),s.addEventListener("dispose",i),t(u.texture,s.mapping)}else return null}}return s}function i(s){const o=s.target;o.removeEventListener("dispose",i);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function a(){e=new WeakMap}return{get:r,dispose:a}}const la=4,If=[.125,.215,.35,.446,.526,.582],yi=20,Kl=new ip,Of=new St;let $l=null,Zl=0,Ql=0,Jl=!1;const di=(1+Math.sqrt(5))/2,Ji=1/di,Ff=[new Te(-di,Ji,0),new Te(di,Ji,0),new Te(-Ji,0,di),new Te(Ji,0,di),new Te(0,di,-Ji),new Te(0,di,Ji),new Te(-1,1,-1),new Te(1,1,-1),new Te(-1,1,1),new Te(1,1,1)];class Uf{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){$l=this._renderer.getRenderTarget(),Zl=this._renderer.getActiveCubeFace(),Ql=this._renderer.getActiveMipmapLevel(),Jl=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,r,i,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=zf(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=kf(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget($l,Zl,Ql),this._renderer.xr.enabled=Jl,e.scissorTest=!1,uo(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===_a||e.mapping===ba?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),$l=this._renderer.getRenderTarget(),Zl=this._renderer.getActiveCubeFace(),Ql=this._renderer.getActiveMipmapLevel(),Jl=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Xn,minFilter:Xn,generateMipmaps:!1,type:Cs,format:Yn,colorSpace:Ma,depthBuffer:!1},i=Bf(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Bf(e,t,r);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Ix(a)),this._blurMaterial=Ox(a,e,t)}return i}_compileMaterial(e){const t=new rr(this._lodPlanes[0],e);this._renderer.compile(t,Kl)}_sceneToCubeUV(e,t,r,i){const o=new Vn(90,1,t,r),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],c=this._renderer,f=c.autoClear,d=c.toneMapping;c.getClearColor(Of),c.toneMapping=Hr,c.autoClear=!1;const h=new Lc({name:"PMREM.Background",side:xn,depthWrite:!1,depthTest:!1}),v=new rr(new Ds,h);let m=!1;const g=e.background;g?g.isColor&&(h.color.copy(g),e.background=null,m=!0):(h.color.copy(Of),m=!0);for(let p=0;p<6;p++){const x=p%3;x===0?(o.up.set(0,l[p],0),o.lookAt(u[p],0,0)):x===1?(o.up.set(0,0,l[p]),o.lookAt(0,u[p],0)):(o.up.set(0,l[p],0),o.lookAt(0,0,u[p]));const y=this._cubeSize;uo(i,x*y,p>2?y:0,y,y),c.setRenderTarget(i),m&&c.render(v,o),c.render(e,o)}v.geometry.dispose(),v.material.dispose(),c.toneMapping=d,c.autoClear=f,e.background=g}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===_a||e.mapping===ba;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=zf()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=kf());const a=i?this._cubemapMaterial:this._equirectMaterial,s=new rr(this._lodPlanes[0],a),o=a.uniforms;o.envMap.value=e;const l=this._cubeSize;uo(t,0,0,3*l,2*l),r.setRenderTarget(t),r.render(s,Kl)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let a=1;a<i;a++){const s=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),o=Ff[(i-a-1)%Ff.length];this._blur(e,a-1,a,s,o)}t.autoClear=r}_blur(e,t,r,i,a){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,i,"latitudinal",a),this._halfBlur(s,e,r,r,i,"longitudinal",a)}_halfBlur(e,t,r,i,a,s,o){const l=this._renderer,u=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,f=new rr(this._lodPlanes[i],u),d=u.uniforms,h=this._sizeLods[r]-1,v=isFinite(a)?Math.PI/(2*h):2*Math.PI/(2*yi-1),m=a/v,g=isFinite(a)?1+Math.floor(c*m):yi;g>yi&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${yi}`);const p=[];let x=0;for(let b=0;b<yi;++b){const C=b/m,T=Math.exp(-C*C/2);p.push(T),b===0?x+=T:b<g&&(x+=2*T)}for(let b=0;b<p.length;b++)p[b]=p[b]/x;d.envMap.value=e.texture,d.samples.value=g,d.weights.value=p,d.latitudinal.value=s==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:y}=this;d.dTheta.value=v,d.mipInt.value=y-r;const E=this._sizeLods[i],M=3*E*(i>y-la?i-y+la:0),w=4*(this._cubeSize-E);uo(t,M,w,3*E,2*E),l.setRenderTarget(t),l.render(f,Kl)}}function Ix(n){const e=[],t=[],r=[];let i=n;const a=n-la+1+If.length;for(let s=0;s<a;s++){const o=Math.pow(2,i);t.push(o);let l=1/o;s>n-la?l=If[s-n+la-1]:s===0&&(l=0),r.push(l);const u=1/(o-2),c=-u,f=1+u,d=[c,c,f,c,f,f,c,c,f,f,c,f],h=6,v=6,m=3,g=2,p=1,x=new Float32Array(m*v*h),y=new Float32Array(g*v*h),E=new Float32Array(p*v*h);for(let w=0;w<h;w++){const b=w%3*2/3-1,C=w>2?0:-1,T=[b,C,0,b+2/3,C,0,b+2/3,C+1,0,b,C,0,b+2/3,C+1,0,b,C+1,0];x.set(T,m*v*w),y.set(d,g*v*w);const S=[w,w,w,w,w,w];E.set(S,p*v*w)}const M=new Ii;M.setAttribute("position",new sr(x,m)),M.setAttribute("uv",new sr(y,g)),M.setAttribute("faceIndex",new sr(E,p)),e.push(M),i>la&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function Bf(n,e,t){const r=new Mi(n,e,t);return r.texture.mapping=sl,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function uo(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function Ox(n,e,t){const r=new Float32Array(yi),i=new Te(0,1,0);return new qr({name:"SphericalGaussianBlur",defines:{n:yi,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Pc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Vr,depthTest:!1,depthWrite:!1})}function kf(){return new qr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Pc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Vr,depthTest:!1,depthWrite:!1})}function zf(){return new qr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Pc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Vr,depthTest:!1,depthWrite:!1})}function Pc(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Fx(n){let e=new WeakMap,t=null;function r(o){if(o&&o.isTexture){const l=o.mapping,u=l===wu||l===Au,c=l===_a||l===ba;if(u||c){let f=e.get(o);const d=f!==void 0?f.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return t===null&&(t=new Uf(n)),f=u?t.fromEquirectangular(o,f):t.fromCubemap(o,f),f.texture.pmremVersion=o.pmremVersion,e.set(o,f),f.texture;if(f!==void 0)return f.texture;{const h=o.image;return u&&h&&h.height>0||c&&h&&i(h)?(t===null&&(t=new Uf(n)),f=u?t.fromEquirectangular(o):t.fromCubemap(o),f.texture.pmremVersion=o.pmremVersion,e.set(o,f),o.addEventListener("dispose",a),f.texture):null}}}return o}function i(o){let l=0;const u=6;for(let c=0;c<u;c++)o[c]!==void 0&&l++;return l===u}function a(o){const l=o.target;l.removeEventListener("dispose",a);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:s}}function Ux(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&sa("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Bx(n,e,t,r){const i={},a=new WeakMap;function s(f){const d=f.target;d.index!==null&&e.remove(d.index);for(const v in d.attributes)e.remove(d.attributes[v]);d.removeEventListener("dispose",s),delete i[d.id];const h=a.get(d);h&&(e.remove(h),a.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function o(f,d){return i[d.id]===!0||(d.addEventListener("dispose",s),i[d.id]=!0,t.memory.geometries++),d}function l(f){const d=f.attributes;for(const h in d)e.update(d[h],n.ARRAY_BUFFER)}function u(f){const d=[],h=f.index,v=f.attributes.position;let m=0;if(h!==null){const x=h.array;m=h.version;for(let y=0,E=x.length;y<E;y+=3){const M=x[y+0],w=x[y+1],b=x[y+2];d.push(M,w,w,b,b,M)}}else if(v!==void 0){const x=v.array;m=v.version;for(let y=0,E=x.length/3-1;y<E;y+=3){const M=y+0,w=y+1,b=y+2;d.push(M,w,w,b,b,M)}}else return;const g=new(Xd(d)?Jd:Qd)(d,1);g.version=m;const p=a.get(f);p&&e.remove(p),a.set(f,g)}function c(f){const d=a.get(f);if(d){const h=f.index;h!==null&&d.version<h.version&&u(f)}else u(f);return a.get(f)}return{get:o,update:l,getWireframeAttribute:c}}function kx(n,e,t){let r;function i(d){r=d}let a,s;function o(d){a=d.type,s=d.bytesPerElement}function l(d,h){n.drawElements(r,h,a,d*s),t.update(h,r,1)}function u(d,h,v){v!==0&&(n.drawElementsInstanced(r,h,a,d*s,v),t.update(h,r,v))}function c(d,h,v){if(v===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,h,0,a,d,0,v);let g=0;for(let p=0;p<v;p++)g+=h[p];t.update(g,r,1)}function f(d,h,v,m){if(v===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let p=0;p<d.length;p++)u(d[p]/s,h[p],m[p]);else{g.multiDrawElementsInstancedWEBGL(r,h,0,a,d,0,m,0,v);let p=0;for(let x=0;x<v;x++)p+=h[x]*m[x];t.update(p,r,1)}}this.setMode=i,this.setIndex=o,this.render=l,this.renderInstances=u,this.renderMultiDraw=c,this.renderMultiDrawInstances=f}function zx(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(a,s,o){switch(t.calls++,s){case n.TRIANGLES:t.triangles+=o*(a/3);break;case n.LINES:t.lines+=o*(a/2);break;case n.LINE_STRIP:t.lines+=o*(a-1);break;case n.LINE_LOOP:t.lines+=o*a;break;case n.POINTS:t.points+=o*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function Gx(n,e,t){const r=new WeakMap,i=new Ft;function a(s,o,l){const u=s.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,f=c!==void 0?c.length:0;let d=r.get(o);if(d===void 0||d.count!==f){let S=function(){C.dispose(),r.delete(o),o.removeEventListener("dispose",S)};var h=S;d!==void 0&&d.texture.dispose();const v=o.morphAttributes.position!==void 0,m=o.morphAttributes.normal!==void 0,g=o.morphAttributes.color!==void 0,p=o.morphAttributes.position||[],x=o.morphAttributes.normal||[],y=o.morphAttributes.color||[];let E=0;v===!0&&(E=1),m===!0&&(E=2),g===!0&&(E=3);let M=o.attributes.position.count*E,w=1;M>e.maxTextureSize&&(w=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const b=new Float32Array(M*w*4*f),C=new qd(b,M,w,f);C.type=xr,C.needsUpdate=!0;const T=E*4;for(let L=0;L<f;L++){const N=p[L],I=x[L],_=y[L],P=M*w*4*L;for(let A=0;A<N.count;A++){const D=A*T;v===!0&&(i.fromBufferAttribute(N,A),b[P+D+0]=i.x,b[P+D+1]=i.y,b[P+D+2]=i.z,b[P+D+3]=0),m===!0&&(i.fromBufferAttribute(I,A),b[P+D+4]=i.x,b[P+D+5]=i.y,b[P+D+6]=i.z,b[P+D+7]=0),g===!0&&(i.fromBufferAttribute(_,A),b[P+D+8]=i.x,b[P+D+9]=i.y,b[P+D+10]=i.z,b[P+D+11]=_.itemSize===4?i.w:1)}}d={count:f,texture:C,size:new ot(M,w)},r.set(o,d),o.addEventListener("dispose",S)}if(s.isInstancedMesh===!0&&s.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",s.morphTexture,t);else{let v=0;for(let g=0;g<u.length;g++)v+=u[g];const m=o.morphTargetsRelative?1:1-v;l.getUniforms().setValue(n,"morphTargetBaseInfluence",m),l.getUniforms().setValue(n,"morphTargetInfluences",u)}l.getUniforms().setValue(n,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:a}}function Vx(n,e,t,r){let i=new WeakMap;function a(l){const u=r.render.frame,c=l.geometry,f=e.get(l,c);if(i.get(f)!==u&&(e.update(f),i.set(f,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.get(l)!==u&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),i.set(l,u))),l.isSkinnedMesh){const d=l.skeleton;i.get(d)!==u&&(d.update(),i.set(d,u))}return f}function s(){i=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:a,dispose:s}}const sp=new pn,Gf=new rp(1,1),op=new qd,lp=new _m,up=new tp,Vf=[],Hf=[],Wf=new Float32Array(16),Xf=new Float32Array(9),Yf=new Float32Array(4);function Pa(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let a=Vf[i];if(a===void 0&&(a=new Float32Array(i),Vf[i]=a),e!==0){r.toArray(a,0);for(let s=1,o=0;s!==e;++s)o+=t,n[s].toArray(a,o)}return a}function Vt(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Ht(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function ll(n,e){let t=Hf[e];t===void 0&&(t=new Int32Array(e),Hf[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function Hx(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Wx(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Vt(t,e))return;n.uniform2fv(this.addr,e),Ht(t,e)}}function Xx(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Vt(t,e))return;n.uniform3fv(this.addr,e),Ht(t,e)}}function Yx(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Vt(t,e))return;n.uniform4fv(this.addr,e),Ht(t,e)}}function qx(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Vt(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ht(t,e)}else{if(Vt(t,r))return;Yf.set(r),n.uniformMatrix2fv(this.addr,!1,Yf),Ht(t,r)}}function Kx(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Vt(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ht(t,e)}else{if(Vt(t,r))return;Xf.set(r),n.uniformMatrix3fv(this.addr,!1,Xf),Ht(t,r)}}function $x(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Vt(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ht(t,e)}else{if(Vt(t,r))return;Wf.set(r),n.uniformMatrix4fv(this.addr,!1,Wf),Ht(t,r)}}function Zx(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function Qx(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Vt(t,e))return;n.uniform2iv(this.addr,e),Ht(t,e)}}function Jx(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Vt(t,e))return;n.uniform3iv(this.addr,e),Ht(t,e)}}function jx(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Vt(t,e))return;n.uniform4iv(this.addr,e),Ht(t,e)}}function eE(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function tE(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Vt(t,e))return;n.uniform2uiv(this.addr,e),Ht(t,e)}}function nE(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Vt(t,e))return;n.uniform3uiv(this.addr,e),Ht(t,e)}}function rE(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Vt(t,e))return;n.uniform4uiv(this.addr,e),Ht(t,e)}}function iE(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let a;this.type===n.SAMPLER_2D_SHADOW?(Gf.compareFunction=Wd,a=Gf):a=sp,t.setTexture2D(e||a,i)}function aE(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||lp,i)}function sE(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||up,i)}function oE(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||op,i)}function lE(n){switch(n){case 5126:return Hx;case 35664:return Wx;case 35665:return Xx;case 35666:return Yx;case 35674:return qx;case 35675:return Kx;case 35676:return $x;case 5124:case 35670:return Zx;case 35667:case 35671:return Qx;case 35668:case 35672:return Jx;case 35669:case 35673:return jx;case 5125:return eE;case 36294:return tE;case 36295:return nE;case 36296:return rE;case 35678:case 36198:case 36298:case 36306:case 35682:return iE;case 35679:case 36299:case 36307:return aE;case 35680:case 36300:case 36308:case 36293:return sE;case 36289:case 36303:case 36311:case 36292:return oE}}function uE(n,e){n.uniform1fv(this.addr,e)}function cE(n,e){const t=Pa(e,this.size,2);n.uniform2fv(this.addr,t)}function fE(n,e){const t=Pa(e,this.size,3);n.uniform3fv(this.addr,t)}function hE(n,e){const t=Pa(e,this.size,4);n.uniform4fv(this.addr,t)}function dE(n,e){const t=Pa(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function pE(n,e){const t=Pa(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function vE(n,e){const t=Pa(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function gE(n,e){n.uniform1iv(this.addr,e)}function mE(n,e){n.uniform2iv(this.addr,e)}function yE(n,e){n.uniform3iv(this.addr,e)}function xE(n,e){n.uniform4iv(this.addr,e)}function EE(n,e){n.uniform1uiv(this.addr,e)}function _E(n,e){n.uniform2uiv(this.addr,e)}function bE(n,e){n.uniform3uiv(this.addr,e)}function TE(n,e){n.uniform4uiv(this.addr,e)}function SE(n,e,t){const r=this.cache,i=e.length,a=ll(t,i);Vt(r,a)||(n.uniform1iv(this.addr,a),Ht(r,a));for(let s=0;s!==i;++s)t.setTexture2D(e[s]||sp,a[s])}function ME(n,e,t){const r=this.cache,i=e.length,a=ll(t,i);Vt(r,a)||(n.uniform1iv(this.addr,a),Ht(r,a));for(let s=0;s!==i;++s)t.setTexture3D(e[s]||lp,a[s])}function wE(n,e,t){const r=this.cache,i=e.length,a=ll(t,i);Vt(r,a)||(n.uniform1iv(this.addr,a),Ht(r,a));for(let s=0;s!==i;++s)t.setTextureCube(e[s]||up,a[s])}function AE(n,e,t){const r=this.cache,i=e.length,a=ll(t,i);Vt(r,a)||(n.uniform1iv(this.addr,a),Ht(r,a));for(let s=0;s!==i;++s)t.setTexture2DArray(e[s]||op,a[s])}function CE(n){switch(n){case 5126:return uE;case 35664:return cE;case 35665:return fE;case 35666:return hE;case 35674:return dE;case 35675:return pE;case 35676:return vE;case 5124:case 35670:return gE;case 35667:case 35671:return mE;case 35668:case 35672:return yE;case 35669:case 35673:return xE;case 5125:return EE;case 36294:return _E;case 36295:return bE;case 36296:return TE;case 35678:case 36198:case 36298:case 36306:case 35682:return SE;case 35679:case 36299:case 36307:return ME;case 35680:case 36300:case 36308:case 36293:return wE;case 36289:case 36303:case 36311:case 36292:return AE}}class RE{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=lE(t.type)}}class DE{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=CE(t.type)}}class LE{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let a=0,s=i.length;a!==s;++a){const o=i[a];o.setValue(e,t[o.id],r)}}}const jl=/(\w+)(\])?(\[|\.)?/g;function qf(n,e){n.seq.push(e),n.map[e.id]=e}function PE(n,e,t){const r=n.name,i=r.length;for(jl.lastIndex=0;;){const a=jl.exec(r),s=jl.lastIndex;let o=a[1];const l=a[2]==="]",u=a[3];if(l&&(o=o|0),u===void 0||u==="["&&s+2===i){qf(t,u===void 0?new RE(o,n,e):new DE(o,n,e));break}else{let f=t.map[o];f===void 0&&(f=new LE(o),qf(t,f)),t=f}}}class Po{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const a=e.getActiveUniform(t,i),s=e.getUniformLocation(t,a.name);PE(a,s,this)}}setValue(e,t,r,i){const a=this.map[t];a!==void 0&&a.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let a=0,s=t.length;a!==s;++a){const o=t[a],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,a=e.length;i!==a;++i){const s=e[i];s.id in t&&r.push(s)}return r}}function Kf(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const NE=37297;let IE=0;function OE(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),a=Math.min(e+6,t.length);for(let s=i;s<a;s++){const o=s+1;r.push(`${o===e?">":" "} ${o}: ${t[s]}`)}return r.join(`
`)}const $f=new nt;function FE(n){gt._getMatrix($f,gt.workingColorSpace,n);const e=`mat3( ${$f.elements.map(t=>t.toFixed(4))} )`;switch(gt.getTransfer(n)){case Xo:return[e,"LinearTransferOETF"];case bt:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function Zf(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const s=parseInt(a[1]);return t.toUpperCase()+`

`+i+`

`+OE(n.getShaderSource(e),s)}else return i}function UE(n,e){const t=FE(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function BE(n,e){let t;switch(e){case Rg:t="Linear";break;case Dg:t="Reinhard";break;case Lg:t="Cineon";break;case Pg:t="ACESFilmic";break;case Ig:t="AgX";break;case Og:t="Neutral";break;case Ng:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const co=new Te;function kE(){gt.getLuminanceCoefficients(co);const n=co.x.toFixed(4),e=co.y.toFixed(4),t=co.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function zE(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ns).join(`
`)}function GE(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function VE(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const a=n.getActiveAttrib(e,i),s=a.name;let o=1;a.type===n.FLOAT_MAT2&&(o=2),a.type===n.FLOAT_MAT3&&(o=3),a.type===n.FLOAT_MAT4&&(o=4),t[s]={type:a.type,location:n.getAttribLocation(e,s),locationSize:o}}return t}function ns(n){return n!==""}function Qf(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Jf(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const HE=/^[ \t]*#include +<([\w\d./]+)>/gm;function nc(n){return n.replace(HE,XE)}const WE=new Map;function XE(n,e){let t=rt[e];if(t===void 0){const r=WE.get(e);if(r!==void 0)t=rt[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return nc(t)}const YE=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function jf(n){return n.replace(YE,qE)}function qE(n,e,t,r){let i="";for(let a=parseInt(e);a<parseInt(t);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function eh(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function KE(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Ld?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===lg?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===yr&&(e="SHADOWMAP_TYPE_VSM"),e}function $E(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case _a:case ba:e="ENVMAP_TYPE_CUBE";break;case sl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function ZE(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case ba:e="ENVMAP_MODE_REFRACTION";break}return e}function QE(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Pd:e="ENVMAP_BLENDING_MULTIPLY";break;case Ag:e="ENVMAP_BLENDING_MIX";break;case Cg:e="ENVMAP_BLENDING_ADD";break}return e}function JE(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function jE(n,e,t,r){const i=n.getContext(),a=t.defines;let s=t.vertexShader,o=t.fragmentShader;const l=KE(t),u=$E(t),c=ZE(t),f=QE(t),d=JE(t),h=zE(t),v=GE(a),m=i.createProgram();let g,p,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(ns).join(`
`),g.length>0&&(g+=`
`),p=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(ns).join(`
`),p.length>0&&(p+=`
`)):(g=[eh(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ns).join(`
`),p=[eh(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+c:"",t.envMap?"#define "+f:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Hr?"#define TONE_MAPPING":"",t.toneMapping!==Hr?rt.tonemapping_pars_fragment:"",t.toneMapping!==Hr?BE("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",rt.colorspace_pars_fragment,UE("linearToOutputTexel",t.outputColorSpace),kE(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(ns).join(`
`)),s=nc(s),s=Qf(s,t),s=Jf(s,t),o=nc(o),o=Qf(o,t),o=Jf(o,t),s=jf(s),o=jf(o),t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,g=[h,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,p=["#define varying in",t.glslVersion===df?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===df?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const y=x+g+s,E=x+p+o,M=Kf(i,i.VERTEX_SHADER,y),w=Kf(i,i.FRAGMENT_SHADER,E);i.attachShader(m,M),i.attachShader(m,w),t.index0AttributeName!==void 0?i.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m);function b(L){if(n.debug.checkShaderErrors){const N=i.getProgramInfoLog(m).trim(),I=i.getShaderInfoLog(M).trim(),_=i.getShaderInfoLog(w).trim();let P=!0,A=!0;if(i.getProgramParameter(m,i.LINK_STATUS)===!1)if(P=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,m,M,w);else{const D=Zf(i,M,"vertex"),R=Zf(i,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+`

Material Name: `+L.name+`
Material Type: `+L.type+`

Program Info Log: `+N+`
`+D+`
`+R)}else N!==""?console.warn("THREE.WebGLProgram: Program Info Log:",N):(I===""||_==="")&&(A=!1);A&&(L.diagnostics={runnable:P,programLog:N,vertexShader:{log:I,prefix:g},fragmentShader:{log:_,prefix:p}})}i.deleteShader(M),i.deleteShader(w),C=new Po(i,m),T=VE(i,m)}let C;this.getUniforms=function(){return C===void 0&&b(this),C};let T;this.getAttributes=function(){return T===void 0&&b(this),T};let S=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return S===!1&&(S=i.getProgramParameter(m,NE)),S},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=IE++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=M,this.fragmentShader=w,this}let e_=0;class t_{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),a=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return s.has(i)===!1&&(s.add(i),i.usedTimes++),s.has(a)===!1&&(s.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new n_(e),t.set(e,r)),r}}class n_{constructor(e){this.id=e_++,this.code=e,this.usedTimes=0}}function r_(n,e,t,r,i,a,s){const o=new $d,l=new t_,u=new Set,c=[],f=i.logarithmicDepthBuffer,d=i.vertexTextures;let h=i.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(T){return u.add(T),T===0?"uv":`uv${T}`}function g(T,S,L,N,I){const _=N.fog,P=I.geometry,A=T.isMeshStandardMaterial?N.environment:null,D=(T.isMeshStandardMaterial?t:e).get(T.envMap||A),R=D&&D.mapping===sl?D.image.height:null,B=v[T.type];T.precision!==null&&(h=i.getMaxPrecision(T.precision),h!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",h,"instead."));const k=P.morphAttributes.position||P.morphAttributes.normal||P.morphAttributes.color,V=k!==void 0?k.length:0;let Y=0;P.morphAttributes.position!==void 0&&(Y=1),P.morphAttributes.normal!==void 0&&(Y=2),P.morphAttributes.color!==void 0&&(Y=3);let Z,W,K,Q;if(B){const Be=tr[B];Z=Be.vertexShader,W=Be.fragmentShader}else Z=T.vertexShader,W=T.fragmentShader,l.update(T),K=l.getVertexShaderID(T),Q=l.getFragmentShaderID(T);const ne=n.getRenderTarget(),ie=n.state.buffers.depth.getReversed(),H=I.isInstancedMesh===!0,X=I.isBatchedMesh===!0,te=!!T.map,ue=!!T.matcap,Se=!!D,U=!!T.aoMap,Ge=!!T.lightMap,Le=!!T.bumpMap,De=!!T.normalMap,de=!!T.displacementMap,we=!!T.emissiveMap,Me=!!T.metalnessMap,z=!!T.roughnessMap,O=T.anisotropy>0,re=T.clearcoat>0,ve=T.dispersion>0,Ee=T.iridescence>0,ae=T.sheen>0,F=T.transmission>0,j=O&&!!T.anisotropyMap,ce=re&&!!T.clearcoatMap,le=re&&!!T.clearcoatNormalMap,ee=re&&!!T.clearcoatRoughnessMap,J=Ee&&!!T.iridescenceMap,$=Ee&&!!T.iridescenceThicknessMap,oe=ae&&!!T.sheenColorMap,fe=ae&&!!T.sheenRoughnessMap,ye=!!T.specularMap,xe=!!T.specularColorMap,Ce=!!T.specularIntensityMap,q=F&&!!T.transmissionMap,he=F&&!!T.thicknessMap,se=!!T.gradientMap,ge=!!T.alphaMap,Re=T.alphaTest>0,Ae=!!T.alphaHash,Fe=!!T.extensions;let Ie=Hr;T.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(Ie=n.toneMapping);const Oe={shaderID:B,shaderType:T.type,shaderName:T.name,vertexShader:Z,fragmentShader:W,defines:T.defines,customVertexShaderID:K,customFragmentShaderID:Q,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:h,batching:X,batchingColor:X&&I._colorsTexture!==null,instancing:H,instancingColor:H&&I.instanceColor!==null,instancingMorph:H&&I.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:ne===null?n.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:Ma,alphaToCoverage:!!T.alphaToCoverage,map:te,matcap:ue,envMap:Se,envMapMode:Se&&D.mapping,envMapCubeUVHeight:R,aoMap:U,lightMap:Ge,bumpMap:Le,normalMap:De,displacementMap:d&&de,emissiveMap:we,normalMapObjectSpace:De&&T.normalMapType===Gg,normalMapTangentSpace:De&&T.normalMapType===zg,metalnessMap:Me,roughnessMap:z,anisotropy:O,anisotropyMap:j,clearcoat:re,clearcoatMap:ce,clearcoatNormalMap:le,clearcoatRoughnessMap:ee,dispersion:ve,iridescence:Ee,iridescenceMap:J,iridescenceThicknessMap:$,sheen:ae,sheenColorMap:oe,sheenRoughnessMap:fe,specularMap:ye,specularColorMap:xe,specularIntensityMap:Ce,transmission:F,transmissionMap:q,thicknessMap:he,gradientMap:se,opaque:T.transparent===!1&&T.blending===da&&T.alphaToCoverage===!1,alphaMap:ge,alphaTest:Re,alphaHash:Ae,combine:T.combine,mapUv:te&&m(T.map.channel),aoMapUv:U&&m(T.aoMap.channel),lightMapUv:Ge&&m(T.lightMap.channel),bumpMapUv:Le&&m(T.bumpMap.channel),normalMapUv:De&&m(T.normalMap.channel),displacementMapUv:de&&m(T.displacementMap.channel),emissiveMapUv:we&&m(T.emissiveMap.channel),metalnessMapUv:Me&&m(T.metalnessMap.channel),roughnessMapUv:z&&m(T.roughnessMap.channel),anisotropyMapUv:j&&m(T.anisotropyMap.channel),clearcoatMapUv:ce&&m(T.clearcoatMap.channel),clearcoatNormalMapUv:le&&m(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&m(T.clearcoatRoughnessMap.channel),iridescenceMapUv:J&&m(T.iridescenceMap.channel),iridescenceThicknessMapUv:$&&m(T.iridescenceThicknessMap.channel),sheenColorMapUv:oe&&m(T.sheenColorMap.channel),sheenRoughnessMapUv:fe&&m(T.sheenRoughnessMap.channel),specularMapUv:ye&&m(T.specularMap.channel),specularColorMapUv:xe&&m(T.specularColorMap.channel),specularIntensityMapUv:Ce&&m(T.specularIntensityMap.channel),transmissionMapUv:q&&m(T.transmissionMap.channel),thicknessMapUv:he&&m(T.thicknessMap.channel),alphaMapUv:ge&&m(T.alphaMap.channel),vertexTangents:!!P.attributes.tangent&&(De||O),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!P.attributes.color&&P.attributes.color.itemSize===4,pointsUvs:I.isPoints===!0&&!!P.attributes.uv&&(te||ge),fog:!!_,useFog:T.fog===!0,fogExp2:!!_&&_.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:f,reverseDepthBuffer:ie,skinning:I.isSkinnedMesh===!0,morphTargets:P.morphAttributes.position!==void 0,morphNormals:P.morphAttributes.normal!==void 0,morphColors:P.morphAttributes.color!==void 0,morphTargetsCount:V,morphTextureStride:Y,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:T.dithering,shadowMapEnabled:n.shadowMap.enabled&&L.length>0,shadowMapType:n.shadowMap.type,toneMapping:Ie,decodeVideoTexture:te&&T.map.isVideoTexture===!0&&gt.getTransfer(T.map.colorSpace)===bt,decodeVideoTextureEmissive:we&&T.emissiveMap.isVideoTexture===!0&&gt.getTransfer(T.emissiveMap.colorSpace)===bt,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===nr,flipSided:T.side===xn,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionClipCullDistance:Fe&&T.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Fe&&T.extensions.multiDraw===!0||X)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()};return Oe.vertexUv1s=u.has(1),Oe.vertexUv2s=u.has(2),Oe.vertexUv3s=u.has(3),u.clear(),Oe}function p(T){const S=[];if(T.shaderID?S.push(T.shaderID):(S.push(T.customVertexShaderID),S.push(T.customFragmentShaderID)),T.defines!==void 0)for(const L in T.defines)S.push(L),S.push(T.defines[L]);return T.isRawShaderMaterial===!1&&(x(S,T),y(S,T),S.push(n.outputColorSpace)),S.push(T.customProgramCacheKey),S.join()}function x(T,S){T.push(S.precision),T.push(S.outputColorSpace),T.push(S.envMapMode),T.push(S.envMapCubeUVHeight),T.push(S.mapUv),T.push(S.alphaMapUv),T.push(S.lightMapUv),T.push(S.aoMapUv),T.push(S.bumpMapUv),T.push(S.normalMapUv),T.push(S.displacementMapUv),T.push(S.emissiveMapUv),T.push(S.metalnessMapUv),T.push(S.roughnessMapUv),T.push(S.anisotropyMapUv),T.push(S.clearcoatMapUv),T.push(S.clearcoatNormalMapUv),T.push(S.clearcoatRoughnessMapUv),T.push(S.iridescenceMapUv),T.push(S.iridescenceThicknessMapUv),T.push(S.sheenColorMapUv),T.push(S.sheenRoughnessMapUv),T.push(S.specularMapUv),T.push(S.specularColorMapUv),T.push(S.specularIntensityMapUv),T.push(S.transmissionMapUv),T.push(S.thicknessMapUv),T.push(S.combine),T.push(S.fogExp2),T.push(S.sizeAttenuation),T.push(S.morphTargetsCount),T.push(S.morphAttributeCount),T.push(S.numDirLights),T.push(S.numPointLights),T.push(S.numSpotLights),T.push(S.numSpotLightMaps),T.push(S.numHemiLights),T.push(S.numRectAreaLights),T.push(S.numDirLightShadows),T.push(S.numPointLightShadows),T.push(S.numSpotLightShadows),T.push(S.numSpotLightShadowsWithMaps),T.push(S.numLightProbes),T.push(S.shadowMapType),T.push(S.toneMapping),T.push(S.numClippingPlanes),T.push(S.numClipIntersection),T.push(S.depthPacking)}function y(T,S){o.disableAll(),S.supportsVertexTextures&&o.enable(0),S.instancing&&o.enable(1),S.instancingColor&&o.enable(2),S.instancingMorph&&o.enable(3),S.matcap&&o.enable(4),S.envMap&&o.enable(5),S.normalMapObjectSpace&&o.enable(6),S.normalMapTangentSpace&&o.enable(7),S.clearcoat&&o.enable(8),S.iridescence&&o.enable(9),S.alphaTest&&o.enable(10),S.vertexColors&&o.enable(11),S.vertexAlphas&&o.enable(12),S.vertexUv1s&&o.enable(13),S.vertexUv2s&&o.enable(14),S.vertexUv3s&&o.enable(15),S.vertexTangents&&o.enable(16),S.anisotropy&&o.enable(17),S.alphaHash&&o.enable(18),S.batching&&o.enable(19),S.dispersion&&o.enable(20),S.batchingColor&&o.enable(21),T.push(o.mask),o.disableAll(),S.fog&&o.enable(0),S.useFog&&o.enable(1),S.flatShading&&o.enable(2),S.logarithmicDepthBuffer&&o.enable(3),S.reverseDepthBuffer&&o.enable(4),S.skinning&&o.enable(5),S.morphTargets&&o.enable(6),S.morphNormals&&o.enable(7),S.morphColors&&o.enable(8),S.premultipliedAlpha&&o.enable(9),S.shadowMapEnabled&&o.enable(10),S.doubleSided&&o.enable(11),S.flipSided&&o.enable(12),S.useDepthPacking&&o.enable(13),S.dithering&&o.enable(14),S.transmission&&o.enable(15),S.sheen&&o.enable(16),S.opaque&&o.enable(17),S.pointsUvs&&o.enable(18),S.decodeVideoTexture&&o.enable(19),S.decodeVideoTextureEmissive&&o.enable(20),S.alphaToCoverage&&o.enable(21),T.push(o.mask)}function E(T){const S=v[T.type];let L;if(S){const N=tr[S];L=Nm.clone(N.uniforms)}else L=T.uniforms;return L}function M(T,S){let L;for(let N=0,I=c.length;N<I;N++){const _=c[N];if(_.cacheKey===S){L=_,++L.usedTimes;break}}return L===void 0&&(L=new jE(n,S,T,a),c.push(L)),L}function w(T){if(--T.usedTimes===0){const S=c.indexOf(T);c[S]=c[c.length-1],c.pop(),T.destroy()}}function b(T){l.remove(T)}function C(){l.dispose()}return{getParameters:g,getProgramCacheKey:p,getUniforms:E,acquireProgram:M,releaseProgram:w,releaseShaderCache:b,programs:c,dispose:C}}function i_(){let n=new WeakMap;function e(s){return n.has(s)}function t(s){let o=n.get(s);return o===void 0&&(o={},n.set(s,o)),o}function r(s){n.delete(s)}function i(s,o,l){n.get(s)[o]=l}function a(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:a}}function a_(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function th(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function nh(){const n=[];let e=0;const t=[],r=[],i=[];function a(){e=0,t.length=0,r.length=0,i.length=0}function s(f,d,h,v,m,g){let p=n[e];return p===void 0?(p={id:f.id,object:f,geometry:d,material:h,groupOrder:v,renderOrder:f.renderOrder,z:m,group:g},n[e]=p):(p.id=f.id,p.object=f,p.geometry=d,p.material=h,p.groupOrder=v,p.renderOrder=f.renderOrder,p.z=m,p.group=g),e++,p}function o(f,d,h,v,m,g){const p=s(f,d,h,v,m,g);h.transmission>0?r.push(p):h.transparent===!0?i.push(p):t.push(p)}function l(f,d,h,v,m,g){const p=s(f,d,h,v,m,g);h.transmission>0?r.unshift(p):h.transparent===!0?i.unshift(p):t.unshift(p)}function u(f,d){t.length>1&&t.sort(f||a_),r.length>1&&r.sort(d||th),i.length>1&&i.sort(d||th)}function c(){for(let f=e,d=n.length;f<d;f++){const h=n[f];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}return{opaque:t,transmissive:r,transparent:i,init:a,push:o,unshift:l,finish:c,sort:u}}function s_(){let n=new WeakMap;function e(r,i){const a=n.get(r);let s;return a===void 0?(s=new nh,n.set(r,[s])):i>=a.length?(s=new nh,a.push(s)):s=a[i],s}function t(){n=new WeakMap}return{get:e,dispose:t}}function o_(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Te,color:new St};break;case"SpotLight":t={position:new Te,direction:new Te,color:new St,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Te,color:new St,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Te,skyColor:new St,groundColor:new St};break;case"RectAreaLight":t={color:new St,position:new Te,halfWidth:new Te,halfHeight:new Te};break}return n[e.id]=t,t}}}function l_(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ot,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let u_=0;function c_(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function f_(n){const e=new o_,t=l_(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new Te);const i=new Te,a=new Bt,s=new Bt;function o(u){let c=0,f=0,d=0;for(let T=0;T<9;T++)r.probe[T].set(0,0,0);let h=0,v=0,m=0,g=0,p=0,x=0,y=0,E=0,M=0,w=0,b=0;u.sort(c_);for(let T=0,S=u.length;T<S;T++){const L=u[T],N=L.color,I=L.intensity,_=L.distance,P=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)c+=N.r*I,f+=N.g*I,d+=N.b*I;else if(L.isLightProbe){for(let A=0;A<9;A++)r.probe[A].addScaledVector(L.sh.coefficients[A],I);b++}else if(L.isDirectionalLight){const A=e.get(L);if(A.color.copy(L.color).multiplyScalar(L.intensity),L.castShadow){const D=L.shadow,R=t.get(L);R.shadowIntensity=D.intensity,R.shadowBias=D.bias,R.shadowNormalBias=D.normalBias,R.shadowRadius=D.radius,R.shadowMapSize=D.mapSize,r.directionalShadow[h]=R,r.directionalShadowMap[h]=P,r.directionalShadowMatrix[h]=L.shadow.matrix,x++}r.directional[h]=A,h++}else if(L.isSpotLight){const A=e.get(L);A.position.setFromMatrixPosition(L.matrixWorld),A.color.copy(N).multiplyScalar(I),A.distance=_,A.coneCos=Math.cos(L.angle),A.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),A.decay=L.decay,r.spot[m]=A;const D=L.shadow;if(L.map&&(r.spotLightMap[M]=L.map,M++,D.updateMatrices(L),L.castShadow&&w++),r.spotLightMatrix[m]=D.matrix,L.castShadow){const R=t.get(L);R.shadowIntensity=D.intensity,R.shadowBias=D.bias,R.shadowNormalBias=D.normalBias,R.shadowRadius=D.radius,R.shadowMapSize=D.mapSize,r.spotShadow[m]=R,r.spotShadowMap[m]=P,E++}m++}else if(L.isRectAreaLight){const A=e.get(L);A.color.copy(N).multiplyScalar(I),A.halfWidth.set(L.width*.5,0,0),A.halfHeight.set(0,L.height*.5,0),r.rectArea[g]=A,g++}else if(L.isPointLight){const A=e.get(L);if(A.color.copy(L.color).multiplyScalar(L.intensity),A.distance=L.distance,A.decay=L.decay,L.castShadow){const D=L.shadow,R=t.get(L);R.shadowIntensity=D.intensity,R.shadowBias=D.bias,R.shadowNormalBias=D.normalBias,R.shadowRadius=D.radius,R.shadowMapSize=D.mapSize,R.shadowCameraNear=D.camera.near,R.shadowCameraFar=D.camera.far,r.pointShadow[v]=R,r.pointShadowMap[v]=P,r.pointShadowMatrix[v]=L.shadow.matrix,y++}r.point[v]=A,v++}else if(L.isHemisphereLight){const A=e.get(L);A.skyColor.copy(L.color).multiplyScalar(I),A.groundColor.copy(L.groundColor).multiplyScalar(I),r.hemi[p]=A,p++}}g>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ve.LTC_FLOAT_1,r.rectAreaLTC2=Ve.LTC_FLOAT_2):(r.rectAreaLTC1=Ve.LTC_HALF_1,r.rectAreaLTC2=Ve.LTC_HALF_2)),r.ambient[0]=c,r.ambient[1]=f,r.ambient[2]=d;const C=r.hash;(C.directionalLength!==h||C.pointLength!==v||C.spotLength!==m||C.rectAreaLength!==g||C.hemiLength!==p||C.numDirectionalShadows!==x||C.numPointShadows!==y||C.numSpotShadows!==E||C.numSpotMaps!==M||C.numLightProbes!==b)&&(r.directional.length=h,r.spot.length=m,r.rectArea.length=g,r.point.length=v,r.hemi.length=p,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=y,r.pointShadowMap.length=y,r.spotShadow.length=E,r.spotShadowMap.length=E,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=y,r.spotLightMatrix.length=E+M-w,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=w,r.numLightProbes=b,C.directionalLength=h,C.pointLength=v,C.spotLength=m,C.rectAreaLength=g,C.hemiLength=p,C.numDirectionalShadows=x,C.numPointShadows=y,C.numSpotShadows=E,C.numSpotMaps=M,C.numLightProbes=b,r.version=u_++)}function l(u,c){let f=0,d=0,h=0,v=0,m=0;const g=c.matrixWorldInverse;for(let p=0,x=u.length;p<x;p++){const y=u[p];if(y.isDirectionalLight){const E=r.directional[f];E.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),E.direction.sub(i),E.direction.transformDirection(g),f++}else if(y.isSpotLight){const E=r.spot[h];E.position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(g),E.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),E.direction.sub(i),E.direction.transformDirection(g),h++}else if(y.isRectAreaLight){const E=r.rectArea[v];E.position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(g),s.identity(),a.copy(y.matrixWorld),a.premultiply(g),s.extractRotation(a),E.halfWidth.set(y.width*.5,0,0),E.halfHeight.set(0,y.height*.5,0),E.halfWidth.applyMatrix4(s),E.halfHeight.applyMatrix4(s),v++}else if(y.isPointLight){const E=r.point[d];E.position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(g),d++}else if(y.isHemisphereLight){const E=r.hemi[m];E.direction.setFromMatrixPosition(y.matrixWorld),E.direction.transformDirection(g),m++}}}return{setup:o,setupView:l,state:r}}function rh(n){const e=new f_(n),t=[],r=[];function i(c){u.camera=c,t.length=0,r.length=0}function a(c){t.push(c)}function s(c){r.push(c)}function o(){e.setup(t)}function l(c){e.setupView(t,c)}const u={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:u,setupLights:o,setupLightsView:l,pushLight:a,pushShadow:s}}function h_(n){let e=new WeakMap;function t(i,a=0){const s=e.get(i);let o;return s===void 0?(o=new rh(n),e.set(i,[o])):a>=s.length?(o=new rh(n),s.push(o)):o=s[a],o}function r(){e=new WeakMap}return{get:t,dispose:r}}const d_=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,p_=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function v_(n,e,t){let r=new np;const i=new ot,a=new ot,s=new Ft,o=new Vm({depthPacking:kg}),l=new Hm,u={},c=t.maxTextureSize,f={[Yr]:xn,[xn]:Yr,[nr]:nr},d=new qr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ot},radius:{value:4}},vertexShader:d_,fragmentShader:p_}),h=d.clone();h.defines.HORIZONTAL_PASS=1;const v=new Ii;v.setAttribute("position",new sr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new rr(v,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ld;let p=this.type;this.render=function(w,b,C){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||w.length===0)return;const T=n.getRenderTarget(),S=n.getActiveCubeFace(),L=n.getActiveMipmapLevel(),N=n.state;N.setBlending(Vr),N.buffers.color.setClear(1,1,1,1),N.buffers.depth.setTest(!0),N.setScissorTest(!1);const I=p!==yr&&this.type===yr,_=p===yr&&this.type!==yr;for(let P=0,A=w.length;P<A;P++){const D=w[P],R=D.shadow;if(R===void 0){console.warn("THREE.WebGLShadowMap:",D,"has no shadow.");continue}if(R.autoUpdate===!1&&R.needsUpdate===!1)continue;i.copy(R.mapSize);const B=R.getFrameExtents();if(i.multiply(B),a.copy(R.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(a.x=Math.floor(c/B.x),i.x=a.x*B.x,R.mapSize.x=a.x),i.y>c&&(a.y=Math.floor(c/B.y),i.y=a.y*B.y,R.mapSize.y=a.y)),R.map===null||I===!0||_===!0){const V=this.type!==yr?{minFilter:qn,magFilter:qn}:{};R.map!==null&&R.map.dispose(),R.map=new Mi(i.x,i.y,V),R.map.texture.name=D.name+".shadowMap",R.camera.updateProjectionMatrix()}n.setRenderTarget(R.map),n.clear();const k=R.getViewportCount();for(let V=0;V<k;V++){const Y=R.getViewport(V);s.set(a.x*Y.x,a.y*Y.y,a.x*Y.z,a.y*Y.w),N.viewport(s),R.updateMatrices(D,V),r=R.getFrustum(),E(b,C,R.camera,D,this.type)}R.isPointLightShadow!==!0&&this.type===yr&&x(R,C),R.needsUpdate=!1}p=this.type,g.needsUpdate=!1,n.setRenderTarget(T,S,L)};function x(w,b){const C=e.update(m);d.defines.VSM_SAMPLES!==w.blurSamples&&(d.defines.VSM_SAMPLES=w.blurSamples,h.defines.VSM_SAMPLES=w.blurSamples,d.needsUpdate=!0,h.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new Mi(i.x,i.y)),d.uniforms.shadow_pass.value=w.map.texture,d.uniforms.resolution.value=w.mapSize,d.uniforms.radius.value=w.radius,n.setRenderTarget(w.mapPass),n.clear(),n.renderBufferDirect(b,null,C,d,m,null),h.uniforms.shadow_pass.value=w.mapPass.texture,h.uniforms.resolution.value=w.mapSize,h.uniforms.radius.value=w.radius,n.setRenderTarget(w.map),n.clear(),n.renderBufferDirect(b,null,C,h,m,null)}function y(w,b,C,T){let S=null;const L=C.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(L!==void 0)S=L;else if(S=C.isPointLight===!0?l:o,n.localClippingEnabled&&b.clipShadows===!0&&Array.isArray(b.clippingPlanes)&&b.clippingPlanes.length!==0||b.displacementMap&&b.displacementScale!==0||b.alphaMap&&b.alphaTest>0||b.map&&b.alphaTest>0){const N=S.uuid,I=b.uuid;let _=u[N];_===void 0&&(_={},u[N]=_);let P=_[I];P===void 0&&(P=S.clone(),_[I]=P,b.addEventListener("dispose",M)),S=P}if(S.visible=b.visible,S.wireframe=b.wireframe,T===yr?S.side=b.shadowSide!==null?b.shadowSide:b.side:S.side=b.shadowSide!==null?b.shadowSide:f[b.side],S.alphaMap=b.alphaMap,S.alphaTest=b.alphaTest,S.map=b.map,S.clipShadows=b.clipShadows,S.clippingPlanes=b.clippingPlanes,S.clipIntersection=b.clipIntersection,S.displacementMap=b.displacementMap,S.displacementScale=b.displacementScale,S.displacementBias=b.displacementBias,S.wireframeLinewidth=b.wireframeLinewidth,S.linewidth=b.linewidth,C.isPointLight===!0&&S.isMeshDistanceMaterial===!0){const N=n.properties.get(S);N.light=C}return S}function E(w,b,C,T,S){if(w.visible===!1)return;if(w.layers.test(b.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&S===yr)&&(!w.frustumCulled||r.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,w.matrixWorld);const I=e.update(w),_=w.material;if(Array.isArray(_)){const P=I.groups;for(let A=0,D=P.length;A<D;A++){const R=P[A],B=_[R.materialIndex];if(B&&B.visible){const k=y(w,B,T,S);w.onBeforeShadow(n,w,b,C,I,k,R),n.renderBufferDirect(C,null,I,k,w,R),w.onAfterShadow(n,w,b,C,I,k,R)}}}else if(_.visible){const P=y(w,_,T,S);w.onBeforeShadow(n,w,b,C,I,P,null),n.renderBufferDirect(C,null,I,P,w,null),w.onAfterShadow(n,w,b,C,I,P,null)}}const N=w.children;for(let I=0,_=N.length;I<_;I++)E(N[I],b,C,T,S)}function M(w){w.target.removeEventListener("dispose",M);for(const C in u){const T=u[C],S=w.target.uuid;S in T&&(T[S].dispose(),delete T[S])}}}const g_={[xu]:Eu,[_u]:Su,[bu]:Mu,[Ea]:Tu,[Eu]:xu,[Su]:_u,[Mu]:bu,[Tu]:Ea};function m_(n,e){function t(){let q=!1;const he=new Ft;let se=null;const ge=new Ft(0,0,0,0);return{setMask:function(Re){se!==Re&&!q&&(n.colorMask(Re,Re,Re,Re),se=Re)},setLocked:function(Re){q=Re},setClear:function(Re,Ae,Fe,Ie,Oe){Oe===!0&&(Re*=Ie,Ae*=Ie,Fe*=Ie),he.set(Re,Ae,Fe,Ie),ge.equals(he)===!1&&(n.clearColor(Re,Ae,Fe,Ie),ge.copy(he))},reset:function(){q=!1,se=null,ge.set(-1,0,0,0)}}}function r(){let q=!1,he=!1,se=null,ge=null,Re=null;return{setReversed:function(Ae){if(he!==Ae){const Fe=e.get("EXT_clip_control");he?Fe.clipControlEXT(Fe.LOWER_LEFT_EXT,Fe.ZERO_TO_ONE_EXT):Fe.clipControlEXT(Fe.LOWER_LEFT_EXT,Fe.NEGATIVE_ONE_TO_ONE_EXT);const Ie=Re;Re=null,this.setClear(Ie)}he=Ae},getReversed:function(){return he},setTest:function(Ae){Ae?ne(n.DEPTH_TEST):ie(n.DEPTH_TEST)},setMask:function(Ae){se!==Ae&&!q&&(n.depthMask(Ae),se=Ae)},setFunc:function(Ae){if(he&&(Ae=g_[Ae]),ge!==Ae){switch(Ae){case xu:n.depthFunc(n.NEVER);break;case Eu:n.depthFunc(n.ALWAYS);break;case _u:n.depthFunc(n.LESS);break;case Ea:n.depthFunc(n.LEQUAL);break;case bu:n.depthFunc(n.EQUAL);break;case Tu:n.depthFunc(n.GEQUAL);break;case Su:n.depthFunc(n.GREATER);break;case Mu:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}ge=Ae}},setLocked:function(Ae){q=Ae},setClear:function(Ae){Re!==Ae&&(he&&(Ae=1-Ae),n.clearDepth(Ae),Re=Ae)},reset:function(){q=!1,se=null,ge=null,Re=null,he=!1}}}function i(){let q=!1,he=null,se=null,ge=null,Re=null,Ae=null,Fe=null,Ie=null,Oe=null;return{setTest:function(Be){q||(Be?ne(n.STENCIL_TEST):ie(n.STENCIL_TEST))},setMask:function(Be){he!==Be&&!q&&(n.stencilMask(Be),he=Be)},setFunc:function(Be,ze,We){(se!==Be||ge!==ze||Re!==We)&&(n.stencilFunc(Be,ze,We),se=Be,ge=ze,Re=We)},setOp:function(Be,ze,We){(Ae!==Be||Fe!==ze||Ie!==We)&&(n.stencilOp(Be,ze,We),Ae=Be,Fe=ze,Ie=We)},setLocked:function(Be){q=Be},setClear:function(Be){Oe!==Be&&(n.clearStencil(Be),Oe=Be)},reset:function(){q=!1,he=null,se=null,ge=null,Re=null,Ae=null,Fe=null,Ie=null,Oe=null}}}const a=new t,s=new r,o=new i,l=new WeakMap,u=new WeakMap;let c={},f={},d=new WeakMap,h=[],v=null,m=!1,g=null,p=null,x=null,y=null,E=null,M=null,w=null,b=new St(0,0,0),C=0,T=!1,S=null,L=null,N=null,I=null,_=null;const P=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let A=!1,D=0;const R=n.getParameter(n.VERSION);R.indexOf("WebGL")!==-1?(D=parseFloat(/^WebGL (\d)/.exec(R)[1]),A=D>=1):R.indexOf("OpenGL ES")!==-1&&(D=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),A=D>=2);let B=null,k={};const V=n.getParameter(n.SCISSOR_BOX),Y=n.getParameter(n.VIEWPORT),Z=new Ft().fromArray(V),W=new Ft().fromArray(Y);function K(q,he,se,ge){const Re=new Uint8Array(4),Ae=n.createTexture();n.bindTexture(q,Ae),n.texParameteri(q,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(q,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Fe=0;Fe<se;Fe++)q===n.TEXTURE_3D||q===n.TEXTURE_2D_ARRAY?n.texImage3D(he,0,n.RGBA,1,1,ge,0,n.RGBA,n.UNSIGNED_BYTE,Re):n.texImage2D(he+Fe,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Re);return Ae}const Q={};Q[n.TEXTURE_2D]=K(n.TEXTURE_2D,n.TEXTURE_2D,1),Q[n.TEXTURE_CUBE_MAP]=K(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Q[n.TEXTURE_2D_ARRAY]=K(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Q[n.TEXTURE_3D]=K(n.TEXTURE_3D,n.TEXTURE_3D,1,1),a.setClear(0,0,0,1),s.setClear(1),o.setClear(0),ne(n.DEPTH_TEST),s.setFunc(Ea),Le(!1),De(of),ne(n.CULL_FACE),U(Vr);function ne(q){c[q]!==!0&&(n.enable(q),c[q]=!0)}function ie(q){c[q]!==!1&&(n.disable(q),c[q]=!1)}function H(q,he){return f[q]!==he?(n.bindFramebuffer(q,he),f[q]=he,q===n.DRAW_FRAMEBUFFER&&(f[n.FRAMEBUFFER]=he),q===n.FRAMEBUFFER&&(f[n.DRAW_FRAMEBUFFER]=he),!0):!1}function X(q,he){let se=h,ge=!1;if(q){se=d.get(he),se===void 0&&(se=[],d.set(he,se));const Re=q.textures;if(se.length!==Re.length||se[0]!==n.COLOR_ATTACHMENT0){for(let Ae=0,Fe=Re.length;Ae<Fe;Ae++)se[Ae]=n.COLOR_ATTACHMENT0+Ae;se.length=Re.length,ge=!0}}else se[0]!==n.BACK&&(se[0]=n.BACK,ge=!0);ge&&n.drawBuffers(se)}function te(q){return v!==q?(n.useProgram(q),v=q,!0):!1}const ue={[mi]:n.FUNC_ADD,[cg]:n.FUNC_SUBTRACT,[fg]:n.FUNC_REVERSE_SUBTRACT};ue[hg]=n.MIN,ue[dg]=n.MAX;const Se={[pg]:n.ZERO,[vg]:n.ONE,[gg]:n.SRC_COLOR,[mu]:n.SRC_ALPHA,[bg]:n.SRC_ALPHA_SATURATE,[Eg]:n.DST_COLOR,[yg]:n.DST_ALPHA,[mg]:n.ONE_MINUS_SRC_COLOR,[yu]:n.ONE_MINUS_SRC_ALPHA,[_g]:n.ONE_MINUS_DST_COLOR,[xg]:n.ONE_MINUS_DST_ALPHA,[Tg]:n.CONSTANT_COLOR,[Sg]:n.ONE_MINUS_CONSTANT_COLOR,[Mg]:n.CONSTANT_ALPHA,[wg]:n.ONE_MINUS_CONSTANT_ALPHA};function U(q,he,se,ge,Re,Ae,Fe,Ie,Oe,Be){if(q===Vr){m===!0&&(ie(n.BLEND),m=!1);return}if(m===!1&&(ne(n.BLEND),m=!0),q!==ug){if(q!==g||Be!==T){if((p!==mi||E!==mi)&&(n.blendEquation(n.FUNC_ADD),p=mi,E=mi),Be)switch(q){case da:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case lf:n.blendFunc(n.ONE,n.ONE);break;case uf:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case cf:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case da:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case lf:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case uf:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case cf:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}x=null,y=null,M=null,w=null,b.set(0,0,0),C=0,g=q,T=Be}return}Re=Re||he,Ae=Ae||se,Fe=Fe||ge,(he!==p||Re!==E)&&(n.blendEquationSeparate(ue[he],ue[Re]),p=he,E=Re),(se!==x||ge!==y||Ae!==M||Fe!==w)&&(n.blendFuncSeparate(Se[se],Se[ge],Se[Ae],Se[Fe]),x=se,y=ge,M=Ae,w=Fe),(Ie.equals(b)===!1||Oe!==C)&&(n.blendColor(Ie.r,Ie.g,Ie.b,Oe),b.copy(Ie),C=Oe),g=q,T=!1}function Ge(q,he){q.side===nr?ie(n.CULL_FACE):ne(n.CULL_FACE);let se=q.side===xn;he&&(se=!se),Le(se),q.blending===da&&q.transparent===!1?U(Vr):U(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.blendColor,q.blendAlpha,q.premultipliedAlpha),s.setFunc(q.depthFunc),s.setTest(q.depthTest),s.setMask(q.depthWrite),a.setMask(q.colorWrite);const ge=q.stencilWrite;o.setTest(ge),ge&&(o.setMask(q.stencilWriteMask),o.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),o.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),we(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits),q.alphaToCoverage===!0?ne(n.SAMPLE_ALPHA_TO_COVERAGE):ie(n.SAMPLE_ALPHA_TO_COVERAGE)}function Le(q){S!==q&&(q?n.frontFace(n.CW):n.frontFace(n.CCW),S=q)}function De(q){q!==sg?(ne(n.CULL_FACE),q!==L&&(q===of?n.cullFace(n.BACK):q===og?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):ie(n.CULL_FACE),L=q}function de(q){q!==N&&(A&&n.lineWidth(q),N=q)}function we(q,he,se){q?(ne(n.POLYGON_OFFSET_FILL),(I!==he||_!==se)&&(n.polygonOffset(he,se),I=he,_=se)):ie(n.POLYGON_OFFSET_FILL)}function Me(q){q?ne(n.SCISSOR_TEST):ie(n.SCISSOR_TEST)}function z(q){q===void 0&&(q=n.TEXTURE0+P-1),B!==q&&(n.activeTexture(q),B=q)}function O(q,he,se){se===void 0&&(B===null?se=n.TEXTURE0+P-1:se=B);let ge=k[se];ge===void 0&&(ge={type:void 0,texture:void 0},k[se]=ge),(ge.type!==q||ge.texture!==he)&&(B!==se&&(n.activeTexture(se),B=se),n.bindTexture(q,he||Q[q]),ge.type=q,ge.texture=he)}function re(){const q=k[B];q!==void 0&&q.type!==void 0&&(n.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function ve(){try{n.compressedTexImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ee(){try{n.compressedTexImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ae(){try{n.texSubImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function F(){try{n.texSubImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function j(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ce(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function le(){try{n.texStorage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ee(){try{n.texStorage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function J(){try{n.texImage2D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function $(){try{n.texImage3D.apply(n,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function oe(q){Z.equals(q)===!1&&(n.scissor(q.x,q.y,q.z,q.w),Z.copy(q))}function fe(q){W.equals(q)===!1&&(n.viewport(q.x,q.y,q.z,q.w),W.copy(q))}function ye(q,he){let se=u.get(he);se===void 0&&(se=new WeakMap,u.set(he,se));let ge=se.get(q);ge===void 0&&(ge=n.getUniformBlockIndex(he,q.name),se.set(q,ge))}function xe(q,he){const ge=u.get(he).get(q);l.get(he)!==ge&&(n.uniformBlockBinding(he,ge,q.__bindingPointIndex),l.set(he,ge))}function Ce(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),s.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},B=null,k={},f={},d=new WeakMap,h=[],v=null,m=!1,g=null,p=null,x=null,y=null,E=null,M=null,w=null,b=new St(0,0,0),C=0,T=!1,S=null,L=null,N=null,I=null,_=null,Z.set(0,0,n.canvas.width,n.canvas.height),W.set(0,0,n.canvas.width,n.canvas.height),a.reset(),s.reset(),o.reset()}return{buffers:{color:a,depth:s,stencil:o},enable:ne,disable:ie,bindFramebuffer:H,drawBuffers:X,useProgram:te,setBlending:U,setMaterial:Ge,setFlipSided:Le,setCullFace:De,setLineWidth:de,setPolygonOffset:we,setScissorTest:Me,activeTexture:z,bindTexture:O,unbindTexture:re,compressedTexImage2D:ve,compressedTexImage3D:Ee,texImage2D:J,texImage3D:$,updateUBOMapping:ye,uniformBlockBinding:xe,texStorage2D:le,texStorage3D:ee,texSubImage2D:ae,texSubImage3D:F,compressedTexSubImage2D:j,compressedTexSubImage3D:ce,scissor:oe,viewport:fe,reset:Ce}}function y_(n,e,t,r,i,a,s){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new ot,c=new WeakMap;let f;const d=new WeakMap;let h=!1;try{h=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(z,O){return h?new OffscreenCanvas(z,O):qo("canvas")}function m(z,O,re){let ve=1;const Ee=Me(z);if((Ee.width>re||Ee.height>re)&&(ve=re/Math.max(Ee.width,Ee.height)),ve<1)if(typeof HTMLImageElement<"u"&&z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&z instanceof ImageBitmap||typeof VideoFrame<"u"&&z instanceof VideoFrame){const ae=Math.floor(ve*Ee.width),F=Math.floor(ve*Ee.height);f===void 0&&(f=v(ae,F));const j=O?v(ae,F):f;return j.width=ae,j.height=F,j.getContext("2d").drawImage(z,0,0,ae,F),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ee.width+"x"+Ee.height+") to ("+ae+"x"+F+")."),j}else return"data"in z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ee.width+"x"+Ee.height+")."),z;return z}function g(z){return z.generateMipmaps}function p(z){n.generateMipmap(z)}function x(z){return z.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:z.isWebGL3DRenderTarget?n.TEXTURE_3D:z.isWebGLArrayRenderTarget||z.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function y(z,O,re,ve,Ee=!1){if(z!==null){if(n[z]!==void 0)return n[z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+z+"'")}let ae=O;if(O===n.RED&&(re===n.FLOAT&&(ae=n.R32F),re===n.HALF_FLOAT&&(ae=n.R16F),re===n.UNSIGNED_BYTE&&(ae=n.R8)),O===n.RED_INTEGER&&(re===n.UNSIGNED_BYTE&&(ae=n.R8UI),re===n.UNSIGNED_SHORT&&(ae=n.R16UI),re===n.UNSIGNED_INT&&(ae=n.R32UI),re===n.BYTE&&(ae=n.R8I),re===n.SHORT&&(ae=n.R16I),re===n.INT&&(ae=n.R32I)),O===n.RG&&(re===n.FLOAT&&(ae=n.RG32F),re===n.HALF_FLOAT&&(ae=n.RG16F),re===n.UNSIGNED_BYTE&&(ae=n.RG8)),O===n.RG_INTEGER&&(re===n.UNSIGNED_BYTE&&(ae=n.RG8UI),re===n.UNSIGNED_SHORT&&(ae=n.RG16UI),re===n.UNSIGNED_INT&&(ae=n.RG32UI),re===n.BYTE&&(ae=n.RG8I),re===n.SHORT&&(ae=n.RG16I),re===n.INT&&(ae=n.RG32I)),O===n.RGB_INTEGER&&(re===n.UNSIGNED_BYTE&&(ae=n.RGB8UI),re===n.UNSIGNED_SHORT&&(ae=n.RGB16UI),re===n.UNSIGNED_INT&&(ae=n.RGB32UI),re===n.BYTE&&(ae=n.RGB8I),re===n.SHORT&&(ae=n.RGB16I),re===n.INT&&(ae=n.RGB32I)),O===n.RGBA_INTEGER&&(re===n.UNSIGNED_BYTE&&(ae=n.RGBA8UI),re===n.UNSIGNED_SHORT&&(ae=n.RGBA16UI),re===n.UNSIGNED_INT&&(ae=n.RGBA32UI),re===n.BYTE&&(ae=n.RGBA8I),re===n.SHORT&&(ae=n.RGBA16I),re===n.INT&&(ae=n.RGBA32I)),O===n.RGB&&re===n.UNSIGNED_INT_5_9_9_9_REV&&(ae=n.RGB9_E5),O===n.RGBA){const F=Ee?Xo:gt.getTransfer(ve);re===n.FLOAT&&(ae=n.RGBA32F),re===n.HALF_FLOAT&&(ae=n.RGBA16F),re===n.UNSIGNED_BYTE&&(ae=F===bt?n.SRGB8_ALPHA8:n.RGBA8),re===n.UNSIGNED_SHORT_4_4_4_4&&(ae=n.RGBA4),re===n.UNSIGNED_SHORT_5_5_5_1&&(ae=n.RGB5_A1)}return(ae===n.R16F||ae===n.R32F||ae===n.RG16F||ae===n.RG32F||ae===n.RGBA16F||ae===n.RGBA32F)&&e.get("EXT_color_buffer_float"),ae}function E(z,O){let re;return z?O===null||O===Si||O===Ta?re=n.DEPTH24_STENCIL8:O===xr?re=n.DEPTH32F_STENCIL8:O===ps&&(re=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):O===null||O===Si||O===Ta?re=n.DEPTH_COMPONENT24:O===xr?re=n.DEPTH_COMPONENT32F:O===ps&&(re=n.DEPTH_COMPONENT16),re}function M(z,O){return g(z)===!0||z.isFramebufferTexture&&z.minFilter!==qn&&z.minFilter!==Xn?Math.log2(Math.max(O.width,O.height))+1:z.mipmaps!==void 0&&z.mipmaps.length>0?z.mipmaps.length:z.isCompressedTexture&&Array.isArray(z.image)?O.mipmaps.length:1}function w(z){const O=z.target;O.removeEventListener("dispose",w),C(O),O.isVideoTexture&&c.delete(O)}function b(z){const O=z.target;O.removeEventListener("dispose",b),S(O)}function C(z){const O=r.get(z);if(O.__webglInit===void 0)return;const re=z.source,ve=d.get(re);if(ve){const Ee=ve[O.__cacheKey];Ee.usedTimes--,Ee.usedTimes===0&&T(z),Object.keys(ve).length===0&&d.delete(re)}r.remove(z)}function T(z){const O=r.get(z);n.deleteTexture(O.__webglTexture);const re=z.source,ve=d.get(re);delete ve[O.__cacheKey],s.memory.textures--}function S(z){const O=r.get(z);if(z.depthTexture&&(z.depthTexture.dispose(),r.remove(z.depthTexture)),z.isWebGLCubeRenderTarget)for(let ve=0;ve<6;ve++){if(Array.isArray(O.__webglFramebuffer[ve]))for(let Ee=0;Ee<O.__webglFramebuffer[ve].length;Ee++)n.deleteFramebuffer(O.__webglFramebuffer[ve][Ee]);else n.deleteFramebuffer(O.__webglFramebuffer[ve]);O.__webglDepthbuffer&&n.deleteRenderbuffer(O.__webglDepthbuffer[ve])}else{if(Array.isArray(O.__webglFramebuffer))for(let ve=0;ve<O.__webglFramebuffer.length;ve++)n.deleteFramebuffer(O.__webglFramebuffer[ve]);else n.deleteFramebuffer(O.__webglFramebuffer);if(O.__webglDepthbuffer&&n.deleteRenderbuffer(O.__webglDepthbuffer),O.__webglMultisampledFramebuffer&&n.deleteFramebuffer(O.__webglMultisampledFramebuffer),O.__webglColorRenderbuffer)for(let ve=0;ve<O.__webglColorRenderbuffer.length;ve++)O.__webglColorRenderbuffer[ve]&&n.deleteRenderbuffer(O.__webglColorRenderbuffer[ve]);O.__webglDepthRenderbuffer&&n.deleteRenderbuffer(O.__webglDepthRenderbuffer)}const re=z.textures;for(let ve=0,Ee=re.length;ve<Ee;ve++){const ae=r.get(re[ve]);ae.__webglTexture&&(n.deleteTexture(ae.__webglTexture),s.memory.textures--),r.remove(re[ve])}r.remove(z)}let L=0;function N(){L=0}function I(){const z=L;return z>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+z+" texture units while this GPU supports only "+i.maxTextures),L+=1,z}function _(z){const O=[];return O.push(z.wrapS),O.push(z.wrapT),O.push(z.wrapR||0),O.push(z.magFilter),O.push(z.minFilter),O.push(z.anisotropy),O.push(z.internalFormat),O.push(z.format),O.push(z.type),O.push(z.generateMipmaps),O.push(z.premultiplyAlpha),O.push(z.flipY),O.push(z.unpackAlignment),O.push(z.colorSpace),O.join()}function P(z,O){const re=r.get(z);if(z.isVideoTexture&&de(z),z.isRenderTargetTexture===!1&&z.version>0&&re.__version!==z.version){const ve=z.image;if(ve===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ve.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{W(re,z,O);return}}t.bindTexture(n.TEXTURE_2D,re.__webglTexture,n.TEXTURE0+O)}function A(z,O){const re=r.get(z);if(z.version>0&&re.__version!==z.version){W(re,z,O);return}t.bindTexture(n.TEXTURE_2D_ARRAY,re.__webglTexture,n.TEXTURE0+O)}function D(z,O){const re=r.get(z);if(z.version>0&&re.__version!==z.version){W(re,z,O);return}t.bindTexture(n.TEXTURE_3D,re.__webglTexture,n.TEXTURE0+O)}function R(z,O){const re=r.get(z);if(z.version>0&&re.__version!==z.version){K(re,z,O);return}t.bindTexture(n.TEXTURE_CUBE_MAP,re.__webglTexture,n.TEXTURE0+O)}const B={[Cu]:n.REPEAT,[Ei]:n.CLAMP_TO_EDGE,[Ru]:n.MIRRORED_REPEAT},k={[qn]:n.NEAREST,[Fg]:n.NEAREST_MIPMAP_NEAREST,[Hs]:n.NEAREST_MIPMAP_LINEAR,[Xn]:n.LINEAR,[Al]:n.LINEAR_MIPMAP_NEAREST,[_i]:n.LINEAR_MIPMAP_LINEAR},V={[Vg]:n.NEVER,[Kg]:n.ALWAYS,[Hg]:n.LESS,[Wd]:n.LEQUAL,[Wg]:n.EQUAL,[qg]:n.GEQUAL,[Xg]:n.GREATER,[Yg]:n.NOTEQUAL};function Y(z,O){if(O.type===xr&&e.has("OES_texture_float_linear")===!1&&(O.magFilter===Xn||O.magFilter===Al||O.magFilter===Hs||O.magFilter===_i||O.minFilter===Xn||O.minFilter===Al||O.minFilter===Hs||O.minFilter===_i)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(z,n.TEXTURE_WRAP_S,B[O.wrapS]),n.texParameteri(z,n.TEXTURE_WRAP_T,B[O.wrapT]),(z===n.TEXTURE_3D||z===n.TEXTURE_2D_ARRAY)&&n.texParameteri(z,n.TEXTURE_WRAP_R,B[O.wrapR]),n.texParameteri(z,n.TEXTURE_MAG_FILTER,k[O.magFilter]),n.texParameteri(z,n.TEXTURE_MIN_FILTER,k[O.minFilter]),O.compareFunction&&(n.texParameteri(z,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(z,n.TEXTURE_COMPARE_FUNC,V[O.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(O.magFilter===qn||O.minFilter!==Hs&&O.minFilter!==_i||O.type===xr&&e.has("OES_texture_float_linear")===!1)return;if(O.anisotropy>1||r.get(O).__currentAnisotropy){const re=e.get("EXT_texture_filter_anisotropic");n.texParameterf(z,re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(O.anisotropy,i.getMaxAnisotropy())),r.get(O).__currentAnisotropy=O.anisotropy}}}function Z(z,O){let re=!1;z.__webglInit===void 0&&(z.__webglInit=!0,O.addEventListener("dispose",w));const ve=O.source;let Ee=d.get(ve);Ee===void 0&&(Ee={},d.set(ve,Ee));const ae=_(O);if(ae!==z.__cacheKey){Ee[ae]===void 0&&(Ee[ae]={texture:n.createTexture(),usedTimes:0},s.memory.textures++,re=!0),Ee[ae].usedTimes++;const F=Ee[z.__cacheKey];F!==void 0&&(Ee[z.__cacheKey].usedTimes--,F.usedTimes===0&&T(O)),z.__cacheKey=ae,z.__webglTexture=Ee[ae].texture}return re}function W(z,O,re){let ve=n.TEXTURE_2D;(O.isDataArrayTexture||O.isCompressedArrayTexture)&&(ve=n.TEXTURE_2D_ARRAY),O.isData3DTexture&&(ve=n.TEXTURE_3D);const Ee=Z(z,O),ae=O.source;t.bindTexture(ve,z.__webglTexture,n.TEXTURE0+re);const F=r.get(ae);if(ae.version!==F.__version||Ee===!0){t.activeTexture(n.TEXTURE0+re);const j=gt.getPrimaries(gt.workingColorSpace),ce=O.colorSpace===kr?null:gt.getPrimaries(O.colorSpace),le=O.colorSpace===kr||j===ce?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,O.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,O.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,O.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,le);let ee=m(O.image,!1,i.maxTextureSize);ee=we(O,ee);const J=a.convert(O.format,O.colorSpace),$=a.convert(O.type);let oe=y(O.internalFormat,J,$,O.colorSpace,O.isVideoTexture);Y(ve,O);let fe;const ye=O.mipmaps,xe=O.isVideoTexture!==!0,Ce=F.__version===void 0||Ee===!0,q=ae.dataReady,he=M(O,ee);if(O.isDepthTexture)oe=E(O.format===Sa,O.type),Ce&&(xe?t.texStorage2D(n.TEXTURE_2D,1,oe,ee.width,ee.height):t.texImage2D(n.TEXTURE_2D,0,oe,ee.width,ee.height,0,J,$,null));else if(O.isDataTexture)if(ye.length>0){xe&&Ce&&t.texStorage2D(n.TEXTURE_2D,he,oe,ye[0].width,ye[0].height);for(let se=0,ge=ye.length;se<ge;se++)fe=ye[se],xe?q&&t.texSubImage2D(n.TEXTURE_2D,se,0,0,fe.width,fe.height,J,$,fe.data):t.texImage2D(n.TEXTURE_2D,se,oe,fe.width,fe.height,0,J,$,fe.data);O.generateMipmaps=!1}else xe?(Ce&&t.texStorage2D(n.TEXTURE_2D,he,oe,ee.width,ee.height),q&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,ee.width,ee.height,J,$,ee.data)):t.texImage2D(n.TEXTURE_2D,0,oe,ee.width,ee.height,0,J,$,ee.data);else if(O.isCompressedTexture)if(O.isCompressedArrayTexture){xe&&Ce&&t.texStorage3D(n.TEXTURE_2D_ARRAY,he,oe,ye[0].width,ye[0].height,ee.depth);for(let se=0,ge=ye.length;se<ge;se++)if(fe=ye[se],O.format!==Yn)if(J!==null)if(xe){if(q)if(O.layerUpdates.size>0){const Re=Nf(fe.width,fe.height,O.format,O.type);for(const Ae of O.layerUpdates){const Fe=fe.data.subarray(Ae*Re/fe.data.BYTES_PER_ELEMENT,(Ae+1)*Re/fe.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,se,0,0,Ae,fe.width,fe.height,1,J,Fe)}O.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,se,0,0,0,fe.width,fe.height,ee.depth,J,fe.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,se,oe,fe.width,fe.height,ee.depth,0,fe.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else xe?q&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,se,0,0,0,fe.width,fe.height,ee.depth,J,$,fe.data):t.texImage3D(n.TEXTURE_2D_ARRAY,se,oe,fe.width,fe.height,ee.depth,0,J,$,fe.data)}else{xe&&Ce&&t.texStorage2D(n.TEXTURE_2D,he,oe,ye[0].width,ye[0].height);for(let se=0,ge=ye.length;se<ge;se++)fe=ye[se],O.format!==Yn?J!==null?xe?q&&t.compressedTexSubImage2D(n.TEXTURE_2D,se,0,0,fe.width,fe.height,J,fe.data):t.compressedTexImage2D(n.TEXTURE_2D,se,oe,fe.width,fe.height,0,fe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):xe?q&&t.texSubImage2D(n.TEXTURE_2D,se,0,0,fe.width,fe.height,J,$,fe.data):t.texImage2D(n.TEXTURE_2D,se,oe,fe.width,fe.height,0,J,$,fe.data)}else if(O.isDataArrayTexture)if(xe){if(Ce&&t.texStorage3D(n.TEXTURE_2D_ARRAY,he,oe,ee.width,ee.height,ee.depth),q)if(O.layerUpdates.size>0){const se=Nf(ee.width,ee.height,O.format,O.type);for(const ge of O.layerUpdates){const Re=ee.data.subarray(ge*se/ee.data.BYTES_PER_ELEMENT,(ge+1)*se/ee.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ge,ee.width,ee.height,1,J,$,Re)}O.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ee.width,ee.height,ee.depth,J,$,ee.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,oe,ee.width,ee.height,ee.depth,0,J,$,ee.data);else if(O.isData3DTexture)xe?(Ce&&t.texStorage3D(n.TEXTURE_3D,he,oe,ee.width,ee.height,ee.depth),q&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ee.width,ee.height,ee.depth,J,$,ee.data)):t.texImage3D(n.TEXTURE_3D,0,oe,ee.width,ee.height,ee.depth,0,J,$,ee.data);else if(O.isFramebufferTexture){if(Ce)if(xe)t.texStorage2D(n.TEXTURE_2D,he,oe,ee.width,ee.height);else{let se=ee.width,ge=ee.height;for(let Re=0;Re<he;Re++)t.texImage2D(n.TEXTURE_2D,Re,oe,se,ge,0,J,$,null),se>>=1,ge>>=1}}else if(ye.length>0){if(xe&&Ce){const se=Me(ye[0]);t.texStorage2D(n.TEXTURE_2D,he,oe,se.width,se.height)}for(let se=0,ge=ye.length;se<ge;se++)fe=ye[se],xe?q&&t.texSubImage2D(n.TEXTURE_2D,se,0,0,J,$,fe):t.texImage2D(n.TEXTURE_2D,se,oe,J,$,fe);O.generateMipmaps=!1}else if(xe){if(Ce){const se=Me(ee);t.texStorage2D(n.TEXTURE_2D,he,oe,se.width,se.height)}q&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,J,$,ee)}else t.texImage2D(n.TEXTURE_2D,0,oe,J,$,ee);g(O)&&p(ve),F.__version=ae.version,O.onUpdate&&O.onUpdate(O)}z.__version=O.version}function K(z,O,re){if(O.image.length!==6)return;const ve=Z(z,O),Ee=O.source;t.bindTexture(n.TEXTURE_CUBE_MAP,z.__webglTexture,n.TEXTURE0+re);const ae=r.get(Ee);if(Ee.version!==ae.__version||ve===!0){t.activeTexture(n.TEXTURE0+re);const F=gt.getPrimaries(gt.workingColorSpace),j=O.colorSpace===kr?null:gt.getPrimaries(O.colorSpace),ce=O.colorSpace===kr||F===j?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,O.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,O.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,O.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,ce);const le=O.isCompressedTexture||O.image[0].isCompressedTexture,ee=O.image[0]&&O.image[0].isDataTexture,J=[];for(let ge=0;ge<6;ge++)!le&&!ee?J[ge]=m(O.image[ge],!0,i.maxCubemapSize):J[ge]=ee?O.image[ge].image:O.image[ge],J[ge]=we(O,J[ge]);const $=J[0],oe=a.convert(O.format,O.colorSpace),fe=a.convert(O.type),ye=y(O.internalFormat,oe,fe,O.colorSpace),xe=O.isVideoTexture!==!0,Ce=ae.__version===void 0||ve===!0,q=Ee.dataReady;let he=M(O,$);Y(n.TEXTURE_CUBE_MAP,O);let se;if(le){xe&&Ce&&t.texStorage2D(n.TEXTURE_CUBE_MAP,he,ye,$.width,$.height);for(let ge=0;ge<6;ge++){se=J[ge].mipmaps;for(let Re=0;Re<se.length;Re++){const Ae=se[Re];O.format!==Yn?oe!==null?xe?q&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,Re,0,0,Ae.width,Ae.height,oe,Ae.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,Re,ye,Ae.width,Ae.height,0,Ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):xe?q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,Re,0,0,Ae.width,Ae.height,oe,fe,Ae.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,Re,ye,Ae.width,Ae.height,0,oe,fe,Ae.data)}}}else{if(se=O.mipmaps,xe&&Ce){se.length>0&&he++;const ge=Me(J[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,he,ye,ge.width,ge.height)}for(let ge=0;ge<6;ge++)if(ee){xe?q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,0,0,J[ge].width,J[ge].height,oe,fe,J[ge].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,ye,J[ge].width,J[ge].height,0,oe,fe,J[ge].data);for(let Re=0;Re<se.length;Re++){const Fe=se[Re].image[ge].image;xe?q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,Re+1,0,0,Fe.width,Fe.height,oe,fe,Fe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,Re+1,ye,Fe.width,Fe.height,0,oe,fe,Fe.data)}}else{xe?q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,0,0,oe,fe,J[ge]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,ye,oe,fe,J[ge]);for(let Re=0;Re<se.length;Re++){const Ae=se[Re];xe?q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,Re+1,0,0,oe,fe,Ae.image[ge]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ge,Re+1,ye,oe,fe,Ae.image[ge])}}}g(O)&&p(n.TEXTURE_CUBE_MAP),ae.__version=Ee.version,O.onUpdate&&O.onUpdate(O)}z.__version=O.version}function Q(z,O,re,ve,Ee,ae){const F=a.convert(re.format,re.colorSpace),j=a.convert(re.type),ce=y(re.internalFormat,F,j,re.colorSpace),le=r.get(O),ee=r.get(re);if(ee.__renderTarget=O,!le.__hasExternalTextures){const J=Math.max(1,O.width>>ae),$=Math.max(1,O.height>>ae);Ee===n.TEXTURE_3D||Ee===n.TEXTURE_2D_ARRAY?t.texImage3D(Ee,ae,ce,J,$,O.depth,0,F,j,null):t.texImage2D(Ee,ae,ce,J,$,0,F,j,null)}t.bindFramebuffer(n.FRAMEBUFFER,z),De(O)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,ve,Ee,ee.__webglTexture,0,Le(O)):(Ee===n.TEXTURE_2D||Ee>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Ee<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,ve,Ee,ee.__webglTexture,ae),t.bindFramebuffer(n.FRAMEBUFFER,null)}function ne(z,O,re){if(n.bindRenderbuffer(n.RENDERBUFFER,z),O.depthBuffer){const ve=O.depthTexture,Ee=ve&&ve.isDepthTexture?ve.type:null,ae=E(O.stencilBuffer,Ee),F=O.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,j=Le(O);De(O)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,j,ae,O.width,O.height):re?n.renderbufferStorageMultisample(n.RENDERBUFFER,j,ae,O.width,O.height):n.renderbufferStorage(n.RENDERBUFFER,ae,O.width,O.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,F,n.RENDERBUFFER,z)}else{const ve=O.textures;for(let Ee=0;Ee<ve.length;Ee++){const ae=ve[Ee],F=a.convert(ae.format,ae.colorSpace),j=a.convert(ae.type),ce=y(ae.internalFormat,F,j,ae.colorSpace),le=Le(O);re&&De(O)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,le,ce,O.width,O.height):De(O)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,le,ce,O.width,O.height):n.renderbufferStorage(n.RENDERBUFFER,ce,O.width,O.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function ie(z,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,z),!(O.depthTexture&&O.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ve=r.get(O.depthTexture);ve.__renderTarget=O,(!ve.__webglTexture||O.depthTexture.image.width!==O.width||O.depthTexture.image.height!==O.height)&&(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),P(O.depthTexture,0);const Ee=ve.__webglTexture,ae=Le(O);if(O.depthTexture.format===pa)De(O)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Ee,0,ae):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Ee,0);else if(O.depthTexture.format===Sa)De(O)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Ee,0,ae):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Ee,0);else throw new Error("Unknown depthTexture format")}function H(z){const O=r.get(z),re=z.isWebGLCubeRenderTarget===!0;if(O.__boundDepthTexture!==z.depthTexture){const ve=z.depthTexture;if(O.__depthDisposeCallback&&O.__depthDisposeCallback(),ve){const Ee=()=>{delete O.__boundDepthTexture,delete O.__depthDisposeCallback,ve.removeEventListener("dispose",Ee)};ve.addEventListener("dispose",Ee),O.__depthDisposeCallback=Ee}O.__boundDepthTexture=ve}if(z.depthTexture&&!O.__autoAllocateDepthBuffer){if(re)throw new Error("target.depthTexture not supported in Cube render targets");ie(O.__webglFramebuffer,z)}else if(re){O.__webglDepthbuffer=[];for(let ve=0;ve<6;ve++)if(t.bindFramebuffer(n.FRAMEBUFFER,O.__webglFramebuffer[ve]),O.__webglDepthbuffer[ve]===void 0)O.__webglDepthbuffer[ve]=n.createRenderbuffer(),ne(O.__webglDepthbuffer[ve],z,!1);else{const Ee=z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ae=O.__webglDepthbuffer[ve];n.bindRenderbuffer(n.RENDERBUFFER,ae),n.framebufferRenderbuffer(n.FRAMEBUFFER,Ee,n.RENDERBUFFER,ae)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,O.__webglFramebuffer),O.__webglDepthbuffer===void 0)O.__webglDepthbuffer=n.createRenderbuffer(),ne(O.__webglDepthbuffer,z,!1);else{const ve=z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ee=O.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,Ee),n.framebufferRenderbuffer(n.FRAMEBUFFER,ve,n.RENDERBUFFER,Ee)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function X(z,O,re){const ve=r.get(z);O!==void 0&&Q(ve.__webglFramebuffer,z,z.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),re!==void 0&&H(z)}function te(z){const O=z.texture,re=r.get(z),ve=r.get(O);z.addEventListener("dispose",b);const Ee=z.textures,ae=z.isWebGLCubeRenderTarget===!0,F=Ee.length>1;if(F||(ve.__webglTexture===void 0&&(ve.__webglTexture=n.createTexture()),ve.__version=O.version,s.memory.textures++),ae){re.__webglFramebuffer=[];for(let j=0;j<6;j++)if(O.mipmaps&&O.mipmaps.length>0){re.__webglFramebuffer[j]=[];for(let ce=0;ce<O.mipmaps.length;ce++)re.__webglFramebuffer[j][ce]=n.createFramebuffer()}else re.__webglFramebuffer[j]=n.createFramebuffer()}else{if(O.mipmaps&&O.mipmaps.length>0){re.__webglFramebuffer=[];for(let j=0;j<O.mipmaps.length;j++)re.__webglFramebuffer[j]=n.createFramebuffer()}else re.__webglFramebuffer=n.createFramebuffer();if(F)for(let j=0,ce=Ee.length;j<ce;j++){const le=r.get(Ee[j]);le.__webglTexture===void 0&&(le.__webglTexture=n.createTexture(),s.memory.textures++)}if(z.samples>0&&De(z)===!1){re.__webglMultisampledFramebuffer=n.createFramebuffer(),re.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,re.__webglMultisampledFramebuffer);for(let j=0;j<Ee.length;j++){const ce=Ee[j];re.__webglColorRenderbuffer[j]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,re.__webglColorRenderbuffer[j]);const le=a.convert(ce.format,ce.colorSpace),ee=a.convert(ce.type),J=y(ce.internalFormat,le,ee,ce.colorSpace,z.isXRRenderTarget===!0),$=Le(z);n.renderbufferStorageMultisample(n.RENDERBUFFER,$,J,z.width,z.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+j,n.RENDERBUFFER,re.__webglColorRenderbuffer[j])}n.bindRenderbuffer(n.RENDERBUFFER,null),z.depthBuffer&&(re.__webglDepthRenderbuffer=n.createRenderbuffer(),ne(re.__webglDepthRenderbuffer,z,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ae){t.bindTexture(n.TEXTURE_CUBE_MAP,ve.__webglTexture),Y(n.TEXTURE_CUBE_MAP,O);for(let j=0;j<6;j++)if(O.mipmaps&&O.mipmaps.length>0)for(let ce=0;ce<O.mipmaps.length;ce++)Q(re.__webglFramebuffer[j][ce],z,O,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+j,ce);else Q(re.__webglFramebuffer[j],z,O,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+j,0);g(O)&&p(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(F){for(let j=0,ce=Ee.length;j<ce;j++){const le=Ee[j],ee=r.get(le);t.bindTexture(n.TEXTURE_2D,ee.__webglTexture),Y(n.TEXTURE_2D,le),Q(re.__webglFramebuffer,z,le,n.COLOR_ATTACHMENT0+j,n.TEXTURE_2D,0),g(le)&&p(n.TEXTURE_2D)}t.unbindTexture()}else{let j=n.TEXTURE_2D;if((z.isWebGL3DRenderTarget||z.isWebGLArrayRenderTarget)&&(j=z.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(j,ve.__webglTexture),Y(j,O),O.mipmaps&&O.mipmaps.length>0)for(let ce=0;ce<O.mipmaps.length;ce++)Q(re.__webglFramebuffer[ce],z,O,n.COLOR_ATTACHMENT0,j,ce);else Q(re.__webglFramebuffer,z,O,n.COLOR_ATTACHMENT0,j,0);g(O)&&p(j),t.unbindTexture()}z.depthBuffer&&H(z)}function ue(z){const O=z.textures;for(let re=0,ve=O.length;re<ve;re++){const Ee=O[re];if(g(Ee)){const ae=x(z),F=r.get(Ee).__webglTexture;t.bindTexture(ae,F),p(ae),t.unbindTexture()}}}const Se=[],U=[];function Ge(z){if(z.samples>0){if(De(z)===!1){const O=z.textures,re=z.width,ve=z.height;let Ee=n.COLOR_BUFFER_BIT;const ae=z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,F=r.get(z),j=O.length>1;if(j)for(let ce=0;ce<O.length;ce++)t.bindFramebuffer(n.FRAMEBUFFER,F.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ce,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,F.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+ce,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,F.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,F.__webglFramebuffer);for(let ce=0;ce<O.length;ce++){if(z.resolveDepthBuffer&&(z.depthBuffer&&(Ee|=n.DEPTH_BUFFER_BIT),z.stencilBuffer&&z.resolveStencilBuffer&&(Ee|=n.STENCIL_BUFFER_BIT)),j){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,F.__webglColorRenderbuffer[ce]);const le=r.get(O[ce]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,le,0)}n.blitFramebuffer(0,0,re,ve,0,0,re,ve,Ee,n.NEAREST),l===!0&&(Se.length=0,U.length=0,Se.push(n.COLOR_ATTACHMENT0+ce),z.depthBuffer&&z.resolveDepthBuffer===!1&&(Se.push(ae),U.push(ae),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,U)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Se))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),j)for(let ce=0;ce<O.length;ce++){t.bindFramebuffer(n.FRAMEBUFFER,F.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ce,n.RENDERBUFFER,F.__webglColorRenderbuffer[ce]);const le=r.get(O[ce]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,F.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+ce,n.TEXTURE_2D,le,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,F.__webglMultisampledFramebuffer)}else if(z.depthBuffer&&z.resolveDepthBuffer===!1&&l){const O=z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[O])}}}function Le(z){return Math.min(i.maxSamples,z.samples)}function De(z){const O=r.get(z);return z.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&O.__useRenderToTexture!==!1}function de(z){const O=s.render.frame;c.get(z)!==O&&(c.set(z,O),z.update())}function we(z,O){const re=z.colorSpace,ve=z.format,Ee=z.type;return z.isCompressedTexture===!0||z.isVideoTexture===!0||re!==Ma&&re!==kr&&(gt.getTransfer(re)===bt?(ve!==Yn||Ee!==br)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",re)),O}function Me(z){return typeof HTMLImageElement<"u"&&z instanceof HTMLImageElement?(u.width=z.naturalWidth||z.width,u.height=z.naturalHeight||z.height):typeof VideoFrame<"u"&&z instanceof VideoFrame?(u.width=z.displayWidth,u.height=z.displayHeight):(u.width=z.width,u.height=z.height),u}this.allocateTextureUnit=I,this.resetTextureUnits=N,this.setTexture2D=P,this.setTexture2DArray=A,this.setTexture3D=D,this.setTextureCube=R,this.rebindTextures=X,this.setupRenderTarget=te,this.updateRenderTargetMipmap=ue,this.updateMultisampleRenderTarget=Ge,this.setupDepthRenderbuffer=H,this.setupFrameBufferTexture=Q,this.useMultisampledRTT=De}function x_(n,e){function t(r,i=kr){let a;const s=gt.getTransfer(i);if(r===br)return n.UNSIGNED_BYTE;if(r===Sc)return n.UNSIGNED_SHORT_4_4_4_4;if(r===Mc)return n.UNSIGNED_SHORT_5_5_5_1;if(r===Fd)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===Id)return n.BYTE;if(r===Od)return n.SHORT;if(r===ps)return n.UNSIGNED_SHORT;if(r===Tc)return n.INT;if(r===Si)return n.UNSIGNED_INT;if(r===xr)return n.FLOAT;if(r===Cs)return n.HALF_FLOAT;if(r===Ud)return n.ALPHA;if(r===Bd)return n.RGB;if(r===Yn)return n.RGBA;if(r===kd)return n.LUMINANCE;if(r===zd)return n.LUMINANCE_ALPHA;if(r===pa)return n.DEPTH_COMPONENT;if(r===Sa)return n.DEPTH_STENCIL;if(r===Gd)return n.RED;if(r===wc)return n.RED_INTEGER;if(r===Vd)return n.RG;if(r===Ac)return n.RG_INTEGER;if(r===Cc)return n.RGBA_INTEGER;if(r===Ao||r===Co||r===Ro||r===Do)if(s===bt)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===Ao)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Co)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Ro)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Do)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===Ao)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Co)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Ro)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Do)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===Du||r===Lu||r===Pu||r===Nu)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===Du)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Lu)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Pu)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Nu)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===Iu||r===Ou||r===Fu)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===Iu||r===Ou)return s===bt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===Fu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===Uu||r===Bu||r===ku||r===zu||r===Gu||r===Vu||r===Hu||r===Wu||r===Xu||r===Yu||r===qu||r===Ku||r===$u||r===Zu)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===Uu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===Bu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===ku)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===zu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Gu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===Vu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===Hu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===Wu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===Xu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===Yu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===qu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===Ku)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===$u)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===Zu)return s===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Lo||r===Qu||r===Ju)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===Lo)return s===bt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===Qu)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===Ju)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===Hd||r===ju||r===ec||r===tc)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(r===Lo)return a.COMPRESSED_RED_RGTC1_EXT;if(r===ju)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===ec)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===tc)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Ta?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}const E_={type:"move"};class eu{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new oo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new oo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Te,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Te),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new oo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Te,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Te),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,a=null,s=null;const o=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){s=!0;for(const m of e.hand.values()){const g=t.getJointPose(m,r),p=this._getHandJoint(u,m);g!==null&&(p.matrix.fromArray(g.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=g.radius),p.visible=g!==null}const c=u.joints["index-finger-tip"],f=u.joints["thumb-tip"],d=c.position.distanceTo(f.position),h=.02,v=.005;u.inputState.pinching&&d>h+v?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&d<=h-v&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,r),a!==null&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,a.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(a.linearVelocity)):l.hasLinearVelocity=!1,a.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(a.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&a!==null&&(i=a),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(E_)))}return o!==null&&(o.visible=i!==null),l!==null&&(l.visible=a!==null),u!==null&&(u.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new oo;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}const __=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,b_=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class T_{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new pn,a=e.properties.get(i);a.__webglTexture=t.texture,(t.depthNear!==r.depthNear||t.depthFar!==r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new qr({vertexShader:__,fragmentShader:b_,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new rr(new Ls(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class S_ extends Ni{constructor(e,t){super();const r=this;let i=null,a=1,s=null,o="local-floor",l=1,u=null,c=null,f=null,d=null,h=null,v=null;const m=new T_,g=t.getContextAttributes();let p=null,x=null;const y=[],E=[],M=new ot;let w=null;const b=new Vn;b.viewport=new Ft;const C=new Vn;C.viewport=new Ft;const T=[b,C],S=new Wm;let L=null,N=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(W){let K=y[W];return K===void 0&&(K=new eu,y[W]=K),K.getTargetRaySpace()},this.getControllerGrip=function(W){let K=y[W];return K===void 0&&(K=new eu,y[W]=K),K.getGripSpace()},this.getHand=function(W){let K=y[W];return K===void 0&&(K=new eu,y[W]=K),K.getHandSpace()};function I(W){const K=E.indexOf(W.inputSource);if(K===-1)return;const Q=y[K];Q!==void 0&&(Q.update(W.inputSource,W.frame,u||s),Q.dispatchEvent({type:W.type,data:W.inputSource}))}function _(){i.removeEventListener("select",I),i.removeEventListener("selectstart",I),i.removeEventListener("selectend",I),i.removeEventListener("squeeze",I),i.removeEventListener("squeezestart",I),i.removeEventListener("squeezeend",I),i.removeEventListener("end",_),i.removeEventListener("inputsourceschange",P);for(let W=0;W<y.length;W++){const K=E[W];K!==null&&(E[W]=null,y[W].disconnect(K))}L=null,N=null,m.reset(),e.setRenderTarget(p),h=null,d=null,f=null,i=null,x=null,Z.stop(),r.isPresenting=!1,e.setPixelRatio(w),e.setSize(M.width,M.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(W){a=W,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){o=W,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||s},this.setReferenceSpace=function(W){u=W},this.getBaseLayer=function(){return d!==null?d:h},this.getBinding=function(){return f},this.getFrame=function(){return v},this.getSession=function(){return i},this.setSession=async function(W){if(i=W,i!==null){if(p=e.getRenderTarget(),i.addEventListener("select",I),i.addEventListener("selectstart",I),i.addEventListener("selectend",I),i.addEventListener("squeeze",I),i.addEventListener("squeezestart",I),i.addEventListener("squeezeend",I),i.addEventListener("end",_),i.addEventListener("inputsourceschange",P),g.xrCompatible!==!0&&await t.makeXRCompatible(),w=e.getPixelRatio(),e.getSize(M),i.enabledFeatures!==void 0&&i.enabledFeatures.includes("layers")){let Q=null,ne=null,ie=null;g.depth&&(ie=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Q=g.stencil?Sa:pa,ne=g.stencil?Ta:Si);const H={colorFormat:t.RGBA8,depthFormat:ie,scaleFactor:a};f=new XRWebGLBinding(i,t),d=f.createProjectionLayer(H),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),x=new Mi(d.textureWidth,d.textureHeight,{format:Yn,type:br,depthTexture:new rp(d.textureWidth,d.textureHeight,ne,void 0,void 0,void 0,void 0,void 0,void 0,Q),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}else{const Q={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:a};h=new XRWebGLLayer(i,t,Q),i.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),x=new Mi(h.framebufferWidth,h.framebufferHeight,{format:Yn,type:br,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}x.isXRRenderTarget=!0,this.setFoveation(l),u=null,s=await i.requestReferenceSpace(o),Z.setContext(i),Z.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};function P(W){for(let K=0;K<W.removed.length;K++){const Q=W.removed[K],ne=E.indexOf(Q);ne>=0&&(E[ne]=null,y[ne].disconnect(Q))}for(let K=0;K<W.added.length;K++){const Q=W.added[K];let ne=E.indexOf(Q);if(ne===-1){for(let H=0;H<y.length;H++)if(H>=E.length){E.push(Q),ne=H;break}else if(E[H]===null){E[H]=Q,ne=H;break}if(ne===-1)break}const ie=y[ne];ie&&ie.connect(Q)}}const A=new Te,D=new Te;function R(W,K,Q){A.setFromMatrixPosition(K.matrixWorld),D.setFromMatrixPosition(Q.matrixWorld);const ne=A.distanceTo(D),ie=K.projectionMatrix.elements,H=Q.projectionMatrix.elements,X=ie[14]/(ie[10]-1),te=ie[14]/(ie[10]+1),ue=(ie[9]+1)/ie[5],Se=(ie[9]-1)/ie[5],U=(ie[8]-1)/ie[0],Ge=(H[8]+1)/H[0],Le=X*U,De=X*Ge,de=ne/(-U+Ge),we=de*-U;if(K.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(we),W.translateZ(de),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert(),ie[10]===-1)W.projectionMatrix.copy(K.projectionMatrix),W.projectionMatrixInverse.copy(K.projectionMatrixInverse);else{const Me=X+de,z=te+de,O=Le-we,re=De+(ne-we),ve=ue*te/z*Me,Ee=Se*te/z*Me;W.projectionMatrix.makePerspective(O,re,ve,Ee,Me,z),W.projectionMatrixInverse.copy(W.projectionMatrix).invert()}}function B(W,K){K===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(K.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}this.updateCamera=function(W){if(i===null)return;let K=W.near,Q=W.far;m.texture!==null&&(m.depthNear>0&&(K=m.depthNear),m.depthFar>0&&(Q=m.depthFar)),S.near=C.near=b.near=K,S.far=C.far=b.far=Q,(L!==S.near||N!==S.far)&&(i.updateRenderState({depthNear:S.near,depthFar:S.far}),L=S.near,N=S.far),b.layers.mask=W.layers.mask|2,C.layers.mask=W.layers.mask|4,S.layers.mask=b.layers.mask|C.layers.mask;const ne=W.parent,ie=S.cameras;B(S,ne);for(let H=0;H<ie.length;H++)B(ie[H],ne);ie.length===2?R(S,b,C):S.projectionMatrix.copy(b.projectionMatrix),k(W,S,ne)};function k(W,K,Q){Q===null?W.matrix.copy(K.matrixWorld):(W.matrix.copy(Q.matrixWorld),W.matrix.invert(),W.matrix.multiply(K.matrixWorld)),W.matrix.decompose(W.position,W.quaternion,W.scale),W.updateMatrixWorld(!0),W.projectionMatrix.copy(K.projectionMatrix),W.projectionMatrixInverse.copy(K.projectionMatrixInverse),W.isPerspectiveCamera&&(W.fov=vs*2*Math.atan(1/W.projectionMatrix.elements[5]),W.zoom=1)}this.getCamera=function(){return S},this.getFoveation=function(){if(!(d===null&&h===null))return l},this.setFoveation=function(W){l=W,d!==null&&(d.fixedFoveation=W),h!==null&&h.fixedFoveation!==void 0&&(h.fixedFoveation=W)},this.hasDepthSensing=function(){return m.texture!==null},this.getDepthSensingMesh=function(){return m.getMesh(S)};let V=null;function Y(W,K){if(c=K.getViewerPose(u||s),v=K,c!==null){const Q=c.views;h!==null&&(e.setRenderTargetFramebuffer(x,h.framebuffer),e.setRenderTarget(x));let ne=!1;Q.length!==S.cameras.length&&(S.cameras.length=0,ne=!0);for(let H=0;H<Q.length;H++){const X=Q[H];let te=null;if(h!==null)te=h.getViewport(X);else{const Se=f.getViewSubImage(d,X);te=Se.viewport,H===0&&(e.setRenderTargetTextures(x,Se.colorTexture,d.ignoreDepthValues?void 0:Se.depthStencilTexture),e.setRenderTarget(x))}let ue=T[H];ue===void 0&&(ue=new Vn,ue.layers.enable(H),ue.viewport=new Ft,T[H]=ue),ue.matrix.fromArray(X.transform.matrix),ue.matrix.decompose(ue.position,ue.quaternion,ue.scale),ue.projectionMatrix.fromArray(X.projectionMatrix),ue.projectionMatrixInverse.copy(ue.projectionMatrix).invert(),ue.viewport.set(te.x,te.y,te.width,te.height),H===0&&(S.matrix.copy(ue.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),ne===!0&&S.cameras.push(ue)}const ie=i.enabledFeatures;if(ie&&ie.includes("depth-sensing")){const H=f.getDepthInformation(Q[0]);H&&H.isValid&&H.texture&&m.init(e,H,i.renderState)}}for(let Q=0;Q<y.length;Q++){const ne=E[Q],ie=y[Q];ne!==null&&ie!==void 0&&ie.update(ne,K,u||s)}V&&V(W,K),K.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:K}),v=null}const Z=new ap;Z.setAnimationLoop(Y),this.setAnimationLoop=function(W){V=W},this.dispose=function(){}}}const fi=new Tr,M_=new Bt;function w_(n,e){function t(g,p){g.matrixAutoUpdate===!0&&g.updateMatrix(),p.value.copy(g.matrix)}function r(g,p){p.color.getRGB(g.fogColor.value,jd(n)),p.isFog?(g.fogNear.value=p.near,g.fogFar.value=p.far):p.isFogExp2&&(g.fogDensity.value=p.density)}function i(g,p,x,y,E){p.isMeshBasicMaterial||p.isMeshLambertMaterial?a(g,p):p.isMeshToonMaterial?(a(g,p),f(g,p)):p.isMeshPhongMaterial?(a(g,p),c(g,p)):p.isMeshStandardMaterial?(a(g,p),d(g,p),p.isMeshPhysicalMaterial&&h(g,p,E)):p.isMeshMatcapMaterial?(a(g,p),v(g,p)):p.isMeshDepthMaterial?a(g,p):p.isMeshDistanceMaterial?(a(g,p),m(g,p)):p.isMeshNormalMaterial?a(g,p):p.isLineBasicMaterial?(s(g,p),p.isLineDashedMaterial&&o(g,p)):p.isPointsMaterial?l(g,p,x,y):p.isSpriteMaterial?u(g,p):p.isShadowMaterial?(g.color.value.copy(p.color),g.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function a(g,p){g.opacity.value=p.opacity,p.color&&g.diffuse.value.copy(p.color),p.emissive&&g.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(g.map.value=p.map,t(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.bumpMap&&(g.bumpMap.value=p.bumpMap,t(p.bumpMap,g.bumpMapTransform),g.bumpScale.value=p.bumpScale,p.side===xn&&(g.bumpScale.value*=-1)),p.normalMap&&(g.normalMap.value=p.normalMap,t(p.normalMap,g.normalMapTransform),g.normalScale.value.copy(p.normalScale),p.side===xn&&g.normalScale.value.negate()),p.displacementMap&&(g.displacementMap.value=p.displacementMap,t(p.displacementMap,g.displacementMapTransform),g.displacementScale.value=p.displacementScale,g.displacementBias.value=p.displacementBias),p.emissiveMap&&(g.emissiveMap.value=p.emissiveMap,t(p.emissiveMap,g.emissiveMapTransform)),p.specularMap&&(g.specularMap.value=p.specularMap,t(p.specularMap,g.specularMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest);const x=e.get(p),y=x.envMap,E=x.envMapRotation;y&&(g.envMap.value=y,fi.copy(E),fi.x*=-1,fi.y*=-1,fi.z*=-1,y.isCubeTexture&&y.isRenderTargetTexture===!1&&(fi.y*=-1,fi.z*=-1),g.envMapRotation.value.setFromMatrix4(M_.makeRotationFromEuler(fi)),g.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=p.reflectivity,g.ior.value=p.ior,g.refractionRatio.value=p.refractionRatio),p.lightMap&&(g.lightMap.value=p.lightMap,g.lightMapIntensity.value=p.lightMapIntensity,t(p.lightMap,g.lightMapTransform)),p.aoMap&&(g.aoMap.value=p.aoMap,g.aoMapIntensity.value=p.aoMapIntensity,t(p.aoMap,g.aoMapTransform))}function s(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,p.map&&(g.map.value=p.map,t(p.map,g.mapTransform))}function o(g,p){g.dashSize.value=p.dashSize,g.totalSize.value=p.dashSize+p.gapSize,g.scale.value=p.scale}function l(g,p,x,y){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.size.value=p.size*x,g.scale.value=y*.5,p.map&&(g.map.value=p.map,t(p.map,g.uvTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function u(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.rotation.value=p.rotation,p.map&&(g.map.value=p.map,t(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,t(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function c(g,p){g.specular.value.copy(p.specular),g.shininess.value=Math.max(p.shininess,1e-4)}function f(g,p){p.gradientMap&&(g.gradientMap.value=p.gradientMap)}function d(g,p){g.metalness.value=p.metalness,p.metalnessMap&&(g.metalnessMap.value=p.metalnessMap,t(p.metalnessMap,g.metalnessMapTransform)),g.roughness.value=p.roughness,p.roughnessMap&&(g.roughnessMap.value=p.roughnessMap,t(p.roughnessMap,g.roughnessMapTransform)),p.envMap&&(g.envMapIntensity.value=p.envMapIntensity)}function h(g,p,x){g.ior.value=p.ior,p.sheen>0&&(g.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),g.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(g.sheenColorMap.value=p.sheenColorMap,t(p.sheenColorMap,g.sheenColorMapTransform)),p.sheenRoughnessMap&&(g.sheenRoughnessMap.value=p.sheenRoughnessMap,t(p.sheenRoughnessMap,g.sheenRoughnessMapTransform))),p.clearcoat>0&&(g.clearcoat.value=p.clearcoat,g.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(g.clearcoatMap.value=p.clearcoatMap,t(p.clearcoatMap,g.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,t(p.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(g.clearcoatNormalMap.value=p.clearcoatNormalMap,t(p.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===xn&&g.clearcoatNormalScale.value.negate())),p.dispersion>0&&(g.dispersion.value=p.dispersion),p.iridescence>0&&(g.iridescence.value=p.iridescence,g.iridescenceIOR.value=p.iridescenceIOR,g.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(g.iridescenceMap.value=p.iridescenceMap,t(p.iridescenceMap,g.iridescenceMapTransform)),p.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=p.iridescenceThicknessMap,t(p.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),p.transmission>0&&(g.transmission.value=p.transmission,g.transmissionSamplerMap.value=x.texture,g.transmissionSamplerSize.value.set(x.width,x.height),p.transmissionMap&&(g.transmissionMap.value=p.transmissionMap,t(p.transmissionMap,g.transmissionMapTransform)),g.thickness.value=p.thickness,p.thicknessMap&&(g.thicknessMap.value=p.thicknessMap,t(p.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=p.attenuationDistance,g.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(g.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(g.anisotropyMap.value=p.anisotropyMap,t(p.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=p.specularIntensity,g.specularColor.value.copy(p.specularColor),p.specularColorMap&&(g.specularColorMap.value=p.specularColorMap,t(p.specularColorMap,g.specularColorMapTransform)),p.specularIntensityMap&&(g.specularIntensityMap.value=p.specularIntensityMap,t(p.specularIntensityMap,g.specularIntensityMapTransform))}function v(g,p){p.matcap&&(g.matcap.value=p.matcap)}function m(g,p){const x=e.get(p).light;g.referencePosition.value.setFromMatrixPosition(x.matrixWorld),g.nearDistance.value=x.shadow.camera.near,g.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function A_(n,e,t,r){let i={},a={},s=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(x,y){const E=y.program;r.uniformBlockBinding(x,E)}function u(x,y){let E=i[x.id];E===void 0&&(v(x),E=c(x),i[x.id]=E,x.addEventListener("dispose",g));const M=y.program;r.updateUBOMapping(x,M);const w=e.render.frame;a[x.id]!==w&&(d(x),a[x.id]=w)}function c(x){const y=f();x.__bindingPointIndex=y;const E=n.createBuffer(),M=x.__size,w=x.usage;return n.bindBuffer(n.UNIFORM_BUFFER,E),n.bufferData(n.UNIFORM_BUFFER,M,w),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,y,E),E}function f(){for(let x=0;x<o;x++)if(s.indexOf(x)===-1)return s.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(x){const y=i[x.id],E=x.uniforms,M=x.__cache;n.bindBuffer(n.UNIFORM_BUFFER,y);for(let w=0,b=E.length;w<b;w++){const C=Array.isArray(E[w])?E[w]:[E[w]];for(let T=0,S=C.length;T<S;T++){const L=C[T];if(h(L,w,T,M)===!0){const N=L.__offset,I=Array.isArray(L.value)?L.value:[L.value];let _=0;for(let P=0;P<I.length;P++){const A=I[P],D=m(A);typeof A=="number"||typeof A=="boolean"?(L.__data[0]=A,n.bufferSubData(n.UNIFORM_BUFFER,N+_,L.__data)):A.isMatrix3?(L.__data[0]=A.elements[0],L.__data[1]=A.elements[1],L.__data[2]=A.elements[2],L.__data[3]=0,L.__data[4]=A.elements[3],L.__data[5]=A.elements[4],L.__data[6]=A.elements[5],L.__data[7]=0,L.__data[8]=A.elements[6],L.__data[9]=A.elements[7],L.__data[10]=A.elements[8],L.__data[11]=0):(A.toArray(L.__data,_),_+=D.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,N,L.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function h(x,y,E,M){const w=x.value,b=y+"_"+E;if(M[b]===void 0)return typeof w=="number"||typeof w=="boolean"?M[b]=w:M[b]=w.clone(),!0;{const C=M[b];if(typeof w=="number"||typeof w=="boolean"){if(C!==w)return M[b]=w,!0}else if(C.equals(w)===!1)return C.copy(w),!0}return!1}function v(x){const y=x.uniforms;let E=0;const M=16;for(let b=0,C=y.length;b<C;b++){const T=Array.isArray(y[b])?y[b]:[y[b]];for(let S=0,L=T.length;S<L;S++){const N=T[S],I=Array.isArray(N.value)?N.value:[N.value];for(let _=0,P=I.length;_<P;_++){const A=I[_],D=m(A),R=E%M,B=R%D.boundary,k=R+B;E+=B,k!==0&&M-k<D.storage&&(E+=M-k),N.__data=new Float32Array(D.storage/Float32Array.BYTES_PER_ELEMENT),N.__offset=E,E+=D.storage}}}const w=E%M;return w>0&&(E+=M-w),x.__size=E,x.__cache={},this}function m(x){const y={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(y.boundary=4,y.storage=4):x.isVector2?(y.boundary=8,y.storage=8):x.isVector3||x.isColor?(y.boundary=16,y.storage=12):x.isVector4?(y.boundary=16,y.storage=16):x.isMatrix3?(y.boundary=48,y.storage=48):x.isMatrix4?(y.boundary=64,y.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),y}function g(x){const y=x.target;y.removeEventListener("dispose",g);const E=s.indexOf(y.__bindingPointIndex);s.splice(E,1),n.deleteBuffer(i[y.id]),delete i[y.id],delete a[y.id]}function p(){for(const x in i)n.deleteBuffer(i[x]);s=[],i={},a={}}return{bind:l,update:u,dispose:p}}class C_{constructor(e={}){const{canvas:t=hm(),context:r=null,depth:i=!0,stencil:a=!1,alpha:s=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:f=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let h;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=r.getContextAttributes().alpha}else h=s;const v=new Uint32Array(4),m=new Int32Array(4);let g=null,p=null;const x=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Nn,this.toneMapping=Hr,this.toneMappingExposure=1;const E=this;let M=!1,w=0,b=0,C=null,T=-1,S=null;const L=new Ft,N=new Ft;let I=null;const _=new St(0);let P=0,A=t.width,D=t.height,R=1,B=null,k=null;const V=new Ft(0,0,A,D),Y=new Ft(0,0,A,D);let Z=!1;const W=new np;let K=!1,Q=!1;this.transmissionResolutionScale=1;const ne=new Bt,ie=new Bt,H=new Te,X=new Ft,te={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ue=!1;function Se(){return C===null?R:1}let U=r;function Ge(G,pe){return t.getContext(G,pe)}try{const G={alpha:!0,depth:i,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:f};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${bc}`),t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",Re,!1),t.addEventListener("webglcontextcreationerror",Ae,!1),U===null){const pe="webgl2";if(U=Ge(pe,G),U===null)throw Ge(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(G){throw console.error("THREE.WebGLRenderer: "+G.message),G}let Le,De,de,we,Me,z,O,re,ve,Ee,ae,F,j,ce,le,ee,J,$,oe,fe,ye,xe,Ce,q;function he(){Le=new Ux(U),Le.init(),xe=new x_(U,Le),De=new Lx(U,Le,e,xe),de=new m_(U,Le),De.reverseDepthBuffer&&d&&de.buffers.depth.setReversed(!0),we=new zx(U),Me=new i_,z=new y_(U,Le,de,Me,De,xe,we),O=new Nx(E),re=new Fx(E),ve=new qm(U),Ce=new Rx(U,ve),Ee=new Bx(U,ve,we,Ce),ae=new Vx(U,Ee,ve,we),oe=new Gx(U,De,z),ee=new Px(Me),F=new r_(E,O,re,Le,De,Ce,ee),j=new w_(E,Me),ce=new s_,le=new h_(Le),$=new Cx(E,O,re,de,ae,h,l),J=new v_(E,ae,De),q=new A_(U,we,De,de),fe=new Dx(U,Le,we),ye=new kx(U,Le,we),we.programs=F.programs,E.capabilities=De,E.extensions=Le,E.properties=Me,E.renderLists=ce,E.shadowMap=J,E.state=de,E.info=we}he();const se=new S_(E,U);this.xr=se,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){const G=Le.get("WEBGL_lose_context");G&&G.loseContext()},this.forceContextRestore=function(){const G=Le.get("WEBGL_lose_context");G&&G.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(G){G!==void 0&&(R=G,this.setSize(A,D,!1))},this.getSize=function(G){return G.set(A,D)},this.setSize=function(G,pe,_e=!0){if(se.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}A=G,D=pe,t.width=Math.floor(G*R),t.height=Math.floor(pe*R),_e===!0&&(t.style.width=G+"px",t.style.height=pe+"px"),this.setViewport(0,0,G,pe)},this.getDrawingBufferSize=function(G){return G.set(A*R,D*R).floor()},this.setDrawingBufferSize=function(G,pe,_e){A=G,D=pe,R=_e,t.width=Math.floor(G*_e),t.height=Math.floor(pe*_e),this.setViewport(0,0,G,pe)},this.getCurrentViewport=function(G){return G.copy(L)},this.getViewport=function(G){return G.copy(V)},this.setViewport=function(G,pe,_e,be){G.isVector4?V.set(G.x,G.y,G.z,G.w):V.set(G,pe,_e,be),de.viewport(L.copy(V).multiplyScalar(R).round())},this.getScissor=function(G){return G.copy(Y)},this.setScissor=function(G,pe,_e,be){G.isVector4?Y.set(G.x,G.y,G.z,G.w):Y.set(G,pe,_e,be),de.scissor(N.copy(Y).multiplyScalar(R).round())},this.getScissorTest=function(){return Z},this.setScissorTest=function(G){de.setScissorTest(Z=G)},this.setOpaqueSort=function(G){B=G},this.setTransparentSort=function(G){k=G},this.getClearColor=function(G){return G.copy($.getClearColor())},this.setClearColor=function(){$.setClearColor.apply($,arguments)},this.getClearAlpha=function(){return $.getClearAlpha()},this.setClearAlpha=function(){$.setClearAlpha.apply($,arguments)},this.clear=function(G=!0,pe=!0,_e=!0){let be=0;if(G){let me=!1;if(C!==null){const Pe=C.texture.format;me=Pe===Cc||Pe===Ac||Pe===wc}if(me){const Pe=C.texture.type,Ue=Pe===br||Pe===Si||Pe===ps||Pe===Ta||Pe===Sc||Pe===Mc,Xe=$.getClearColor(),Ye=$.getClearAlpha(),Ze=Xe.r,He=Xe.g,Ne=Xe.b;Ue?(v[0]=Ze,v[1]=He,v[2]=Ne,v[3]=Ye,U.clearBufferuiv(U.COLOR,0,v)):(m[0]=Ze,m[1]=He,m[2]=Ne,m[3]=Ye,U.clearBufferiv(U.COLOR,0,m))}else be|=U.COLOR_BUFFER_BIT}pe&&(be|=U.DEPTH_BUFFER_BIT),_e&&(be|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(be)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",Re,!1),t.removeEventListener("webglcontextcreationerror",Ae,!1),$.dispose(),ce.dispose(),le.dispose(),Me.dispose(),O.dispose(),re.dispose(),ae.dispose(),Ce.dispose(),q.dispose(),F.dispose(),se.dispose(),se.removeEventListener("sessionstart",pt),se.removeEventListener("sessionend",je),Qe.stop()};function ge(G){G.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function Re(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const G=we.autoReset,pe=J.enabled,_e=J.autoUpdate,be=J.needsUpdate,me=J.type;he(),we.autoReset=G,J.enabled=pe,J.autoUpdate=_e,J.needsUpdate=be,J.type=me}function Ae(G){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",G.statusMessage)}function Fe(G){const pe=G.target;pe.removeEventListener("dispose",Fe),Ie(pe)}function Ie(G){Oe(G),Me.remove(G)}function Oe(G){const pe=Me.get(G).programs;pe!==void 0&&(pe.forEach(function(_e){F.releaseProgram(_e)}),G.isShaderMaterial&&F.releaseShaderCache(G))}this.renderBufferDirect=function(G,pe,_e,be,me,Pe){pe===null&&(pe=te);const Ue=me.isMesh&&me.matrixWorld.determinant()<0,Xe=$n(G,pe,_e,be,me);de.setMaterial(be,Ue);let Ye=_e.index,Ze=1;if(be.wireframe===!0){if(Ye=Ee.getWireframeAttribute(_e),Ye===void 0)return;Ze=2}const He=_e.drawRange,Ne=_e.attributes.position;let Ke=He.start*Ze,it=(He.start+He.count)*Ze;Pe!==null&&(Ke=Math.max(Ke,Pe.start*Ze),it=Math.min(it,(Pe.start+Pe.count)*Ze)),Ye!==null?(Ke=Math.max(Ke,0),it=Math.min(it,Ye.count)):Ne!=null&&(Ke=Math.max(Ke,0),it=Math.min(it,Ne.count));const ft=it-Ke;if(ft<0||ft===1/0)return;Ce.setup(me,be,Xe,_e,Ye);let It,vt=fe;if(Ye!==null&&(It=ve.get(Ye),vt=ye,vt.setIndex(It)),me.isMesh)be.wireframe===!0?(de.setLineWidth(be.wireframeLinewidth*Se()),vt.setMode(U.LINES)):vt.setMode(U.TRIANGLES);else if(me.isLine){let et=be.linewidth;et===void 0&&(et=1),de.setLineWidth(et*Se()),me.isLineSegments?vt.setMode(U.LINES):me.isLineLoop?vt.setMode(U.LINE_LOOP):vt.setMode(U.LINE_STRIP)}else me.isPoints?vt.setMode(U.POINTS):me.isSprite&&vt.setMode(U.TRIANGLES);if(me.isBatchedMesh)if(me._multiDrawInstances!==null)vt.renderMultiDrawInstances(me._multiDrawStarts,me._multiDrawCounts,me._multiDrawCount,me._multiDrawInstances);else if(Le.get("WEBGL_multi_draw"))vt.renderMultiDraw(me._multiDrawStarts,me._multiDrawCounts,me._multiDrawCount);else{const et=me._multiDrawStarts,Qt=me._multiDrawCounts,yt=me._multiDrawCount,Un=Ye?ve.get(Ye).bytesPerElement:1,Bi=Me.get(be).currentProgram.getUniforms();for(let _n=0;_n<yt;_n++)Bi.setValue(U,"_gl_DrawID",_n),vt.render(et[_n]/Un,Qt[_n])}else if(me.isInstancedMesh)vt.renderInstances(Ke,ft,me.count);else if(_e.isInstancedBufferGeometry){const et=_e._maxInstanceCount!==void 0?_e._maxInstanceCount:1/0,Qt=Math.min(_e.instanceCount,et);vt.renderInstances(Ke,ft,Qt)}else vt.render(Ke,ft)};function Be(G,pe,_e){G.transparent===!0&&G.side===nr&&G.forceSinglePass===!1?(G.side=xn,G.needsUpdate=!0,Nt(G,pe,_e),G.side=Yr,G.needsUpdate=!0,Nt(G,pe,_e),G.side=nr):Nt(G,pe,_e)}this.compile=function(G,pe,_e=null){_e===null&&(_e=G),p=le.get(_e),p.init(pe),y.push(p),_e.traverseVisible(function(me){me.isLight&&me.layers.test(pe.layers)&&(p.pushLight(me),me.castShadow&&p.pushShadow(me))}),G!==_e&&G.traverseVisible(function(me){me.isLight&&me.layers.test(pe.layers)&&(p.pushLight(me),me.castShadow&&p.pushShadow(me))}),p.setupLights();const be=new Set;return G.traverse(function(me){if(!(me.isMesh||me.isPoints||me.isLine||me.isSprite))return;const Pe=me.material;if(Pe)if(Array.isArray(Pe))for(let Ue=0;Ue<Pe.length;Ue++){const Xe=Pe[Ue];Be(Xe,_e,me),be.add(Xe)}else Be(Pe,_e,me),be.add(Pe)}),y.pop(),p=null,be},this.compileAsync=function(G,pe,_e=null){const be=this.compile(G,pe,_e);return new Promise(me=>{function Pe(){if(be.forEach(function(Ue){Me.get(Ue).currentProgram.isReady()&&be.delete(Ue)}),be.size===0){me(G);return}setTimeout(Pe,10)}Le.get("KHR_parallel_shader_compile")!==null?Pe():setTimeout(Pe,10)})};let ze=null;function We(G){ze&&ze(G)}function pt(){Qe.stop()}function je(){Qe.start()}const Qe=new ap;Qe.setAnimationLoop(We),typeof self<"u"&&Qe.setContext(self),this.setAnimationLoop=function(G){ze=G,se.setAnimationLoop(G),G===null?Qe.stop():Qe.start()},se.addEventListener("sessionstart",pt),se.addEventListener("sessionend",je),this.render=function(G,pe){if(pe!==void 0&&pe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;if(G.matrixWorldAutoUpdate===!0&&G.updateMatrixWorld(),pe.parent===null&&pe.matrixWorldAutoUpdate===!0&&pe.updateMatrixWorld(),se.enabled===!0&&se.isPresenting===!0&&(se.cameraAutoUpdate===!0&&se.updateCamera(pe),pe=se.getCamera()),G.isScene===!0&&G.onBeforeRender(E,G,pe,C),p=le.get(G,y.length),p.init(pe),y.push(p),ie.multiplyMatrices(pe.projectionMatrix,pe.matrixWorldInverse),W.setFromProjectionMatrix(ie),Q=this.localClippingEnabled,K=ee.init(this.clippingPlanes,Q),g=ce.get(G,x.length),g.init(),x.push(g),se.enabled===!0&&se.isPresenting===!0){const Pe=E.xr.getDepthSensingMesh();Pe!==null&&wt(Pe,pe,-1/0,E.sortObjects)}wt(G,pe,0,E.sortObjects),g.finish(),E.sortObjects===!0&&g.sort(B,k),ue=se.enabled===!1||se.isPresenting===!1||se.hasDepthSensing()===!1,ue&&$.addToRenderList(g,G),this.info.render.frame++,K===!0&&ee.beginShadows();const _e=p.state.shadowsArray;J.render(_e,G,pe),K===!0&&ee.endShadows(),this.info.autoReset===!0&&this.info.reset();const be=g.opaque,me=g.transmissive;if(p.setupLights(),pe.isArrayCamera){const Pe=pe.cameras;if(me.length>0)for(let Ue=0,Xe=Pe.length;Ue<Xe;Ue++){const Ye=Pe[Ue];ut(be,me,G,Ye)}ue&&$.render(G);for(let Ue=0,Xe=Pe.length;Ue<Xe;Ue++){const Ye=Pe[Ue];st(g,G,Ye,Ye.viewport)}}else me.length>0&&ut(be,me,G,pe),ue&&$.render(G),st(g,G,pe);C!==null&&b===0&&(z.updateMultisampleRenderTarget(C),z.updateRenderTargetMipmap(C)),G.isScene===!0&&G.onAfterRender(E,G,pe),Ce.resetDefaultState(),T=-1,S=null,y.pop(),y.length>0?(p=y[y.length-1],K===!0&&ee.setGlobalState(E.clippingPlanes,p.state.camera)):p=null,x.pop(),x.length>0?g=x[x.length-1]:g=null};function wt(G,pe,_e,be){if(G.visible===!1)return;if(G.layers.test(pe.layers)){if(G.isGroup)_e=G.renderOrder;else if(G.isLOD)G.autoUpdate===!0&&G.update(pe);else if(G.isLight)p.pushLight(G),G.castShadow&&p.pushShadow(G);else if(G.isSprite){if(!G.frustumCulled||W.intersectsSprite(G)){be&&X.setFromMatrixPosition(G.matrixWorld).applyMatrix4(ie);const Ue=ae.update(G),Xe=G.material;Xe.visible&&g.push(G,Ue,Xe,_e,X.z,null)}}else if((G.isMesh||G.isLine||G.isPoints)&&(!G.frustumCulled||W.intersectsObject(G))){const Ue=ae.update(G),Xe=G.material;if(be&&(G.boundingSphere!==void 0?(G.boundingSphere===null&&G.computeBoundingSphere(),X.copy(G.boundingSphere.center)):(Ue.boundingSphere===null&&Ue.computeBoundingSphere(),X.copy(Ue.boundingSphere.center)),X.applyMatrix4(G.matrixWorld).applyMatrix4(ie)),Array.isArray(Xe)){const Ye=Ue.groups;for(let Ze=0,He=Ye.length;Ze<He;Ze++){const Ne=Ye[Ze],Ke=Xe[Ne.materialIndex];Ke&&Ke.visible&&g.push(G,Ue,Ke,_e,X.z,Ne)}}else Xe.visible&&g.push(G,Ue,Xe,_e,X.z,null)}}const Pe=G.children;for(let Ue=0,Xe=Pe.length;Ue<Xe;Ue++)wt(Pe[Ue],pe,_e,be)}function st(G,pe,_e,be){const me=G.opaque,Pe=G.transmissive,Ue=G.transparent;p.setupLightsView(_e),K===!0&&ee.setGlobalState(E.clippingPlanes,_e),be&&de.viewport(L.copy(be)),me.length>0&&tt(me,pe,_e),Pe.length>0&&tt(Pe,pe,_e),Ue.length>0&&tt(Ue,pe,_e),de.buffers.depth.setTest(!0),de.buffers.depth.setMask(!0),de.buffers.color.setMask(!0),de.setPolygonOffset(!1)}function ut(G,pe,_e,be){if((_e.isScene===!0?_e.overrideMaterial:null)!==null)return;p.state.transmissionRenderTarget[be.id]===void 0&&(p.state.transmissionRenderTarget[be.id]=new Mi(1,1,{generateMipmaps:!0,type:Le.has("EXT_color_buffer_half_float")||Le.has("EXT_color_buffer_float")?Cs:br,minFilter:_i,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:gt.workingColorSpace}));const Pe=p.state.transmissionRenderTarget[be.id],Ue=be.viewport||L;Pe.setSize(Ue.z*E.transmissionResolutionScale,Ue.w*E.transmissionResolutionScale);const Xe=E.getRenderTarget();E.setRenderTarget(Pe),E.getClearColor(_),P=E.getClearAlpha(),P<1&&E.setClearColor(16777215,.5),E.clear(),ue&&$.render(_e);const Ye=E.toneMapping;E.toneMapping=Hr;const Ze=be.viewport;if(be.viewport!==void 0&&(be.viewport=void 0),p.setupLightsView(be),K===!0&&ee.setGlobalState(E.clippingPlanes,be),tt(G,_e,be),z.updateMultisampleRenderTarget(Pe),z.updateRenderTargetMipmap(Pe),Le.has("WEBGL_multisampled_render_to_texture")===!1){let He=!1;for(let Ne=0,Ke=pe.length;Ne<Ke;Ne++){const it=pe[Ne],ft=it.object,It=it.geometry,vt=it.material,et=it.group;if(vt.side===nr&&ft.layers.test(be.layers)){const Qt=vt.side;vt.side=xn,vt.needsUpdate=!0,Yt(ft,_e,be,It,vt,et),vt.side=Qt,vt.needsUpdate=!0,He=!0}}He===!0&&(z.updateMultisampleRenderTarget(Pe),z.updateRenderTargetMipmap(Pe))}E.setRenderTarget(Xe),E.setClearColor(_,P),Ze!==void 0&&(be.viewport=Ze),E.toneMapping=Ye}function tt(G,pe,_e){const be=pe.isScene===!0?pe.overrideMaterial:null;for(let me=0,Pe=G.length;me<Pe;me++){const Ue=G[me],Xe=Ue.object,Ye=Ue.geometry,Ze=be===null?Ue.material:be,He=Ue.group;Xe.layers.test(_e.layers)&&Yt(Xe,pe,_e,Ye,Ze,He)}}function Yt(G,pe,_e,be,me,Pe){G.onBeforeRender(E,pe,_e,be,me,Pe),G.modelViewMatrix.multiplyMatrices(_e.matrixWorldInverse,G.matrixWorld),G.normalMatrix.getNormalMatrix(G.modelViewMatrix),me.onBeforeRender(E,pe,_e,be,G,Pe),me.transparent===!0&&me.side===nr&&me.forceSinglePass===!1?(me.side=xn,me.needsUpdate=!0,E.renderBufferDirect(_e,pe,be,me,G,Pe),me.side=Yr,me.needsUpdate=!0,E.renderBufferDirect(_e,pe,be,me,G,Pe),me.side=nr):E.renderBufferDirect(_e,pe,be,me,G,Pe),G.onAfterRender(E,pe,_e,be,me,Pe)}function Nt(G,pe,_e){pe.isScene!==!0&&(pe=te);const be=Me.get(G),me=p.state.lights,Pe=p.state.shadowsArray,Ue=me.state.version,Xe=F.getParameters(G,me.state,Pe,pe,_e),Ye=F.getProgramCacheKey(Xe);let Ze=be.programs;be.environment=G.isMeshStandardMaterial?pe.environment:null,be.fog=pe.fog,be.envMap=(G.isMeshStandardMaterial?re:O).get(G.envMap||be.environment),be.envMapRotation=be.environment!==null&&G.envMap===null?pe.environmentRotation:G.envMapRotation,Ze===void 0&&(G.addEventListener("dispose",Fe),Ze=new Map,be.programs=Ze);let He=Ze.get(Ye);if(He!==void 0){if(be.currentProgram===He&&be.lightsStateVersion===Ue)return Cn(G,Xe),He}else Xe.uniforms=F.getUniforms(G),G.onBeforeCompile(Xe,E),He=F.acquireProgram(Xe,Ye),Ze.set(Ye,He),be.uniforms=Xe.uniforms;const Ne=be.uniforms;return(!G.isShaderMaterial&&!G.isRawShaderMaterial||G.clipping===!0)&&(Ne.clippingPlanes=ee.uniform),Cn(G,Xe),be.needsLights=Fn(G),be.lightsStateVersion=Ue,be.needsLights&&(Ne.ambientLightColor.value=me.state.ambient,Ne.lightProbe.value=me.state.probe,Ne.directionalLights.value=me.state.directional,Ne.directionalLightShadows.value=me.state.directionalShadow,Ne.spotLights.value=me.state.spot,Ne.spotLightShadows.value=me.state.spotShadow,Ne.rectAreaLights.value=me.state.rectArea,Ne.ltc_1.value=me.state.rectAreaLTC1,Ne.ltc_2.value=me.state.rectAreaLTC2,Ne.pointLights.value=me.state.point,Ne.pointLightShadows.value=me.state.pointShadow,Ne.hemisphereLights.value=me.state.hemi,Ne.directionalShadowMap.value=me.state.directionalShadowMap,Ne.directionalShadowMatrix.value=me.state.directionalShadowMatrix,Ne.spotShadowMap.value=me.state.spotShadowMap,Ne.spotLightMatrix.value=me.state.spotLightMatrix,Ne.spotLightMap.value=me.state.spotLightMap,Ne.pointShadowMap.value=me.state.pointShadowMap,Ne.pointShadowMatrix.value=me.state.pointShadowMatrix),be.currentProgram=He,be.uniformsList=null,He}function fr(G){if(G.uniformsList===null){const pe=G.currentProgram.getUniforms();G.uniformsList=Po.seqWithValue(pe.seq,G.uniforms)}return G.uniformsList}function Cn(G,pe){const _e=Me.get(G);_e.outputColorSpace=pe.outputColorSpace,_e.batching=pe.batching,_e.batchingColor=pe.batchingColor,_e.instancing=pe.instancing,_e.instancingColor=pe.instancingColor,_e.instancingMorph=pe.instancingMorph,_e.skinning=pe.skinning,_e.morphTargets=pe.morphTargets,_e.morphNormals=pe.morphNormals,_e.morphColors=pe.morphColors,_e.morphTargetsCount=pe.morphTargetsCount,_e.numClippingPlanes=pe.numClippingPlanes,_e.numIntersection=pe.numClipIntersection,_e.vertexAlphas=pe.vertexAlphas,_e.vertexTangents=pe.vertexTangents,_e.toneMapping=pe.toneMapping}function $n(G,pe,_e,be,me){pe.isScene!==!0&&(pe=te),z.resetTextureUnits();const Pe=pe.fog,Ue=be.isMeshStandardMaterial?pe.environment:null,Xe=C===null?E.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:Ma,Ye=(be.isMeshStandardMaterial?re:O).get(be.envMap||Ue),Ze=be.vertexColors===!0&&!!_e.attributes.color&&_e.attributes.color.itemSize===4,He=!!_e.attributes.tangent&&(!!be.normalMap||be.anisotropy>0),Ne=!!_e.morphAttributes.position,Ke=!!_e.morphAttributes.normal,it=!!_e.morphAttributes.color;let ft=Hr;be.toneMapped&&(C===null||C.isXRRenderTarget===!0)&&(ft=E.toneMapping);const It=_e.morphAttributes.position||_e.morphAttributes.normal||_e.morphAttributes.color,vt=It!==void 0?It.length:0,et=Me.get(be),Qt=p.state.lights;if(K===!0&&(Q===!0||G!==S)){const cn=G===S&&be.id===T;ee.setState(be,G,cn)}let yt=!1;be.version===et.__version?(et.needsLights&&et.lightsStateVersion!==Qt.state.version||et.outputColorSpace!==Xe||me.isBatchedMesh&&et.batching===!1||!me.isBatchedMesh&&et.batching===!0||me.isBatchedMesh&&et.batchingColor===!0&&me.colorTexture===null||me.isBatchedMesh&&et.batchingColor===!1&&me.colorTexture!==null||me.isInstancedMesh&&et.instancing===!1||!me.isInstancedMesh&&et.instancing===!0||me.isSkinnedMesh&&et.skinning===!1||!me.isSkinnedMesh&&et.skinning===!0||me.isInstancedMesh&&et.instancingColor===!0&&me.instanceColor===null||me.isInstancedMesh&&et.instancingColor===!1&&me.instanceColor!==null||me.isInstancedMesh&&et.instancingMorph===!0&&me.morphTexture===null||me.isInstancedMesh&&et.instancingMorph===!1&&me.morphTexture!==null||et.envMap!==Ye||be.fog===!0&&et.fog!==Pe||et.numClippingPlanes!==void 0&&(et.numClippingPlanes!==ee.numPlanes||et.numIntersection!==ee.numIntersection)||et.vertexAlphas!==Ze||et.vertexTangents!==He||et.morphTargets!==Ne||et.morphNormals!==Ke||et.morphColors!==it||et.toneMapping!==ft||et.morphTargetsCount!==vt)&&(yt=!0):(yt=!0,et.__version=be.version);let Un=et.currentProgram;yt===!0&&(Un=Nt(be,pe,me));let Bi=!1,_n=!1,Wa=!1;const Dt=Un.getUniforms(),Rn=et.uniforms;if(de.useProgram(Un.program)&&(Bi=!0,_n=!0,Wa=!0),be.id!==T&&(T=be.id,_n=!0),Bi||S!==G){de.buffers.depth.getReversed()?(ne.copy(G.projectionMatrix),pm(ne),vm(ne),Dt.setValue(U,"projectionMatrix",ne)):Dt.setValue(U,"projectionMatrix",G.projectionMatrix),Dt.setValue(U,"viewMatrix",G.matrixWorldInverse);const gn=Dt.map.cameraPosition;gn!==void 0&&gn.setValue(U,H.setFromMatrixPosition(G.matrixWorld)),De.logarithmicDepthBuffer&&Dt.setValue(U,"logDepthBufFC",2/(Math.log(G.far+1)/Math.LN2)),(be.isMeshPhongMaterial||be.isMeshToonMaterial||be.isMeshLambertMaterial||be.isMeshBasicMaterial||be.isMeshStandardMaterial||be.isShaderMaterial)&&Dt.setValue(U,"isOrthographic",G.isOrthographicCamera===!0),S!==G&&(S=G,_n=!0,Wa=!0)}if(me.isSkinnedMesh){Dt.setOptional(U,me,"bindMatrix"),Dt.setOptional(U,me,"bindMatrixInverse");const cn=me.skeleton;cn&&(cn.boneTexture===null&&cn.computeBoneTexture(),Dt.setValue(U,"boneTexture",cn.boneTexture,z))}me.isBatchedMesh&&(Dt.setOptional(U,me,"batchingTexture"),Dt.setValue(U,"batchingTexture",me._matricesTexture,z),Dt.setOptional(U,me,"batchingIdTexture"),Dt.setValue(U,"batchingIdTexture",me._indirectTexture,z),Dt.setOptional(U,me,"batchingColorTexture"),me._colorsTexture!==null&&Dt.setValue(U,"batchingColorTexture",me._colorsTexture,z));const Dn=_e.morphAttributes;if((Dn.position!==void 0||Dn.normal!==void 0||Dn.color!==void 0)&&oe.update(me,_e,Un),(_n||et.receiveShadow!==me.receiveShadow)&&(et.receiveShadow=me.receiveShadow,Dt.setValue(U,"receiveShadow",me.receiveShadow)),be.isMeshGouraudMaterial&&be.envMap!==null&&(Rn.envMap.value=Ye,Rn.flipEnvMap.value=Ye.isCubeTexture&&Ye.isRenderTargetTexture===!1?-1:1),be.isMeshStandardMaterial&&be.envMap===null&&pe.environment!==null&&(Rn.envMapIntensity.value=pe.environmentIntensity),_n&&(Dt.setValue(U,"toneMappingExposure",E.toneMappingExposure),et.needsLights&&Zn(Rn,Wa),Pe&&be.fog===!0&&j.refreshFogUniforms(Rn,Pe),j.refreshMaterialUniforms(Rn,be,R,D,p.state.transmissionRenderTarget[G.id]),Po.upload(U,fr(et),Rn,z)),be.isShaderMaterial&&be.uniformsNeedUpdate===!0&&(Po.upload(U,fr(et),Rn,z),be.uniformsNeedUpdate=!1),be.isSpriteMaterial&&Dt.setValue(U,"center",me.center),Dt.setValue(U,"modelViewMatrix",me.modelViewMatrix),Dt.setValue(U,"normalMatrix",me.normalMatrix),Dt.setValue(U,"modelMatrix",me.matrixWorld),be.isShaderMaterial||be.isRawShaderMaterial){const cn=be.uniformsGroups;for(let gn=0,wl=cn.length;gn<wl;gn++){const ai=cn[gn];q.update(ai,Un),q.bind(ai,Un)}}return Un}function Zn(G,pe){G.ambientLightColor.needsUpdate=pe,G.lightProbe.needsUpdate=pe,G.directionalLights.needsUpdate=pe,G.directionalLightShadows.needsUpdate=pe,G.pointLights.needsUpdate=pe,G.pointLightShadows.needsUpdate=pe,G.spotLights.needsUpdate=pe,G.spotLightShadows.needsUpdate=pe,G.rectAreaLights.needsUpdate=pe,G.hemisphereLights.needsUpdate=pe}function Fn(G){return G.isMeshLambertMaterial||G.isMeshToonMaterial||G.isMeshPhongMaterial||G.isMeshStandardMaterial||G.isShadowMaterial||G.isShaderMaterial&&G.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(G,pe,_e){Me.get(G.texture).__webglTexture=pe,Me.get(G.depthTexture).__webglTexture=_e;const be=Me.get(G);be.__hasExternalTextures=!0,be.__autoAllocateDepthBuffer=_e===void 0,be.__autoAllocateDepthBuffer||Le.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),be.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(G,pe){const _e=Me.get(G);_e.__webglFramebuffer=pe,_e.__useDefaultFramebuffer=pe===void 0};const Rr=U.createFramebuffer();this.setRenderTarget=function(G,pe=0,_e=0){C=G,w=pe,b=_e;let be=!0,me=null,Pe=!1,Ue=!1;if(G){const Ye=Me.get(G);if(Ye.__useDefaultFramebuffer!==void 0)de.bindFramebuffer(U.FRAMEBUFFER,null),be=!1;else if(Ye.__webglFramebuffer===void 0)z.setupRenderTarget(G);else if(Ye.__hasExternalTextures)z.rebindTextures(G,Me.get(G.texture).__webglTexture,Me.get(G.depthTexture).__webglTexture);else if(G.depthBuffer){const Ne=G.depthTexture;if(Ye.__boundDepthTexture!==Ne){if(Ne!==null&&Me.has(Ne)&&(G.width!==Ne.image.width||G.height!==Ne.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");z.setupDepthRenderbuffer(G)}}const Ze=G.texture;(Ze.isData3DTexture||Ze.isDataArrayTexture||Ze.isCompressedArrayTexture)&&(Ue=!0);const He=Me.get(G).__webglFramebuffer;G.isWebGLCubeRenderTarget?(Array.isArray(He[pe])?me=He[pe][_e]:me=He[pe],Pe=!0):G.samples>0&&z.useMultisampledRTT(G)===!1?me=Me.get(G).__webglMultisampledFramebuffer:Array.isArray(He)?me=He[_e]:me=He,L.copy(G.viewport),N.copy(G.scissor),I=G.scissorTest}else L.copy(V).multiplyScalar(R).floor(),N.copy(Y).multiplyScalar(R).floor(),I=Z;if(_e!==0&&(me=Rr),de.bindFramebuffer(U.FRAMEBUFFER,me)&&be&&de.drawBuffers(G,me),de.viewport(L),de.scissor(N),de.setScissorTest(I),Pe){const Ye=Me.get(G.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Ye.__webglTexture,_e)}else if(Ue){const Ye=Me.get(G.texture),Ze=pe;U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,Ye.__webglTexture,_e,Ze)}else if(G!==null&&_e!==0){const Ye=Me.get(G.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,Ye.__webglTexture,_e)}T=-1},this.readRenderTargetPixels=function(G,pe,_e,be,me,Pe,Ue){if(!(G&&G.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Xe=Me.get(G).__webglFramebuffer;if(G.isWebGLCubeRenderTarget&&Ue!==void 0&&(Xe=Xe[Ue]),Xe){de.bindFramebuffer(U.FRAMEBUFFER,Xe);try{const Ye=G.texture,Ze=Ye.format,He=Ye.type;if(!De.textureFormatReadable(Ze)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!De.textureTypeReadable(He)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pe>=0&&pe<=G.width-be&&_e>=0&&_e<=G.height-me&&U.readPixels(pe,_e,be,me,xe.convert(Ze),xe.convert(He),Pe)}finally{const Ye=C!==null?Me.get(C).__webglFramebuffer:null;de.bindFramebuffer(U.FRAMEBUFFER,Ye)}}},this.readRenderTargetPixelsAsync=async function(G,pe,_e,be,me,Pe,Ue){if(!(G&&G.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Xe=Me.get(G).__webglFramebuffer;if(G.isWebGLCubeRenderTarget&&Ue!==void 0&&(Xe=Xe[Ue]),Xe){const Ye=G.texture,Ze=Ye.format,He=Ye.type;if(!De.textureFormatReadable(Ze))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!De.textureTypeReadable(He))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(pe>=0&&pe<=G.width-be&&_e>=0&&_e<=G.height-me){de.bindFramebuffer(U.FRAMEBUFFER,Xe);const Ne=U.createBuffer();U.bindBuffer(U.PIXEL_PACK_BUFFER,Ne),U.bufferData(U.PIXEL_PACK_BUFFER,Pe.byteLength,U.STREAM_READ),U.readPixels(pe,_e,be,me,xe.convert(Ze),xe.convert(He),0);const Ke=C!==null?Me.get(C).__webglFramebuffer:null;de.bindFramebuffer(U.FRAMEBUFFER,Ke);const it=U.fenceSync(U.SYNC_GPU_COMMANDS_COMPLETE,0);return U.flush(),await dm(U,it,4),U.bindBuffer(U.PIXEL_PACK_BUFFER,Ne),U.getBufferSubData(U.PIXEL_PACK_BUFFER,0,Pe),U.deleteBuffer(Ne),U.deleteSync(it),Pe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(G,pe=null,_e=0){G.isTexture!==!0&&(sa("WebGLRenderer: copyFramebufferToTexture function signature has changed."),pe=arguments[0]||null,G=arguments[1]);const be=Math.pow(2,-_e),me=Math.floor(G.image.width*be),Pe=Math.floor(G.image.height*be),Ue=pe!==null?pe.x:0,Xe=pe!==null?pe.y:0;z.setTexture2D(G,0),U.copyTexSubImage2D(U.TEXTURE_2D,_e,0,0,Ue,Xe,me,Pe),de.unbindTexture()};const Qn=U.createFramebuffer(),Jn=U.createFramebuffer();this.copyTextureToTexture=function(G,pe,_e=null,be=null,me=0,Pe=null){G.isTexture!==!0&&(sa("WebGLRenderer: copyTextureToTexture function signature has changed."),be=arguments[0]||null,G=arguments[1],pe=arguments[2],Pe=arguments[3]||0,_e=null),Pe===null&&(me!==0?(sa("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Pe=me,me=0):Pe=0);let Ue,Xe,Ye,Ze,He,Ne,Ke,it,ft;const It=G.isCompressedTexture?G.mipmaps[Pe]:G.image;if(_e!==null)Ue=_e.max.x-_e.min.x,Xe=_e.max.y-_e.min.y,Ye=_e.isBox3?_e.max.z-_e.min.z:1,Ze=_e.min.x,He=_e.min.y,Ne=_e.isBox3?_e.min.z:0;else{const Dn=Math.pow(2,-me);Ue=Math.floor(It.width*Dn),Xe=Math.floor(It.height*Dn),G.isDataArrayTexture?Ye=It.depth:G.isData3DTexture?Ye=Math.floor(It.depth*Dn):Ye=1,Ze=0,He=0,Ne=0}be!==null?(Ke=be.x,it=be.y,ft=be.z):(Ke=0,it=0,ft=0);const vt=xe.convert(pe.format),et=xe.convert(pe.type);let Qt;pe.isData3DTexture?(z.setTexture3D(pe,0),Qt=U.TEXTURE_3D):pe.isDataArrayTexture||pe.isCompressedArrayTexture?(z.setTexture2DArray(pe,0),Qt=U.TEXTURE_2D_ARRAY):(z.setTexture2D(pe,0),Qt=U.TEXTURE_2D),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,pe.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,pe.unpackAlignment);const yt=U.getParameter(U.UNPACK_ROW_LENGTH),Un=U.getParameter(U.UNPACK_IMAGE_HEIGHT),Bi=U.getParameter(U.UNPACK_SKIP_PIXELS),_n=U.getParameter(U.UNPACK_SKIP_ROWS),Wa=U.getParameter(U.UNPACK_SKIP_IMAGES);U.pixelStorei(U.UNPACK_ROW_LENGTH,It.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,It.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,Ze),U.pixelStorei(U.UNPACK_SKIP_ROWS,He),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Ne);const Dt=G.isDataArrayTexture||G.isData3DTexture,Rn=pe.isDataArrayTexture||pe.isData3DTexture;if(G.isDepthTexture){const Dn=Me.get(G),cn=Me.get(pe),gn=Me.get(Dn.__renderTarget),wl=Me.get(cn.__renderTarget);de.bindFramebuffer(U.READ_FRAMEBUFFER,gn.__webglFramebuffer),de.bindFramebuffer(U.DRAW_FRAMEBUFFER,wl.__webglFramebuffer);for(let ai=0;ai<Ye;ai++)Dt&&(U.framebufferTextureLayer(U.READ_FRAMEBUFFER,U.COLOR_ATTACHMENT0,Me.get(G).__webglTexture,me,Ne+ai),U.framebufferTextureLayer(U.DRAW_FRAMEBUFFER,U.COLOR_ATTACHMENT0,Me.get(pe).__webglTexture,Pe,ft+ai)),U.blitFramebuffer(Ze,He,Ue,Xe,Ke,it,Ue,Xe,U.DEPTH_BUFFER_BIT,U.NEAREST);de.bindFramebuffer(U.READ_FRAMEBUFFER,null),de.bindFramebuffer(U.DRAW_FRAMEBUFFER,null)}else if(me!==0||G.isRenderTargetTexture||Me.has(G)){const Dn=Me.get(G),cn=Me.get(pe);de.bindFramebuffer(U.READ_FRAMEBUFFER,Qn),de.bindFramebuffer(U.DRAW_FRAMEBUFFER,Jn);for(let gn=0;gn<Ye;gn++)Dt?U.framebufferTextureLayer(U.READ_FRAMEBUFFER,U.COLOR_ATTACHMENT0,Dn.__webglTexture,me,Ne+gn):U.framebufferTexture2D(U.READ_FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,Dn.__webglTexture,me),Rn?U.framebufferTextureLayer(U.DRAW_FRAMEBUFFER,U.COLOR_ATTACHMENT0,cn.__webglTexture,Pe,ft+gn):U.framebufferTexture2D(U.DRAW_FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,cn.__webglTexture,Pe),me!==0?U.blitFramebuffer(Ze,He,Ue,Xe,Ke,it,Ue,Xe,U.COLOR_BUFFER_BIT,U.NEAREST):Rn?U.copyTexSubImage3D(Qt,Pe,Ke,it,ft+gn,Ze,He,Ue,Xe):U.copyTexSubImage2D(Qt,Pe,Ke,it,Ze,He,Ue,Xe);de.bindFramebuffer(U.READ_FRAMEBUFFER,null),de.bindFramebuffer(U.DRAW_FRAMEBUFFER,null)}else Rn?G.isDataTexture||G.isData3DTexture?U.texSubImage3D(Qt,Pe,Ke,it,ft,Ue,Xe,Ye,vt,et,It.data):pe.isCompressedArrayTexture?U.compressedTexSubImage3D(Qt,Pe,Ke,it,ft,Ue,Xe,Ye,vt,It.data):U.texSubImage3D(Qt,Pe,Ke,it,ft,Ue,Xe,Ye,vt,et,It):G.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,Pe,Ke,it,Ue,Xe,vt,et,It.data):G.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,Pe,Ke,it,It.width,It.height,vt,It.data):U.texSubImage2D(U.TEXTURE_2D,Pe,Ke,it,Ue,Xe,vt,et,It);U.pixelStorei(U.UNPACK_ROW_LENGTH,yt),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,Un),U.pixelStorei(U.UNPACK_SKIP_PIXELS,Bi),U.pixelStorei(U.UNPACK_SKIP_ROWS,_n),U.pixelStorei(U.UNPACK_SKIP_IMAGES,Wa),Pe===0&&pe.generateMipmaps&&U.generateMipmap(Qt),de.unbindTexture()},this.copyTextureToTexture3D=function(G,pe,_e=null,be=null,me=0){return G.isTexture!==!0&&(sa("WebGLRenderer: copyTextureToTexture3D function signature has changed."),_e=arguments[0]||null,be=arguments[1]||null,G=arguments[2],pe=arguments[3],me=arguments[4]||0),sa('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(G,pe,_e,be,me)},this.initRenderTarget=function(G){Me.get(G).__webglFramebuffer===void 0&&z.setupRenderTarget(G)},this.initTexture=function(G){G.isCubeTexture?z.setTextureCube(G,0):G.isData3DTexture?z.setTexture3D(G,0):G.isDataArrayTexture||G.isCompressedArrayTexture?z.setTexture2DArray(G,0):z.setTexture2D(G,0),de.unbindTexture()},this.resetState=function(){w=0,b=0,C=null,de.reset(),Ce.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Er}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=gt._getDrawingBufferColorSpace(e),t.unpackColorSpace=gt._getUnpackColorSpace()}}const ih={type:"change"},Nc={type:"start"},cp={type:"end"},fo=new Kd,ah=new Br,R_=Math.cos(70*fm.DEG2RAD),kt=new Te,mn=2*Math.PI,Tt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},tu=1e-6;class D_ extends Xm{constructor(e,t=null){super(e,t),this.state=Tt.NONE,this.enabled=!0,this.target=new Te,this.cursor=new Te,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ha.ROTATE,MIDDLE:ha.DOLLY,RIGHT:ha.PAN},this.touches={ONE:oa.ROTATE,TWO:oa.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Te,this._lastQuaternion=new wi,this._lastTargetPosition=new Te,this._quat=new wi().setFromUnitVectors(e.up,new Te(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Pf,this._sphericalDelta=new Pf,this._scale=1,this._panOffset=new Te,this._rotateStart=new ot,this._rotateEnd=new ot,this._rotateDelta=new ot,this._panStart=new ot,this._panEnd=new ot,this._panDelta=new ot,this._dollyStart=new ot,this._dollyEnd=new ot,this._dollyDelta=new ot,this._dollyDirection=new Te,this._mouse=new ot,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=P_.bind(this),this._onPointerDown=L_.bind(this),this._onPointerUp=N_.bind(this),this._onContextMenu=z_.bind(this),this._onMouseWheel=F_.bind(this),this._onKeyDown=U_.bind(this),this._onTouchStart=B_.bind(this),this._onTouchMove=k_.bind(this),this._onMouseDown=I_.bind(this),this._onMouseMove=O_.bind(this),this._interceptControlDown=G_.bind(this),this._interceptControlUp=V_.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(ih),this.update(),this.state=Tt.NONE}update(e=null){const t=this.object.position;kt.copy(t).sub(this.target),kt.applyQuaternion(this._quat),this._spherical.setFromVector3(kt),this.autoRotate&&this.state===Tt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(r)&&isFinite(i)&&(r<-Math.PI?r+=mn:r>Math.PI&&(r-=mn),i<-Math.PI?i+=mn:i>Math.PI&&(i-=mn),r<=i?this._spherical.theta=Math.max(r,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+i)/2?Math.max(r,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const s=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=s!=this._spherical.radius}if(kt.setFromSpherical(this._spherical),kt.applyQuaternion(this._quatInverse),t.copy(this.target).add(kt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let s=null;if(this.object.isPerspectiveCamera){const o=kt.length();s=this._clampDistance(o*this._scale);const l=o-s;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),a=!!l}else if(this.object.isOrthographicCamera){const o=new Te(this._mouse.x,this._mouse.y,0);o.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=l!==this.object.zoom;const u=new Te(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(o),this.object.updateMatrixWorld(),s=kt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;s!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(s).add(this.object.position):(fo.origin.copy(this.object.position),fo.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(fo.direction))<R_?this.object.lookAt(this.target):(ah.setFromNormalAndCoplanarPoint(this.object.up,this.target),fo.intersectPlane(ah,this.target))))}else if(this.object.isOrthographicCamera){const s=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),s!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,a||this._lastPosition.distanceToSquared(this.object.position)>tu||8*(1-this._lastQuaternion.dot(this.object.quaternion))>tu||this._lastTargetPosition.distanceToSquared(this.target)>tu?(this.dispatchEvent(ih),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?mn/60*this.autoRotateSpeed*e:mn/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){kt.setFromMatrixColumn(t,0),kt.multiplyScalar(-e),this._panOffset.add(kt)}_panUp(e,t){this.screenSpacePanning===!0?kt.setFromMatrixColumn(t,1):(kt.setFromMatrixColumn(t,0),kt.crossVectors(this.object.up,kt)),kt.multiplyScalar(e),this._panOffset.add(kt)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;kt.copy(i).sub(this.target);let a=kt.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*a/r.clientHeight,this.object.matrix),this._panUp(2*t*a/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),i=e-r.left,a=t-r.top,s=r.width,o=r.height;this._mouse.x=i/s*2-1,this._mouse.y=-(a/o)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(mn*this._rotateDelta.x/t.clientHeight),this._rotateUp(mn*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(mn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-mn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(mn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-mn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(r,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(r,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(r*r+i*i);this._dollyStart.set(0,a)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),i=.5*(e.pageX+r.x),a=.5*(e.pageY+r.y);this._rotateEnd.set(i,a)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(mn*this._rotateDelta.x/t.clientHeight),this._rotateUp(mn*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(r,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(r*r+i*i);this._dollyEnd.set(0,a),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=(e.pageX+t.x)*.5,o=(e.pageY+t.y)*.5;this._updateZoomParameters(s,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new ot,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function L_(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function P_(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function N_(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(cp),this.state=Tt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function I_(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ha.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Tt.DOLLY;break;case ha.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Tt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Tt.ROTATE}break;case ha.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Tt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Tt.PAN}break;default:this.state=Tt.NONE}this.state!==Tt.NONE&&this.dispatchEvent(Nc)}function O_(n){switch(this.state){case Tt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Tt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Tt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function F_(n){this.enabled===!1||this.enableZoom===!1||this.state!==Tt.NONE||(n.preventDefault(),this.dispatchEvent(Nc),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(cp))}function U_(n){this.enabled!==!1&&this._handleKeyDown(n)}function B_(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case oa.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Tt.TOUCH_ROTATE;break;case oa.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Tt.TOUCH_PAN;break;default:this.state=Tt.NONE}break;case 2:switch(this.touches.TWO){case oa.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Tt.TOUCH_DOLLY_PAN;break;case oa.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Tt.TOUCH_DOLLY_ROTATE;break;default:this.state=Tt.NONE}break;default:this.state=Tt.NONE}this.state!==Tt.NONE&&this.dispatchEvent(Nc)}function k_(n){switch(this._trackPointer(n),this.state){case Tt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Tt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Tt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Tt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Tt.NONE}}function z_(n){this.enabled!==!1&&n.preventDefault()}function G_(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function V_(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function H_(){let n=new rr(new Ls(ct.LAYER_WIDTH,ct.LAYER_HEIGHT),new Lc({color:"white",side:nr,alphaTest:.01,depthWrite:!1}));return n.rotateX(Math.PI/2),Ec().add(n),n}function sh(n,e){const t=document.createElement("canvas");t.width=ct.LAYER_WIDTH*ct.TEXTURE_RES,t.height=ct.LAYER_HEIGHT*ct.TEXTURE_RES;const r=t.getContext("2d");r.fillStyle=ct.TEXTURE_FILL,r.fillRect(0,0,t.width,t.height);for(const a of e){let s=n.find(d=>d.id===a.src),o=s.x*t.width,l=s.y*t.height,u=n.find(d=>d.id===a.dst),c=u.x*t.width,f=u.y*t.height;W_(r,o,l,c,f,a.type,8)}const i=new Gm(t);return i.minFilter=Ug,i.magFilter=Xn,i.anisotropy=lR().capabilities.getMaxAnisotropy(),i}function W_(n,e,t,r,i,a,s){const o=n.createLinearGradient(e,t,r,i);o.addColorStop(0,ct.COLORS.m),o.addColorStop(1,ct.COLORS[a]),n.strokeStyle=o,n.lineWidth=s,n.lineCap="round",n.beginPath(),n.moveTo(e,t),n.lineTo(r,i),n.stroke()}function or(n,e){return n.replace(/rgba\(([\d\s,]+),\s*\d*\.?\d*\)/,`rgba($1, ${e})`)}function Wt(n){"@babel/helpers - typeof";return Wt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wt(n)}function ti(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function X_(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function ni(n,e,t){return e&&X_(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function fp(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function $t(n,e){return q_(n)||$_(n,e)||Ic(n,e)||Q_()}function hp(n){return Y_(n)||K_(n)||Ic(n)||Z_()}function Y_(n){if(Array.isArray(n))return rc(n)}function q_(n){if(Array.isArray(n))return n}function K_(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function $_(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],i=!0,a=!1,s,o;try{for(t=t.call(n);!(i=(s=t.next()).done)&&(r.push(s.value),!(e&&r.length===e));i=!0);}catch(l){a=!0,o=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw o}}return r}}function Ic(n,e){if(n){if(typeof n=="string")return rc(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rc(n,e)}}function rc(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Z_(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q_(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mn(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=Ic(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,o;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return a=l.done,l},e:function(l){s=!0,o=l},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw o}}}}var zt=typeof window>"u"?null:window,oh=zt?zt.navigator:null;zt&&zt.document;var J_=Wt(""),dp=Wt({}),j_=Wt(function(){}),eb=typeof HTMLElement>"u"?"undefined":Wt(HTMLElement),Ps=function(e){return e&&e.instanceString&&Pt(e.instanceString)?e.instanceString():null},$e=function(e){return e!=null&&Wt(e)==J_},Pt=function(e){return e!=null&&Wt(e)===j_},Mt=function(e){return!An(e)&&(Array.isArray?Array.isArray(e):e!=null&&e instanceof Array)},dt=function(e){return e!=null&&Wt(e)===dp&&!Mt(e)&&e.constructor===Object},tb=function(e){return e!=null&&Wt(e)===dp},ke=function(e){return e!=null&&Wt(e)===Wt(1)&&!isNaN(e)},nb=function(e){return ke(e)&&Math.floor(e)===e},Ko=function(e){if(eb!=="undefined")return e!=null&&e instanceof HTMLElement},An=function(e){return Ns(e)||pp(e)},Ns=function(e){return Ps(e)==="collection"&&e._private.single},pp=function(e){return Ps(e)==="collection"&&!e._private.single},Oc=function(e){return Ps(e)==="core"},vp=function(e){return Ps(e)==="stylesheet"},rb=function(e){return Ps(e)==="event"},Kr=function(e){return e==null?!0:!!(e===""||e.match(/^\s+$/))},ib=function(e){return typeof HTMLElement>"u"?!1:e instanceof HTMLElement},ab=function(e){return dt(e)&&ke(e.x1)&&ke(e.x2)&&ke(e.y1)&&ke(e.y2)},sb=function(e){return tb(e)&&Pt(e.then)},ob=function(){return oh&&oh.userAgent.match(/msie|trident|edge/i)},gs=function(e,t){t||(t=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);return a.join("$")});var r=function i(){var a=this,s=arguments,o,l=t.apply(a,s),u=i.cache;return(o=u[l])||(o=u[l]=e.apply(a,s)),o};return r.cache={},r},Fc=gs(function(n){return n.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}),ul=gs(function(n){return n.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}),gp=gs(function(n,e){return n+e[0].toUpperCase()+e.substring(1)},function(n,e){return n+"$"+e}),lh=function(e){return Kr(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},Gt="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",lb="rgb[a]?\\(("+Gt+"[%]?)\\s*,\\s*("+Gt+"[%]?)\\s*,\\s*("+Gt+"[%]?)(?:\\s*,\\s*("+Gt+"))?\\)",ub="rgb[a]?\\((?:"+Gt+"[%]?)\\s*,\\s*(?:"+Gt+"[%]?)\\s*,\\s*(?:"+Gt+"[%]?)(?:\\s*,\\s*(?:"+Gt+"))?\\)",cb="hsl[a]?\\(("+Gt+")\\s*,\\s*("+Gt+"[%])\\s*,\\s*("+Gt+"[%])(?:\\s*,\\s*("+Gt+"))?\\)",fb="hsl[a]?\\((?:"+Gt+")\\s*,\\s*(?:"+Gt+"[%])\\s*,\\s*(?:"+Gt+"[%])(?:\\s*,\\s*(?:"+Gt+"))?\\)",hb="\\#[0-9a-fA-F]{3}",db="\\#[0-9a-fA-F]{6}",mp=function(e,t){return e<t?-1:e>t?1:0},pb=function(e,t){return-1*mp(e,t)},Je=Object.assign!=null?Object.assign.bind(Object):function(n){for(var e=arguments,t=1;t<e.length;t++){var r=e[t];if(r!=null)for(var i=Object.keys(r),a=0;a<i.length;a++){var s=i[a];n[s]=r[s]}}return n},vb=function(e){if(!(!(e.length===4||e.length===7)||e[0]!=="#")){var t=e.length===4,r,i,a,s=16;return t?(r=parseInt(e[1]+e[1],s),i=parseInt(e[2]+e[2],s),a=parseInt(e[3]+e[3],s)):(r=parseInt(e[1]+e[2],s),i=parseInt(e[3]+e[4],s),a=parseInt(e[5]+e[6],s)),[r,i,a]}},gb=function(e){var t,r,i,a,s,o,l,u;function c(v,m,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?v+(m-v)*6*g:g<1/2?m:g<2/3?v+(m-v)*(2/3-g)*6:v}var f=new RegExp("^"+cb+"$").exec(e);if(f){if(r=parseInt(f[1]),r<0?r=(360- -1*r%360)%360:r>360&&(r=r%360),r/=360,i=parseFloat(f[2]),i<0||i>100||(i=i/100,a=parseFloat(f[3]),a<0||a>100)||(a=a/100,s=f[4],s!==void 0&&(s=parseFloat(s),s<0||s>1)))return;if(i===0)o=l=u=Math.round(a*255);else{var d=a<.5?a*(1+i):a+i-a*i,h=2*a-d;o=Math.round(255*c(h,d,r+1/3)),l=Math.round(255*c(h,d,r)),u=Math.round(255*c(h,d,r-1/3))}t=[o,l,u,s]}return t},mb=function(e){var t,r=new RegExp("^"+lb+"$").exec(e);if(r){t=[];for(var i=[],a=1;a<=3;a++){var s=r[a];if(s[s.length-1]==="%"&&(i[a]=!0),s=parseFloat(s),i[a]&&(s=s/100*255),s<0||s>255)return;t.push(Math.floor(s))}var o=i[1]||i[2]||i[3],l=i[1]&&i[2]&&i[3];if(o&&!l)return;var u=r[4];if(u!==void 0){if(u=parseFloat(u),u<0||u>1)return;t.push(u)}}return t},yb=function(e){return xb[e.toLowerCase()]},yp=function(e){return(Mt(e)?e:null)||yb(e)||vb(e)||mb(e)||gb(e)},xb={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},xp=function(e){for(var t=e.map,r=e.keys,i=r.length,a=0;a<i;a++){var s=r[a];if(dt(s))throw Error("Tried to set map with object key");a<r.length-1?(t[s]==null&&(t[s]={}),t=t[s]):t[s]=e.value}},Ep=function(e){for(var t=e.map,r=e.keys,i=r.length,a=0;a<i;a++){var s=r[a];if(dt(s))throw Error("Tried to get map with object key");if(t=t[s],t==null)return t}return t};function Eb(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var Ai=Eb,rs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _b(n,e){return e={exports:{}},n(e,e.exports),e.exports}var bb=typeof rs=="object"&&rs&&rs.Object===Object&&rs,Tb=bb,Sb=typeof self=="object"&&self&&self.Object===Object&&self,Mb=Tb||Sb||Function("return this")(),cl=Mb,wb=function(){return cl.Date.now()},nu=wb,Ab=/\s/;function Cb(n){for(var e=n.length;e--&&Ab.test(n.charAt(e)););return e}var Rb=Cb,Db=/^\s+/;function Lb(n){return n&&n.slice(0,Rb(n)+1).replace(Db,"")}var Pb=Lb,Nb=cl.Symbol,Aa=Nb,_p=Object.prototype,Ib=_p.hasOwnProperty,Ob=_p.toString,$a=Aa?Aa.toStringTag:void 0;function Fb(n){var e=Ib.call(n,$a),t=n[$a];try{n[$a]=void 0;var r=!0}catch{}var i=Ob.call(n);return r&&(e?n[$a]=t:delete n[$a]),i}var Ub=Fb,Bb=Object.prototype,kb=Bb.toString;function zb(n){return kb.call(n)}var Gb=zb,Vb="[object Null]",Hb="[object Undefined]",uh=Aa?Aa.toStringTag:void 0;function Wb(n){return n==null?n===void 0?Hb:Vb:uh&&uh in Object(n)?Ub(n):Gb(n)}var bp=Wb;function Xb(n){return n!=null&&typeof n=="object"}var Yb=Xb,qb="[object Symbol]";function Kb(n){return typeof n=="symbol"||Yb(n)&&bp(n)==qb}var Is=Kb,ch=NaN,$b=/^[-+]0x[0-9a-f]+$/i,Zb=/^0b[01]+$/i,Qb=/^0o[0-7]+$/i,Jb=parseInt;function jb(n){if(typeof n=="number")return n;if(Is(n))return ch;if(Ai(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=Ai(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=Pb(n);var t=Zb.test(n);return t||Qb.test(n)?Jb(n.slice(2),t?2:8):$b.test(n)?ch:+n}var fh=jb,eT="Expected a function",tT=Math.max,nT=Math.min;function rT(n,e,t){var r,i,a,s,o,l,u=0,c=!1,f=!1,d=!0;if(typeof n!="function")throw new TypeError(eT);e=fh(e)||0,Ai(t)&&(c=!!t.leading,f="maxWait"in t,a=f?tT(fh(t.maxWait)||0,e):a,d="trailing"in t?!!t.trailing:d);function h(w){var b=r,C=i;return r=i=void 0,u=w,s=n.apply(C,b),s}function v(w){return u=w,o=setTimeout(p,e),c?h(w):s}function m(w){var b=w-l,C=w-u,T=e-b;return f?nT(T,a-C):T}function g(w){var b=w-l,C=w-u;return l===void 0||b>=e||b<0||f&&C>=a}function p(){var w=nu();if(g(w))return x(w);o=setTimeout(p,m(w))}function x(w){return o=void 0,d&&r?h(w):(r=i=void 0,s)}function y(){o!==void 0&&clearTimeout(o),u=0,r=l=i=o=void 0}function E(){return o===void 0?s:x(nu())}function M(){var w=nu(),b=g(w);if(r=arguments,i=this,l=w,b){if(o===void 0)return v(l);if(f)return clearTimeout(o),o=setTimeout(p,e),h(l)}return o===void 0&&(o=setTimeout(p,e)),s}return M.cancel=y,M.flush=E,M}var Os=rT,ru=zt?zt.performance:null,Tp=ru&&ru.now?function(){return ru.now()}:function(){return Date.now()},iT=function(){if(zt){if(zt.requestAnimationFrame)return function(n){zt.requestAnimationFrame(n)};if(zt.mozRequestAnimationFrame)return function(n){zt.mozRequestAnimationFrame(n)};if(zt.webkitRequestAnimationFrame)return function(n){zt.webkitRequestAnimationFrame(n)};if(zt.msRequestAnimationFrame)return function(n){zt.msRequestAnimationFrame(n)}}return function(n){n&&setTimeout(function(){n(Tp())},1e3/60)}}(),$o=function(e){return iT(e)},Sr=Tp,ua=9261,Sp=65599,is=5381,Mp=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ua,r=t,i;i=e.next(),!i.done;)r=r*Sp+i.value|0;return r},ms=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ua;return t*Sp+e|0},ys=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:is;return(t<<5)+t+e|0},aT=function(e,t){return e*2097152+t},Fr=function(e){return e[0]*2097152+e[1]},ho=function(e,t){return[ms(e[0],t[0]),ys(e[1],t[1])]},sT=function(e,t){var r={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?r.value=e[i++]:r.done=!0,r}};return Mp(s,t)},$r=function(e,t){var r={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?r.value=e.charCodeAt(i++):r.done=!0,r}};return Mp(s,t)},wp=function(){return oT(arguments)},oT=function(e){for(var t,r=0;r<e.length;r++){var i=e[r];r===0?t=$r(i):t=$r(i,t)}return t},hh=!0,lT=console.warn!=null,uT=console.trace!=null,Uc=Number.MAX_SAFE_INTEGER||9007199254740991,Ap=function(){return!0},Zo=function(){return!1},dh=function(){return 0},Bc=function(){},Lt=function(e){throw new Error(e)},Cp=function(e){if(e!==void 0)hh=!!e;else return hh},Et=function(e){Cp()&&(lT?console.warn(e):(console.log(e),uT&&console.trace()))},cT=function(e){return Je({},e)},ir=function(e){return e==null?e:Mt(e)?e.slice():dt(e)?cT(e):e},fT=function(e){return e.slice()},Rp=function(e,t){for(t=e="";e++<36;t+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return t},hT={},Dp=function(){return hT},Zt=function(e){var t=Object.keys(e);return function(r){for(var i={},a=0;a<t.length;a++){var s=t[a],o=r==null?void 0:r[s];i[s]=o===void 0?e[s]:o}return i}},Zr=function(e,t,r){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)},kc=function(e){e.splice(0,e.length)},dT=function(e,t){for(var r=0;r<t.length;r++){var i=t[r];e.push(i)}},Hn=function(e,t,r){return r&&(t=gp(r,t)),e[t]},zr=function(e,t,r,i){r&&(t=gp(r,t)),e[t]=i},pT=function(){function n(){ti(this,n),this._obj={}}return ni(n,[{key:"set",value:function(t,r){return this._obj[t]=r,this}},{key:"delete",value:function(t){return this._obj[t]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(t){return this._obj[t]!==void 0}},{key:"get",value:function(t){return this._obj[t]}}]),n}(),ar=typeof Map<"u"?Map:pT,vT="undefined",gT=function(){function n(e){if(ti(this,n),this._obj=Object.create(null),this.size=0,e!=null){var t;e.instanceString!=null&&e.instanceString()===this.instanceString()?t=e.toArray():t=e;for(var r=0;r<t.length;r++)this.add(t[r])}}return ni(n,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(t){var r=this._obj;r[t]!==1&&(r[t]=1,this.size++)}},{key:"delete",value:function(t){var r=this._obj;r[t]===1&&(r[t]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(t){return this._obj[t]===1}},{key:"toArray",value:function(){var t=this;return Object.keys(this._obj).filter(function(r){return t.has(r)})}},{key:"forEach",value:function(t,r){return this.toArray().forEach(t,r)}}]),n}(),Na=(typeof Set>"u"?"undefined":Wt(Set))!==vT?Set:gT,fl=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e===void 0||t===void 0||!Oc(e)){Lt("An element must have a core reference and parameters set");return}var i=t.group;if(i==null&&(t.data&&t.data.source!=null&&t.data.target!=null?i="edges":i="nodes"),i!=="nodes"&&i!=="edges"){Lt("An element must be of type `nodes` or `edges`; you specified `"+i+"`");return}this.length=1,this[0]=this;var a=this._private={cy:e,single:!0,data:t.data||{},position:t.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!t.selected,selectable:t.selectable===void 0?!0:!!t.selectable,locked:!!t.locked,grabbed:!1,grabbable:t.grabbable===void 0?!0:!!t.grabbable,pannable:t.pannable===void 0?i==="edges":!!t.pannable,active:!1,classes:new Na,animation:{current:[],queue:[]},rscratch:{},scratch:t.scratch||{},edges:[],children:[],parent:t.parent&&t.parent.isNode()?t.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(a.position.x==null&&(a.position.x=0),a.position.y==null&&(a.position.y=0),t.renderedPosition){var s=t.renderedPosition,o=e.pan(),l=e.zoom();a.position={x:(s.x-o.x)/l,y:(s.y-o.y)/l}}var u=[];Mt(t.classes)?u=t.classes:$e(t.classes)&&(u=t.classes.split(/\s+/));for(var c=0,f=u.length;c<f;c++){var d=u[c];!d||d===""||a.classes.add(d)}this.createEmitter();var h=t.style||t.css;h&&(Et("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(h)),(r===void 0||r)&&this.restore()},ph=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(r,i,a){var s;dt(r)&&!An(r)&&(s=r,r=s.roots||s.root,i=s.visit,a=s.directed),a=arguments.length===2&&!Pt(i)?i:a,i=Pt(i)?i:function(){};for(var o=this._private.cy,l=r=$e(r)?this.filter(r):r,u=[],c=[],f={},d={},h={},v=0,m,g=this.byGroup(),p=g.nodes,x=g.edges,y=0;y<l.length;y++){var E=l[y],M=E.id();E.isNode()&&(u.unshift(E),e.bfs&&(h[M]=!0,c.push(E)),d[M]=0)}for(var w=function(){var I=e.bfs?u.shift():u.pop(),_=I.id();if(e.dfs){if(h[_])return"continue";h[_]=!0,c.push(I)}var P=d[_],A=f[_],D=A!=null?A.source():null,R=A!=null?A.target():null,B=A==null?void 0:I.same(D)?R[0]:D[0],k=void 0;if(k=i(I,A,B,v++,P),k===!0)return m=I,"break";if(k===!1)return"break";for(var V=I.connectedEdges().filter(function(Q){return(!a||Q.source().same(I))&&x.has(Q)}),Y=0;Y<V.length;Y++){var Z=V[Y],W=Z.connectedNodes().filter(function(Q){return!Q.same(I)&&p.has(Q)}),K=W.id();W.length!==0&&!h[K]&&(W=W[0],u.push(W),e.bfs&&(h[K]=!0,c.push(W)),f[K]=Z,d[K]=d[_]+1)}};u.length!==0;){var b=w();if(b!=="continue"&&b==="break")break}for(var C=o.collection(),T=0;T<c.length;T++){var S=c[T],L=f[S.id()];L!=null&&C.push(L),C.push(S)}return{path:o.collection(C),found:o.collection(m)}}},xs={breadthFirstSearch:ph({bfs:!0}),depthFirstSearch:ph({dfs:!0})};xs.bfs=xs.breadthFirstSearch;xs.dfs=xs.depthFirstSearch;var mT=_b(function(n,e){(function(){var t,r,i,a,s,o,l,u,c,f,d,h,v,m,g;i=Math.floor,f=Math.min,r=function(p,x){return p<x?-1:p>x?1:0},c=function(p,x,y,E,M){var w;if(y==null&&(y=0),M==null&&(M=r),y<0)throw new Error("lo must be non-negative");for(E==null&&(E=p.length);y<E;)w=i((y+E)/2),M(x,p[w])<0?E=w:y=w+1;return[].splice.apply(p,[y,y-y].concat(x)),x},o=function(p,x,y){return y==null&&(y=r),p.push(x),m(p,0,p.length-1,y)},s=function(p,x){var y,E;return x==null&&(x=r),y=p.pop(),p.length?(E=p[0],p[0]=y,g(p,0,x)):E=y,E},u=function(p,x,y){var E;return y==null&&(y=r),E=p[0],p[0]=x,g(p,0,y),E},l=function(p,x,y){var E;return y==null&&(y=r),p.length&&y(p[0],x)<0&&(E=[p[0],x],x=E[0],p[0]=E[1],g(p,0,y)),x},a=function(p,x){var y,E,M,w,b,C;for(x==null&&(x=r),w=(function(){C=[];for(var T=0,S=i(p.length/2);0<=S?T<S:T>S;0<=S?T++:T--)C.push(T);return C}).apply(this).reverse(),b=[],E=0,M=w.length;E<M;E++)y=w[E],b.push(g(p,y,x));return b},v=function(p,x,y){var E;if(y==null&&(y=r),E=p.indexOf(x),E!==-1)return m(p,0,E,y),g(p,E,y)},d=function(p,x,y){var E,M,w,b,C;if(y==null&&(y=r),M=p.slice(0,x),!M.length)return M;for(a(M,y),C=p.slice(x),w=0,b=C.length;w<b;w++)E=C[w],l(M,E,y);return M.sort(y).reverse()},h=function(p,x,y){var E,M,w,b,C,T,S,L,N;if(y==null&&(y=r),x*10<=p.length){if(w=p.slice(0,x).sort(y),!w.length)return w;for(M=w[w.length-1],S=p.slice(x),b=0,T=S.length;b<T;b++)E=S[b],y(E,M)<0&&(c(w,E,0,null,y),w.pop(),M=w[w.length-1]);return w}for(a(p,y),N=[],C=0,L=f(x,p.length);0<=L?C<L:C>L;0<=L?++C:--C)N.push(s(p,y));return N},m=function(p,x,y,E){var M,w,b;for(E==null&&(E=r),M=p[y];y>x;){if(b=y-1>>1,w=p[b],E(M,w)<0){p[y]=w,y=b;continue}break}return p[y]=M},g=function(p,x,y){var E,M,w,b,C;for(y==null&&(y=r),M=p.length,C=x,w=p[x],E=2*x+1;E<M;)b=E+1,b<M&&!(y(p[E],p[b])<0)&&(E=b),p[x]=p[E],x=E,E=2*x+1;return p[x]=w,m(p,C,x,y)},t=function(){p.push=o,p.pop=s,p.replace=u,p.pushpop=l,p.heapify=a,p.updateItem=v,p.nlargest=d,p.nsmallest=h;function p(x){this.cmp=x??r,this.nodes=[]}return p.prototype.push=function(x){return o(this.nodes,x,this.cmp)},p.prototype.pop=function(){return s(this.nodes,this.cmp)},p.prototype.peek=function(){return this.nodes[0]},p.prototype.contains=function(x){return this.nodes.indexOf(x)!==-1},p.prototype.replace=function(x){return u(this.nodes,x,this.cmp)},p.prototype.pushpop=function(x){return l(this.nodes,x,this.cmp)},p.prototype.heapify=function(){return a(this.nodes,this.cmp)},p.prototype.updateItem=function(x){return v(this.nodes,x,this.cmp)},p.prototype.clear=function(){return this.nodes=[]},p.prototype.empty=function(){return this.nodes.length===0},p.prototype.size=function(){return this.nodes.length},p.prototype.clone=function(){var x;return x=new p,x.nodes=this.nodes.slice(0),x},p.prototype.toArray=function(){return this.nodes.slice(0)},p.prototype.insert=p.prototype.push,p.prototype.top=p.prototype.peek,p.prototype.front=p.prototype.peek,p.prototype.has=p.prototype.contains,p.prototype.copy=p.prototype.clone,p}(),function(p,x){return n.exports=x()}(this,function(){return t})}).call(rs)}),Fs=mT,yT=Zt({root:null,weight:function(e){return 1},directed:!1}),xT={dijkstra:function(e){if(!dt(e)){var t=arguments;e={root:t[0],weight:t[1],directed:t[2]}}var r=yT(e),i=r.root,a=r.weight,s=r.directed,o=this,l=a,u=$e(i)?this.filter(i)[0]:i[0],c={},f={},d={},h=this.byGroup(),v=h.nodes,m=h.edges;m.unmergeBy(function(P){return P.isLoop()});for(var g=function(A){return c[A.id()]},p=function(A,D){c[A.id()]=D,x.updateItem(A)},x=new Fs(function(P,A){return g(P)-g(A)}),y=0;y<v.length;y++){var E=v[y];c[E.id()]=E.same(u)?0:1/0,x.push(E)}for(var M=function(A,D){for(var R=(s?A.edgesTo(D):A.edgesWith(D)).intersect(m),B=1/0,k,V=0;V<R.length;V++){var Y=R[V],Z=l(Y);(Z<B||!k)&&(B=Z,k=Y)}return{edge:k,dist:B}};x.size()>0;){var w=x.pop(),b=g(w),C=w.id();if(d[C]=b,b!==1/0)for(var T=w.neighborhood().intersect(v),S=0;S<T.length;S++){var L=T[S],N=L.id(),I=M(w,L),_=b+I.dist;_<g(L)&&(p(L,_),f[N]={node:w,edge:I.edge})}}return{distanceTo:function(A){var D=$e(A)?v.filter(A)[0]:A[0];return d[D.id()]},pathTo:function(A){var D=$e(A)?v.filter(A)[0]:A[0],R=[],B=D,k=B.id();if(D.length>0)for(R.unshift(D);f[k];){var V=f[k];R.unshift(V.edge),R.unshift(V.node),B=V.node,k=B.id()}return o.spawn(R)}}}},ET={kruskal:function(e){e=e||function(y){return 1};for(var t=this.byGroup(),r=t.nodes,i=t.edges,a=r.length,s=new Array(a),o=r,l=function(E){for(var M=0;M<s.length;M++){var w=s[M];if(w.has(E))return M}},u=0;u<a;u++)s[u]=this.spawn(r[u]);for(var c=i.sort(function(y,E){return e(y)-e(E)}),f=0;f<c.length;f++){var d=c[f],h=d.source()[0],v=d.target()[0],m=l(h),g=l(v),p=s[m],x=s[g];m!==g&&(o.merge(d),p.merge(x),s.splice(g,1))}return o}},_T=Zt({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),bT={aStar:function(e){var t=this.cy(),r=_T(e),i=r.root,a=r.goal,s=r.heuristic,o=r.directed,l=r.weight;i=t.collection(i)[0],a=t.collection(a)[0];var u=i.id(),c=a.id(),f={},d={},h={},v=new Fs(function(k,V){return d[k.id()]-d[V.id()]}),m=new Na,g={},p={},x=function(V,Y){v.push(V),m.add(Y)},y,E,M=function(){y=v.pop(),E=y.id(),m.delete(E)},w=function(V){return m.has(V)};x(i,u),f[u]=0,d[u]=s(i);for(var b=0;v.size()>0;){if(M(),b++,E===c){for(var C=[],T=a,S=c,L=p[S];C.unshift(T),L!=null&&C.unshift(L),T=g[S],T!=null;)S=T.id(),L=p[S];return{found:!0,distance:f[E],path:this.spawn(C),steps:b}}h[E]=!0;for(var N=y._private.edges,I=0;I<N.length;I++){var _=N[I];if(this.hasElementWithId(_.id())&&!(o&&_.data("source")!==E)){var P=_.source(),A=_.target(),D=P.id()!==E?P:A,R=D.id();if(this.hasElementWithId(R)&&!h[R]){var B=f[E]+l(_);if(!w(R)){f[R]=B,d[R]=B+s(D),x(D,R),g[R]=y,p[R]=_;continue}B<f[R]&&(f[R]=B,d[R]=B+s(D),g[R]=y,p[R]=_)}}}}return{found:!1,distance:void 0,path:void 0,steps:b}}},TT=Zt({weight:function(e){return 1},directed:!1}),ST={floydWarshall:function(e){for(var t=this.cy(),r=TT(e),i=r.weight,a=r.directed,s=i,o=this.byGroup(),l=o.nodes,u=o.edges,c=l.length,f=c*c,d=function(Z){return l.indexOf(Z)},h=function(Z){return l[Z]},v=new Array(f),m=0;m<f;m++){var g=m%c,p=(m-g)/c;p===g?v[m]=0:v[m]=1/0}for(var x=new Array(f),y=new Array(f),E=0;E<u.length;E++){var M=u[E],w=M.source()[0],b=M.target()[0];if(w!==b){var C=d(w),T=d(b),S=C*c+T,L=s(M);if(v[S]>L&&(v[S]=L,x[S]=T,y[S]=M),!a){var N=T*c+C;!a&&v[N]>L&&(v[N]=L,x[N]=C,y[N]=M)}}}for(var I=0;I<c;I++)for(var _=0;_<c;_++)for(var P=_*c+I,A=0;A<c;A++){var D=_*c+A,R=I*c+A;v[P]+v[R]<v[D]&&(v[D]=v[P]+v[R],x[D]=x[P])}var B=function(Z){return($e(Z)?t.filter(Z):Z)[0]},k=function(Z){return d(B(Z))},V={distance:function(Z,W){var K=k(Z),Q=k(W);return v[K*c+Q]},path:function(Z,W){var K=k(Z),Q=k(W),ne=h(K);if(K===Q)return ne.collection();if(x[K*c+Q]==null)return t.collection();var ie=t.collection(),H=K,X;for(ie.merge(ne);K!==Q;)H=K,K=x[K*c+Q],X=y[H*c+K],ie.merge(X),ie.merge(h(K));return ie}};return V}},MT=Zt({weight:function(e){return 1},directed:!1,root:null}),wT={bellmanFord:function(e){var t=this,r=MT(e),i=r.weight,a=r.directed,s=r.root,o=i,l=this,u=this.cy(),c=this.byGroup(),f=c.edges,d=c.nodes,h=d.length,v=new ar,m=!1,g=[];s=u.collection(s)[0],f.unmergeBy(function(De){return De.isLoop()});for(var p=f.length,x=function(de){var we=v.get(de.id());return we||(we={},v.set(de.id(),we)),we},y=function(de){return($e(de)?u.$(de):de)[0]},E=function(de){return x(y(de)).dist},M=function(de){for(var we=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s,Me=y(de),z=[],O=Me;;){if(O==null)return t.spawn();var re=x(O),ve=re.edge,Ee=re.pred;if(z.unshift(O[0]),O.same(we)&&z.length>0)break;ve!=null&&z.unshift(ve),O=Ee}return l.spawn(z)},w=0;w<h;w++){var b=d[w],C=x(b);b.same(s)?C.dist=0:C.dist=1/0,C.pred=null,C.edge=null}for(var T=!1,S=function(de,we,Me,z,O,re){var ve=z.dist+re;ve<O.dist&&!Me.same(z.edge)&&(O.dist=ve,O.pred=de,O.edge=Me,T=!0)},L=1;L<h;L++){T=!1;for(var N=0;N<p;N++){var I=f[N],_=I.source(),P=I.target(),A=o(I),D=x(_),R=x(P);S(_,P,I,D,R,A),a||S(P,_,I,R,D,A)}if(!T)break}if(T)for(var B=[],k=0;k<p;k++){var V=f[k],Y=V.source(),Z=V.target(),W=o(V),K=x(Y).dist,Q=x(Z).dist;if(K+W<Q||!a&&Q+W<K)if(m||(Et("Graph contains a negative weight cycle for Bellman-Ford"),m=!0),e.findNegativeWeightCycles!==!1){var ne=[];K+W<Q&&ne.push(Y),!a&&Q+W<K&&ne.push(Z);for(var ie=ne.length,H=0;H<ie;H++){var X=ne[H],te=[X];te.push(x(X).edge);for(var ue=x(X).pred;te.indexOf(ue)===-1;)te.push(ue),te.push(x(ue).edge),ue=x(ue).pred;te=te.slice(te.indexOf(ue));for(var Se=te[0].id(),U=0,Ge=2;Ge<te.length;Ge+=2)te[Ge].id()<Se&&(Se=te[Ge].id(),U=Ge);te=te.slice(U).concat(te.slice(0,U)),te.push(te[0]);var Le=te.map(function(De){return De.id()}).join(",");B.indexOf(Le)===-1&&(g.push(l.spawn(te)),B.push(Le))}}else break}return{distanceTo:E,pathTo:M,hasNegativeWeightCycle:m,negativeWeightCycles:g}}},AT=Math.sqrt(2),CT=function(e,t,r){r.length===0&&Lt("Karger-Stein must be run on a connected (sub)graph");for(var i=r[e],a=i[1],s=i[2],o=t[a],l=t[s],u=r,c=u.length-1;c>=0;c--){var f=u[c],d=f[1],h=f[2];(t[d]===o&&t[h]===l||t[d]===l&&t[h]===o)&&u.splice(c,1)}for(var v=0;v<u.length;v++){var m=u[v];m[1]===l?(u[v]=m.slice(),u[v][1]=o):m[2]===l&&(u[v]=m.slice(),u[v][2]=o)}for(var g=0;g<t.length;g++)t[g]===l&&(t[g]=o);return u},iu=function(e,t,r,i){for(;r>i;){var a=Math.floor(Math.random()*t.length);t=CT(a,e,t),r--}return t},RT={kargerStein:function(){var e=this,t=this.byGroup(),r=t.nodes,i=t.edges;i.unmergeBy(function(R){return R.isLoop()});var a=r.length,s=i.length,o=Math.ceil(Math.pow(Math.log(a)/Math.LN2,2)),l=Math.floor(a/AT);if(a<2){Lt("At least 2 nodes are required for Karger-Stein algorithm");return}for(var u=[],c=0;c<s;c++){var f=i[c];u.push([c,r.indexOf(f.source()),r.indexOf(f.target())])}for(var d=1/0,h=[],v=new Array(a),m=new Array(a),g=new Array(a),p=function(B,k){for(var V=0;V<a;V++)k[V]=B[V]},x=0;x<=o;x++){for(var y=0;y<a;y++)m[y]=y;var E=iu(m,u.slice(),a,l),M=E.slice();p(m,g);var w=iu(m,E,l,2),b=iu(g,M,l,2);w.length<=b.length&&w.length<d?(d=w.length,h=w,p(m,v)):b.length<=w.length&&b.length<d&&(d=b.length,h=b,p(g,v))}for(var C=this.spawn(h.map(function(R){return i[R[0]]})),T=this.spawn(),S=this.spawn(),L=v[0],N=0;N<v.length;N++){var I=v[N],_=r[N];I===L?T.merge(_):S.merge(_)}var P=function(B){var k=e.spawn();return B.forEach(function(V){k.merge(V),V.connectedEdges().forEach(function(Y){e.contains(Y)&&!C.contains(Y)&&k.merge(Y)})}),k},A=[P(T),P(S)],D={cut:C,components:A,partition1:T,partition2:S};return D}},DT=function(e){return{x:e.x,y:e.y}},hl=function(e,t,r){return{x:e.x*t+r.x,y:e.y*t+r.y}},Lp=function(e,t,r){return{x:(e.x-r.x)/t,y:(e.y-r.y)/t}},ca=function(e){return{x:e[0],y:e[1]}},LT=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=1/0,a=t;a<r;a++){var s=e[a];isFinite(s)&&(i=Math.min(s,i))}return i},PT=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=-1/0,a=t;a<r;a++){var s=e[a];isFinite(s)&&(i=Math.max(s,i))}return i},NT=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=0,a=0,s=t;s<r;s++){var o=e[s];isFinite(o)&&(i+=o,a++)}return i/a},IT=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;i?e=e.slice(t,r):(r<e.length&&e.splice(r,e.length-r),t>0&&e.splice(0,t));for(var o=0,l=e.length-1;l>=0;l--){var u=e[l];s?isFinite(u)||(e[l]=-1/0,o++):e.splice(l,1)}a&&e.sort(function(d,h){return d-h});var c=e.length,f=Math.floor(c/2);return c%2!==0?e[f+1+o]:(e[f-1+o]+e[f+o])/2},OT=function(e){return Math.PI*e/180},po=function(e,t){return Math.atan2(t,e)-Math.PI/2},zc=Math.log2||function(n){return Math.log(n)/Math.log(2)},Pp=function(e){return e>0?1:e<0?-1:0},Ci=function(e,t){return Math.sqrt(pi(e,t))},pi=function(e,t){var r=t.x-e.x,i=t.y-e.y;return r*r+i*i},FT=function(e){for(var t=e.length,r=0,i=0;i<t;i++)r+=e[i];for(var a=0;a<t;a++)e[a]=e[a]/r;return e},Kt=function(e,t,r,i){return(1-i)*(1-i)*e+2*(1-i)*i*t+i*i*r},ga=function(e,t,r,i){return{x:Kt(e.x,t.x,r.x,i),y:Kt(e.y,t.y,r.y,i)}},UT=function(e,t,r,i){var a={x:t.x-e.x,y:t.y-e.y},s=Ci(e,t),o={x:a.x/s,y:a.y/s};return r=r??0,i=i??r*s,{x:e.x+o.x*i,y:e.y+o.y*i}},Es=function(e,t,r){return Math.max(e,Math.min(r,t))},En=function(e){if(e==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(e.x1!=null&&e.y1!=null){if(e.x2!=null&&e.y2!=null&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};if(e.w!=null&&e.h!=null&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},BT=function(e){return{x1:e.x1,x2:e.x2,w:e.w,y1:e.y1,y2:e.y2,h:e.h}},kT=function(e){e.x1=1/0,e.y1=1/0,e.x2=-1/0,e.y2=-1/0,e.w=0,e.h=0},zT=function(e,t,r){return{x1:e.x1+t,x2:e.x2+t,y1:e.y1+r,y2:e.y2+r,w:e.w,h:e.h}},Np=function(e,t){e.x1=Math.min(e.x1,t.x1),e.x2=Math.max(e.x2,t.x2),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,t.y1),e.y2=Math.max(e.y2,t.y2),e.h=e.y2-e.y1},GT=function(e,t,r){e.x1=Math.min(e.x1,t),e.x2=Math.max(e.x2,t),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,r),e.y2=Math.max(e.y2,r),e.h=e.y2-e.y1},No=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.x1-=t,e.x2+=t,e.y1-=t,e.y2+=t,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},Io=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],r,i,a,s;if(t.length===1)r=i=a=s=t[0];else if(t.length===2)r=a=t[0],s=i=t[1];else if(t.length===4){var o=$t(t,4);r=o[0],i=o[1],a=o[2],s=o[3]}return e.x1-=s,e.x2+=i,e.y1-=r,e.y2+=a,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},vh=function(e,t){e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},Gc=function(e,t){return!(e.x1>t.x2||t.x1>e.x2||e.x2<t.x1||t.x2<e.x1||e.y2<t.y1||t.y2<e.y1||e.y1>t.y2||t.y1>e.y2)},Ca=function(e,t,r){return e.x1<=t&&t<=e.x2&&e.y1<=r&&r<=e.y2},VT=function(e,t){return Ca(e,t.x,t.y)},Ip=function(e,t){return Ca(e,t.x1,t.y1)&&Ca(e,t.x2,t.y2)},Op=function(e,t,r,i,a,s,o){var l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",u=l==="auto"?Ri(a,s):l,c=a/2,f=s/2;u=Math.min(u,c,f);var d=u!==c,h=u!==f,v;if(d){var m=r-c+u-o,g=i-f-o,p=r+c-u+o,x=g;if(v=Gr(e,t,r,i,m,g,p,x,!1),v.length>0)return v}if(h){var y=r+c+o,E=i-f+u-o,M=y,w=i+f-u+o;if(v=Gr(e,t,r,i,y,E,M,w,!1),v.length>0)return v}if(d){var b=r-c+u-o,C=i+f+o,T=r+c-u+o,S=C;if(v=Gr(e,t,r,i,b,C,T,S,!1),v.length>0)return v}if(h){var L=r-c-o,N=i-f+u-o,I=L,_=i+f-u+o;if(v=Gr(e,t,r,i,L,N,I,_,!1),v.length>0)return v}var P;{var A=r-c+u,D=i-f+u;if(P=as(e,t,r,i,A,D,u+o),P.length>0&&P[0]<=A&&P[1]<=D)return[P[0],P[1]]}{var R=r+c-u,B=i-f+u;if(P=as(e,t,r,i,R,B,u+o),P.length>0&&P[0]>=R&&P[1]<=B)return[P[0],P[1]]}{var k=r+c-u,V=i+f-u;if(P=as(e,t,r,i,k,V,u+o),P.length>0&&P[0]>=k&&P[1]>=V)return[P[0],P[1]]}{var Y=r-c+u,Z=i+f-u;if(P=as(e,t,r,i,Y,Z,u+o),P.length>0&&P[0]<=Y&&P[1]>=Z)return[P[0],P[1]]}return[]},HT=function(e,t,r,i,a,s,o){var l=o,u=Math.min(r,a),c=Math.max(r,a),f=Math.min(i,s),d=Math.max(i,s);return u-l<=e&&e<=c+l&&f-l<=t&&t<=d+l},WT=function(e,t,r,i,a,s,o,l,u){var c={x1:Math.min(r,o,a)-u,x2:Math.max(r,o,a)+u,y1:Math.min(i,l,s)-u,y2:Math.max(i,l,s)+u};return!(e<c.x1||e>c.x2||t<c.y1||t>c.y2)},XT=function(e,t,r,i){r-=i;var a=t*t-4*e*r;if(a<0)return[];var s=Math.sqrt(a),o=2*e,l=(-t+s)/o,u=(-t-s)/o;return[l,u]},YT=function(e,t,r,i,a){var s=1e-5;e===0&&(e=s),t/=e,r/=e,i/=e;var o,l,u,c,f,d,h,v;if(l=(3*r-t*t)/9,u=-(27*i)+t*(9*r-2*(t*t)),u/=54,o=l*l*l+u*u,a[1]=0,h=t/3,o>0){f=u+Math.sqrt(o),f=f<0?-Math.pow(-f,1/3):Math.pow(f,1/3),d=u-Math.sqrt(o),d=d<0?-Math.pow(-d,1/3):Math.pow(d,1/3),a[0]=-h+f+d,h+=(f+d)/2,a[4]=a[2]=-h,h=Math.sqrt(3)*(-d+f)/2,a[3]=h,a[5]=-h;return}if(a[5]=a[3]=0,o===0){v=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3),a[0]=-h+2*v,a[4]=a[2]=-(v+h);return}l=-l,c=l*l*l,c=Math.acos(u/Math.sqrt(c)),v=2*Math.sqrt(l),a[0]=-h+v*Math.cos(c/3),a[2]=-h+v*Math.cos((c+2*Math.PI)/3),a[4]=-h+v*Math.cos((c+4*Math.PI)/3)},qT=function(e,t,r,i,a,s,o,l){var u=1*r*r-4*r*a+2*r*o+4*a*a-4*a*o+o*o+i*i-4*i*s+2*i*l+4*s*s-4*s*l+l*l,c=1*9*r*a-3*r*r-3*r*o-6*a*a+3*a*o+9*i*s-3*i*i-3*i*l-6*s*s+3*s*l,f=1*3*r*r-6*r*a+r*o-r*e+2*a*a+2*a*e-o*e+3*i*i-6*i*s+i*l-i*t+2*s*s+2*s*t-l*t,d=1*r*a-r*r+r*e-a*e+i*s-i*i+i*t-s*t,h=[];YT(u,c,f,d,h);for(var v=1e-7,m=[],g=0;g<6;g+=2)Math.abs(h[g+1])<v&&h[g]>=0&&h[g]<=1&&m.push(h[g]);m.push(1),m.push(0);for(var p=-1,x,y,E,M=0;M<m.length;M++)x=Math.pow(1-m[M],2)*r+2*(1-m[M])*m[M]*a+m[M]*m[M]*o,y=Math.pow(1-m[M],2)*i+2*(1-m[M])*m[M]*s+m[M]*m[M]*l,E=Math.pow(x-e,2)+Math.pow(y-t,2),p>=0?E<p&&(p=E):p=E;return p},KT=function(e,t,r,i,a,s){var o=[e-r,t-i],l=[a-r,s-i],u=l[0]*l[0]+l[1]*l[1],c=o[0]*o[0]+o[1]*o[1],f=o[0]*l[0]+o[1]*l[1],d=f*f/u;return f<0?c:d>u?(e-a)*(e-a)+(t-s)*(t-s):c-d},yn=function(e,t,r){for(var i,a,s,o,l,u=0,c=0;c<r.length/2;c++)if(i=r[c*2],a=r[c*2+1],c+1<r.length/2?(s=r[(c+1)*2],o=r[(c+1)*2+1]):(s=r[(c+1-r.length/2)*2],o=r[(c+1-r.length/2)*2+1]),!(i==e&&s==e))if(i>=e&&e>=s||i<=e&&e<=s)l=(e-i)/(s-i)*(o-a)+a,l>t&&u++;else continue;return u%2!==0},Mr=function(e,t,r,i,a,s,o,l,u){var c=new Array(r.length),f;l[0]!=null?(f=Math.atan(l[1]/l[0]),l[0]<0?f=f+Math.PI/2:f=-f-Math.PI/2):f=l;for(var d=Math.cos(-f),h=Math.sin(-f),v=0;v<c.length/2;v++)c[v*2]=s/2*(r[v*2]*d-r[v*2+1]*h),c[v*2+1]=o/2*(r[v*2+1]*d+r[v*2]*h),c[v*2]+=i,c[v*2+1]+=a;var m;if(u>0){var g=Jo(c,-u);m=Qo(g)}else m=c;return yn(e,t,m)},$T=function(e,t,r,i,a,s,o,l){for(var u=new Array(r.length*2),c=0;c<l.length;c++){var f=l[c];u[c*4+0]=f.startX,u[c*4+1]=f.startY,u[c*4+2]=f.stopX,u[c*4+3]=f.stopY;var d=Math.pow(f.cx-e,2)+Math.pow(f.cy-t,2);if(d<=Math.pow(f.radius,2))return!0}return yn(e,t,u)},Qo=function(e){for(var t=new Array(e.length/2),r,i,a,s,o,l,u,c,f=0;f<e.length/4;f++){r=e[f*4],i=e[f*4+1],a=e[f*4+2],s=e[f*4+3],f<e.length/4-1?(o=e[(f+1)*4],l=e[(f+1)*4+1],u=e[(f+1)*4+2],c=e[(f+1)*4+3]):(o=e[0],l=e[1],u=e[2],c=e[3]);var d=Gr(r,i,a,s,o,l,u,c,!0);t[f*2]=d[0],t[f*2+1]=d[1]}return t},Jo=function(e,t){for(var r=new Array(e.length*2),i,a,s,o,l=0;l<e.length/2;l++){i=e[l*2],a=e[l*2+1],l<e.length/2-1?(s=e[(l+1)*2],o=e[(l+1)*2+1]):(s=e[0],o=e[1]);var u=o-a,c=-(s-i),f=Math.sqrt(u*u+c*c),d=u/f,h=c/f;r[l*4]=i+d*t,r[l*4+1]=a+h*t,r[l*4+2]=s+d*t,r[l*4+3]=o+h*t}return r},ZT=function(e,t,r,i,a,s){var o=r-e,l=i-t;o/=a,l/=s;var u=Math.sqrt(o*o+l*l),c=u-1;if(c<0)return[];var f=c/u;return[(r-e)*f+e,(i-t)*f+t]},bi=function(e,t,r,i,a,s,o){return e-=a,t-=s,e/=r/2+o,t/=i/2+o,e*e+t*t<=1},as=function(e,t,r,i,a,s,o){var l=[r-e,i-t],u=[e-a,t-s],c=l[0]*l[0]+l[1]*l[1],f=2*(u[0]*l[0]+u[1]*l[1]),d=u[0]*u[0]+u[1]*u[1]-o*o,h=f*f-4*c*d;if(h<0)return[];var v=(-f+Math.sqrt(h))/(2*c),m=(-f-Math.sqrt(h))/(2*c),g=Math.min(v,m),p=Math.max(v,m),x=[];if(g>=0&&g<=1&&x.push(g),p>=0&&p<=1&&x.push(p),x.length===0)return[];var y=x[0]*l[0]+e,E=x[0]*l[1]+t;if(x.length>1){if(x[0]==x[1])return[y,E];var M=x[1]*l[0]+e,w=x[1]*l[1]+t;return[y,E,M,w]}else return[y,E]},au=function(e,t,r){return t<=e&&e<=r||r<=e&&e<=t?e:e<=t&&t<=r||r<=t&&t<=e?t:r},Gr=function(e,t,r,i,a,s,o,l,u){var c=e-a,f=r-e,d=o-a,h=t-s,v=i-t,m=l-s,g=d*h-m*c,p=f*h-v*c,x=m*f-d*v;if(x!==0){var y=g/x,E=p/x,M=.001,w=0-M,b=1+M;return w<=y&&y<=b&&w<=E&&E<=b?[e+y*f,t+y*v]:u?[e+y*f,t+y*v]:[]}else return g===0||p===0?au(e,r,o)===o?[o,l]:au(e,r,a)===a?[a,s]:au(a,o,r)===r?[r,i]:[]:[]},_s=function(e,t,r,i,a,s,o,l){var u=[],c,f=new Array(r.length),d=!0;s==null&&(d=!1);var h;if(d){for(var v=0;v<f.length/2;v++)f[v*2]=r[v*2]*s+i,f[v*2+1]=r[v*2+1]*o+a;if(l>0){var m=Jo(f,-l);h=Qo(m)}else h=f}else h=r;for(var g,p,x,y,E=0;E<h.length/2;E++)g=h[E*2],p=h[E*2+1],E<h.length/2-1?(x=h[(E+1)*2],y=h[(E+1)*2+1]):(x=h[0],y=h[1]),c=Gr(e,t,i,a,g,p,x,y),c.length!==0&&u.push(c[0],c[1]);return u},QT=function(e,t,r,i,a,s,o,l,u){var c=[],f,d=new Array(r.length*2);u.forEach(function(x,y){y===0?(d[d.length-2]=x.startX,d[d.length-1]=x.startY):(d[y*4-2]=x.startX,d[y*4-1]=x.startY),d[y*4]=x.stopX,d[y*4+1]=x.stopY,f=as(e,t,i,a,x.cx,x.cy,x.radius),f.length!==0&&c.push(f[0],f[1])});for(var h=0;h<d.length/4;h++)f=Gr(e,t,i,a,d[h*4],d[h*4+1],d[h*4+2],d[h*4+3],!1),f.length!==0&&c.push(f[0],f[1]);if(c.length>2){for(var v=[c[0],c[1]],m=Math.pow(v[0]-e,2)+Math.pow(v[1]-t,2),g=1;g<c.length/2;g++){var p=Math.pow(c[g*2]-e,2)+Math.pow(c[g*2+1]-t,2);p<=m&&(v[0]=c[g*2],v[1]=c[g*2+1],m=p)}return v}return c},vo=function(e,t,r){var i=[e[0]-t[0],e[1]-t[1]],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=(a-r)/a;return s<0&&(s=1e-5),[t[0]+s*i[0],t[1]+s*i[1]]},dn=function(e,t){var r=ic(e,t);return r=Fp(r),r},Fp=function(e){for(var t,r,i=e.length/2,a=1/0,s=1/0,o=-1/0,l=-1/0,u=0;u<i;u++)t=e[2*u],r=e[2*u+1],a=Math.min(a,t),o=Math.max(o,t),s=Math.min(s,r),l=Math.max(l,r);for(var c=2/(o-a),f=2/(l-s),d=0;d<i;d++)t=e[2*d]=e[2*d]*c,r=e[2*d+1]=e[2*d+1]*f,a=Math.min(a,t),o=Math.max(o,t),s=Math.min(s,r),l=Math.max(l,r);if(s<-1)for(var h=0;h<i;h++)r=e[2*h+1]=e[2*h+1]+(-1-s);return e},ic=function(e,t){var r=1/e*2*Math.PI,i=e%2===0?Math.PI/2+r/2:Math.PI/2;i+=t;for(var a=new Array(e*2),s,o=0;o<e;o++)s=o*r+i,a[2*o]=Math.cos(s),a[2*o+1]=Math.sin(-s);return a},Ri=function(e,t){return Math.min(e/4,t/4,8)},Up=function(e,t){return Math.min(e/10,t/10,8)},Vc=function(){return 8},JT=function(e,t,r){return[e-2*t+r,2*(t-e),e]},ac=function(e,t){return{heightOffset:Math.min(15,.05*t),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}},jT=Zt({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),eS={pageRank:function(e){for(var t=jT(e),r=t.dampingFactor,i=t.precision,a=t.iterations,s=t.weight,o=this._private.cy,l=this.byGroup(),u=l.nodes,c=l.edges,f=u.length,d=f*f,h=c.length,v=new Array(d),m=new Array(f),g=(1-r)/f,p=0;p<f;p++){for(var x=0;x<f;x++){var y=p*f+x;v[y]=0}m[p]=0}for(var E=0;E<h;E++){var M=c[E],w=M.data("source"),b=M.data("target");if(w!==b){var C=u.indexOfId(w),T=u.indexOfId(b),S=s(M),L=T*f+C;v[L]+=S,m[C]+=S}}for(var N=1/f+g,I=0;I<f;I++)if(m[I]===0)for(var _=0;_<f;_++){var P=_*f+I;v[P]=N}else for(var A=0;A<f;A++){var D=A*f+I;v[D]=v[D]/m[I]+g}for(var R=new Array(f),B=new Array(f),k,V=0;V<f;V++)R[V]=1;for(var Y=0;Y<a;Y++){for(var Z=0;Z<f;Z++)B[Z]=0;for(var W=0;W<f;W++)for(var K=0;K<f;K++){var Q=W*f+K;B[W]+=v[Q]*R[K]}FT(B),k=R,R=B,B=k;for(var ne=0,ie=0;ie<f;ie++){var H=k[ie]-R[ie];ne+=H*H}if(ne<i)break}var X={rank:function(ue){return ue=o.collection(ue)[0],R[u.indexOf(ue)]}};return X}},gh=Zt({root:null,weight:function(e){return 1},directed:!1,alpha:0}),ma={degreeCentralityNormalized:function(e){e=gh(e);var t=this.cy(),r=this.nodes(),i=r.length;if(e.directed){for(var c={},f={},d=0,h=0,v=0;v<i;v++){var m=r[v],g=m.id();e.root=m;var p=this.degreeCentrality(e);d<p.indegree&&(d=p.indegree),h<p.outdegree&&(h=p.outdegree),c[g]=p.indegree,f[g]=p.outdegree}return{indegree:function(y){return d==0?0:($e(y)&&(y=t.filter(y)),c[y.id()]/d)},outdegree:function(y){return h===0?0:($e(y)&&(y=t.filter(y)),f[y.id()]/h)}}}else{for(var a={},s=0,o=0;o<i;o++){var l=r[o];e.root=l;var u=this.degreeCentrality(e);s<u.degree&&(s=u.degree),a[l.id()]=u.degree}return{degree:function(y){return s===0?0:($e(y)&&(y=t.filter(y)),a[y.id()]/s)}}}},degreeCentrality:function(e){e=gh(e);var t=this.cy(),r=this,i=e,a=i.root,s=i.weight,o=i.directed,l=i.alpha;if(a=t.collection(a)[0],o){for(var h=a.connectedEdges(),v=h.filter(function(w){return w.target().same(a)&&r.has(w)}),m=h.filter(function(w){return w.source().same(a)&&r.has(w)}),g=v.length,p=m.length,x=0,y=0,E=0;E<v.length;E++)x+=s(v[E]);for(var M=0;M<m.length;M++)y+=s(m[M]);return{indegree:Math.pow(g,1-l)*Math.pow(x,l),outdegree:Math.pow(p,1-l)*Math.pow(y,l)}}else{for(var u=a.connectedEdges().intersection(r),c=u.length,f=0,d=0;d<u.length;d++)f+=s(u[d]);return{degree:Math.pow(c,1-l)*Math.pow(f,l)}}}};ma.dc=ma.degreeCentrality;ma.dcn=ma.degreeCentralityNormalised=ma.degreeCentralityNormalized;var mh=Zt({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),ya={closenessCentralityNormalized:function(e){for(var t=mh(e),r=t.harmonic,i=t.weight,a=t.directed,s=this.cy(),o={},l=0,u=this.nodes(),c=this.floydWarshall({weight:i,directed:a}),f=0;f<u.length;f++){for(var d=0,h=u[f],v=0;v<u.length;v++)if(f!==v){var m=c.distance(h,u[v]);r?d+=1/m:d+=m}r||(d=1/d),l<d&&(l=d),o[h.id()]=d}return{closeness:function(p){return l==0?0:($e(p)?p=s.filter(p)[0].id():p=p.id(),o[p]/l)}}},closenessCentrality:function(e){var t=mh(e),r=t.root,i=t.weight,a=t.directed,s=t.harmonic;r=this.filter(r)[0];for(var o=this.dijkstra({root:r,weight:i,directed:a}),l=0,u=this.nodes(),c=0;c<u.length;c++){var f=u[c];if(!f.same(r)){var d=o.distanceTo(f);s?l+=1/d:l+=d}}return s?l:1/l}};ya.cc=ya.closenessCentrality;ya.ccn=ya.closenessCentralityNormalised=ya.closenessCentralityNormalized;var tS=Zt({weight:null,directed:!1}),sc={betweennessCentrality:function(e){for(var t=tS(e),r=t.directed,i=t.weight,a=i!=null,s=this.cy(),o=this.nodes(),l={},u={},c=0,f={set:function(y,E){u[y]=E,E>c&&(c=E)},get:function(y){return u[y]}},d=0;d<o.length;d++){var h=o[d],v=h.id();r?l[v]=h.outgoers().nodes():l[v]=h.openNeighborhood().nodes(),f.set(v,0)}for(var m=function(y){for(var E=o[y].id(),M=[],w={},b={},C={},T=new Fs(function(K,Q){return C[K]-C[Q]}),S=0;S<o.length;S++){var L=o[S].id();w[L]=[],b[L]=0,C[L]=1/0}for(b[E]=1,C[E]=0,T.push(E);!T.empty();){var N=T.pop();if(M.push(N),a)for(var I=0;I<l[N].length;I++){var _=l[N][I],P=s.getElementById(N),A=void 0;P.edgesTo(_).length>0?A=P.edgesTo(_)[0]:A=_.edgesTo(P)[0];var D=i(A);_=_.id(),C[_]>C[N]+D&&(C[_]=C[N]+D,T.nodes.indexOf(_)<0?T.push(_):T.updateItem(_),b[_]=0,w[_]=[]),C[_]==C[N]+D&&(b[_]=b[_]+b[N],w[_].push(N))}else for(var R=0;R<l[N].length;R++){var B=l[N][R].id();C[B]==1/0&&(T.push(B),C[B]=C[N]+1),C[B]==C[N]+1&&(b[B]=b[B]+b[N],w[B].push(N))}}for(var k={},V=0;V<o.length;V++)k[o[V].id()]=0;for(;M.length>0;){for(var Y=M.pop(),Z=0;Z<w[Y].length;Z++){var W=w[Y][Z];k[W]=k[W]+b[W]/b[Y]*(1+k[Y])}Y!=o[y].id()&&f.set(Y,f.get(Y)+k[Y])}},g=0;g<o.length;g++)m(g);var p={betweenness:function(y){var E=s.collection(y).id();return f.get(E)},betweennessNormalized:function(y){if(c==0)return 0;var E=s.collection(y).id();return f.get(E)/c}};return p.betweennessNormalised=p.betweennessNormalized,p}};sc.bc=sc.betweennessCentrality;var nS=Zt({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(n){return 1}]}),rS=function(e){return nS(e)},iS=function(e,t){for(var r=0,i=0;i<t.length;i++)r+=t[i](e);return r},aS=function(e,t,r){for(var i=0;i<t;i++)e[i*t+i]=r},Bp=function(e,t){for(var r,i=0;i<t;i++){r=0;for(var a=0;a<t;a++)r+=e[a*t+i];for(var s=0;s<t;s++)e[s*t+i]=e[s*t+i]/r}},sS=function(e,t,r){for(var i=new Array(r*r),a=0;a<r;a++){for(var s=0;s<r;s++)i[a*r+s]=0;for(var o=0;o<r;o++)for(var l=0;l<r;l++)i[a*r+l]+=e[a*r+o]*t[o*r+l]}return i},oS=function(e,t,r){for(var i=e.slice(0),a=1;a<r;a++)e=sS(e,i,t);return e},lS=function(e,t,r){for(var i=new Array(t*t),a=0;a<t*t;a++)i[a]=Math.pow(e[a],r);return Bp(i,t),i},uS=function(e,t,r,i){for(var a=0;a<r;a++){var s=Math.round(e[a]*Math.pow(10,i))/Math.pow(10,i),o=Math.round(t[a]*Math.pow(10,i))/Math.pow(10,i);if(s!==o)return!1}return!0},cS=function(e,t,r,i){for(var a=[],s=0;s<t;s++){for(var o=[],l=0;l<t;l++)Math.round(e[s*t+l]*1e3)/1e3>0&&o.push(r[l]);o.length!==0&&a.push(i.collection(o))}return a},fS=function(e,t){for(var r=0;r<e.length;r++)if(!t[r]||e[r].id()!==t[r].id())return!1;return!0},hS=function(e){for(var t=0;t<e.length;t++)for(var r=0;r<e.length;r++)t!=r&&fS(e[t],e[r])&&e.splice(r,1);return e},yh=function(e){for(var t=this.nodes(),r=this.edges(),i=this.cy(),a=rS(e),s={},o=0;o<t.length;o++)s[t[o].id()]=o;for(var l=t.length,u=l*l,c=new Array(u),f,d=0;d<u;d++)c[d]=0;for(var h=0;h<r.length;h++){var v=r[h],m=s[v.source().id()],g=s[v.target().id()],p=iS(v,a.attributes);c[m*l+g]+=p,c[g*l+m]+=p}aS(c,l,a.multFactor),Bp(c,l);for(var x=!0,y=0;x&&y<a.maxIterations;)x=!1,f=oS(c,l,a.expandFactor),c=lS(f,l,a.inflateFactor),uS(c,f,u,4)||(x=!0),y++;var E=cS(c,l,t,i);return E=hS(E),E},dS={markovClustering:yh,mcl:yh},pS=function(e){return e},kp=function(e,t){return Math.abs(t-e)},xh=function(e,t,r){return e+kp(t,r)},Eh=function(e,t,r){return e+Math.pow(r-t,2)},vS=function(e){return Math.sqrt(e)},gS=function(e,t,r){return Math.max(e,kp(t,r))},Za=function(e,t,r,i,a){for(var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:pS,o=i,l,u,c=0;c<e;c++)l=t(c),u=r(c),o=a(o,l,u);return s(o)},Ra={euclidean:function(e,t,r){return e>=2?Za(e,t,r,0,Eh,vS):Za(e,t,r,0,xh)},squaredEuclidean:function(e,t,r){return Za(e,t,r,0,Eh)},manhattan:function(e,t,r){return Za(e,t,r,0,xh)},max:function(e,t,r){return Za(e,t,r,-1/0,gS)}};Ra["squared-euclidean"]=Ra.squaredEuclidean;Ra.squaredeuclidean=Ra.squaredEuclidean;function dl(n,e,t,r,i,a){var s;return Pt(n)?s=n:s=Ra[n]||Ra.euclidean,e===0&&Pt(n)?s(i,a):s(e,t,r,i,a)}var mS=Zt({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),Hc=function(e){return mS(e)},jo=function(e,t,r,i,a){var s=a!=="kMedoids",o=s?function(f){return r[f]}:function(f){return i[f](r)},l=function(d){return i[d](t)},u=r,c=t;return dl(e,i.length,o,l,u,c)},su=function(e,t,r){for(var i=r.length,a=new Array(i),s=new Array(i),o=new Array(t),l=null,u=0;u<i;u++)a[u]=e.min(r[u]).value,s[u]=e.max(r[u]).value;for(var c=0;c<t;c++){l=[];for(var f=0;f<i;f++)l[f]=Math.random()*(s[f]-a[f])+a[f];o[c]=l}return o},zp=function(e,t,r,i,a){for(var s=1/0,o=0,l=0;l<t.length;l++){var u=jo(r,e,t[l],i,a);u<s&&(s=u,o=l)}return o},Gp=function(e,t,r){for(var i=[],a=null,s=0;s<t.length;s++)a=t[s],r[a.id()]===e&&i.push(a);return i},yS=function(e,t,r){return Math.abs(t-e)<=r},xS=function(e,t,r){for(var i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++){var s=Math.abs(e[i][a]-t[i][a]);if(s>r)return!1}return!0},ES=function(e,t,r){for(var i=0;i<r;i++)if(e===t[i])return!0;return!1},_h=function(e,t){var r=new Array(t);if(e.length<50)for(var i=0;i<t;i++){for(var a=e[Math.floor(Math.random()*e.length)];ES(a,r,i);)a=e[Math.floor(Math.random()*e.length)];r[i]=a}else for(var s=0;s<t;s++)r[s]=e[Math.floor(Math.random()*e.length)];return r},bh=function(e,t,r){for(var i=0,a=0;a<t.length;a++)i+=jo("manhattan",t[a],e,r,"kMedoids");return i},_S=function(e){var t=this.cy(),r=this.nodes(),i=null,a=Hc(e),s=new Array(a.k),o={},l;a.testMode?typeof a.testCentroids=="number"?(a.testCentroids,l=su(r,a.k,a.attributes)):Wt(a.testCentroids)==="object"?l=a.testCentroids:l=su(r,a.k,a.attributes):l=su(r,a.k,a.attributes);for(var u=!0,c=0;u&&c<a.maxIterations;){for(var f=0;f<r.length;f++)i=r[f],o[i.id()]=zp(i,l,a.distance,a.attributes,"kMeans");u=!1;for(var d=0;d<a.k;d++){var h=Gp(d,r,o);if(h.length!==0){for(var v=a.attributes.length,m=l[d],g=new Array(v),p=new Array(v),x=0;x<v;x++){p[x]=0;for(var y=0;y<h.length;y++)i=h[y],p[x]+=a.attributes[x](i);g[x]=p[x]/h.length,yS(g[x],m[x],a.sensitivityThreshold)||(u=!0)}l[d]=g,s[d]=t.collection(h)}}c++}return s},bS=function(e){var t=this.cy(),r=this.nodes(),i=null,a=Hc(e),s=new Array(a.k),o,l={},u,c=new Array(a.k);a.testMode?typeof a.testCentroids=="number"||(Wt(a.testCentroids)==="object"?o=a.testCentroids:o=_h(r,a.k)):o=_h(r,a.k);for(var f=!0,d=0;f&&d<a.maxIterations;){for(var h=0;h<r.length;h++)i=r[h],l[i.id()]=zp(i,o,a.distance,a.attributes,"kMedoids");f=!1;for(var v=0;v<o.length;v++){var m=Gp(v,r,l);if(m.length!==0){c[v]=bh(o[v],m,a.attributes);for(var g=0;g<m.length;g++)u=bh(m[g],m,a.attributes),u<c[v]&&(c[v]=u,o[v]=m[g],f=!0);s[v]=t.collection(m)}}d++}return s},TS=function(e,t,r,i,a){for(var s,o,l=0;l<t.length;l++)for(var u=0;u<e.length;u++)i[l][u]=Math.pow(r[l][u],a.m);for(var c=0;c<e.length;c++)for(var f=0;f<a.attributes.length;f++){s=0,o=0;for(var d=0;d<t.length;d++)s+=i[d][c]*a.attributes[f](t[d]),o+=i[d][c];e[c][f]=s/o}},SS=function(e,t,r,i,a){for(var s=0;s<e.length;s++)t[s]=e[s].slice();for(var o,l,u,c=2/(a.m-1),f=0;f<r.length;f++)for(var d=0;d<i.length;d++){o=0;for(var h=0;h<r.length;h++)l=jo(a.distance,i[d],r[f],a.attributes,"cmeans"),u=jo(a.distance,i[d],r[h],a.attributes,"cmeans"),o+=Math.pow(l/u,c);e[d][f]=1/o}},MS=function(e,t,r,i){for(var a=new Array(r.k),s=0;s<a.length;s++)a[s]=[];for(var o,l,u=0;u<t.length;u++){o=-1/0,l=-1;for(var c=0;c<t[0].length;c++)t[u][c]>o&&(o=t[u][c],l=c);a[l].push(e[u])}for(var f=0;f<a.length;f++)a[f]=i.collection(a[f]);return a},Th=function(e){var t=this.cy(),r=this.nodes(),i=Hc(e),a,s,o,l,u;l=new Array(r.length);for(var c=0;c<r.length;c++)l[c]=new Array(i.k);o=new Array(r.length);for(var f=0;f<r.length;f++)o[f]=new Array(i.k);for(var d=0;d<r.length;d++){for(var h=0,v=0;v<i.k;v++)o[d][v]=Math.random(),h+=o[d][v];for(var m=0;m<i.k;m++)o[d][m]=o[d][m]/h}s=new Array(i.k);for(var g=0;g<i.k;g++)s[g]=new Array(i.attributes.length);u=new Array(r.length);for(var p=0;p<r.length;p++)u[p]=new Array(i.k);for(var x=!0,y=0;x&&y<i.maxIterations;)x=!1,TS(s,r,o,u,i),SS(o,l,s,r,i),xS(o,l,i.sensitivityThreshold)||(x=!0),y++;return a=MS(r,o,i,t),{clusters:a,degreeOfMembership:o}},wS={kMeans:_S,kMedoids:bS,fuzzyCMeans:Th,fcm:Th},AS=Zt({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),CS={single:"min",complete:"max"},RS=function(e){var t=AS(e),r=CS[t.linkage];return r!=null&&(t.linkage=r),t},Sh=function(e,t,r,i,a){for(var s=0,o=1/0,l,u=a.attributes,c=function(T,S){return dl(a.distance,u.length,function(L){return u[L](T)},function(L){return u[L](S)},T,S)},f=0;f<e.length;f++){var d=e[f].key,h=r[d][i[d]];h<o&&(s=d,o=h)}if(a.mode==="threshold"&&o>=a.threshold||a.mode==="dendrogram"&&e.length===1)return!1;var v=t[s],m=t[i[s]],g;a.mode==="dendrogram"?g={left:v,right:m,key:v.key}:g={value:v.value.concat(m.value),key:v.key},e[v.index]=g,e.splice(m.index,1),t[v.key]=g;for(var p=0;p<e.length;p++){var x=e[p];v.key===x.key?l=1/0:a.linkage==="min"?(l=r[v.key][x.key],r[v.key][x.key]>r[m.key][x.key]&&(l=r[m.key][x.key])):a.linkage==="max"?(l=r[v.key][x.key],r[v.key][x.key]<r[m.key][x.key]&&(l=r[m.key][x.key])):a.linkage==="mean"?l=(r[v.key][x.key]*v.size+r[m.key][x.key]*m.size)/(v.size+m.size):a.mode==="dendrogram"?l=c(x.value,v.value):l=c(x.value[0],v.value[0]),r[v.key][x.key]=r[x.key][v.key]=l}for(var y=0;y<e.length;y++){var E=e[y].key;if(i[E]===v.key||i[E]===m.key){for(var M=E,w=0;w<e.length;w++){var b=e[w].key;r[E][b]<r[E][M]&&(M=b)}i[E]=M}e[y].index=y}return v.key=m.key=v.index=m.index=null,!0},go=function n(e,t,r){e&&(e.value?t.push(e.value):(e.left&&n(e.left,t),e.right&&n(e.right,t)))},DS=function n(e,t){if(!e)return"";if(e.left&&e.right){var r=n(e.left,t),i=n(e.right,t),a=t.add({group:"nodes",data:{id:r+","+i}});return t.add({group:"edges",data:{source:r,target:a.id()}}),t.add({group:"edges",data:{source:i,target:a.id()}}),a.id()}else if(e.value)return e.value.id()},LS=function n(e,t,r){if(!e)return[];var i=[],a=[],s=[];return t===0?(e.left&&go(e.left,i),e.right&&go(e.right,a),s=i.concat(a),[r.collection(s)]):t===1?e.value?[r.collection(e.value)]:(e.left&&go(e.left,i),e.right&&go(e.right,a),[r.collection(i),r.collection(a)]):e.value?[r.collection(e.value)]:(e.left&&(i=n(e.left,t-1,r)),e.right&&(a=n(e.right,t-1,r)),i.concat(a))},Mh=function(e){for(var t=this.cy(),r=this.nodes(),i=RS(e),a=i.attributes,s=function(y,E){return dl(i.distance,a.length,function(M){return a[M](y)},function(M){return a[M](E)},y,E)},o=[],l=[],u=[],c=[],f=0;f<r.length;f++){var d={value:i.mode==="dendrogram"?r[f]:[r[f]],key:f,index:f};o[f]=d,c[f]=d,l[f]=[],u[f]=0}for(var h=0;h<o.length;h++)for(var v=0;v<=h;v++){var m=void 0;i.mode==="dendrogram"?m=h===v?1/0:s(o[h].value,o[v].value):m=h===v?1/0:s(o[h].value[0],o[v].value[0]),l[h][v]=m,l[v][h]=m,m<l[h][u[h]]&&(u[h]=v)}for(var g=Sh(o,c,l,u,i);g;)g=Sh(o,c,l,u,i);var p;return i.mode==="dendrogram"?(p=LS(o[0],i.dendrogramDepth,t),i.addDendrogram&&DS(o[0],t)):(p=new Array(o.length),o.forEach(function(x,y){x.key=x.index=null,p[y]=t.collection(x.value)})),p},PS={hierarchicalClustering:Mh,hca:Mh},NS=Zt({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),IS=function(e){var t=e.damping,r=e.preference;.5<=t&&t<1||Lt("Damping must range on [0.5, 1).  Got: ".concat(t));var i=["median","mean","min","max"];return i.some(function(a){return a===r})||ke(r)||Lt("Preference must be one of [".concat(i.map(function(a){return"'".concat(a,"'")}).join(", "),"] or a number.  Got: ").concat(r)),NS(e)},OS=function(e,t,r,i){var a=function(o,l){return i[l](o)};return-dl(e,i.length,function(s){return a(t,s)},function(s){return a(r,s)},t,r)},FS=function(e,t){var r=null;return t==="median"?r=IT(e):t==="mean"?r=NT(e):t==="min"?r=LT(e):t==="max"?r=PT(e):r=t,r},US=function(e,t,r){for(var i=[],a=0;a<e;a++)t[a*e+a]+r[a*e+a]>0&&i.push(a);return i},wh=function(e,t,r){for(var i=[],a=0;a<e;a++){for(var s=-1,o=-1/0,l=0;l<r.length;l++){var u=r[l];t[a*e+u]>o&&(s=u,o=t[a*e+u])}s>0&&i.push(s)}for(var c=0;c<r.length;c++)i[r[c]]=r[c];return i},BS=function(e,t,r){for(var i=wh(e,t,r),a=0;a<r.length;a++){for(var s=[],o=0;o<i.length;o++)i[o]===r[a]&&s.push(o);for(var l=-1,u=-1/0,c=0;c<s.length;c++){for(var f=0,d=0;d<s.length;d++)f+=t[s[d]*e+s[c]];f>u&&(l=c,u=f)}r[a]=s[l]}return i=wh(e,t,r),i},Ah=function(e){for(var t=this.cy(),r=this.nodes(),i=IS(e),a={},s=0;s<r.length;s++)a[r[s].id()]=s;var o,l,u,c,f,d;o=r.length,l=o*o,u=new Array(l);for(var h=0;h<l;h++)u[h]=-1/0;for(var v=0;v<o;v++)for(var m=0;m<o;m++)v!==m&&(u[v*o+m]=OS(i.distance,r[v],r[m],i.attributes));c=FS(u,i.preference);for(var g=0;g<o;g++)u[g*o+g]=c;f=new Array(l);for(var p=0;p<l;p++)f[p]=0;d=new Array(l);for(var x=0;x<l;x++)d[x]=0;for(var y=new Array(o),E=new Array(o),M=new Array(o),w=0;w<o;w++)y[w]=0,E[w]=0,M[w]=0;for(var b=new Array(o*i.minIterations),C=0;C<b.length;C++)b[C]=0;var T;for(T=0;T<i.maxIterations;T++){for(var S=0;S<o;S++){for(var L=-1/0,N=-1/0,I=-1,_=0,P=0;P<o;P++)y[P]=f[S*o+P],_=d[S*o+P]+u[S*o+P],_>=L?(N=L,L=_,I=P):_>N&&(N=_);for(var A=0;A<o;A++)f[S*o+A]=(1-i.damping)*(u[S*o+A]-L)+i.damping*y[A];f[S*o+I]=(1-i.damping)*(u[S*o+I]-N)+i.damping*y[I]}for(var D=0;D<o;D++){for(var R=0,B=0;B<o;B++)y[B]=d[B*o+D],E[B]=Math.max(0,f[B*o+D]),R+=E[B];R-=E[D],E[D]=f[D*o+D],R+=E[D];for(var k=0;k<o;k++)d[k*o+D]=(1-i.damping)*Math.min(0,R-E[k])+i.damping*y[k];d[D*o+D]=(1-i.damping)*(R-E[D])+i.damping*y[D]}for(var V=0,Y=0;Y<o;Y++){var Z=d[Y*o+Y]+f[Y*o+Y]>0?1:0;b[T%i.minIterations*o+Y]=Z,V+=Z}if(V>0&&(T>=i.minIterations-1||T==i.maxIterations-1)){for(var W=0,K=0;K<o;K++){M[K]=0;for(var Q=0;Q<i.minIterations;Q++)M[K]+=b[Q*o+K];(M[K]===0||M[K]===i.minIterations)&&W++}if(W===o)break}}for(var ne=US(o,f,d),ie=BS(o,u,ne),H={},X=0;X<ne.length;X++)H[ne[X]]=[];for(var te=0;te<r.length;te++){var ue=a[r[te].id()],Se=ie[ue];Se!=null&&H[Se].push(r[te])}for(var U=new Array(ne.length),Ge=0;Ge<ne.length;Ge++)U[Ge]=t.collection(H[ne[Ge]]);return U},kS={affinityPropagation:Ah,ap:Ah},zS=Zt({root:void 0,directed:!1}),GS={hierholzer:function(e){if(!dt(e)){var t=arguments;e={root:t[0],directed:t[1]}}var r=zS(e),i=r.root,a=r.directed,s=this,o=!1,l,u,c;i&&(c=$e(i)?this.filter(i)[0].id():i[0].id());var f={},d={};a?s.forEach(function(x){var y=x.id();if(x.isNode()){var E=x.indegree(!0),M=x.outdegree(!0),w=E-M,b=M-E;w==1?l?o=!0:l=y:b==1?u?o=!0:u=y:(b>1||w>1)&&(o=!0),f[y]=[],x.outgoers().forEach(function(C){C.isEdge()&&f[y].push(C.id())})}else d[y]=[void 0,x.target().id()]}):s.forEach(function(x){var y=x.id();if(x.isNode()){var E=x.degree(!0);E%2&&(l?u?o=!0:u=y:l=y),f[y]=[],x.connectedEdges().forEach(function(M){return f[y].push(M.id())})}else d[y]=[x.source().id(),x.target().id()]});var h={found:!1,trail:void 0};if(o)return h;if(u&&l)if(a){if(c&&u!=c)return h;c=u}else{if(c&&u!=c&&l!=c)return h;c||(c=u)}else c||(c=s[0].id());var v=function(y){for(var E=y,M=[y],w,b,C;f[E].length;)w=f[E].shift(),b=d[w][0],C=d[w][1],E!=C?(f[C]=f[C].filter(function(T){return T!=w}),E=C):!a&&E!=b&&(f[b]=f[b].filter(function(T){return T!=w}),E=b),M.unshift(w),M.unshift(E);return M},m=[],g=[];for(g=v(c);g.length!=1;)f[g[0]].length==0?(m.unshift(s.getElementById(g.shift())),m.unshift(s.getElementById(g.shift()))):g=v(g.shift()).concat(g);m.unshift(s.getElementById(g.shift()));for(var p in f)if(f[p].length)return h;return h.found=!0,h.trail=this.spawn(m,!0),h}},mo=function(){var e=this,t={},r=0,i=0,a=[],s=[],o={},l=function(d,h){for(var v=s.length-1,m=[],g=e.spawn();s[v].x!=d||s[v].y!=h;)m.push(s.pop().edge),v--;m.push(s.pop().edge),m.forEach(function(p){var x=p.connectedNodes().intersection(e);g.merge(p),x.forEach(function(y){var E=y.id(),M=y.connectedEdges().intersection(e);g.merge(y),t[E].cutVertex?g.merge(M.filter(function(w){return w.isLoop()})):g.merge(M)})}),a.push(g)},u=function f(d,h,v){d===v&&(i+=1),t[h]={id:r,low:r++,cutVertex:!1};var m=e.getElementById(h).connectedEdges().intersection(e);if(m.size()===0)a.push(e.spawn(e.getElementById(h)));else{var g,p,x,y;m.forEach(function(E){g=E.source().id(),p=E.target().id(),x=g===h?p:g,x!==v&&(y=E.id(),o[y]||(o[y]=!0,s.push({x:h,y:x,edge:E})),x in t?t[h].low=Math.min(t[h].low,t[x].id):(f(d,x,h),t[h].low=Math.min(t[h].low,t[x].low),t[h].id<=t[x].low&&(t[h].cutVertex=!0,l(h,x))))})}};e.forEach(function(f){if(f.isNode()){var d=f.id();d in t||(i=0,u(d,d),t[d].cutVertex=i>1)}});var c=Object.keys(t).filter(function(f){return t[f].cutVertex}).map(function(f){return e.getElementById(f)});return{cut:e.spawn(c),components:a}},VS={hopcroftTarjanBiconnected:mo,htbc:mo,htb:mo,hopcroftTarjanBiconnectedComponents:mo},yo=function(){var e=this,t={},r=0,i=[],a=[],s=e.spawn(e),o=function l(u){a.push(u),t[u]={index:r,low:r++,explored:!1};var c=e.getElementById(u).connectedEdges().intersection(e);if(c.forEach(function(m){var g=m.target().id();g!==u&&(g in t||l(g),t[g].explored||(t[u].low=Math.min(t[u].low,t[g].low)))}),t[u].index===t[u].low){for(var f=e.spawn();;){var d=a.pop();if(f.merge(e.getElementById(d)),t[d].low=t[u].index,t[d].explored=!0,d===u)break}var h=f.edgesWith(f),v=f.merge(h);i.push(v),s=s.difference(v)}};return e.forEach(function(l){if(l.isNode()){var u=l.id();u in t||o(u)}}),{cut:s,components:i}},HS={tarjanStronglyConnected:yo,tsc:yo,tscc:yo,tarjanStronglyConnectedComponents:yo},Vp={};[xs,xT,ET,bT,ST,wT,RT,eS,ma,ya,sc,dS,wS,PS,kS,GS,VS,HS].forEach(function(n){Je(Vp,n)});/*!
Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable
Copyright (c) 2013-2014 Ralf S. Engelschall (http://engelschall.com)
Licensed under The MIT License (http://opensource.org/licenses/MIT)
*/var Hp=0,Wp=1,Xp=2,wr=function n(e){if(!(this instanceof n))return new n(e);this.id="Thenable/1.0.7",this.state=Hp,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof e=="function"&&e.call(this,this.fulfill.bind(this),this.reject.bind(this))};wr.prototype={fulfill:function(e){return Ch(this,Wp,"fulfillValue",e)},reject:function(e){return Ch(this,Xp,"rejectReason",e)},then:function(e,t){var r=this,i=new wr;return r.onFulfilled.push(Dh(e,i,"fulfill")),r.onRejected.push(Dh(t,i,"reject")),Yp(r),i.proxy}};var Ch=function(e,t,r,i){return e.state===Hp&&(e.state=t,e[r]=i,Yp(e)),e},Yp=function(e){e.state===Wp?Rh(e,"onFulfilled",e.fulfillValue):e.state===Xp&&Rh(e,"onRejected",e.rejectReason)},Rh=function(e,t,r){if(e[t].length!==0){var i=e[t];e[t]=[];var a=function(){for(var o=0;o<i.length;o++)i[o](r)};typeof setImmediate=="function"?setImmediate(a):setTimeout(a,0)}},Dh=function(e,t,r){return function(i){if(typeof e!="function")t[r].call(t,i);else{var a;try{a=e(i)}catch(s){t.reject(s);return}WS(t,a)}}},WS=function n(e,t){if(e===t||e.proxy===t){e.reject(new TypeError("cannot resolve promise with itself"));return}var r;if(Wt(t)==="object"&&t!==null||typeof t=="function")try{r=t.then}catch(a){e.reject(a);return}if(typeof r=="function"){var i=!1;try{r.call(t,function(a){i||(i=!0,a===t?e.reject(new TypeError("circular thenable chain")):n(e,a))},function(a){i||(i=!0,e.reject(a))})}catch(a){i||e.reject(a)}return}e.fulfill(t)};wr.all=function(n){return new wr(function(e,t){for(var r=new Array(n.length),i=0,a=function(l,u){r[l]=u,i++,i===n.length&&e(r)},s=0;s<n.length;s++)(function(o){var l=n[o],u=l!=null&&l.then!=null;if(u)l.then(function(f){a(o,f)},function(f){t(f)});else{var c=l;a(o,c)}})(s)})};wr.resolve=function(n){return new wr(function(e,t){e(n)})};wr.reject=function(n){return new wr(function(e,t){t(n)})};var Ia=typeof Promise<"u"?Promise:wr,oc=function(e,t,r){var i=Oc(e),a=!i,s=this._private=Je({duration:1e3},t,r);if(s.target=e,s.style=s.style||s.css,s.started=!1,s.playing=!1,s.hooked=!1,s.applying=!1,s.progress=0,s.completes=[],s.frames=[],s.complete&&Pt(s.complete)&&s.completes.push(s.complete),a){var o=e.position();s.startPosition=s.startPosition||{x:o.x,y:o.y},s.startStyle=s.startStyle||e.cy().style().getAnimationStartStyle(e,s.style)}if(i){var l=e.pan();s.startPan={x:l.x,y:l.y},s.startZoom=e.zoom()}this.length=1,this[0]=this},Di=oc.prototype;Je(Di,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var t,r=e.target._private.animation;e.queue?t=r.queue:t=r.current,t.push(this),An(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return e.progress===1&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var t=this._private;return e===void 0?t.progress*t.duration:this.progress(e/t.duration)},progress:function(e){var t=this._private,r=t.playing;return e===void 0?t.progress:(r&&this.pause(),t.progress=e,t.started=!1,r&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var e=this._private,t=e.playing;t&&this.pause(),e.progress=1-e.progress,e.started=!1;var r=function(u,c){var f=e[u];f!=null&&(e[u]=e[c],e[c]=f)};if(r("zoom","startZoom"),r("pan","startPan"),r("position","startPosition"),e.style)for(var i=0;i<e.style.length;i++){var a=e.style[i],s=a.name,o=e.startStyle[s];e.startStyle[s]=a,e.style[i]=o}return t&&this.play(),this},promise:function(e){var t=this._private,r;switch(e){case"frame":r=t.frames;break;default:case"complete":case"completed":r=t.completes}return new Ia(function(i,a){r.push(function(){i()})})}});Di.complete=Di.completed;Di.run=Di.play;Di.running=Di.playing;var XS={animated:function(){return function(){var t=this,r=t.length!==void 0,i=r?t:[t],a=this._private.cy||this;if(!a.styleEnabled())return!1;var s=i[0];if(s)return s._private.animation.current.length>0}},clearQueue:function(){return function(){var t=this,r=t.length!==void 0,i=r?t:[t],a=this._private.cy||this;if(!a.styleEnabled())return this;for(var s=0;s<i.length;s++){var o=i[s];o._private.animation.queue=[]}return this}},delay:function(){return function(t,r){var i=this._private.cy||this;return i.styleEnabled()?this.animate({delay:t,duration:t,complete:r}):this}},delayAnimation:function(){return function(t,r){var i=this._private.cy||this;return i.styleEnabled()?this.animation({delay:t,duration:t,complete:r}):this}},animation:function(){return function(t,r){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this,l=!a,u=!l;if(!o.styleEnabled())return this;var c=o.style();t=Je({},t,r);var f=Object.keys(t).length===0;if(f)return new oc(s[0],t);switch(t.duration===void 0&&(t.duration=400),t.duration){case"slow":t.duration=600;break;case"fast":t.duration=200;break}if(u&&(t.style=c.getPropsList(t.style||t.css),t.css=void 0),u&&t.renderedPosition!=null){var d=t.renderedPosition,h=o.pan(),v=o.zoom();t.position=Lp(d,v,h)}if(l&&t.panBy!=null){var m=t.panBy,g=o.pan();t.pan={x:g.x+m.x,y:g.y+m.y}}var p=t.center||t.centre;if(l&&p!=null){var x=o.getCenterPan(p.eles,t.zoom);x!=null&&(t.pan=x)}if(l&&t.fit!=null){var y=t.fit,E=o.getFitViewport(y.eles||y.boundingBox,y.padding);E!=null&&(t.pan=E.pan,t.zoom=E.zoom)}if(l&&dt(t.zoom)){var M=o.getZoomedViewport(t.zoom);M!=null?(M.zoomed&&(t.zoom=M.zoom),M.panned&&(t.pan=M.pan)):t.zoom=null}return new oc(s[0],t)}},animate:function(){return function(t,r){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;r&&(t=Je({},t,r));for(var l=0;l<s.length;l++){var u=s[l],c=u.animated()&&(t.queue===void 0||t.queue),f=u.animation(t,c?{queue:!0}:void 0);f.play()}return this}},stop:function(){return function(t,r){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;for(var l=0;l<s.length;l++){for(var u=s[l],c=u._private,f=c.animation.current,d=0;d<f.length;d++){var h=f[d],v=h._private;r&&(v.duration=0)}t&&(c.animation.queue=[]),r||(c.animation.current=[])}return o.notify("draw"),this}}},YS=Array.isArray,pl=YS,qS=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,KS=/^\w*$/;function $S(n,e){if(pl(n))return!1;var t=typeof n;return t=="number"||t=="symbol"||t=="boolean"||n==null||Is(n)?!0:KS.test(n)||!qS.test(n)||e!=null&&n in Object(e)}var ZS=$S,QS="[object AsyncFunction]",JS="[object Function]",jS="[object GeneratorFunction]",eM="[object Proxy]";function tM(n){if(!Ai(n))return!1;var e=bp(n);return e==JS||e==jS||e==QS||e==eM}var nM=tM,rM=cl["__core-js_shared__"],ou=rM,Lh=function(){var n=/[^.]+$/.exec(ou&&ou.keys&&ou.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function iM(n){return!!Lh&&Lh in n}var aM=iM,sM=Function.prototype,oM=sM.toString;function lM(n){if(n!=null){try{return oM.call(n)}catch{}try{return n+""}catch{}}return""}var uM=lM,cM=/[\\^$.*+?()[\]{}|]/g,fM=/^\[object .+?Constructor\]$/,hM=Function.prototype,dM=Object.prototype,pM=hM.toString,vM=dM.hasOwnProperty,gM=RegExp("^"+pM.call(vM).replace(cM,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mM(n){if(!Ai(n)||aM(n))return!1;var e=nM(n)?gM:fM;return e.test(uM(n))}var yM=mM;function xM(n,e){return n==null?void 0:n[e]}var EM=xM;function _M(n,e){var t=EM(n,e);return yM(t)?t:void 0}var Wc=_M,bM=Wc(Object,"create"),bs=bM;function TM(){this.__data__=bs?bs(null):{},this.size=0}var SM=TM;function MM(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var wM=MM,AM="__lodash_hash_undefined__",CM=Object.prototype,RM=CM.hasOwnProperty;function DM(n){var e=this.__data__;if(bs){var t=e[n];return t===AM?void 0:t}return RM.call(e,n)?e[n]:void 0}var LM=DM,PM=Object.prototype,NM=PM.hasOwnProperty;function IM(n){var e=this.__data__;return bs?e[n]!==void 0:NM.call(e,n)}var OM=IM,FM="__lodash_hash_undefined__";function UM(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=bs&&e===void 0?FM:e,this}var BM=UM;function Oa(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Oa.prototype.clear=SM;Oa.prototype.delete=wM;Oa.prototype.get=LM;Oa.prototype.has=OM;Oa.prototype.set=BM;var Ph=Oa;function kM(){this.__data__=[],this.size=0}var zM=kM;function GM(n,e){return n===e||n!==n&&e!==e}var qp=GM;function VM(n,e){for(var t=n.length;t--;)if(qp(n[t][0],e))return t;return-1}var vl=VM,HM=Array.prototype,WM=HM.splice;function XM(n){var e=this.__data__,t=vl(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():WM.call(e,t,1),--this.size,!0}var YM=XM;function qM(n){var e=this.__data__,t=vl(e,n);return t<0?void 0:e[t][1]}var KM=qM;function $M(n){return vl(this.__data__,n)>-1}var ZM=$M;function QM(n,e){var t=this.__data__,r=vl(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}var JM=QM;function Fa(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Fa.prototype.clear=zM;Fa.prototype.delete=YM;Fa.prototype.get=KM;Fa.prototype.has=ZM;Fa.prototype.set=JM;var jM=Fa,ew=Wc(cl,"Map"),tw=ew;function nw(){this.size=0,this.__data__={hash:new Ph,map:new(tw||jM),string:new Ph}}var rw=nw;function iw(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var aw=iw;function sw(n,e){var t=n.__data__;return aw(e)?t[typeof e=="string"?"string":"hash"]:t.map}var gl=sw;function ow(n){var e=gl(this,n).delete(n);return this.size-=e?1:0,e}var lw=ow;function uw(n){return gl(this,n).get(n)}var cw=uw;function fw(n){return gl(this,n).has(n)}var hw=fw;function dw(n,e){var t=gl(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}var pw=dw;function Ua(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Ua.prototype.clear=rw;Ua.prototype.delete=lw;Ua.prototype.get=cw;Ua.prototype.has=hw;Ua.prototype.set=pw;var Kp=Ua,vw="Expected a function";function Xc(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(vw);var t=function(){var r=arguments,i=e?e.apply(this,r):r[0],a=t.cache;if(a.has(i))return a.get(i);var s=n.apply(this,r);return t.cache=a.set(i,s)||a,s};return t.cache=new(Xc.Cache||Kp),t}Xc.Cache=Kp;var gw=Xc,mw=500;function yw(n){var e=gw(n,function(r){return t.size===mw&&t.clear(),r}),t=e.cache;return e}var xw=yw,Ew=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_w=/\\(\\)?/g,bw=xw(function(n){var e=[];return n.charCodeAt(0)===46&&e.push(""),n.replace(Ew,function(t,r,i,a){e.push(i?a.replace(_w,"$1"):r||t)}),e}),$p=bw;function Tw(n,e){for(var t=-1,r=n==null?0:n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}var Zp=Tw,Nh=Aa?Aa.prototype:void 0,Ih=Nh?Nh.toString:void 0;function Qp(n){if(typeof n=="string")return n;if(pl(n))return Zp(n,Qp)+"";if(Is(n))return Ih?Ih.call(n):"";var e=n+"";return e=="0"&&1/n==-1/0?"-0":e}var Sw=Qp;function Mw(n){return n==null?"":Sw(n)}var Jp=Mw;function ww(n,e){return pl(n)?n:ZS(n,e)?[n]:$p(Jp(n))}var jp=ww;function Aw(n){if(typeof n=="string"||Is(n))return n;var e=n+"";return e=="0"&&1/n==-1/0?"-0":e}var Yc=Aw;function Cw(n,e){e=jp(e,n);for(var t=0,r=e.length;n!=null&&t<r;)n=n[Yc(e[t++])];return t&&t==r?n:void 0}var Rw=Cw;function Dw(n,e,t){var r=n==null?void 0:Rw(n,e);return r===void 0?t:r}var Lw=Dw,Pw=function(){try{var n=Wc(Object,"defineProperty");return n({},"",{}),n}catch{}}(),Oh=Pw;function Nw(n,e,t){e=="__proto__"&&Oh?Oh(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}var Iw=Nw,Ow=Object.prototype,Fw=Ow.hasOwnProperty;function Uw(n,e,t){var r=n[e];(!(Fw.call(n,e)&&qp(r,t))||t===void 0&&!(e in n))&&Iw(n,e,t)}var Bw=Uw,kw=9007199254740991,zw=/^(?:0|[1-9]\d*)$/;function Gw(n,e){var t=typeof n;return e=e??kw,!!e&&(t=="number"||t!="symbol"&&zw.test(n))&&n>-1&&n%1==0&&n<e}var Vw=Gw;function Hw(n,e,t,r){if(!Ai(n))return n;e=jp(e,n);for(var i=-1,a=e.length,s=a-1,o=n;o!=null&&++i<a;){var l=Yc(e[i]),u=t;if(l==="__proto__"||l==="constructor"||l==="prototype")return n;if(i!=s){var c=o[l];u=r?r(c,l,o):void 0,u===void 0&&(u=Ai(c)?c:Vw(e[i+1])?[]:{})}Bw(o,l,u),o=o[l]}return n}var Ww=Hw;function Xw(n,e,t){return n==null?n:Ww(n,e,t)}var Yw=Xw;function qw(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var Kw=qw;function $w(n){return pl(n)?Zp(n,Yc):Is(n)?[n]:Kw($p(Jp(n)))}var Zw=$w,Qw={data:function(e){var t={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(i){},beforeSet:function(i,a){},onSet:function(i){},canSet:function(i){return!0}};return e=Je({},t,e),function(i,a){var s=e,o=this,l=o.length!==void 0,u=l?o:[o],c=l?o[0]:o;if($e(i)){var f=i.indexOf(".")!==-1,d=f&&Zw(i);if(s.allowGetting&&a===void 0){var h;return c&&(s.beforeGet(c),d&&c._private[s.field][i]===void 0?h=Lw(c._private[s.field],d):h=c._private[s.field][i]),h}else if(s.allowSetting&&a!==void 0){var v=!s.immutableKeys[i];if(v){var m=fp({},i,a);s.beforeSet(o,m);for(var g=0,p=u.length;g<p;g++){var x=u[g];s.canSet(x)&&(d&&c._private[s.field][i]===void 0?Yw(x._private[s.field],d,a):x._private[s.field][i]=a)}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}}}else if(s.allowSetting&&dt(i)){var y=i,E,M,w=Object.keys(y);s.beforeSet(o,y);for(var b=0;b<w.length;b++){E=w[b],M=y[E];var C=!s.immutableKeys[E];if(C)for(var T=0;T<u.length;T++){var S=u[T];s.canSet(S)&&(S._private[s.field][E]=M)}}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}else if(s.allowBinding&&Pt(i)){var L=i;o.on(s.bindingEvent,L)}else if(s.allowGetting&&i===void 0){var N;return c&&(s.beforeGet(c),N=c._private[s.field]),N}return o}},removeData:function(e){var t={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return e=Je({},t,e),function(i){var a=e,s=this,o=s.length!==void 0,l=o?s:[s];if($e(i)){for(var u=i.split(/\s+/),c=u.length,f=0;f<c;f++){var d=u[f];if(!Kr(d)){var h=!a.immutableKeys[d];if(h)for(var v=0,m=l.length;v<m;v++)l[v]._private[a.field][d]=void 0}}a.triggerEvent&&s[a.triggerFnName](a.event)}else if(i===void 0){for(var g=0,p=l.length;g<p;g++)for(var x=l[g]._private[a.field],y=Object.keys(x),E=0;E<y.length;E++){var M=y[E],w=!a.immutableKeys[M];w&&(x[M]=void 0)}a.triggerEvent&&s[a.triggerFnName](a.event)}return s}}},Jw={eventAliasesOn:function(e){var t=e;t.addListener=t.listen=t.bind=t.on,t.unlisten=t.unbind=t.off=t.removeListener,t.trigger=t.emit,t.pon=t.promiseOn=function(r,i){var a=this,s=Array.prototype.slice.call(arguments,0);return new Ia(function(o,l){var u=function(h){a.off.apply(a,f),o(h)},c=s.concat([u]),f=c.concat([]);a.on.apply(a,c)})}}},xt={};[XS,Qw,Jw].forEach(function(n){Je(xt,n)});var jw={animate:xt.animate(),animation:xt.animation(),animated:xt.animated(),clearQueue:xt.clearQueue(),delay:xt.delay(),delayAnimation:xt.delayAnimation(),stop:xt.stop()},Oo={classes:function(e){var t=this;if(e===void 0){var r=[];return t[0]._private.classes.forEach(function(v){return r.push(v)}),r}else Mt(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],a=new Na(e),s=0;s<t.length;s++){for(var o=t[s],l=o._private,u=l.classes,c=!1,f=0;f<e.length;f++){var d=e[f],h=u.has(d);if(!h){c=!0;break}}c||(c=u.size!==e.length),c&&(l.classes=a,i.push(o))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),t},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var t=this[0];return t!=null&&t._private.classes.has(e)},toggleClass:function(e,t){Mt(e)||(e=e.match(/\S+/g)||[]);for(var r=this,i=t===void 0,a=[],s=0,o=r.length;s<o;s++)for(var l=r[s],u=l._private.classes,c=!1,f=0;f<e.length;f++){var d=e[f],h=u.has(d),v=!1;t||i&&!h?(u.add(d),v=!0):(!t||i&&h)&&(u.delete(d),v=!0),!c&&v&&(a.push(l),c=!0)}return a.length>0&&this.spawn(a).updateStyle().emit("class"),r},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,t){var r=this;if(t==null)t=250;else if(t===0)return r;return r.addClass(e),setTimeout(function(){r.removeClass(e)},t),r}};Oo.className=Oo.classNames=Oo.classes;var ht={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:Gt,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};ht.variable="(?:[\\w-.]|(?:\\\\"+ht.metaChar+"))+";ht.className="(?:[\\w-]|(?:\\\\"+ht.metaChar+"))+";ht.value=ht.string+"|"+ht.number;ht.id=ht.variable;(function(){var n,e,t;for(n=ht.comparatorOp.split("|"),t=0;t<n.length;t++)e=n[t],ht.comparatorOp+="|@"+e;for(n=ht.comparatorOp.split("|"),t=0;t<n.length;t++)e=n[t],!(e.indexOf("!")>=0)&&e!=="="&&(ht.comparatorOp+="|\\!"+e)})();var _t=function(){return{checks:[]}},qe={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},lc=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort(function(n,e){return pb(n.selector,e.selector)}),e1=function(){for(var n={},e,t=0;t<lc.length;t++)e=lc[t],n[e.selector]=e.matches;return n}(),t1=function(e,t){return e1[e](t)},n1="("+lc.map(function(n){return n.selector}).join("|")+")",ji=function(e){return e.replace(new RegExp("\\\\("+ht.metaChar+")","g"),function(t,r){return r})},Ur=function(e,t,r){e[e.length-1]=r},uc=[{name:"group",query:!0,regex:"("+ht.group+")",populate:function(e,t,r){var i=$t(r,1),a=i[0];t.checks.push({type:qe.GROUP,value:a==="*"?a:a+"s"})}},{name:"state",query:!0,regex:n1,populate:function(e,t,r){var i=$t(r,1),a=i[0];t.checks.push({type:qe.STATE,value:a})}},{name:"id",query:!0,regex:"\\#("+ht.id+")",populate:function(e,t,r){var i=$t(r,1),a=i[0];t.checks.push({type:qe.ID,value:ji(a)})}},{name:"className",query:!0,regex:"\\.("+ht.className+")",populate:function(e,t,r){var i=$t(r,1),a=i[0];t.checks.push({type:qe.CLASS,value:ji(a)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+ht.variable+")\\s*\\]",populate:function(e,t,r){var i=$t(r,1),a=i[0];t.checks.push({type:qe.DATA_EXIST,field:ji(a)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+ht.variable+")\\s*("+ht.comparatorOp+")\\s*("+ht.value+")\\s*\\]",populate:function(e,t,r){var i=$t(r,3),a=i[0],s=i[1],o=i[2],l=new RegExp("^"+ht.string+"$").exec(o)!=null;l?o=o.substring(1,o.length-1):o=parseFloat(o),t.checks.push({type:qe.DATA_COMPARE,field:ji(a),operator:s,value:o})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+ht.boolOp+")\\s*("+ht.variable+")\\s*\\]",populate:function(e,t,r){var i=$t(r,2),a=i[0],s=i[1];t.checks.push({type:qe.DATA_BOOL,field:ji(s),operator:a})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+ht.meta+")\\s*("+ht.comparatorOp+")\\s*("+ht.number+")\\s*\\]\\]",populate:function(e,t,r){var i=$t(r,3),a=i[0],s=i[1],o=i[2];t.checks.push({type:qe.META_COMPARE,field:ji(a),operator:s,value:parseFloat(o)})}},{name:"nextQuery",separator:!0,regex:ht.separator,populate:function(e,t){var r=e.currentSubject,i=e.edgeCount,a=e.compoundCount,s=e[e.length-1];r!=null&&(s.subject=r,e.currentSubject=null),s.edgeCount=i,s.compoundCount=a,e.edgeCount=0,e.compoundCount=0;var o=e[e.length++]=_t();return o}},{name:"directedEdge",separator:!0,regex:ht.directedEdge,populate:function(e,t){if(e.currentSubject==null){var r=_t(),i=t,a=_t();return r.checks.push({type:qe.DIRECTED_EDGE,source:i,target:a}),Ur(e,t,r),e.edgeCount++,a}else{var s=_t(),o=t,l=_t();return s.checks.push({type:qe.NODE_SOURCE,source:o,target:l}),Ur(e,t,s),e.edgeCount++,l}}},{name:"undirectedEdge",separator:!0,regex:ht.undirectedEdge,populate:function(e,t){if(e.currentSubject==null){var r=_t(),i=t,a=_t();return r.checks.push({type:qe.UNDIRECTED_EDGE,nodes:[i,a]}),Ur(e,t,r),e.edgeCount++,a}else{var s=_t(),o=t,l=_t();return s.checks.push({type:qe.NODE_NEIGHBOR,node:o,neighbor:l}),Ur(e,t,s),l}}},{name:"child",separator:!0,regex:ht.child,populate:function(e,t){if(e.currentSubject==null){var r=_t(),i=_t(),a=e[e.length-1];return r.checks.push({type:qe.CHILD,parent:a,child:i}),Ur(e,t,r),e.compoundCount++,i}else if(e.currentSubject===t){var s=_t(),o=e[e.length-1],l=_t(),u=_t(),c=_t(),f=_t();return s.checks.push({type:qe.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=t.checks,t.checks=[{type:qe.TRUE}],f.checks.push({type:qe.TRUE}),l.checks.push({type:qe.PARENT,parent:f,child:c}),Ur(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var d=_t(),h=_t(),v=[{type:qe.PARENT,parent:d,child:h}];return d.checks=t.checks,t.checks=v,e.compoundCount++,h}}},{name:"descendant",separator:!0,regex:ht.descendant,populate:function(e,t){if(e.currentSubject==null){var r=_t(),i=_t(),a=e[e.length-1];return r.checks.push({type:qe.DESCENDANT,ancestor:a,descendant:i}),Ur(e,t,r),e.compoundCount++,i}else if(e.currentSubject===t){var s=_t(),o=e[e.length-1],l=_t(),u=_t(),c=_t(),f=_t();return s.checks.push({type:qe.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=t.checks,t.checks=[{type:qe.TRUE}],f.checks.push({type:qe.TRUE}),l.checks.push({type:qe.ANCESTOR,ancestor:f,descendant:c}),Ur(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var d=_t(),h=_t(),v=[{type:qe.ANCESTOR,ancestor:d,descendant:h}];return d.checks=t.checks,t.checks=v,e.compoundCount++,h}}},{name:"subject",modifier:!0,regex:ht.subject,populate:function(e,t){if(e.currentSubject!=null&&e.currentSubject!==t)return Et("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=t;var r=e[e.length-1],i=r.checks[0],a=i==null?null:i.type;a===qe.DIRECTED_EDGE?i.type=qe.NODE_TARGET:a===qe.UNDIRECTED_EDGE&&(i.type=qe.NODE_NEIGHBOR,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];uc.forEach(function(n){return n.regexObj=new RegExp("^"+n.regex)});var r1=function(e){for(var t,r,i,a=0;a<uc.length;a++){var s=uc[a],o=s.name,l=e.match(s.regexObj);if(l!=null){r=l,t=s,i=o;var u=l[0];e=e.substring(u.length);break}}return{expr:t,match:r,name:i,remaining:e}},i1=function(e){var t=e.match(/^\s+/);if(t){var r=t[0];e=e.substring(r.length)}return e},a1=function(e){var t=this,r=t.inputText=e,i=t[0]=_t();for(t.length=1,r=i1(r);;){var a=r1(r);if(a.expr==null)return Et("The selector `"+e+"`is invalid"),!1;var s=a.match.slice(1),o=a.expr.populate(t,i,s);if(o===!1)return!1;if(o!=null&&(i=o),r=a.remaining,r.match(/^\s*$/))break}var l=t[t.length-1];t.currentSubject!=null&&(l.subject=t.currentSubject),l.edgeCount=t.edgeCount,l.compoundCount=t.compoundCount;for(var u=0;u<t.length;u++){var c=t[u];if(c.compoundCount>0&&c.edgeCount>0)return Et("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(c.edgeCount>1)return Et("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;c.edgeCount===1&&Et("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},s1=function(){if(this.toStringCache!=null)return this.toStringCache;for(var e=function(c){return c??""},t=function(c){return $e(c)?'"'+c+'"':e(c)},r=function(c){return" "+c+" "},i=function(c,f){var d=c.type,h=c.value;switch(d){case qe.GROUP:{var v=e(h);return v.substring(0,v.length-1)}case qe.DATA_COMPARE:{var m=c.field,g=c.operator;return"["+m+r(e(g))+t(h)+"]"}case qe.DATA_BOOL:{var p=c.operator,x=c.field;return"["+e(p)+x+"]"}case qe.DATA_EXIST:{var y=c.field;return"["+y+"]"}case qe.META_COMPARE:{var E=c.operator,M=c.field;return"[["+M+r(e(E))+t(h)+"]]"}case qe.STATE:return h;case qe.ID:return"#"+h;case qe.CLASS:return"."+h;case qe.PARENT:case qe.CHILD:return a(c.parent,f)+r(">")+a(c.child,f);case qe.ANCESTOR:case qe.DESCENDANT:return a(c.ancestor,f)+" "+a(c.descendant,f);case qe.COMPOUND_SPLIT:{var w=a(c.left,f),b=a(c.subject,f),C=a(c.right,f);return w+(w.length>0?" ":"")+b+C}case qe.TRUE:return""}},a=function(c,f){return c.checks.reduce(function(d,h,v){return d+(f===c&&v===0?"$":"")+i(h,f)},"")},s="",o=0;o<this.length;o++){var l=this[o];s+=a(l,l.subject),this.length>1&&o<this.length-1&&(s+=", ")}return this.toStringCache=s,s},o1={parse:a1,toString:s1},ev=function(e,t,r){var i,a=$e(e),s=ke(e),o=$e(r),l,u,c=!1,f=!1,d=!1;switch(t.indexOf("!")>=0&&(t=t.replace("!",""),f=!0),t.indexOf("@")>=0&&(t=t.replace("@",""),c=!0),(a||o||c)&&(l=!a&&!s?"":""+e,u=""+r),c&&(e=l=l.toLowerCase(),r=u=u.toLowerCase()),t){case"*=":i=l.indexOf(u)>=0;break;case"$=":i=l.indexOf(u,l.length-u.length)>=0;break;case"^=":i=l.indexOf(u)===0;break;case"=":i=e===r;break;case">":d=!0,i=e>r;break;case">=":d=!0,i=e>=r;break;case"<":d=!0,i=e<r;break;case"<=":d=!0,i=e<=r;break;default:i=!1;break}return f&&(e!=null||!d)&&(i=!i),i},l1=function(e,t){switch(t){case"?":return!!e;case"!":return!e;case"^":return e===void 0}},u1=function(e){return e!==void 0},qc=function(e,t){return e.data(t)},c1=function(e,t){return e[t]()},Ot=[],Rt=function(e,t){return e.checks.every(function(r){return Ot[r.type](r,t)})};Ot[qe.GROUP]=function(n,e){var t=n.value;return t==="*"||t===e.group()};Ot[qe.STATE]=function(n,e){var t=n.value;return t1(t,e)};Ot[qe.ID]=function(n,e){var t=n.value;return e.id()===t};Ot[qe.CLASS]=function(n,e){var t=n.value;return e.hasClass(t)};Ot[qe.META_COMPARE]=function(n,e){var t=n.field,r=n.operator,i=n.value;return ev(c1(e,t),r,i)};Ot[qe.DATA_COMPARE]=function(n,e){var t=n.field,r=n.operator,i=n.value;return ev(qc(e,t),r,i)};Ot[qe.DATA_BOOL]=function(n,e){var t=n.field,r=n.operator;return l1(qc(e,t),r)};Ot[qe.DATA_EXIST]=function(n,e){var t=n.field;return n.operator,u1(qc(e,t))};Ot[qe.UNDIRECTED_EDGE]=function(n,e){var t=n.nodes[0],r=n.nodes[1],i=e.source(),a=e.target();return Rt(t,i)&&Rt(r,a)||Rt(r,i)&&Rt(t,a)};Ot[qe.NODE_NEIGHBOR]=function(n,e){return Rt(n.node,e)&&e.neighborhood().some(function(t){return t.isNode()&&Rt(n.neighbor,t)})};Ot[qe.DIRECTED_EDGE]=function(n,e){return Rt(n.source,e.source())&&Rt(n.target,e.target())};Ot[qe.NODE_SOURCE]=function(n,e){return Rt(n.source,e)&&e.outgoers().some(function(t){return t.isNode()&&Rt(n.target,t)})};Ot[qe.NODE_TARGET]=function(n,e){return Rt(n.target,e)&&e.incomers().some(function(t){return t.isNode()&&Rt(n.source,t)})};Ot[qe.CHILD]=function(n,e){return Rt(n.child,e)&&Rt(n.parent,e.parent())};Ot[qe.PARENT]=function(n,e){return Rt(n.parent,e)&&e.children().some(function(t){return Rt(n.child,t)})};Ot[qe.DESCENDANT]=function(n,e){return Rt(n.descendant,e)&&e.ancestors().some(function(t){return Rt(n.ancestor,t)})};Ot[qe.ANCESTOR]=function(n,e){return Rt(n.ancestor,e)&&e.descendants().some(function(t){return Rt(n.descendant,t)})};Ot[qe.COMPOUND_SPLIT]=function(n,e){return Rt(n.subject,e)&&Rt(n.left,e)&&Rt(n.right,e)};Ot[qe.TRUE]=function(){return!0};Ot[qe.COLLECTION]=function(n,e){var t=n.value;return t.has(e)};Ot[qe.FILTER]=function(n,e){var t=n.value;return t(e)};var f1=function(e){var t=this;if(t.length===1&&t[0].checks.length===1&&t[0].checks[0].type===qe.ID)return e.getElementById(t[0].checks[0].value).collection();var r=function(a){for(var s=0;s<t.length;s++){var o=t[s];if(Rt(o,a))return!0}return!1};return t.text()==null&&(r=function(){return!0}),e.filter(r)},h1=function(e){for(var t=this,r=0;r<t.length;r++){var i=t[r];if(Rt(i,e))return!0}return!1},d1={matches:h1,filter:f1},Qr=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,e==null||$e(e)&&e.match(/^\s*$/)||(An(e)?this.addQuery({checks:[{type:qe.COLLECTION,value:e.collection()}]}):Pt(e)?this.addQuery({checks:[{type:qe.FILTER,value:e}]}):$e(e)?this.parse(e)||(this.invalid=!0):Lt("A selector must be created from a string; found "))},Jr=Qr.prototype;[o1,d1].forEach(function(n){return Je(Jr,n)});Jr.text=function(){return this.inputText};Jr.size=function(){return this.length};Jr.eq=function(n){return this[n]};Jr.sameText=function(n){return!this.invalid&&!n.invalid&&this.text()===n.text()};Jr.addQuery=function(n){this[this.length++]=n};Jr.selector=Jr.toString;var Wr={allAre:function(e){var t=new Qr(e);return this.every(function(r){return t.matches(r)})},is:function(e){var t=new Qr(e);return this.some(function(r){return t.matches(r)})},some:function(e,t){for(var r=0;r<this.length;r++){var i=t?e.apply(t,[this[r],r,this]):e(this[r],r,this);if(i)return!0}return!1},every:function(e,t){for(var r=0;r<this.length;r++){var i=t?e.apply(t,[this[r],r,this]):e(this[r],r,this);if(!i)return!1}return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var t=this.length,r=e.length;return t!==r?!1:t===1?this[0]===e[0]:this.every(function(i){return e.hasElementWithId(i.id())})},anySame:function(e){return e=this.cy().collection(e),this.some(function(t){return e.hasElementWithId(t.id())})},allAreNeighbors:function(e){e=this.cy().collection(e);var t=this.neighborhood();return e.every(function(r){return t.hasElementWithId(r.id())})},contains:function(e){e=this.cy().collection(e);var t=this;return e.every(function(r){return t.hasElementWithId(r.id())})}};Wr.allAreNeighbours=Wr.allAreNeighbors;Wr.has=Wr.contains;Wr.equal=Wr.equals=Wr.same;var On=function(e,t){return function(i,a,s,o){var l=i,u=this,c;if(l==null?c="":An(l)&&l.length===1&&(c=l.id()),u.length===1&&c){var f=u[0]._private,d=f.traversalCache=f.traversalCache||{},h=d[t]=d[t]||[],v=$r(c),m=h[v];return m||(h[v]=e.call(u,i,a,s,o))}else return e.call(u,i,a,s,o)}},Da={parent:function(e){var t=[];if(this.length===1){var r=this[0]._private.parent;if(r)return r}for(var i=0;i<this.length;i++){var a=this[i],s=a._private.parent;s&&t.push(s)}return this.spawn(t,!0).filter(e)},parents:function(e){for(var t=[],r=this.parent();r.nonempty();){for(var i=0;i<r.length;i++){var a=r[i];t.push(a)}r=r.parent()}return this.spawn(t,!0).filter(e)},commonAncestors:function(e){for(var t,r=0;r<this.length;r++){var i=this[r],a=i.parents();t=t||a,t=t.intersect(a)}return t.filter(e)},orphans:function(e){return this.stdFilter(function(t){return t.isOrphan()}).filter(e)},nonorphans:function(e){return this.stdFilter(function(t){return t.isChild()}).filter(e)},children:On(function(n){for(var e=[],t=0;t<this.length;t++)for(var r=this[t],i=r._private.children,a=0;a<i.length;a++)e.push(i[a]);return this.spawn(e,!0).filter(n)},"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length!==0},isChildless:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length===0},isChild:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent!=null},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent==null},descendants:function(e){var t=[];function r(i){for(var a=0;a<i.length;a++){var s=i[a];t.push(s),s.children().nonempty()&&r(s.children())}}return r(this.children()),this.spawn(t,!0).filter(e)}};function Kc(n,e,t,r){for(var i=[],a=new Na,s=n.cy(),o=s.hasCompoundNodes(),l=0;l<n.length;l++){var u=n[l];t?i.push(u):o&&r(i,a,u)}for(;i.length>0;){var c=i.shift();e(c),a.add(c.id()),o&&r(i,a,c)}return n}function tv(n,e,t){if(t.isParent())for(var r=t._private.children,i=0;i<r.length;i++){var a=r[i];e.has(a.id())||n.push(a)}}Da.forEachDown=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Kc(this,n,e,tv)};function nv(n,e,t){if(t.isChild()){var r=t._private.parent;e.has(r.id())||n.push(r)}}Da.forEachUp=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Kc(this,n,e,nv)};function p1(n,e,t){nv(n,e,t),tv(n,e,t)}Da.forEachUpAndDown=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Kc(this,n,e,p1)};Da.ancestors=Da.parents;var Ts,rv;Ts=rv={data:xt.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:xt.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:xt.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:xt.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:xt.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:xt.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}};Ts.attr=Ts.data;Ts.removeAttr=Ts.removeData;var v1=rv,ml={};function lu(n){return function(e){var t=this;if(e===void 0&&(e=!0),t.length!==0)if(t.isNode()&&!t.removed()){for(var r=0,i=t[0],a=i._private.edges,s=0;s<a.length;s++){var o=a[s];!e&&o.isLoop()||(r+=n(i,o))}return r}else return}}Je(ml,{degree:lu(function(n,e){return e.source().same(e.target())?2:1}),indegree:lu(function(n,e){return e.target().same(n)?1:0}),outdegree:lu(function(n,e){return e.source().same(n)?1:0})});function ea(n,e){return function(t){for(var r,i=this.nodes(),a=0;a<i.length;a++){var s=i[a],o=s[n](t);o!==void 0&&(r===void 0||e(o,r))&&(r=o)}return r}}Je(ml,{minDegree:ea("degree",function(n,e){return n<e}),maxDegree:ea("degree",function(n,e){return n>e}),minIndegree:ea("indegree",function(n,e){return n<e}),maxIndegree:ea("indegree",function(n,e){return n>e}),minOutdegree:ea("outdegree",function(n,e){return n<e}),maxOutdegree:ea("outdegree",function(n,e){return n>e})});Je(ml,{totalDegree:function(e){for(var t=0,r=this.nodes(),i=0;i<r.length;i++)t+=r[i].degree(e);return t}});var Kn,iv,av=function(e,t,r){for(var i=0;i<e.length;i++){var a=e[i];if(!a.locked()){var s=a._private.position,o={x:t.x!=null?t.x-s.x:0,y:t.y!=null?t.y-s.y:0};a.isParent()&&!(o.x===0&&o.y===0)&&a.children().shift(o,r),a.dirtyBoundingBoxCache()}}},Fh={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,t){av(e,t,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};Kn=iv={position:xt.data(Fh),silentPosition:xt.data(Je({},Fh,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,t){av(e,t,!0)},onSet:function(e){e.dirtyCompoundBoundsCache()}})),positions:function(e,t){if(dt(e))t?this.silentPosition(e):this.position(e);else if(Pt(e)){var r=e,i=this.cy();i.startBatch();for(var a=0;a<this.length;a++){var s=this[a],o=void 0;(o=r(s,a))&&(t?s.silentPosition(o):s.position(o))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,t,r){var i;if(dt(e)?(i={x:ke(e.x)?e.x:0,y:ke(e.y)?e.y:0},r=t):$e(e)&&ke(t)&&(i={x:0,y:0},i[e]=t),i!=null){var a=this.cy();a.startBatch();for(var s=0;s<this.length;s++){var o=this[s];if(!(a.hasCompoundNodes()&&o.isChild()&&o.ancestors().anySame(this))){var l=o.position(),u={x:l.x+i.x,y:l.y+i.y};r?o.silentPosition(u):o.position(u)}}a.endBatch()}return this},silentShift:function(e,t){return dt(e)?this.shift(e,!0):$e(e)&&ke(t)&&this.shift(e,t,!0),this},renderedPosition:function(e,t){var r=this[0],i=this.cy(),a=i.zoom(),s=i.pan(),o=dt(e)?e:void 0,l=o!==void 0||t!==void 0&&$e(e);if(r&&r.isNode())if(l)for(var u=0;u<this.length;u++){var c=this[u];t!==void 0?c.position(e,(t-s[e])/a):o!==void 0&&c.position(Lp(o,a,s))}else{var f=r.position();return o=hl(f,a,s),e===void 0?o:o[e]}else if(!l)return;return this},relativePosition:function(e,t){var r=this[0],i=this.cy(),a=dt(e)?e:void 0,s=a!==void 0||t!==void 0&&$e(e),o=i.hasCompoundNodes();if(r&&r.isNode())if(s)for(var l=0;l<this.length;l++){var u=this[l],c=o?u.parent():null,f=c&&c.length>0,d=f;f&&(c=c[0]);var h=d?c.position():{x:0,y:0};t!==void 0?u.position(e,t+h[e]):a!==void 0&&u.position({x:a.x+h.x,y:a.y+h.y})}else{var v=r.position(),m=o?r.parent():null,g=m&&m.length>0,p=g;g&&(m=m[0]);var x=p?m.position():{x:0,y:0};return a={x:v.x-x.x,y:v.y-x.y},e===void 0?a:a[e]}else if(!s)return;return this}};Kn.modelPosition=Kn.point=Kn.position;Kn.modelPositions=Kn.points=Kn.positions;Kn.renderedPoint=Kn.renderedPosition;Kn.relativePoint=Kn.relativePosition;var g1=iv,xa,ri;xa=ri={};ri.renderedBoundingBox=function(n){var e=this.boundingBox(n),t=this.cy(),r=t.zoom(),i=t.pan(),a=e.x1*r+i.x,s=e.x2*r+i.x,o=e.y1*r+i.y,l=e.y2*r+i.y;return{x1:a,x2:s,y1:o,y2:l,w:s-a,h:l-o}};ri.dirtyCompoundBoundsCache=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();return!e.styleEnabled()||!e.hasCompoundNodes()?this:(this.forEachUp(function(t){if(t.isParent()){var r=t._private;r.compoundBoundsClean=!1,r.bbCache=null,n||t.emitAndNotify("bounds")}}),this)};ri.updateCompoundBounds=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();if(!e.styleEnabled()||!e.hasCompoundNodes())return this;if(!n&&e.batching())return this;function t(s){if(!s.isParent())return;var o=s._private,l=s.children(),u=s.pstyle("compound-sizing-wrt-labels").value==="include",c={width:{val:s.pstyle("min-width").pfValue,left:s.pstyle("min-width-bias-left"),right:s.pstyle("min-width-bias-right")},height:{val:s.pstyle("min-height").pfValue,top:s.pstyle("min-height-bias-top"),bottom:s.pstyle("min-height-bias-bottom")}},f=l.boundingBox({includeLabels:u,includeOverlays:!1,useCache:!1}),d=o.position;(f.w===0||f.h===0)&&(f={w:s.pstyle("width").pfValue,h:s.pstyle("height").pfValue},f.x1=d.x-f.w/2,f.x2=d.x+f.w/2,f.y1=d.y-f.h/2,f.y2=d.y+f.h/2);function h(T,S,L){var N=0,I=0,_=S+L;return T>0&&_>0&&(N=S/_*T,I=L/_*T),{biasDiff:N,biasComplementDiff:I}}function v(T,S,L,N){if(L.units==="%")switch(N){case"width":return T>0?L.pfValue*T:0;case"height":return S>0?L.pfValue*S:0;case"average":return T>0&&S>0?L.pfValue*(T+S)/2:0;case"min":return T>0&&S>0?T>S?L.pfValue*S:L.pfValue*T:0;case"max":return T>0&&S>0?T>S?L.pfValue*T:L.pfValue*S:0;default:return 0}else return L.units==="px"?L.pfValue:0}var m=c.width.left.value;c.width.left.units==="px"&&c.width.val>0&&(m=m*100/c.width.val);var g=c.width.right.value;c.width.right.units==="px"&&c.width.val>0&&(g=g*100/c.width.val);var p=c.height.top.value;c.height.top.units==="px"&&c.height.val>0&&(p=p*100/c.height.val);var x=c.height.bottom.value;c.height.bottom.units==="px"&&c.height.val>0&&(x=x*100/c.height.val);var y=h(c.width.val-f.w,m,g),E=y.biasDiff,M=y.biasComplementDiff,w=h(c.height.val-f.h,p,x),b=w.biasDiff,C=w.biasComplementDiff;o.autoPadding=v(f.w,f.h,s.pstyle("padding"),s.pstyle("padding-relative-to").value),o.autoWidth=Math.max(f.w,c.width.val),d.x=(-E+f.x1+f.x2+M)/2,o.autoHeight=Math.max(f.h,c.height.val),d.y=(-b+f.y1+f.y2+C)/2}for(var r=0;r<this.length;r++){var i=this[r],a=i._private;(!a.compoundBoundsClean||n)&&(t(i),e.batching()||(a.compoundBoundsClean=!0))}return this};var In=function(e){return e===1/0||e===-1/0?0:e},Gn=function(e,t,r,i,a){i-t===0||a-r===0||t==null||r==null||i==null||a==null||(e.x1=t<e.x1?t:e.x1,e.x2=i>e.x2?i:e.x2,e.y1=r<e.y1?r:e.y1,e.y2=a>e.y2?a:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},vi=function(e,t){return t==null?e:Gn(e,t.x1,t.y1,t.x2,t.y2)},Qa=function(e,t,r){return Hn(e,t,r)},xo=function(e,t,r){if(!t.cy().headless()){var i=t._private,a=i.rstyle,s=a.arrowWidth/2,o=t.pstyle(r+"-arrow-shape").value,l,u;if(o!=="none"){r==="source"?(l=a.srcX,u=a.srcY):r==="target"?(l=a.tgtX,u=a.tgtY):(l=a.midX,u=a.midY);var c=i.arrowBounds=i.arrowBounds||{},f=c[r]=c[r]||{};f.x1=l-s,f.y1=u-s,f.x2=l+s,f.y2=u+s,f.w=f.x2-f.x1,f.h=f.y2-f.y1,No(f,1),Gn(e,f.x1,f.y1,f.x2,f.y2)}}},uu=function(e,t,r){if(!t.cy().headless()){var i;r?i=r+"-":i="";var a=t._private,s=a.rstyle,o=t.pstyle(i+"label").strValue;if(o){var l=t.pstyle("text-halign"),u=t.pstyle("text-valign"),c=Qa(s,"labelWidth",r),f=Qa(s,"labelHeight",r),d=Qa(s,"labelX",r),h=Qa(s,"labelY",r),v=t.pstyle(i+"text-margin-x").pfValue,m=t.pstyle(i+"text-margin-y").pfValue,g=t.isEdge(),p=t.pstyle(i+"text-rotation"),x=t.pstyle("text-outline-width").pfValue,y=t.pstyle("text-border-width").pfValue,E=y/2,M=t.pstyle("text-background-padding").pfValue,w=2,b=f,C=c,T=C/2,S=b/2,L,N,I,_;if(g)L=d-T,N=d+T,I=h-S,_=h+S;else{switch(l.value){case"left":L=d-C,N=d;break;case"center":L=d-T,N=d+T;break;case"right":L=d,N=d+C;break}switch(u.value){case"top":I=h-b,_=h;break;case"center":I=h-S,_=h+S;break;case"bottom":I=h,_=h+b;break}}var P=v-Math.max(x,E)-M-w,A=v+Math.max(x,E)+M+w,D=m-Math.max(x,E)-M-w,R=m+Math.max(x,E)+M+w;L+=P,N+=A,I+=D,_+=R;var B=r||"main",k=a.labelBounds,V=k[B]=k[B]||{};V.x1=L,V.y1=I,V.x2=N,V.y2=_,V.w=N-L,V.h=_-I,V.leftPad=P,V.rightPad=A,V.topPad=D,V.botPad=R;var Y=g&&p.strValue==="autorotate",Z=p.pfValue!=null&&p.pfValue!==0;if(Y||Z){var W=Y?Qa(a.rstyle,"labelAngle",r):p.pfValue,K=Math.cos(W),Q=Math.sin(W),ne=(L+N)/2,ie=(I+_)/2;if(!g){switch(l.value){case"left":ne=N;break;case"right":ne=L;break}switch(u.value){case"top":ie=_;break;case"bottom":ie=I;break}}var H=function(De,de){return De=De-ne,de=de-ie,{x:De*K-de*Q+ne,y:De*Q+de*K+ie}},X=H(L,I),te=H(L,_),ue=H(N,I),Se=H(N,_);L=Math.min(X.x,te.x,ue.x,Se.x),N=Math.max(X.x,te.x,ue.x,Se.x),I=Math.min(X.y,te.y,ue.y,Se.y),_=Math.max(X.y,te.y,ue.y,Se.y)}var U=B+"Rot",Ge=k[U]=k[U]||{};Ge.x1=L,Ge.y1=I,Ge.x2=N,Ge.y2=_,Ge.w=N-L,Ge.h=_-I,Gn(e,L,I,N,_),Gn(a.labelBounds.all,L,I,N,_)}return e}},m1=function(e,t){if(!t.cy().headless()){var r=t.pstyle("outline-opacity").value,i=t.pstyle("outline-width").value;if(r>0&&i>0){var a=t.pstyle("outline-offset").value,s=t.pstyle("shape").value,o=i+a,l=(e.w+o*2)/e.w,u=(e.h+o*2)/e.h,c=0,f=0;["diamond","pentagon","round-triangle"].includes(s)?(l=(e.w+o*2.4)/e.w,f=-o/3.6):["concave-hexagon","rhomboid","right-rhomboid"].includes(s)?l=(e.w+o*2.4)/e.w:s==="star"?(l=(e.w+o*2.8)/e.w,u=(e.h+o*2.6)/e.h,f=-o/3.8):s==="triangle"?(l=(e.w+o*2.8)/e.w,u=(e.h+o*2.4)/e.h,f=-o/1.4):s==="vee"&&(l=(e.w+o*4.4)/e.w,u=(e.h+o*3.8)/e.h,f=-o*.5);var d=e.h*u-e.h,h=e.w*l-e.w;if(Io(e,[Math.ceil(d/2),Math.ceil(h/2)]),c!=0||f!==0){var v=zT(e,c,f);Np(e,v)}}}},y1=function(e,t){var r=e._private.cy,i=r.styleEnabled(),a=r.headless(),s=En(),o=e._private,l=e.isNode(),u=e.isEdge(),c,f,d,h,v,m,g=o.rstyle,p=l&&i?e.pstyle("bounds-expansion").pfValue:[0],x=function(Le){return Le.pstyle("display").value!=="none"},y=!i||x(e)&&(!u||x(e.source())&&x(e.target()));if(y){var E=0,M=0;i&&t.includeOverlays&&(E=e.pstyle("overlay-opacity").value,E!==0&&(M=e.pstyle("overlay-padding").value));var w=0,b=0;i&&t.includeUnderlays&&(w=e.pstyle("underlay-opacity").value,w!==0&&(b=e.pstyle("underlay-padding").value));var C=Math.max(M,b),T=0,S=0;if(i&&(T=e.pstyle("width").pfValue,S=T/2),l&&t.includeNodes){var L=e.position();v=L.x,m=L.y;var N=e.outerWidth(),I=N/2,_=e.outerHeight(),P=_/2;c=v-I,f=v+I,d=m-P,h=m+P,Gn(s,c,d,f,h),i&&t.includeOutlines&&m1(s,e)}else if(u&&t.includeEdges)if(i&&!a){var A=e.pstyle("curve-style").strValue;if(c=Math.min(g.srcX,g.midX,g.tgtX),f=Math.max(g.srcX,g.midX,g.tgtX),d=Math.min(g.srcY,g.midY,g.tgtY),h=Math.max(g.srcY,g.midY,g.tgtY),c-=S,f+=S,d-=S,h+=S,Gn(s,c,d,f,h),A==="haystack"){var D=g.haystackPts;if(D&&D.length===2){if(c=D[0].x,d=D[0].y,f=D[1].x,h=D[1].y,c>f){var R=c;c=f,f=R}if(d>h){var B=d;d=h,h=B}Gn(s,c-S,d-S,f+S,h+S)}}else if(A==="bezier"||A==="unbundled-bezier"||A.endsWith("segments")||A.endsWith("taxi")){var k;switch(A){case"bezier":case"unbundled-bezier":k=g.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":k=g.linePts;break}if(k!=null)for(var V=0;V<k.length;V++){var Y=k[V];c=Y.x-S,f=Y.x+S,d=Y.y-S,h=Y.y+S,Gn(s,c,d,f,h)}}}else{var Z=e.source(),W=Z.position(),K=e.target(),Q=K.position();if(c=W.x,f=Q.x,d=W.y,h=Q.y,c>f){var ne=c;c=f,f=ne}if(d>h){var ie=d;d=h,h=ie}c-=S,f+=S,d-=S,h+=S,Gn(s,c,d,f,h)}if(i&&t.includeEdges&&u&&(xo(s,e,"mid-source"),xo(s,e,"mid-target"),xo(s,e,"source"),xo(s,e,"target")),i){var H=e.pstyle("ghost").value==="yes";if(H){var X=e.pstyle("ghost-offset-x").pfValue,te=e.pstyle("ghost-offset-y").pfValue;Gn(s,s.x1+X,s.y1+te,s.x2+X,s.y2+te)}}var ue=o.bodyBounds=o.bodyBounds||{};vh(ue,s),Io(ue,p),No(ue,1),i&&(c=s.x1,f=s.x2,d=s.y1,h=s.y2,Gn(s,c-C,d-C,f+C,h+C));var Se=o.overlayBounds=o.overlayBounds||{};vh(Se,s),Io(Se,p),No(Se,1);var U=o.labelBounds=o.labelBounds||{};U.all!=null?kT(U.all):U.all=En(),i&&t.includeLabels&&(t.includeMainLabels&&uu(s,e,null),u&&(t.includeSourceLabels&&uu(s,e,"source"),t.includeTargetLabels&&uu(s,e,"target")))}return s.x1=In(s.x1),s.y1=In(s.y1),s.x2=In(s.x2),s.y2=In(s.y2),s.w=In(s.x2-s.x1),s.h=In(s.y2-s.y1),s.w>0&&s.h>0&&y&&(Io(s,p),No(s,1)),s},sv=function(e){var t=0,r=function(s){return(s?1:0)<<t++},i=0;return i+=r(e.incudeNodes),i+=r(e.includeEdges),i+=r(e.includeLabels),i+=r(e.includeMainLabels),i+=r(e.includeSourceLabels),i+=r(e.includeTargetLabels),i+=r(e.includeOverlays),i+=r(e.includeOutlines),i},ov=function(e){if(e.isEdge()){var t=e.source().position(),r=e.target().position(),i=function(s){return Math.round(s)};return sT([i(t.x),i(t.y),i(r.x),i(r.y)])}else return 0},Uh=function(e,t){var r=e._private,i,a=e.isEdge(),s=t==null?Bh:sv(t),o=s===Bh,l=ov(e),u=r.bbCachePosKey===l,c=t.useCache&&u,f=function(m){return m._private.bbCache==null||m._private.styleDirty},d=!c||f(e)||a&&(f(e.source())||f(e.target()));if(d?(u||e.recalculateRenderedStyle(c),i=y1(e,Ss),r.bbCache=i,r.bbCachePosKey=l):i=r.bbCache,!o){var h=e.isNode();i=En(),(t.includeNodes&&h||t.includeEdges&&!h)&&(t.includeOverlays?vi(i,r.overlayBounds):vi(i,r.bodyBounds)),t.includeLabels&&(t.includeMainLabels&&(!a||t.includeSourceLabels&&t.includeTargetLabels)?vi(i,r.labelBounds.all):(t.includeMainLabels&&vi(i,r.labelBounds.mainRot),t.includeSourceLabels&&vi(i,r.labelBounds.sourceRot),t.includeTargetLabels&&vi(i,r.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},Ss={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},Bh=sv(Ss),kh=Zt(Ss);ri.boundingBox=function(n){var e;if(this.length===1&&this[0]._private.bbCache!=null&&!this[0]._private.styleDirty&&(n===void 0||n.useCache===void 0||n.useCache===!0))n===void 0?n=Ss:n=kh(n),e=Uh(this[0],n);else{e=En(),n=n||Ss;var t=kh(n),r=this,i=r.cy(),a=i.styleEnabled();if(a)for(var s=0;s<r.length;s++){var o=r[s],l=o._private,u=ov(o),c=l.bbCachePosKey===u,f=t.useCache&&c&&!l.styleDirty;o.recalculateRenderedStyle(f)}this.updateCompoundBounds(!n.useCache);for(var d=0;d<r.length;d++){var h=r[d];vi(e,Uh(h,t))}}return e.x1=In(e.x1),e.y1=In(e.y1),e.x2=In(e.x2),e.y2=In(e.y2),e.w=In(e.x2-e.x1),e.h=In(e.y2-e.y1),e};ri.dirtyBoundingBoxCache=function(){for(var n=0;n<this.length;n++){var e=this[n]._private;e.bbCache=null,e.bbCachePosKey=null,e.bodyBounds=null,e.overlayBounds=null,e.labelBounds.all=null,e.labelBounds.source=null,e.labelBounds.target=null,e.labelBounds.main=null,e.labelBounds.sourceRot=null,e.labelBounds.targetRot=null,e.labelBounds.mainRot=null,e.arrowBounds.source=null,e.arrowBounds.target=null,e.arrowBounds["mid-source"]=null,e.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};ri.boundingBoxAt=function(n){var e=this.nodes(),t=this.cy(),r=t.hasCompoundNodes(),i=t.collection();if(r&&(i=e.filter(function(u){return u.isParent()}),e=e.not(i)),dt(n)){var a=n;n=function(){return a}}var s=function(c,f){return c._private.bbAtOldPos=n(c,f)},o=function(c){return c._private.bbAtOldPos};t.startBatch(),e.forEach(s).silentPositions(n),r&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0));var l=BT(this.boundingBox({useCache:!1}));return e.silentPositions(o),r&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0)),t.endBatch(),l};xa.boundingbox=xa.bb=xa.boundingBox;xa.renderedBoundingbox=xa.renderedBoundingBox;var x1=ri,ss,Us;ss=Us={};var lv=function(e){e.uppercaseName=lh(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=lh(e.outerName),ss[e.name]=function(){var r=this[0],i=r._private,a=i.cy,s=a._private.styleEnabled;if(r)if(s){if(r.isParent())return r.updateCompoundBounds(),i[e.autoName]||0;var o=r.pstyle(e.name);switch(o.strValue){case"label":return r.recalculateRenderedStyle(),i.rstyle[e.labelName]||0;default:return o.pfValue}}else return 1},ss["outer"+e.uppercaseName]=function(){var r=this[0],i=r._private,a=i.cy,s=a._private.styleEnabled;if(r)if(s){var o=r[e.name](),l=r.pstyle("border-width").pfValue,u=2*r.padding();return o+l+u}else return 1},ss["rendered"+e.uppercaseName]=function(){var r=this[0];if(r){var i=r[e.name]();return i*this.cy().zoom()}},ss["rendered"+e.uppercaseOuterName]=function(){var r=this[0];if(r){var i=r[e.outerName]();return i*this.cy().zoom()}}};lv({name:"width"});lv({name:"height"});Us.padding=function(){var n=this[0],e=n._private;return n.isParent()?(n.updateCompoundBounds(),e.autoPadding!==void 0?e.autoPadding:n.pstyle("padding").pfValue):n.pstyle("padding").pfValue};Us.paddedHeight=function(){var n=this[0];return n.height()+2*n.padding()};Us.paddedWidth=function(){var n=this[0];return n.width()+2*n.padding()};var E1=Us,_1=function(e,t){if(e.isEdge())return t(e)},b1=function(e,t){if(e.isEdge()){var r=e.cy();return hl(t(e),r.zoom(),r.pan())}},T1=function(e,t){if(e.isEdge()){var r=e.cy(),i=r.pan(),a=r.zoom();return t(e).map(function(s){return hl(s,a,i)})}},S1=function(e){return e.renderer().getControlPoints(e)},M1=function(e){return e.renderer().getSegmentPoints(e)},w1=function(e){return e.renderer().getSourceEndpoint(e)},A1=function(e){return e.renderer().getTargetEndpoint(e)},C1=function(e){return e.renderer().getEdgeMidpoint(e)},zh={controlPoints:{get:S1,mult:!0},segmentPoints:{get:M1,mult:!0},sourceEndpoint:{get:w1},targetEndpoint:{get:A1},midpoint:{get:C1}},R1=function(e){return"rendered"+e[0].toUpperCase()+e.substr(1)},D1=Object.keys(zh).reduce(function(n,e){var t=zh[e],r=R1(e);return n[e]=function(){return _1(this,t.get)},t.mult?n[r]=function(){return T1(this,t.get)}:n[r]=function(){return b1(this,t.get)},n},{}),L1=Je({},g1,x1,E1,D1);/*!
Event object based on jQuery events, MIT license

https://jquery.org/license/
https://tldrlegal.com/license/mit-license
https://github.com/jquery/jquery/blob/master/src/event.js
*/var uv=function(e,t){this.recycle(e,t)};function Ja(){return!1}function Eo(){return!0}uv.prototype={instanceString:function(){return"event"},recycle:function(e,t){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=Ja,e!=null&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?Eo:Ja):e!=null&&e.type?t=e:this.type=e,t!=null&&(this.originalEvent=t.originalEvent,this.type=t.type!=null?t.type:this.type,this.cy=t.cy,this.target=t.target,this.position=t.position,this.renderedPosition=t.renderedPosition,this.namespace=t.namespace,this.layout=t.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var r=this.position,i=this.cy.zoom(),a=this.cy.pan();this.renderedPosition={x:r.x*i+a.x,y:r.y*i+a.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=Eo;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=Eo;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Eo,this.stopPropagation()},isDefaultPrevented:Ja,isPropagationStopped:Ja,isImmediatePropagationStopped:Ja};var cv=/^([^.]+)(\.(?:[^.]+))?$/,P1=".*",fv={qualifierCompare:function(e,t){return e===t},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},Gh=Object.keys(fv),N1={};function yl(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N1,e=arguments.length>1?arguments[1]:void 0,t=0;t<Gh.length;t++){var r=Gh[t];this[r]=n[r]||fv[r]}this.context=e||this.context,this.listeners=[],this.emitting=0}var jr=yl.prototype,hv=function(e,t,r,i,a,s,o){Pt(i)&&(a=i,i=null),o&&(s==null?s=o:s=Je({},s,o));for(var l=Mt(r)?r:r.split(/\s+/),u=0;u<l.length;u++){var c=l[u];if(!Kr(c)){var f=c.match(cv);if(f){var d=f[1],h=f[2]?f[2]:null,v=t(e,c,d,h,i,a,s);if(v===!1)break}}}},Vh=function(e,t){return e.addEventFields(e.context,t),new uv(t.type,t)},I1=function(e,t,r){if(rb(r)){t(e,r);return}else if(dt(r)){t(e,Vh(e,r));return}for(var i=Mt(r)?r:r.split(/\s+/),a=0;a<i.length;a++){var s=i[a];if(!Kr(s)){var o=s.match(cv);if(o){var l=o[1],u=o[2]?o[2]:null,c=Vh(e,{type:l,namespace:u,target:e.context});t(e,c)}}}};jr.on=jr.addListener=function(n,e,t,r,i){return hv(this,function(a,s,o,l,u,c,f){Pt(c)&&a.listeners.push({event:s,callback:c,type:o,namespace:l,qualifier:u,conf:f})},n,e,t,r,i),this};jr.one=function(n,e,t,r){return this.on(n,e,t,r,{one:!0})};jr.removeListener=jr.off=function(n,e,t,r){var i=this;this.emitting!==0&&(this.listeners=fT(this.listeners));for(var a=this.listeners,s=function(u){var c=a[u];hv(i,function(f,d,h,v,m,g){if((c.type===h||n==="*")&&(!v&&c.namespace!==".*"||c.namespace===v)&&(!m||f.qualifierCompare(c.qualifier,m))&&(!g||c.callback===g))return a.splice(u,1),!1},n,e,t,r)},o=a.length-1;o>=0;o--)s(o);return this};jr.removeAllListeners=function(){return this.removeListener("*")};jr.emit=jr.trigger=function(n,e,t){var r=this.listeners,i=r.length;return this.emitting++,Mt(e)||(e=[e]),I1(this,function(a,s){t!=null&&(r=[{event:s.event,type:s.type,namespace:s.namespace,callback:t}],i=r.length);for(var o=function(c){var f=r[c];if(f.type===s.type&&(!f.namespace||f.namespace===s.namespace||f.namespace===P1)&&a.eventMatches(a.context,f,s)){var d=[s];e!=null&&dT(d,e),a.beforeEmit(a.context,f,s),f.conf&&f.conf.one&&(a.listeners=a.listeners.filter(function(m){return m!==f}));var h=a.callbackContext(a.context,f,s),v=f.callback.apply(h,d);a.afterEmit(a.context,f,s),v===!1&&(s.stopPropagation(),s.preventDefault())}},l=0;l<i;l++)o(l);a.bubble(a.context)&&!s.isPropagationStopped()&&a.parent(a.context).emit(s,e)},n),this.emitting--,this};var O1={qualifierCompare:function(e,t){return e==null||t==null?e==null&&t==null:e.sameText(t)},eventMatches:function(e,t,r){var i=t.qualifier;return i!=null?e!==r.target&&Ns(r.target)&&i.matches(r.target):!0},addEventFields:function(e,t){t.cy=e.cy(),t.target=e},callbackContext:function(e,t,r){return t.qualifier!=null?r.target:e},beforeEmit:function(e,t){t.conf&&t.conf.once&&t.conf.onceCollection.removeListener(t.event,t.qualifier,t.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},_o=function(e){return $e(e)?new Qr(e):e},dv={createEmitter:function(){for(var e=0;e<this.length;e++){var t=this[e],r=t._private;r.emitter||(r.emitter=new yl(O1,t))}return this},emitter:function(){return this._private.emitter},on:function(e,t,r){for(var i=_o(t),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,r)}return this},removeListener:function(e,t,r){for(var i=_o(t),a=0;a<this.length;a++){var s=this[a];s.emitter().removeListener(e,i,r)}return this},removeAllListeners:function(){for(var e=0;e<this.length;e++){var t=this[e];t.emitter().removeAllListeners()}return this},one:function(e,t,r){for(var i=_o(t),a=0;a<this.length;a++){var s=this[a];s.emitter().one(e,i,r)}return this},once:function(e,t,r){for(var i=_o(t),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,r,{once:!0,onceCollection:this})}},emit:function(e,t){for(var r=0;r<this.length;r++){var i=this[r];i.emitter().emit(e,t)}return this},emitAndNotify:function(e,t){if(this.length!==0)return this.cy().notify(e,this),this.emit(e,t),this}};xt.eventAliasesOn(dv);var pv={nodes:function(e){return this.filter(function(t){return t.isNode()}).filter(e)},edges:function(e){return this.filter(function(t){return t.isEdge()}).filter(e)},byGroup:function(){for(var e=this.spawn(),t=this.spawn(),r=0;r<this.length;r++){var i=this[r];i.isNode()?e.push(i):t.push(i)}return{nodes:e,edges:t}},filter:function(e,t){if(e===void 0)return this;if($e(e)||An(e))return new Qr(e).filter(this);if(Pt(e)){for(var r=this.spawn(),i=this,a=0;a<i.length;a++){var s=i[a],o=t?e.apply(t,[s,a,i]):e(s,a,i);o&&r.push(s)}return r}return this.spawn()},not:function(e){if(e){$e(e)&&(e=this.filter(e));for(var t=this.spawn(),r=0;r<this.length;r++){var i=this[r],a=e.has(i);a||t.push(i)}return t}else return this},absoluteComplement:function(){var e=this.cy();return e.mutableElements().not(this)},intersect:function(e){if($e(e)){var t=e;return this.filter(t)}for(var r=this.spawn(),i=this,a=e,s=this.length<e.length,o=s?i:a,l=s?a:i,u=0;u<o.length;u++){var c=o[u];l.has(c)&&r.push(c)}return r},xor:function(e){var t=this._private.cy;$e(e)&&(e=t.$(e));var r=this.spawn(),i=this,a=e,s=function(l,u){for(var c=0;c<l.length;c++){var f=l[c],d=f._private.data.id,h=u.hasElementWithId(d);h||r.push(f)}};return s(i,a),s(a,i),r},diff:function(e){var t=this._private.cy;$e(e)&&(e=t.$(e));var r=this.spawn(),i=this.spawn(),a=this.spawn(),s=this,o=e,l=function(c,f,d){for(var h=0;h<c.length;h++){var v=c[h],m=v._private.data.id,g=f.hasElementWithId(m);g?a.merge(v):d.push(v)}};return l(s,o,r),l(o,s,i),{left:r,right:i,both:a}},add:function(e){var t=this._private.cy;if(!e)return this;if($e(e)){var r=e;e=t.mutableElements().filter(r)}for(var i=this.spawnSelf(),a=0;a<e.length;a++){var s=e[a],o=!this.has(s);o&&i.push(s)}return i},merge:function(e){var t=this._private,r=t.cy;if(!e)return this;if(e&&$e(e)){var i=e;e=r.mutableElements().filter(i)}for(var a=t.map,s=0;s<e.length;s++){var o=e[s],l=o._private.data.id,u=!a.has(l);if(u){var c=this.length++;this[c]=o,a.set(l,{ele:o,index:c})}}return this},unmergeAt:function(e){var t=this[e],r=t.id(),i=this._private,a=i.map;this[e]=void 0,a.delete(r);var s=e===this.length-1;if(this.length>1&&!s){var o=this.length-1,l=this[o],u=l._private.data.id;this[o]=void 0,this[e]=l,a.set(u,{ele:l,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var t=this._private,r=e._private.data.id,i=t.map,a=i.get(r);if(!a)return this;var s=a.index;return this.unmergeAt(s),this},unmerge:function(e){var t=this._private.cy;if(!e)return this;if(e&&$e(e)){var r=e;e=t.mutableElements().filter(r)}for(var i=0;i<e.length;i++)this.unmergeOne(e[i]);return this},unmergeBy:function(e){for(var t=this.length-1;t>=0;t--){var r=this[t];e(r)&&this.unmergeAt(t)}return this},map:function(e,t){for(var r=[],i=this,a=0;a<i.length;a++){var s=i[a],o=t?e.apply(t,[s,a,i]):e(s,a,i);r.push(o)}return r},reduce:function(e,t){for(var r=t,i=this,a=0;a<i.length;a++)r=e(r,i[a],a,i);return r},max:function(e,t){for(var r=-1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=t?e.apply(t,[o,s,a]):e(o,s,a);l>r&&(r=l,i=o)}return{value:r,ele:i}},min:function(e,t){for(var r=1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=t?e.apply(t,[o,s,a]):e(o,s,a);l<r&&(r=l,i=o)}return{value:r,ele:i}}},mt=pv;mt.u=mt["|"]=mt["+"]=mt.union=mt.or=mt.add;mt["\\"]=mt["!"]=mt["-"]=mt.difference=mt.relativeComplement=mt.subtract=mt.not;mt.n=mt["&"]=mt["."]=mt.and=mt.intersection=mt.intersect;mt["^"]=mt["(+)"]=mt["(-)"]=mt.symmetricDifference=mt.symdiff=mt.xor;mt.fnFilter=mt.filterFn=mt.stdFilter=mt.filter;mt.complement=mt.abscomp=mt.absoluteComplement;var F1={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},vv=function(e,t){var r=e.cy(),i=r.hasCompoundNodes();function a(c){var f=c.pstyle("z-compound-depth");return f.value==="auto"?i?c.zDepth():0:f.value==="bottom"?-1:f.value==="top"?Uc:0}var s=a(e)-a(t);if(s!==0)return s;function o(c){var f=c.pstyle("z-index-compare");return f.value==="auto"&&c.isNode()?1:0}var l=o(e)-o(t);if(l!==0)return l;var u=e.pstyle("z-index").value-t.pstyle("z-index").value;return u!==0?u:e.poolIndex()-t.poolIndex()},el={forEach:function(e,t){if(Pt(e))for(var r=this.length,i=0;i<r;i++){var a=this[i],s=t?e.apply(t,[a,i,this]):e(a,i,this);if(s===!1)break}return this},toArray:function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t]);return e},slice:function(e,t){var r=[],i=this.length;t==null&&(t=i),e==null&&(e=0),e<0&&(e=i+e),t<0&&(t=i+t);for(var a=e;a>=0&&a<t&&a<i;a++)r.push(this[a]);return this.spawn(r)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(e){if(!Pt(e))return this;var t=this.toArray().sort(e);return this.spawn(t)},sortByZIndex:function(){return this.sort(vv)},zDepth:function(){var e=this[0];if(e){var t=e._private,r=t.group;if(r==="nodes"){var i=t.data.parent?e.parents().size():0;return e.isParent()?i:Uc-1}else{var a=t.source,s=t.target,o=a.zDepth(),l=s.zDepth();return Math.max(o,l,0)}}}};el.each=el.forEach;var U1=function(){var e="undefined",t=(typeof Symbol>"u"?"undefined":Wt(Symbol))!=e&&Wt(Symbol.iterator)!=e;t&&(el[Symbol.iterator]=function(){var r=this,i={value:void 0,done:!1},a=0,s=this.length;return fp({next:function(){return a<s?i.value=r[a++]:(i.value=void 0,i.done=!0),i}},Symbol.iterator,function(){return this})})};U1();var B1=Zt({nodeDimensionsIncludeLabels:!1}),Fo={layoutDimensions:function(e){e=B1(e);var t;if(!this.takesUpSpace())t={w:0,h:0};else if(e.nodeDimensionsIncludeLabels){var r=this.boundingBox();t={w:r.w,h:r.h}}else t={w:this.outerWidth(),h:this.outerHeight()};return(t.w===0||t.h===0)&&(t.w=t.h=1),t},layoutPositions:function(e,t,r){var i=this.nodes().filter(function(M){return!M.isParent()}),a=this.cy(),s=t.eles,o=function(w){return w.id()},l=gs(r,o);e.emit({type:"layoutstart",layout:e}),e.animations=[];var u=function(w,b,C){var T={x:b.x1+b.w/2,y:b.y1+b.h/2},S={x:(C.x-T.x)*w,y:(C.y-T.y)*w};return{x:T.x+S.x,y:T.y+S.y}},c=t.spacingFactor&&t.spacingFactor!==1,f=function(){if(!c)return null;for(var w=En(),b=0;b<i.length;b++){var C=i[b],T=l(C,b);GT(w,T.x,T.y)}return w},d=f(),h=gs(function(M,w){var b=l(M,w);if(c){var C=Math.abs(t.spacingFactor);b=u(C,d,b)}return t.transform!=null&&(b=t.transform(M,b)),b},o);if(t.animate){for(var v=0;v<i.length;v++){var m=i[v],g=h(m,v),p=t.animateFilter==null||t.animateFilter(m,v);if(p){var x=m.animation({position:g,duration:t.animationDuration,easing:t.animationEasing});e.animations.push(x)}else m.position(g)}if(t.fit){var y=a.animation({fit:{boundingBox:s.boundingBoxAt(h),padding:t.padding},duration:t.animationDuration,easing:t.animationEasing});e.animations.push(y)}else if(t.zoom!==void 0&&t.pan!==void 0){var E=a.animation({zoom:t.zoom,pan:t.pan,duration:t.animationDuration,easing:t.animationEasing});e.animations.push(E)}e.animations.forEach(function(M){return M.play()}),e.one("layoutready",t.ready),e.emit({type:"layoutready",layout:e}),Ia.all(e.animations.map(function(M){return M.promise()})).then(function(){e.one("layoutstop",t.stop),e.emit({type:"layoutstop",layout:e})})}else i.positions(h),t.fit&&a.fit(t.eles,t.padding),t.zoom!=null&&a.zoom(t.zoom),t.pan&&a.pan(t.pan),e.one("layoutready",t.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",t.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){var t=this.cy();return t.makeLayout(Je({},e,{eles:this}))}};Fo.createLayout=Fo.makeLayout=Fo.layout;function gv(n,e,t){var r=t._private,i=r.styleCache=r.styleCache||[],a;return(a=i[n])!=null||(a=i[n]=e(t)),a}function xl(n,e){return n=$r(n),function(r){return gv(n,e,r)}}function El(n,e){n=$r(n);var t=function(i){return e.call(i)};return function(){var i=this[0];if(i)return gv(n,t,i)}}var jt={recalculateRenderedStyle:function(e){var t=this.cy(),r=t.renderer(),i=t.styleEnabled();return r&&i&&r.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e=this.cy(),t=function(a){return a._private.styleCache=null};if(e.hasCompoundNodes()){var r;r=this.spawnSelf().merge(this.descendants()).merge(this.parents()),r.merge(r.connectedEdges()),r.forEach(t)}else this.forEach(function(i){t(i),i.connectedEdges().forEach(t)});return this},updateStyle:function(e){var t=this._private.cy;if(!t.styleEnabled())return this;if(t.batching()){var r=t._private.batchStyleEles;return r.merge(this),this}var i=t.hasCompoundNodes(),a=this;e=!!(e||e===void 0),i&&(a=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var s=a;return e?s.emitAndNotify("style"):s.emit("style"),a.forEach(function(o){return o._private.styleDirty=!0}),this},cleanStyle:function(){var e=this.cy();if(e.styleEnabled())for(var t=0;t<this.length;t++){var r=this[t];r._private.styleDirty&&(r._private.styleDirty=!1,e.style().apply(r))}},parsedStyle:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this[0],i=r.cy();if(i.styleEnabled()&&r){r._private.styleDirty&&(r._private.styleDirty=!1,i.style().apply(r));var a=r._private.style[e];return a??(t?i.style().getDefaultProperty(e):null)}},numericStyle:function(e){var t=this[0];if(t.cy().styleEnabled()&&t){var r=t.pstyle(e);return r.pfValue!==void 0?r.pfValue:r.value}},numericStyleUnits:function(e){var t=this[0];if(t.cy().styleEnabled()&&t)return t.pstyle(e).units},renderedStyle:function(e){var t=this.cy();if(!t.styleEnabled())return this;var r=this[0];if(r)return t.style().getRenderedStyle(r,e)},style:function(e,t){var r=this.cy();if(!r.styleEnabled())return this;var i=!1,a=r.style();if(dt(e)){var s=e;a.applyBypass(this,s,i),this.emitAndNotify("style")}else if($e(e))if(t===void 0){var o=this[0];return o?a.getStylePropertyValue(o,e):void 0}else a.applyBypass(this,e,t,i),this.emitAndNotify("style");else if(e===void 0){var l=this[0];return l?a.getRawStyle(l):void 0}return this},removeStyle:function(e){var t=this.cy();if(!t.styleEnabled())return this;var r=!1,i=t.style(),a=this;if(e===void 0)for(var s=0;s<a.length;s++){var o=a[s];i.removeAllBypasses(o,r)}else{e=e.split(/\s+/);for(var l=0;l<a.length;l++){var u=a[l];i.removeBypasses(u,e,r)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var t=e.hasCompoundNodes(),r=this[0];if(r){var i=r._private,a=r.pstyle("opacity").value;if(!t)return a;var s=i.data.parent?r.parents():null;if(s)for(var o=0;o<s.length;o++){var l=s[o],u=l.pstyle("opacity").value;a=u*a}return a}},transparent:function(){var e=this.cy();if(!e.styleEnabled())return!1;var t=this[0],r=t.cy().hasCompoundNodes();if(t)return r?t.effectiveOpacity()===0:t.pstyle("opacity").value===0},backgrounding:function(){var e=this.cy();if(!e.styleEnabled())return!1;var t=this[0];return!!t._private.backgrounding}};function cu(n,e){var t=n._private,r=t.data.parent?n.parents():null;if(r)for(var i=0;i<r.length;i++){var a=r[i];if(!e(a))return!1}return!0}function $c(n){var e=n.ok,t=n.edgeOkViaNode||n.ok,r=n.parentOk||n.ok;return function(){var i=this.cy();if(!i.styleEnabled())return!0;var a=this[0],s=i.hasCompoundNodes();if(a){var o=a._private;if(!e(a))return!1;if(a.isNode())return!s||cu(a,r);var l=o.source,u=o.target;return t(l)&&(!s||cu(l,t))&&(l===u||t(u)&&(!s||cu(u,t)))}}}var Ba=xl("eleTakesUpSpace",function(n){return n.pstyle("display").value==="element"&&n.width()!==0&&(n.isNode()?n.height()!==0:!0)});jt.takesUpSpace=El("takesUpSpace",$c({ok:Ba}));var k1=xl("eleInteractive",function(n){return n.pstyle("events").value==="yes"&&n.pstyle("visibility").value==="visible"&&Ba(n)}),z1=xl("parentInteractive",function(n){return n.pstyle("visibility").value==="visible"&&Ba(n)});jt.interactive=El("interactive",$c({ok:k1,parentOk:z1,edgeOkViaNode:Ba}));jt.noninteractive=function(){var n=this[0];if(n)return!n.interactive()};var G1=xl("eleVisible",function(n){return n.pstyle("visibility").value==="visible"&&n.pstyle("opacity").pfValue!==0&&Ba(n)}),V1=Ba;jt.visible=El("visible",$c({ok:G1,edgeOkViaNode:V1}));jt.hidden=function(){var n=this[0];if(n)return!n.visible()};jt.isBundledBezier=El("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});jt.bypass=jt.css=jt.style;jt.renderedCss=jt.renderedStyle;jt.removeBypass=jt.removeCss=jt.removeStyle;jt.pstyle=jt.parsedStyle;var Xr={};function Hh(n){return function(){var e=arguments,t=[];if(e.length===2){var r=e[0],i=e[1];this.on(n.event,r,i)}else if(e.length===1&&Pt(e[0])){var a=e[0];this.on(n.event,a)}else if(e.length===0||e.length===1&&Mt(e[0])){for(var s=e.length===1?e[0]:null,o=0;o<this.length;o++){var l=this[o],u=!n.ableField||l._private[n.ableField],c=l._private[n.field]!=n.value;if(n.overrideAble){var f=n.overrideAble(l);if(f!==void 0&&(u=f,!f))return this}u&&(l._private[n.field]=n.value,c&&t.push(l))}var d=this.spawn(t);d.updateStyle(),d.emit(n.event),s&&d.emit(s)}return this}}function ka(n){Xr[n.field]=function(){var e=this[0];if(e){if(n.overrideField){var t=n.overrideField(e);if(t!==void 0)return t}return e._private[n.field]}},Xr[n.on]=Hh({event:n.on,field:n.field,ableField:n.ableField,overrideAble:n.overrideAble,value:!0}),Xr[n.off]=Hh({event:n.off,field:n.field,ableField:n.ableField,overrideAble:n.overrideAble,value:!1})}ka({field:"locked",overrideField:function(e){return e.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});ka({field:"grabbable",overrideField:function(e){return e.cy().autoungrabify()||e.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});ka({field:"selected",ableField:"selectable",overrideAble:function(e){return e.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});ka({field:"selectable",overrideField:function(e){return e.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});Xr.deselect=Xr.unselect;Xr.grabbed=function(){var n=this[0];if(n)return n._private.grabbed};ka({field:"active",on:"activate",off:"unactivate"});ka({field:"pannable",on:"panify",off:"unpanify"});Xr.inactive=function(){var n=this[0];if(n)return!n._private.active};var sn={},Wh=function(e){return function(r){for(var i=this,a=[],s=0;s<i.length;s++){var o=i[s];if(o.isNode()){for(var l=!1,u=o.connectedEdges(),c=0;c<u.length;c++){var f=u[c],d=f.source(),h=f.target();if(e.noIncomingEdges&&h===o&&d!==o||e.noOutgoingEdges&&d===o&&h!==o){l=!0;break}}l||a.push(o)}}return this.spawn(a,!0).filter(r)}},Xh=function(e){return function(t){for(var r=this,i=[],a=0;a<r.length;a++){var s=r[a];if(s.isNode())for(var o=s.connectedEdges(),l=0;l<o.length;l++){var u=o[l],c=u.source(),f=u.target();e.outgoing&&c===s?(i.push(u),i.push(f)):e.incoming&&f===s&&(i.push(u),i.push(c))}}return this.spawn(i,!0).filter(t)}},Yh=function(e){return function(t){for(var r=this,i=[],a={};;){var s=e.outgoing?r.outgoers():r.incomers();if(s.length===0)break;for(var o=!1,l=0;l<s.length;l++){var u=s[l],c=u.id();a[c]||(a[c]=!0,i.push(u),o=!0)}if(!o)break;r=s}return this.spawn(i,!0).filter(t)}};sn.clearTraversalCache=function(){for(var n=0;n<this.length;n++)this[n]._private.traversalCache=null};Je(sn,{roots:Wh({noIncomingEdges:!0}),leaves:Wh({noOutgoingEdges:!0}),outgoers:On(Xh({outgoing:!0}),"outgoers"),successors:Yh({outgoing:!0}),incomers:On(Xh({incoming:!0}),"incomers"),predecessors:Yh({incoming:!0})});Je(sn,{neighborhood:On(function(n){for(var e=[],t=this.nodes(),r=0;r<t.length;r++)for(var i=t[r],a=i.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),u=o.target(),c=i===l?u:l;c.length>0&&e.push(c[0]),e.push(o[0])}return this.spawn(e,!0).filter(n)},"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}});sn.neighbourhood=sn.neighborhood;sn.closedNeighbourhood=sn.closedNeighborhood;sn.openNeighbourhood=sn.openNeighborhood;Je(sn,{source:On(function(e){var t=this[0],r;return t&&(r=t._private.source||t.cy().collection()),r&&e?r.filter(e):r},"source"),target:On(function(e){var t=this[0],r;return t&&(r=t._private.target||t.cy().collection()),r&&e?r.filter(e):r},"target"),sources:qh({attr:"source"}),targets:qh({attr:"target"})});function qh(n){return function(t){for(var r=[],i=0;i<this.length;i++){var a=this[i],s=a._private[n.attr];s&&r.push(s)}return this.spawn(r,!0).filter(t)}}Je(sn,{edgesWith:On(Kh(),"edgesWith"),edgesTo:On(Kh({thisIsSrc:!0}),"edgesTo")});function Kh(n){return function(t){var r=[],i=this._private.cy,a=n||{};$e(t)&&(t=i.$(t));for(var s=0;s<t.length;s++)for(var o=t[s]._private.edges,l=0;l<o.length;l++){var u=o[l],c=u._private.data,f=this.hasElementWithId(c.source)&&t.hasElementWithId(c.target),d=t.hasElementWithId(c.source)&&this.hasElementWithId(c.target),h=f||d;h&&((a.thisIsSrc||a.thisIsTgt)&&(a.thisIsSrc&&!f||a.thisIsTgt&&!d)||r.push(u))}return this.spawn(r,!0)}}Je(sn,{connectedEdges:On(function(n){for(var e=[],t=this,r=0;r<t.length;r++){var i=t[r];if(i.isNode())for(var a=i._private.edges,s=0;s<a.length;s++){var o=a[s];e.push(o)}}return this.spawn(e,!0).filter(n)},"connectedEdges"),connectedNodes:On(function(n){for(var e=[],t=this,r=0;r<t.length;r++){var i=t[r];i.isEdge()&&(e.push(i.source()[0]),e.push(i.target()[0]))}return this.spawn(e,!0).filter(n)},"connectedNodes"),parallelEdges:On($h(),"parallelEdges"),codirectedEdges:On($h({codirected:!0}),"codirectedEdges")});function $h(n){var e={codirected:!1};return n=Je({},e,n),function(r){for(var i=[],a=this.edges(),s=n,o=0;o<a.length;o++)for(var l=a[o],u=l._private,c=u.source,f=c._private.data.id,d=u.data.target,h=c._private.edges,v=0;v<h.length;v++){var m=h[v],g=m._private.data,p=g.target,x=g.source,y=p===d&&x===f,E=f===p&&d===x;(s.codirected&&y||!s.codirected&&(y||E))&&i.push(m)}return this.spawn(i,!0).filter(r)}}Je(sn,{components:function(e){var t=this,r=t.cy(),i=r.collection(),a=e==null?t.nodes():e.nodes(),s=[];e!=null&&a.empty()&&(a=e.sources());var o=function(c,f){i.merge(c),a.unmerge(c),f.merge(c)};if(a.empty())return t.spawn();var l=function(){var c=r.collection();s.push(c);var f=a[0];o(f,c),t.bfs({directed:!1,roots:f,visit:function(h){return o(h,c)}}),c.forEach(function(d){d.connectedEdges().forEach(function(h){t.has(h)&&c.has(h.source())&&c.has(h.target())&&c.merge(h)})})};do l();while(a.length>0);return s},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}});sn.componentsOf=sn.components;var en=function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e===void 0){Lt("A collection must have a reference to the core");return}var a=new ar,s=!1;if(!t)t=[];else if(t.length>0&&dt(t[0])&&!Ns(t[0])){s=!0;for(var o=[],l=new Na,u=0,c=t.length;u<c;u++){var f=t[u];f.data==null&&(f.data={});var d=f.data;if(d.id==null)d.id=Rp();else if(e.hasElementWithId(d.id)||l.has(d.id))continue;var h=new fl(e,f,!1);o.push(h),l.add(d.id)}t=o}this.length=0;for(var v=0,m=t.length;v<m;v++){var g=t[v][0];if(g!=null){var p=g._private.data.id;(!r||!a.has(p))&&(r&&a.set(p,{index:this.length,ele:g}),this[this.length]=g,this.length++)}}this._private={eles:this,cy:e,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(x){this.lazyMap=x},rebuildMap:function(){for(var y=this.lazyMap=new ar,E=this.eles,M=0;M<E.length;M++){var w=E[M];y.set(w.id(),{index:M,ele:w})}}},r&&(this._private.map=a),s&&!i&&this.restore()},Ct=fl.prototype=en.prototype=Object.create(Array.prototype);Ct.instanceString=function(){return"collection"};Ct.spawn=function(n,e){return new en(this.cy(),n,e)};Ct.spawnSelf=function(){return this.spawn(this)};Ct.cy=function(){return this._private.cy};Ct.renderer=function(){return this._private.cy.renderer()};Ct.element=function(){return this[0]};Ct.collection=function(){return pp(this)?this:new en(this._private.cy,[this])};Ct.unique=function(){return new en(this._private.cy,this,!0)};Ct.hasElementWithId=function(n){return n=""+n,this._private.map.has(n)};Ct.getElementById=function(n){n=""+n;var e=this._private.cy,t=this._private.map.get(n);return t?t.ele:new en(e)};Ct.$id=Ct.getElementById;Ct.poolIndex=function(){var n=this._private.cy,e=n._private.elements,t=this[0]._private.data.id;return e._private.map.get(t).index};Ct.indexOf=function(n){var e=n[0]._private.data.id;return this._private.map.get(e).index};Ct.indexOfId=function(n){return n=""+n,this._private.map.get(n).index};Ct.json=function(n){var e=this.element(),t=this.cy();if(e==null&&n)return this;if(e!=null){var r=e._private;if(dt(n)){if(t.startBatch(),n.data){e.data(n.data);var i=r.data;if(e.isEdge()){var a=!1,s={},o=n.data.source,l=n.data.target;o!=null&&o!=i.source&&(s.source=""+o,a=!0),l!=null&&l!=i.target&&(s.target=""+l,a=!0),a&&(e=e.move(s))}else{var u="parent"in n.data,c=n.data.parent;u&&(c!=null||i.parent!=null)&&c!=i.parent&&(c===void 0&&(c=null),c!=null&&(c=""+c),e=e.move({parent:c}))}}n.position&&e.position(n.position);var f=function(m,g,p){var x=n[m];x!=null&&x!==r[m]&&(x?e[g]():e[p]())};return f("removed","remove","restore"),f("selected","select","unselect"),f("selectable","selectify","unselectify"),f("locked","lock","unlock"),f("grabbable","grabify","ungrabify"),f("pannable","panify","unpanify"),n.classes!=null&&e.classes(n.classes),t.endBatch(),this}else if(n===void 0){var d={data:ir(r.data),position:ir(r.position),group:r.group,removed:r.removed,selected:r.selected,selectable:r.selectable,locked:r.locked,grabbable:r.grabbable,pannable:r.pannable,classes:null};d.classes="";var h=0;return r.classes.forEach(function(v){return d.classes+=h++===0?v:" "+v}),d}}};Ct.jsons=function(){for(var n=[],e=0;e<this.length;e++){var t=this[e],r=t.json();n.push(r)}return n};Ct.clone=function(){for(var n=this.cy(),e=[],t=0;t<this.length;t++){var r=this[t],i=r.json(),a=new fl(n,i,!1);e.push(a)}return new en(n,e)};Ct.copy=Ct.clone;Ct.restore=function(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this,r=t.cy(),i=r._private,a=[],s=[],o,l=0,u=t.length;l<u;l++){var c=t[l];e&&!c.removed()||(c.isNode()?a.push(c):s.push(c))}o=a.concat(s);var f,d=function(){o.splice(f,1),f--};for(f=0;f<o.length;f++){var h=o[f],v=h._private,m=v.data;if(h.clearTraversalCache(),!(!e&&!v.removed)){if(m.id===void 0)m.id=Rp();else if(ke(m.id))m.id=""+m.id;else if(Kr(m.id)||!$e(m.id)){Lt("Can not create element with invalid string ID `"+m.id+"`"),d();continue}else if(r.hasElementWithId(m.id)){Lt("Can not create second element with ID `"+m.id+"`"),d();continue}}var g=m.id;if(h.isNode()){var p=v.position;p.x==null&&(p.x=0),p.y==null&&(p.y=0)}if(h.isEdge()){for(var x=h,y=["source","target"],E=y.length,M=!1,w=0;w<E;w++){var b=y[w],C=m[b];ke(C)&&(C=m[b]=""+m[b]),C==null||C===""?(Lt("Can not create edge `"+g+"` with unspecified "+b),M=!0):r.hasElementWithId(C)||(Lt("Can not create edge `"+g+"` with nonexistant "+b+" `"+C+"`"),M=!0)}if(M){d();continue}var T=r.getElementById(m.source),S=r.getElementById(m.target);T.same(S)?T._private.edges.push(x):(T._private.edges.push(x),S._private.edges.push(x)),x._private.source=T,x._private.target=S}v.map=new ar,v.map.set(g,{ele:h,index:0}),v.removed=!1,e&&r.addToPool(h)}for(var L=0;L<a.length;L++){var N=a[L],I=N._private.data;ke(I.parent)&&(I.parent=""+I.parent);var _=I.parent,P=_!=null;if(P||N._private.parent){var A=N._private.parent?r.collection().merge(N._private.parent):r.getElementById(_);if(A.empty())I.parent=void 0;else if(A[0].removed())Et("Node added with missing parent, reference to parent removed"),I.parent=void 0,N._private.parent=null;else{for(var D=!1,R=A;!R.empty();){if(N.same(R)){D=!0,I.parent=void 0;break}R=R.parent()}D||(A[0]._private.children.push(N),N._private.parent=A[0],i.hasCompoundNodes=!0)}}}if(o.length>0){for(var B=o.length===t.length?t:new en(r,o),k=0;k<B.length;k++){var V=B[k];V.isNode()||(V.parallelEdges().clearTraversalCache(),V.source().clearTraversalCache(),V.target().clearTraversalCache())}var Y;i.hasCompoundNodes?Y=r.collection().merge(B).merge(B.connectedNodes()).merge(B.parent()):Y=B,Y.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(n),n?B.emitAndNotify("add"):e&&B.emit("add")}return t};Ct.removed=function(){var n=this[0];return n&&n._private.removed};Ct.inside=function(){var n=this[0];return n&&!n._private.removed};Ct.remove=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this,r=[],i={},a=t._private.cy;function s(_){for(var P=_._private.edges,A=0;A<P.length;A++)l(P[A])}function o(_){for(var P=_._private.children,A=0;A<P.length;A++)l(P[A])}function l(_){var P=i[_.id()];e&&_.removed()||P||(i[_.id()]=!0,_.isNode()?(r.push(_),s(_),o(_)):r.unshift(_))}for(var u=0,c=t.length;u<c;u++){var f=t[u];l(f)}function d(_,P){var A=_._private.edges;Zr(A,P),_.clearTraversalCache()}function h(_){_.clearTraversalCache()}var v=[];v.ids={};function m(_,P){P=P[0],_=_[0];var A=_._private.children,D=_.id();Zr(A,P),P._private.parent=null,v.ids[D]||(v.ids[D]=!0,v.push(_))}t.dirtyCompoundBoundsCache(),e&&a.removeFromPool(r);for(var g=0;g<r.length;g++){var p=r[g];if(p.isEdge()){var x=p.source()[0],y=p.target()[0];d(x,p),d(y,p);for(var E=p.parallelEdges(),M=0;M<E.length;M++){var w=E[M];h(w),w.isBundledBezier()&&w.dirtyBoundingBoxCache()}}else{var b=p.parent();b.length!==0&&m(b,p)}e&&(p._private.removed=!0)}var C=a._private.elements;a._private.hasCompoundNodes=!1;for(var T=0;T<C.length;T++){var S=C[T];if(S.isParent()){a._private.hasCompoundNodes=!0;break}}var L=new en(this.cy(),r);L.size()>0&&(n?L.emitAndNotify("remove"):e&&L.emit("remove"));for(var N=0;N<v.length;N++){var I=v[N];(!e||!I.removed())&&I.updateStyle()}return L};Ct.move=function(n){var e=this._private.cy,t=this,r=!1,i=!1,a=function(v){return v==null?v:""+v};if(n.source!==void 0||n.target!==void 0){var s=a(n.source),o=a(n.target),l=s!=null&&e.hasElementWithId(s),u=o!=null&&e.hasElementWithId(o);(l||u)&&(e.batch(function(){t.remove(r,i),t.emitAndNotify("moveout");for(var h=0;h<t.length;h++){var v=t[h],m=v._private.data;v.isEdge()&&(l&&(m.source=s),u&&(m.target=o))}t.restore(r,i)}),t.emitAndNotify("move"))}else if(n.parent!==void 0){var c=a(n.parent),f=c===null||e.hasElementWithId(c);if(f){var d=c===null?void 0:c;e.batch(function(){var h=t.remove(r,i);h.emitAndNotify("moveout");for(var v=0;v<t.length;v++){var m=t[v],g=m._private.data;m.isNode()&&(g.parent=d)}h.restore(r,i)}),t.emitAndNotify("move")}}return this};[Vp,jw,Oo,Wr,Da,v1,ml,L1,dv,pv,F1,el,Fo,jt,Xr,sn].forEach(function(n){Je(Ct,n)});var H1={add:function(e){var t,r=this;if(An(e)){var i=e;if(i._private.cy===r)t=i.restore();else{for(var a=[],s=0;s<i.length;s++){var o=i[s];a.push(o.json())}t=new en(r,a)}}else if(Mt(e)){var l=e;t=new en(r,l)}else if(dt(e)&&(Mt(e.nodes)||Mt(e.edges))){for(var u=e,c=[],f=["nodes","edges"],d=0,h=f.length;d<h;d++){var v=f[d],m=u[v];if(Mt(m))for(var g=0,p=m.length;g<p;g++){var x=Je({group:v},m[g]);c.push(x)}}t=new en(r,c)}else{var y=e;t=new fl(r,y).collection()}return t},remove:function(e){if(!An(e)){if($e(e)){var t=e;e=this.$(t)}}return e.remove()}};/*! Bezier curve function generator. Copyright Gaetan Renaudeau. MIT License: http://en.wikipedia.org/wiki/MIT_License */function W1(n,e,t,r){var i=4,a=.001,s=1e-7,o=10,l=11,u=1/(l-1),c=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var f=0;f<4;++f)if(typeof arguments[f]!="number"||isNaN(arguments[f])||!isFinite(arguments[f]))return!1;n=Math.min(n,1),t=Math.min(t,1),n=Math.max(n,0),t=Math.max(t,0);var d=c?new Float32Array(l):new Array(l);function h(S,L){return 1-3*L+3*S}function v(S,L){return 3*L-6*S}function m(S){return 3*S}function g(S,L,N){return((h(L,N)*S+v(L,N))*S+m(L))*S}function p(S,L,N){return 3*h(L,N)*S*S+2*v(L,N)*S+m(L)}function x(S,L){for(var N=0;N<i;++N){var I=p(L,n,t);if(I===0)return L;var _=g(L,n,t)-S;L-=_/I}return L}function y(){for(var S=0;S<l;++S)d[S]=g(S*u,n,t)}function E(S,L,N){var I,_,P=0;do _=L+(N-L)/2,I=g(_,n,t)-S,I>0?N=_:L=_;while(Math.abs(I)>s&&++P<o);return _}function M(S){for(var L=0,N=1,I=l-1;N!==I&&d[N]<=S;++N)L+=u;--N;var _=(S-d[N])/(d[N+1]-d[N]),P=L+_*u,A=p(P,n,t);return A>=a?x(S,P):A===0?P:E(S,L,L+u)}var w=!1;function b(){w=!0,(n!==e||t!==r)&&y()}var C=function(L){return w||b(),n===e&&t===r?L:L===0?0:L===1?1:g(M(L),e,r)};C.getControlPoints=function(){return[{x:n,y:e},{x:t,y:r}]};var T="generateBezier("+[n,e,t,r]+")";return C.toString=function(){return T},C}/*! Runge-Kutta spring physics function generator. Adapted from Framer.js, copyright Koen Bok. MIT License: http://en.wikipedia.org/wiki/MIT_License */var X1=function(){function n(r){return-r.tension*r.x-r.friction*r.v}function e(r,i,a){var s={x:r.x+a.dx*i,v:r.v+a.dv*i,tension:r.tension,friction:r.friction};return{dx:s.v,dv:n(s)}}function t(r,i){var a={dx:r.v,dv:n(r)},s=e(r,i*.5,a),o=e(r,i*.5,s),l=e(r,i,o),u=1/6*(a.dx+2*(s.dx+o.dx)+l.dx),c=1/6*(a.dv+2*(s.dv+o.dv)+l.dv);return r.x=r.x+u*i,r.v=r.v+c*i,r}return function r(i,a,s){var o={x:-1,v:0,tension:null,friction:null},l=[0],u=0,c=1/1e4,f=16/1e3,d,h,v;for(i=parseFloat(i)||500,a=parseFloat(a)||20,s=s||null,o.tension=i,o.friction=a,d=s!==null,d?(u=r(i,a),h=u/s*f):h=f;v=t(v||o,h),l.push(1+v.x),u+=16,Math.abs(v.x)>c&&Math.abs(v.v)>c;);return d?function(m){return l[m*(l.length-1)|0]}:u}}(),At=function(e,t,r,i){var a=W1(e,t,r,i);return function(s,o,l){return s+(o-s)*a(l)}},Uo={linear:function(e,t,r){return e+(t-e)*r},ease:At(.25,.1,.25,1),"ease-in":At(.42,0,1,1),"ease-out":At(0,0,.58,1),"ease-in-out":At(.42,0,.58,1),"ease-in-sine":At(.47,0,.745,.715),"ease-out-sine":At(.39,.575,.565,1),"ease-in-out-sine":At(.445,.05,.55,.95),"ease-in-quad":At(.55,.085,.68,.53),"ease-out-quad":At(.25,.46,.45,.94),"ease-in-out-quad":At(.455,.03,.515,.955),"ease-in-cubic":At(.55,.055,.675,.19),"ease-out-cubic":At(.215,.61,.355,1),"ease-in-out-cubic":At(.645,.045,.355,1),"ease-in-quart":At(.895,.03,.685,.22),"ease-out-quart":At(.165,.84,.44,1),"ease-in-out-quart":At(.77,0,.175,1),"ease-in-quint":At(.755,.05,.855,.06),"ease-out-quint":At(.23,1,.32,1),"ease-in-out-quint":At(.86,0,.07,1),"ease-in-expo":At(.95,.05,.795,.035),"ease-out-expo":At(.19,1,.22,1),"ease-in-out-expo":At(1,0,0,1),"ease-in-circ":At(.6,.04,.98,.335),"ease-out-circ":At(.075,.82,.165,1),"ease-in-out-circ":At(.785,.135,.15,.86),spring:function(e,t,r){if(r===0)return Uo.linear;var i=X1(e,t,r);return function(a,s,o){return a+(s-a)*i(o)}},"cubic-bezier":At};function Zh(n,e,t,r,i){if(r===1||e===t)return t;var a=i(e,t,r);return n==null||((n.roundValue||n.color)&&(a=Math.round(a)),n.min!==void 0&&(a=Math.max(a,n.min)),n.max!==void 0&&(a=Math.min(a,n.max))),a}function Qh(n,e){return n.pfValue!=null||n.value!=null?n.pfValue!=null&&(e==null||e.type.units!=="%")?n.pfValue:n.value:n}function ta(n,e,t,r,i){var a=i!=null?i.type:null;t<0?t=0:t>1&&(t=1);var s=Qh(n,i),o=Qh(e,i);if(ke(s)&&ke(o))return Zh(a,s,o,t,r);if(Mt(s)&&Mt(o)){for(var l=[],u=0;u<o.length;u++){var c=s[u],f=o[u];if(c!=null&&f!=null){var d=Zh(a,c,f,t,r);l.push(d)}else l.push(f)}return l}}function Y1(n,e,t,r){var i=!r,a=n._private,s=e._private,o=s.easing,l=s.startTime,u=r?n:n.cy(),c=u.style();if(!s.easingImpl)if(o==null)s.easingImpl=Uo.linear;else{var f;if($e(o)){var d=c.parse("transition-timing-function",o);f=d.value}else f=o;var h,v;$e(f)?(h=f,v=[]):(h=f[1],v=f.slice(2).map(function(B){return+B})),v.length>0?(h==="spring"&&v.push(s.duration),s.easingImpl=Uo[h].apply(null,v)):s.easingImpl=Uo[h]}var m=s.easingImpl,g;if(s.duration===0?g=1:g=(t-l)/s.duration,s.applying&&(g=s.progress),g<0?g=0:g>1&&(g=1),s.delay==null){var p=s.startPosition,x=s.position;if(x&&i&&!n.locked()){var y={};ja(p.x,x.x)&&(y.x=ta(p.x,x.x,g,m)),ja(p.y,x.y)&&(y.y=ta(p.y,x.y,g,m)),n.position(y)}var E=s.startPan,M=s.pan,w=a.pan,b=M!=null&&r;b&&(ja(E.x,M.x)&&(w.x=ta(E.x,M.x,g,m)),ja(E.y,M.y)&&(w.y=ta(E.y,M.y,g,m)),n.emit("pan"));var C=s.startZoom,T=s.zoom,S=T!=null&&r;S&&(ja(C,T)&&(a.zoom=Es(a.minZoom,ta(C,T,g,m),a.maxZoom)),n.emit("zoom")),(b||S)&&n.emit("viewport");var L=s.style;if(L&&L.length>0&&i){for(var N=0;N<L.length;N++){var I=L[N],_=I.name,P=I,A=s.startStyle[_],D=c.properties[A.name],R=ta(A,P,g,m,D);c.overrideBypass(n,_,R)}n.emit("style")}}return s.progress=g,g}function ja(n,e){return n==null||e==null?!1:ke(n)&&ke(e)?!0:!!(n&&e)}function q1(n,e,t,r){var i=e._private;i.started=!0,i.startTime=t-i.progress*i.duration}function Jh(n,e){var t=e._private.aniEles,r=[];function i(c,f){var d=c._private,h=d.animation.current,v=d.animation.queue,m=!1;if(h.length===0){var g=v.shift();g&&h.push(g)}for(var p=function(w){for(var b=w.length-1;b>=0;b--){var C=w[b];C()}w.splice(0,w.length)},x=h.length-1;x>=0;x--){var y=h[x],E=y._private;if(E.stopped){h.splice(x,1),E.hooked=!1,E.playing=!1,E.started=!1,p(E.frames);continue}!E.playing&&!E.applying||(E.playing&&E.applying&&(E.applying=!1),E.started||q1(c,y,n),Y1(c,y,n,f),E.applying&&(E.applying=!1),p(E.frames),E.step!=null&&E.step(n),y.completed()&&(h.splice(x,1),E.hooked=!1,E.playing=!1,E.started=!1,p(E.completes)),m=!0)}return!f&&h.length===0&&v.length===0&&r.push(c),m}for(var a=!1,s=0;s<t.length;s++){var o=t[s],l=i(o);a=a||l}var u=i(e,!0);(a||u)&&(t.length>0?e.notify("draw",t):e.notify("draw")),t.unmerge(r),e.emit("step")}var K1={animate:xt.animate(),animation:xt.animation(),animated:xt.animated(),clearQueue:xt.clearQueue(),delay:xt.delay(),delayAnimation:xt.delayAnimation(),stop:xt.stop(),addToAnimationPool:function(e){var t=this;t.styleEnabled()&&t._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,!e.styleEnabled())return;function t(){e._private.animationsRunning&&$o(function(a){Jh(a,e),t()})}var r=e.renderer();r&&r.beforeRender?r.beforeRender(function(a,s){Jh(s,e)},r.beforeRenderPriorities.animations):t()}},$1={qualifierCompare:function(e,t){return e==null||t==null?e==null&&t==null:e.sameText(t)},eventMatches:function(e,t,r){var i=t.qualifier;return i!=null?e!==r.target&&Ns(r.target)&&i.matches(r.target):!0},addEventFields:function(e,t){t.cy=e,t.target=e},callbackContext:function(e,t,r){return t.qualifier!=null?r.target:e}},bo=function(e){return $e(e)?new Qr(e):e},mv={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new yl($1,this)),this},emitter:function(){return this._private.emitter},on:function(e,t,r){return this.emitter().on(e,bo(t),r),this},removeListener:function(e,t,r){return this.emitter().removeListener(e,bo(t),r),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,t,r){return this.emitter().one(e,bo(t),r),this},once:function(e,t,r){return this.emitter().one(e,bo(t),r),this},emit:function(e,t){return this.emitter().emit(e,t),this},emitAndNotify:function(e,t){return this.emit(e),this.notify(e,t),this}};xt.eventAliasesOn(mv);var cc={png:function(e){var t=this._private.renderer;return e=e||{},t.png(e)},jpg:function(e){var t=this._private.renderer;return e=e||{},e.bg=e.bg||"#fff",t.jpg(e)}};cc.jpeg=cc.jpg;var Bo={layout:function(e){var t=this;if(e==null){Lt("Layout options must be specified to make a layout");return}if(e.name==null){Lt("A `name` must be specified to make a layout");return}var r=e.name,i=t.extension("layout",r);if(i==null){Lt("No such layout `"+r+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var a;$e(e.eles)?a=t.$(e.eles):a=e.eles!=null?e.eles:t.$();var s=new i(Je({},e,{cy:t,eles:a}));return s}};Bo.createLayout=Bo.makeLayout=Bo.layout;var Z1={notify:function(e,t){var r=this._private;if(this.batching()){r.batchNotifications=r.batchNotifications||{};var i=r.batchNotifications[e]=r.batchNotifications[e]||this.collection();t!=null&&i.merge(t);return}if(r.notificationsEnabled){var a=this.renderer();this.destroyed()||!a||a.notify(e,t)}},notifications:function(e){var t=this._private;return e===void 0?t.notificationsEnabled:(t.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return e.batchCount==null&&(e.batchCount=0),e.batchCount===0&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(e.batchCount===0)return this;if(e.batchCount--,e.batchCount===0){e.batchStyleEles.updateStyle();var t=this.renderer();Object.keys(e.batchNotifications).forEach(function(r){var i=e.batchNotifications[r];i.empty()?t.notify(r):t.notify(r,i)})}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var t=this;return this.batch(function(){for(var r=Object.keys(e),i=0;i<r.length;i++){var a=r[i],s=e[a],o=t.getElementById(a);o.data(s)}})}},Q1=Zt({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:12,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),fc={renderTo:function(e,t,r,i){var a=this._private.renderer;return a.renderTo(e,t,r,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var t=this,r=t.extension("renderer",e.name);if(r==null){Lt("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}e.wheelSensitivity!==void 0&&Et("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=Q1(e);i.cy=t,t._private.renderer=new r(i),this.notify("init")},destroyRenderer:function(){var e=this;e.notify("destroy");var t=e.container();if(t)for(t._cyreg=null;t.childNodes.length>0;)t.removeChild(t.childNodes[0]);e._private.renderer=null,e.mutableElements().forEach(function(r){var i=r._private;i.rscratch={},i.rstyle={},i.animation.current=[],i.animation.queue=[]})},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};fc.invalidateDimensions=fc.resize;var ko={collection:function(e,t){return $e(e)?this.$(e):An(e)?e.collection():Mt(e)?(t||(t={}),new en(this,e,t.unique,t.removed)):new en(this)},nodes:function(e){var t=this.$(function(r){return r.isNode()});return e?t.filter(e):t},edges:function(e){var t=this.$(function(r){return r.isEdge()});return e?t.filter(e):t},$:function(e){var t=this._private.elements;return e?t.filter(e):t.spawnSelf()},mutableElements:function(){return this._private.elements}};ko.elements=ko.filter=ko.$;var ln={},cs="t",J1="f";ln.apply=function(n){for(var e=this,t=e._private,r=t.cy,i=r.collection(),a=0;a<n.length;a++){var s=n[a],o=e.getContextMeta(s);if(!o.empty){var l=e.getContextStyle(o),u=e.applyContextStyle(o,l,s);s._private.appliedInitStyle?e.updateTransitions(s,u.diffProps):s._private.appliedInitStyle=!0;var c=e.updateStyleHints(s);c&&i.push(s)}}return i};ln.getPropertiesDiff=function(n,e){var t=this,r=t._private.propDiffs=t._private.propDiffs||{},i=n+"-"+e,a=r[i];if(a)return a;for(var s=[],o={},l=0;l<t.length;l++){var u=t[l],c=n[l]===cs,f=e[l]===cs,d=c!==f,h=u.mappedProperties.length>0;if(d||f&&h){var v=void 0;d&&h||d?v=u.properties:h&&(v=u.mappedProperties);for(var m=0;m<v.length;m++){for(var g=v[m],p=g.name,x=!1,y=l+1;y<t.length;y++){var E=t[y],M=e[y]===cs;if(M&&(x=E.properties[g.name]!=null,x))break}!o[p]&&!x&&(o[p]=!0,s.push(p))}}}return r[i]=s,s};ln.getContextMeta=function(n){for(var e=this,t="",r,i=n._private.styleCxtKey||"",a=0;a<e.length;a++){var s=e[a],o=s.selector&&s.selector.matches(n);o?t+=cs:t+=J1}return r=e.getPropertiesDiff(i,t),n._private.styleCxtKey=t,{key:t,diffPropNames:r,empty:r.length===0}};ln.getContextStyle=function(n){var e=n.key,t=this,r=this._private.contextStyles=this._private.contextStyles||{};if(r[e])return r[e];for(var i={_private:{key:e}},a=0;a<t.length;a++){var s=t[a],o=e[a]===cs;if(o)for(var l=0;l<s.properties.length;l++){var u=s.properties[l];i[u.name]=u}}return r[e]=i,i};ln.applyContextStyle=function(n,e,t){for(var r=this,i=n.diffPropNames,a={},s=r.types,o=0;o<i.length;o++){var l=i[o],u=e[l],c=t.pstyle(l);if(!u)if(c)c.bypass?u={name:l,deleteBypassed:!0}:u={name:l,delete:!0};else continue;if(c!==u){if(u.mapped===s.fn&&c!=null&&c.mapping!=null&&c.mapping.value===u.value){var f=c.mapping,d=f.fnValue=u.value(t);if(d===f.prevFnValue)continue}var h=a[l]={prev:c};r.applyParsedProperty(t,u),h.next=t.pstyle(l),h.next&&h.next.bypass&&(h.next=h.next.bypassed)}}return{diffProps:a}};ln.updateStyleHints=function(n){var e=n._private,t=this,r=t.propertyGroupNames,i=t.propertyGroupKeys,a=function(te,ue,Se){return t.getPropertiesHash(te,ue,Se)},s=e.styleKey;if(n.removed())return!1;var o=e.group==="nodes",l=n._private.style;r=Object.keys(l);for(var u=0;u<i.length;u++){var c=i[u];e.styleKeys[c]=[ua,is]}for(var f=function(te,ue){return e.styleKeys[ue][0]=ms(te,e.styleKeys[ue][0])},d=function(te,ue){return e.styleKeys[ue][1]=ys(te,e.styleKeys[ue][1])},h=function(te,ue){f(te,ue),d(te,ue)},v=function(te,ue){for(var Se=0;Se<te.length;Se++){var U=te.charCodeAt(Se);f(U,ue),d(U,ue)}},m=2e9,g=function(te){return-128<te&&te<128&&Math.floor(te)!==te?m-(te*1024|0):te},p=0;p<r.length;p++){var x=r[p],y=l[x];if(y!=null){var E=this.properties[x],M=E.type,w=E.groupKey,b=void 0;E.hashOverride!=null?b=E.hashOverride(n,y):y.pfValue!=null&&(b=y.pfValue);var C=E.enums==null?y.value:null,T=b!=null,S=C!=null,L=T||S,N=y.units;if(M.number&&L&&!M.multiple){var I=T?b:C;h(g(I),w),!T&&N!=null&&v(N,w)}else v(y.strValue,w)}}for(var _=[ua,is],P=0;P<i.length;P++){var A=i[P],D=e.styleKeys[A];_[0]=ms(D[0],_[0]),_[1]=ys(D[1],_[1])}e.styleKey=aT(_[0],_[1]);var R=e.styleKeys;e.labelDimsKey=Fr(R.labelDimensions);var B=a(n,["label"],R.labelDimensions);if(e.labelKey=Fr(B),e.labelStyleKey=Fr(ho(R.commonLabel,B)),!o){var k=a(n,["source-label"],R.labelDimensions);e.sourceLabelKey=Fr(k),e.sourceLabelStyleKey=Fr(ho(R.commonLabel,k));var V=a(n,["target-label"],R.labelDimensions);e.targetLabelKey=Fr(V),e.targetLabelStyleKey=Fr(ho(R.commonLabel,V))}if(o){var Y=e.styleKeys,Z=Y.nodeBody,W=Y.nodeBorder,K=Y.nodeOutline,Q=Y.backgroundImage,ne=Y.compound,ie=Y.pie,H=[Z,W,K,Q,ne,ie].filter(function(X){return X!=null}).reduce(ho,[ua,is]);e.nodeKey=Fr(H),e.hasPie=ie!=null&&ie[0]!==ua&&ie[1]!==is}return s!==e.styleKey};ln.clearStyleHints=function(n){var e=n._private;e.styleCxtKey="",e.styleKeys={},e.styleKey=null,e.labelKey=null,e.labelStyleKey=null,e.sourceLabelKey=null,e.sourceLabelStyleKey=null,e.targetLabelKey=null,e.targetLabelStyleKey=null,e.nodeKey=null,e.hasPie=null};ln.applyParsedProperty=function(n,e){var t=this,r=e,i=n._private.style,a,s=t.types,o=t.properties[r.name].type,l=r.bypass,u=i[r.name],c=u&&u.bypass,f=n._private,d="mapping",h=function(Z){return Z==null?null:Z.pfValue!=null?Z.pfValue:Z.value},v=function(){var Z=h(u),W=h(r);t.checkTriggers(n,r.name,Z,W)};if(e.name==="curve-style"&&n.isEdge()&&(e.value!=="bezier"&&n.isLoop()||e.value==="haystack"&&(n.source().isParent()||n.target().isParent()))&&(r=e=this.parse(e.name,"bezier",l)),r.delete)return i[r.name]=void 0,v(),!0;if(r.deleteBypassed)return u?u.bypass?(u.bypassed=void 0,v(),!0):!1:(v(),!0);if(r.deleteBypass)return u?u.bypass?(i[r.name]=u.bypassed,v(),!0):!1:(v(),!0);var m=function(){Et("Do not assign mappings to elements without corresponding data (i.e. ele `"+n.id()+"` has no mapping for property `"+r.name+"` with data field `"+r.field+"`); try a `["+r.field+"]` selector to limit scope to elements with `"+r.field+"` defined")};switch(r.mapped){case s.mapData:{for(var g=r.field.split("."),p=f.data,x=0;x<g.length&&p;x++){var y=g[x];p=p[y]}if(p==null)return m(),!1;var E;if(ke(p)){var M=r.fieldMax-r.fieldMin;M===0?E=0:E=(p-r.fieldMin)/M}else return Et("Do not use continuous mappers without specifying numeric data (i.e. `"+r.field+": "+p+"` for `"+n.id()+"` is non-numeric)"),!1;if(E<0?E=0:E>1&&(E=1),o.color){var w=r.valueMin[0],b=r.valueMax[0],C=r.valueMin[1],T=r.valueMax[1],S=r.valueMin[2],L=r.valueMax[2],N=r.valueMin[3]==null?1:r.valueMin[3],I=r.valueMax[3]==null?1:r.valueMax[3],_=[Math.round(w+(b-w)*E),Math.round(C+(T-C)*E),Math.round(S+(L-S)*E),Math.round(N+(I-N)*E)];a={bypass:r.bypass,name:r.name,value:_,strValue:"rgb("+_[0]+", "+_[1]+", "+_[2]+")"}}else if(o.number){var P=r.valueMin+(r.valueMax-r.valueMin)*E;a=this.parse(r.name,P,r.bypass,d)}else return!1;if(!a)return m(),!1;a.mapping=r,r=a;break}case s.data:{for(var A=r.field.split("."),D=f.data,R=0;R<A.length&&D;R++){var B=A[R];D=D[B]}if(D!=null&&(a=this.parse(r.name,D,r.bypass,d)),!a)return m(),!1;a.mapping=r,r=a;break}case s.fn:{var k=r.value,V=r.fnValue!=null?r.fnValue:k(n);if(r.prevFnValue=V,V==null)return Et("Custom function mappers may not return null (i.e. `"+r.name+"` for ele `"+n.id()+"` is null)"),!1;if(a=this.parse(r.name,V,r.bypass,d),!a)return Et("Custom function mappers may not return invalid values for the property type (i.e. `"+r.name+"` for ele `"+n.id()+"` is invalid)"),!1;a.mapping=ir(r),r=a;break}case void 0:break;default:return!1}return l?(c?r.bypassed=u.bypassed:r.bypassed=u,i[r.name]=r):c?u.bypassed=r:i[r.name]=r,v(),!0};ln.cleanElements=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(this.clearStyleHints(r),r.dirtyCompoundBoundsCache(),r.dirtyBoundingBoxCache(),!e)r._private.style={};else for(var i=r._private.style,a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o];l!=null&&(l.bypass?l.bypassed=null:i[o]=null)}}};ln.update=function(){var n=this._private.cy,e=n.mutableElements();e.updateStyle()};ln.updateTransitions=function(n,e){var t=this,r=n._private,i=n.pstyle("transition-property").value,a=n.pstyle("transition-duration").pfValue,s=n.pstyle("transition-delay").pfValue;if(i.length>0&&a>0){for(var o={},l=!1,u=0;u<i.length;u++){var c=i[u],f=n.pstyle(c),d=e[c];if(d){var h=d.prev,v=h,m=d.next!=null?d.next:f,g=!1,p=void 0,x=1e-6;v&&(ke(v.pfValue)&&ke(m.pfValue)?(g=m.pfValue-v.pfValue,p=v.pfValue+x*g):ke(v.value)&&ke(m.value)?(g=m.value-v.value,p=v.value+x*g):Mt(v.value)&&Mt(m.value)&&(g=v.value[0]!==m.value[0]||v.value[1]!==m.value[1]||v.value[2]!==m.value[2],p=v.strValue),g&&(o[c]=m.strValue,this.applyBypass(n,c,p),l=!0))}}if(!l)return;r.transitioning=!0,new Ia(function(y){s>0?n.delayAnimation(s).play().promise().then(y):y()}).then(function(){return n.animation({style:o,duration:a,easing:n.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){t.removeBypasses(n,i),n.emitAndNotify("style"),r.transitioning=!1})}else r.transitioning&&(this.removeBypasses(n,i),n.emitAndNotify("style"),r.transitioning=!1)};ln.checkTrigger=function(n,e,t,r,i,a){var s=this.properties[e],o=i(s);o!=null&&o(t,r)&&a(s)};ln.checkZOrderTrigger=function(n,e,t,r){var i=this;this.checkTrigger(n,e,t,r,function(a){return a.triggersZOrder},function(){i._private.cy.notify("zorder",n)})};ln.checkBoundsTrigger=function(n,e,t,r){this.checkTrigger(n,e,t,r,function(i){return i.triggersBounds},function(i){n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),i.triggersBoundsOfParallelBeziers&&e==="curve-style"&&(t==="bezier"||r==="bezier")&&n.parallelEdges().forEach(function(a){a.dirtyBoundingBoxCache()}),i.triggersBoundsOfConnectedEdges&&e==="display"&&(t==="none"||r==="none")&&n.connectedEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};ln.checkTriggers=function(n,e,t,r){n.dirtyStyleCache(),this.checkZOrderTrigger(n,e,t,r),this.checkBoundsTrigger(n,e,t,r)};var Bs={};Bs.applyBypass=function(n,e,t,r){var i=this,a=[],s=!0;if(e==="*"||e==="**"){if(t!==void 0)for(var o=0;o<i.properties.length;o++){var l=i.properties[o],u=l.name,c=this.parse(u,t,!0);c&&a.push(c)}}else if($e(e)){var f=this.parse(e,t,!0);f&&a.push(f)}else if(dt(e)){var d=e;r=t;for(var h=Object.keys(d),v=0;v<h.length;v++){var m=h[v],g=d[m];if(g===void 0&&(g=d[ul(m)]),g!==void 0){var p=this.parse(m,g,!0);p&&a.push(p)}}}else return!1;if(a.length===0)return!1;for(var x=!1,y=0;y<n.length;y++){for(var E=n[y],M={},w=void 0,b=0;b<a.length;b++){var C=a[b];if(r){var T=E.pstyle(C.name);w=M[C.name]={prev:T}}x=this.applyParsedProperty(E,ir(C))||x,r&&(w.next=E.pstyle(C.name))}x&&this.updateStyleHints(E),r&&this.updateTransitions(E,M,s)}return x};Bs.overrideBypass=function(n,e,t){e=Fc(e);for(var r=0;r<n.length;r++){var i=n[r],a=i._private.style[e],s=this.properties[e].type,o=s.color,l=s.mutiple,u=a?a.pfValue!=null?a.pfValue:a.value:null;!a||!a.bypass?this.applyBypass(i,e,t):(a.value=t,a.pfValue!=null&&(a.pfValue=t),o?a.strValue="rgb("+t.join(",")+")":l?a.strValue=t.join(" "):a.strValue=""+t,this.updateStyleHints(i)),this.checkTriggers(i,e,u,t)}};Bs.removeAllBypasses=function(n,e){return this.removeBypasses(n,this.propertyNames,e)};Bs.removeBypasses=function(n,e,t){for(var r=!0,i=0;i<n.length;i++){for(var a=n[i],s={},o=0;o<e.length;o++){var l=e[o],u=this.properties[l],c=a.pstyle(u.name);if(!(!c||!c.bypass)){var f="",d=this.parse(l,f,!0),h=s[u.name]={prev:c};this.applyParsedProperty(a,d),h.next=a.pstyle(u.name)}}this.updateStyleHints(a),t&&this.updateTransitions(a,s,r)}};var Zc={};Zc.getEmSizeInPixels=function(){var n=this.containerCss("font-size");return n!=null?parseFloat(n):1};Zc.containerCss=function(n){var e=this._private.cy,t=e.container(),r=e.window();if(r&&t&&r.getComputedStyle)return r.getComputedStyle(t).getPropertyValue(n)};var lr={};lr.getRenderedStyle=function(n,e){return e?this.getStylePropertyValue(n,e,!0):this.getRawStyle(n,!0)};lr.getRawStyle=function(n,e){var t=this;if(n=n[0],n){for(var r={},i=0;i<t.properties.length;i++){var a=t.properties[i],s=t.getStylePropertyValue(n,a.name,e);s!=null&&(r[a.name]=s,r[ul(a.name)]=s)}return r}};lr.getIndexedStyle=function(n,e,t,r){var i=n.pstyle(e)[t][r];return i??n.cy().style().getDefaultProperty(e)[t][0]};lr.getStylePropertyValue=function(n,e,t){var r=this;if(n=n[0],n){var i=r.properties[e];i.alias&&(i=i.pointsTo);var a=i.type,s=n.pstyle(i.name);if(s){var o=s.value,l=s.units,u=s.strValue;if(t&&a.number&&o!=null&&ke(o)){var c=n.cy().zoom(),f=function(g){return g*c},d=function(g,p){return f(g)+p},h=Mt(o),v=h?l.every(function(m){return m!=null}):l!=null;return v?h?o.map(function(m,g){return d(m,l[g])}).join(" "):d(o,l):h?o.map(function(m){return $e(m)?m:""+f(m)}).join(" "):""+f(o)}else if(u!=null)return u}return null}};lr.getAnimationStartStyle=function(n,e){for(var t={},r=0;r<e.length;r++){var i=e[r],a=i.name,s=n.pstyle(a);s!==void 0&&(dt(s)?s=this.parse(a,s.strValue):s=this.parse(a,s)),s&&(t[a]=s)}return t};lr.getPropsList=function(n){var e=this,t=[],r=n,i=e.properties;if(r)for(var a=Object.keys(r),s=0;s<a.length;s++){var o=a[s],l=r[o],u=i[o]||i[Fc(o)],c=this.parse(u.name,l);c&&t.push(c)}return t};lr.getNonDefaultPropertiesHash=function(n,e,t){var r=t.slice(),i,a,s,o,l,u;for(l=0;l<e.length;l++)if(i=e[l],a=n.pstyle(i,!1),a!=null)if(a.pfValue!=null)r[0]=ms(o,r[0]),r[1]=ys(o,r[1]);else for(s=a.strValue,u=0;u<s.length;u++)o=s.charCodeAt(u),r[0]=ms(o,r[0]),r[1]=ys(o,r[1]);return r};lr.getPropertiesHash=lr.getNonDefaultPropertiesHash;var _l={};_l.appendFromJson=function(n){for(var e=this,t=0;t<n.length;t++){var r=n[t],i=r.selector,a=r.style||r.css,s=Object.keys(a);e.selector(i);for(var o=0;o<s.length;o++){var l=s[o],u=a[l];e.css(l,u)}}return e};_l.fromJson=function(n){var e=this;return e.resetToDefault(),e.appendFromJson(n),e};_l.json=function(){for(var n=[],e=this.defaultLength;e<this.length;e++){for(var t=this[e],r=t.selector,i=t.properties,a={},s=0;s<i.length;s++){var o=i[s];a[o.name]=o.strValue}n.push({selector:r?r.toString():"core",style:a})}return n};var Qc={};Qc.appendFromString=function(n){var e=this,t=this,r=""+n,i,a,s;r=r.replace(/[/][*](\s|.)+?[*][/]/g,"");function o(){r.length>i.length?r=r.substr(i.length):r=""}function l(){a.length>s.length?a=a.substr(s.length):a=""}for(;;){var u=r.match(/^\s*$/);if(u)break;var c=r.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!c){Et("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+r);break}i=c[0];var f=c[1];if(f!=="core"){var d=new Qr(f);if(d.invalid){Et("Skipping parsing of block: Invalid selector found in string stylesheet: "+f),o();continue}}var h=c[2],v=!1;a=h;for(var m=[];;){var g=a.match(/^\s*$/);if(g)break;var p=a.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!p){Et("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+h),v=!0;break}s=p[0];var x=p[1],y=p[2],E=e.properties[x];if(!E){Et("Skipping property: Invalid property name in: "+s),l();continue}var M=t.parse(x,y);if(!M){Et("Skipping property: Invalid property definition in: "+s),l();continue}m.push({name:x,val:y}),l()}if(v){o();break}t.selector(f);for(var w=0;w<m.length;w++){var b=m[w];t.css(b.name,b.val)}o()}return t};Qc.fromString=function(n){var e=this;return e.resetToDefault(),e.appendFromString(n),e};var Jt={};(function(){var n=Gt,e=ub,t=fb,r=hb,i=db,a=function(H){return"^"+H+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},s=function(H){var X=n+"|\\w+|"+e+"|"+t+"|"+r+"|"+i;return"^"+H+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+n+")\\s*\\,\\s*("+n+")\\s*,\\s*("+X+")\\s*\\,\\s*("+X+")\\)$"},o=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];Jt.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:a("data")},layoutData:{mapping:!0,regex:a("layoutData")},scratch:{mapping:!0,regex:a("scratch")},mapData:{mapping:!0,regex:s("mapData")},mapLayoutData:{mapping:!0,regex:s("mapLayoutData")},mapScratch:{mapping:!0,regex:s("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:o,singleRegexMatchValue:!0},urls:{regexes:o,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(H,X){switch(H.length){case 2:return X[0]!=="deg"&&X[0]!=="rad"&&X[1]!=="deg"&&X[1]!=="rad";case 1:return $e(H[0])||X[0]==="deg"||X[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+n+")\\s*,\\s*("+n+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+n+")\\s*,\\s*("+n+")\\s*,\\s*("+n+")\\s*,\\s*("+n+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(H){var X=H.length;return X===1||X===2||X===4}}};var l={zeroNonZero:function(H,X){return(H==null||X==null)&&H!==X||H==0&&X!=0?!0:H!=0&&X==0},any:function(H,X){return H!=X},emptyNonEmpty:function(H,X){var te=Kr(H),ue=Kr(X);return te&&!ue||!te&&ue}},u=Jt.types,c=[{name:"label",type:u.text,triggersBounds:l.any,triggersZOrder:l.emptyNonEmpty},{name:"text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any}],f=[{name:"source-label",type:u.text,triggersBounds:l.any},{name:"source-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"source-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-offset",type:u.size,triggersBounds:l.any}],d=[{name:"target-label",type:u.text,triggersBounds:l.any},{name:"target-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"target-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-offset",type:u.size,triggersBounds:l.any}],h=[{name:"font-family",type:u.fontFamily,triggersBounds:l.any},{name:"font-style",type:u.fontStyle,triggersBounds:l.any},{name:"font-weight",type:u.fontWeight,triggersBounds:l.any},{name:"font-size",type:u.size,triggersBounds:l.any},{name:"text-transform",type:u.textTransform,triggersBounds:l.any},{name:"text-wrap",type:u.textWrap,triggersBounds:l.any},{name:"text-overflow-wrap",type:u.textOverflowWrap,triggersBounds:l.any},{name:"text-max-width",type:u.size,triggersBounds:l.any},{name:"text-outline-width",type:u.size,triggersBounds:l.any},{name:"line-height",type:u.positiveNumber,triggersBounds:l.any}],v=[{name:"text-valign",type:u.valign,triggersBounds:l.any},{name:"text-halign",type:u.halign,triggersBounds:l.any},{name:"color",type:u.color},{name:"text-outline-color",type:u.color},{name:"text-outline-opacity",type:u.zeroOneNumber},{name:"text-background-color",type:u.color},{name:"text-background-opacity",type:u.zeroOneNumber},{name:"text-background-padding",type:u.size,triggersBounds:l.any},{name:"text-border-opacity",type:u.zeroOneNumber},{name:"text-border-color",type:u.color},{name:"text-border-width",type:u.size,triggersBounds:l.any},{name:"text-border-style",type:u.borderStyle,triggersBounds:l.any},{name:"text-background-shape",type:u.textBackgroundShape,triggersBounds:l.any},{name:"text-justification",type:u.justification}],m=[{name:"events",type:u.bool,triggersZOrder:l.any},{name:"text-events",type:u.bool,triggersZOrder:l.any}],g=[{name:"display",type:u.display,triggersZOrder:l.any,triggersBounds:l.any,triggersBoundsOfConnectedEdges:!0},{name:"visibility",type:u.visibility,triggersZOrder:l.any},{name:"opacity",type:u.zeroOneNumber,triggersZOrder:l.zeroNonZero},{name:"text-opacity",type:u.zeroOneNumber},{name:"min-zoomed-font-size",type:u.size},{name:"z-compound-depth",type:u.zCompoundDepth,triggersZOrder:l.any},{name:"z-index-compare",type:u.zIndexCompare,triggersZOrder:l.any},{name:"z-index",type:u.number,triggersZOrder:l.any}],p=[{name:"overlay-padding",type:u.size,triggersBounds:l.any},{name:"overlay-color",type:u.color},{name:"overlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"overlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"overlay-corner-radius",type:u.cornerRadius}],x=[{name:"underlay-padding",type:u.size,triggersBounds:l.any},{name:"underlay-color",type:u.color},{name:"underlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"underlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"underlay-corner-radius",type:u.cornerRadius}],y=[{name:"transition-property",type:u.propList},{name:"transition-duration",type:u.time},{name:"transition-delay",type:u.time},{name:"transition-timing-function",type:u.easing}],E=function(H,X){return X.value==="label"?-H.poolIndex():X.pfValue},M=[{name:"height",type:u.nodeSize,triggersBounds:l.any,hashOverride:E},{name:"width",type:u.nodeSize,triggersBounds:l.any,hashOverride:E},{name:"shape",type:u.nodeShape,triggersBounds:l.any},{name:"shape-polygon-points",type:u.polygonPointList,triggersBounds:l.any},{name:"corner-radius",type:u.cornerRadius},{name:"background-color",type:u.color},{name:"background-fill",type:u.fill},{name:"background-opacity",type:u.zeroOneNumber},{name:"background-blacken",type:u.nOneOneNumber},{name:"background-gradient-stop-colors",type:u.colors},{name:"background-gradient-stop-positions",type:u.percentages},{name:"background-gradient-direction",type:u.gradientDirection},{name:"padding",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"padding-relative-to",type:u.paddingRelativeTo,triggersBounds:l.any},{name:"bounds-expansion",type:u.boundsExpansion,triggersBounds:l.any}],w=[{name:"border-color",type:u.color},{name:"border-opacity",type:u.zeroOneNumber},{name:"border-width",type:u.size,triggersBounds:l.any},{name:"border-style",type:u.borderStyle},{name:"border-cap",type:u.lineCap},{name:"border-join",type:u.lineJoin},{name:"border-dash-pattern",type:u.numbers},{name:"border-dash-offset",type:u.number},{name:"border-position",type:u.linePosition}],b=[{name:"outline-color",type:u.color},{name:"outline-opacity",type:u.zeroOneNumber},{name:"outline-width",type:u.size,triggersBounds:l.any},{name:"outline-style",type:u.borderStyle},{name:"outline-offset",type:u.size,triggersBounds:l.any}],C=[{name:"background-image",type:u.urls},{name:"background-image-crossorigin",type:u.bgCrossOrigin},{name:"background-image-opacity",type:u.zeroOneNumbers},{name:"background-image-containment",type:u.bgContainment},{name:"background-image-smoothing",type:u.bools},{name:"background-position-x",type:u.bgPos},{name:"background-position-y",type:u.bgPos},{name:"background-width-relative-to",type:u.bgRelativeTo},{name:"background-height-relative-to",type:u.bgRelativeTo},{name:"background-repeat",type:u.bgRepeat},{name:"background-fit",type:u.bgFit},{name:"background-clip",type:u.bgClip},{name:"background-width",type:u.bgWH},{name:"background-height",type:u.bgWH},{name:"background-offset-x",type:u.bgPos},{name:"background-offset-y",type:u.bgPos}],T=[{name:"position",type:u.position,triggersBounds:l.any},{name:"compound-sizing-wrt-labels",type:u.compoundIncludeLabels,triggersBounds:l.any},{name:"min-width",type:u.size,triggersBounds:l.any},{name:"min-width-bias-left",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-width-bias-right",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height",type:u.size,triggersBounds:l.any},{name:"min-height-bias-top",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height-bias-bottom",type:u.sizeMaybePercent,triggersBounds:l.any}],S=[{name:"line-style",type:u.lineStyle},{name:"line-color",type:u.color},{name:"line-fill",type:u.fill},{name:"line-cap",type:u.lineCap},{name:"line-opacity",type:u.zeroOneNumber},{name:"line-dash-pattern",type:u.numbers},{name:"line-dash-offset",type:u.number},{name:"line-outline-width",type:u.size},{name:"line-outline-color",type:u.color},{name:"line-gradient-stop-colors",type:u.colors},{name:"line-gradient-stop-positions",type:u.percentages},{name:"curve-style",type:u.curveStyle,triggersBounds:l.any,triggersBoundsOfParallelBeziers:!0},{name:"haystack-radius",type:u.zeroOneNumber,triggersBounds:l.any},{name:"source-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"target-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"control-point-step-size",type:u.size,triggersBounds:l.any},{name:"control-point-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"control-point-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"segment-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-radii",type:u.numbers,triggersBounds:l.any},{name:"radius-type",type:u.radiusType,triggersBounds:l.any},{name:"taxi-turn",type:u.bidirectionalSizeMaybePercent,triggersBounds:l.any},{name:"taxi-turn-min-distance",type:u.size,triggersBounds:l.any},{name:"taxi-direction",type:u.axisDirection,triggersBounds:l.any},{name:"taxi-radius",type:u.number,triggersBounds:l.any},{name:"edge-distances",type:u.edgeDistances,triggersBounds:l.any},{name:"arrow-scale",type:u.positiveNumber,triggersBounds:l.any},{name:"loop-direction",type:u.angle,triggersBounds:l.any},{name:"loop-sweep",type:u.angle,triggersBounds:l.any},{name:"source-distance-from-node",type:u.size,triggersBounds:l.any},{name:"target-distance-from-node",type:u.size,triggersBounds:l.any}],L=[{name:"ghost",type:u.bool,triggersBounds:l.any},{name:"ghost-offset-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-offset-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-opacity",type:u.zeroOneNumber}],N=[{name:"selection-box-color",type:u.color},{name:"selection-box-opacity",type:u.zeroOneNumber},{name:"selection-box-border-color",type:u.color},{name:"selection-box-border-width",type:u.size},{name:"active-bg-color",type:u.color},{name:"active-bg-opacity",type:u.zeroOneNumber},{name:"active-bg-size",type:u.size},{name:"outside-texture-bg-color",type:u.color},{name:"outside-texture-bg-opacity",type:u.zeroOneNumber}],I=[];Jt.pieBackgroundN=16,I.push({name:"pie-size",type:u.sizeMaybePercent});for(var _=1;_<=Jt.pieBackgroundN;_++)I.push({name:"pie-"+_+"-background-color",type:u.color}),I.push({name:"pie-"+_+"-background-size",type:u.percent}),I.push({name:"pie-"+_+"-background-opacity",type:u.zeroOneNumber});var P=[],A=Jt.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:u.arrowShape,triggersBounds:l.any},{name:"arrow-color",type:u.color},{name:"arrow-fill",type:u.arrowFill},{name:"arrow-width",type:u.arrowWidth}].forEach(function(ie){A.forEach(function(H){var X=H+"-"+ie.name,te=ie.type,ue=ie.triggersBounds;P.push({name:X,type:te,triggersBounds:ue})})},{});var D=Jt.properties=[].concat(m,y,g,p,x,L,v,h,c,f,d,M,w,b,C,I,T,S,P,N),R=Jt.propertyGroups={behavior:m,transition:y,visibility:g,overlay:p,underlay:x,ghost:L,commonLabel:v,labelDimensions:h,mainLabel:c,sourceLabel:f,targetLabel:d,nodeBody:M,nodeBorder:w,nodeOutline:b,backgroundImage:C,pie:I,compound:T,edgeLine:S,edgeArrow:P,core:N},B=Jt.propertyGroupNames={},k=Jt.propertyGroupKeys=Object.keys(R);k.forEach(function(ie){B[ie]=R[ie].map(function(H){return H.name}),R[ie].forEach(function(H){return H.groupKey=ie})});var V=Jt.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];Jt.propertyNames=D.map(function(ie){return ie.name});for(var Y=0;Y<D.length;Y++){var Z=D[Y];D[Z.name]=Z}for(var W=0;W<V.length;W++){var K=V[W],Q=D[K.pointsTo],ne={name:K.name,alias:!0,pointsTo:Q};D.push(ne),D[K.name]=ne}})();Jt.getDefaultProperty=function(n){return this.getDefaultProperties()[n]};Jt.getDefaultProperties=function(){var n=this._private;if(n.defaultProperties!=null)return n.defaultProperties;for(var e=Je({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Jt.pieBackgroundN;c++){var f=u.name.replace("{{i}}",c),d=u.value;l[f]=d}return l},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(l,u){return Jt.arrowPrefixes.forEach(function(c){var f=c+"-"+u.name,d=u.value;l[f]=d}),l},{})),t={},r=0;r<this.properties.length;r++){var i=this.properties[r];if(!i.pointsTo){var a=i.name,s=e[a],o=this.parse(a,s);t[a]=o}}return n.defaultProperties=t,n.defaultProperties};Jt.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var bl={};bl.parse=function(n,e,t,r){var i=this;if(Pt(e))return i.parseImplWarn(n,e,t,r);var a=r==="mapping"||r===!0||r===!1||r==null?"dontcare":r,s=t?"t":"f",o=""+e,l=wp(n,o,s,a),u=i.propCache=i.propCache||[],c;return(c=u[l])||(c=u[l]=i.parseImplWarn(n,e,t,r)),(t||r==="mapping")&&(c=ir(c),c&&(c.value=ir(c.value))),c};bl.parseImplWarn=function(n,e,t,r){var i=this.parseImpl(n,e,t,r);return!i&&e!=null&&Et("The style property `".concat(n,": ").concat(e,"` is invalid")),i&&(i.name==="width"||i.name==="height")&&e==="label"&&Et("The style value of `label` is deprecated for `"+i.name+"`"),i};bl.parseImpl=function(n,e,t,r){var i=this;n=Fc(n);var a=i.properties[n],s=e,o=i.types;if(!a||e===void 0)return null;a.alias&&(a=a.pointsTo,n=a.name);var l=$e(e);l&&(e=e.trim());var u=a.type;if(!u)return null;if(t&&(e===""||e===null))return{name:n,value:e,bypass:!0,deleteBypass:!0};if(Pt(e))return{name:n,value:e,strValue:"fn",mapped:o.fn,bypass:t};var c,f;if(!(!l||r||e.length<7||e[1]!=="a")){if(e.length>=7&&e[0]==="d"&&(c=new RegExp(o.data.regex).exec(e))){if(t)return!1;var d=o.data;return{name:n,value:c,strValue:""+e,mapped:d,field:c[1],bypass:t}}else if(e.length>=10&&e[0]==="m"&&(f=new RegExp(o.mapData.regex).exec(e))){if(t||u.multiple)return!1;var h=o.mapData;if(!(u.color||u.number))return!1;var v=this.parse(n,f[4]);if(!v||v.mapped)return!1;var m=this.parse(n,f[5]);if(!m||m.mapped)return!1;if(v.pfValue===m.pfValue||v.strValue===m.strValue)return Et("`"+n+": "+e+"` is not a valid mapper because the output range is zero; converting to `"+n+": "+v.strValue+"`"),this.parse(n,v.strValue);if(u.color){var g=v.value,p=m.value,x=g[0]===p[0]&&g[1]===p[1]&&g[2]===p[2]&&(g[3]===p[3]||(g[3]==null||g[3]===1)&&(p[3]==null||p[3]===1));if(x)return!1}return{name:n,value:f,strValue:""+e,mapped:h,field:f[1],fieldMin:parseFloat(f[2]),fieldMax:parseFloat(f[3]),valueMin:v.value,valueMax:m.value,bypass:t}}}if(u.multiple&&r!=="multiple"){var y;if(l?y=e.split(/\s+/):Mt(e)?y=e:y=[e],u.evenMultiple&&y.length%2!==0)return null;for(var E=[],M=[],w=[],b="",C=!1,T=0;T<y.length;T++){var S=i.parse(n,y[T],t,"multiple");C=C||$e(S.value),E.push(S.value),w.push(S.pfValue!=null?S.pfValue:S.value),M.push(S.units),b+=(T>0?" ":"")+S.strValue}return u.validate&&!u.validate(E,M)?null:u.singleEnum&&C?E.length===1&&$e(E[0])?{name:n,value:E[0],strValue:E[0],bypass:t}:null:{name:n,value:E,pfValue:w,strValue:b,bypass:t,units:M}}var L=function(){for(var H=0;H<u.enums.length;H++){var X=u.enums[H];if(X===e)return{name:n,value:e,strValue:""+e,bypass:t}}return null};if(u.number){var N,I="px";if(u.units&&(N=u.units),u.implicitUnits&&(I=u.implicitUnits),!u.unitless)if(l){var _="px|em"+(u.allowPercent?"|\\%":"");N&&(_=N);var P=e.match("^("+Gt+")("+_+")?$");P&&(e=P[1],N=P[2]||I)}else(!N||u.implicitUnits)&&(N=I);if(e=parseFloat(e),isNaN(e)&&u.enums===void 0)return null;if(isNaN(e)&&u.enums!==void 0)return e=s,L();if(u.integer&&!nb(e)||u.min!==void 0&&(e<u.min||u.strictMin&&e===u.min)||u.max!==void 0&&(e>u.max||u.strictMax&&e===u.max))return null;var A={name:n,value:e,strValue:""+e+(N||""),units:N,bypass:t};return u.unitless||N!=="px"&&N!=="em"?A.pfValue=e:A.pfValue=N==="px"||!N?e:this.getEmSizeInPixels()*e,(N==="ms"||N==="s")&&(A.pfValue=N==="ms"?e:1e3*e),(N==="deg"||N==="rad")&&(A.pfValue=N==="rad"?e:OT(e)),N==="%"&&(A.pfValue=e/100),A}else if(u.propList){var D=[],R=""+e;if(R!=="none"){for(var B=R.split(/\s*,\s*|\s+/),k=0;k<B.length;k++){var V=B[k].trim();i.properties[V]?D.push(V):Et("`"+V+"` is not a valid property name")}if(D.length===0)return null}return{name:n,value:D,strValue:D.length===0?"none":D.join(" "),bypass:t}}else if(u.color){var Y=yp(e);return Y?{name:n,value:Y,pfValue:Y,strValue:"rgb("+Y[0]+","+Y[1]+","+Y[2]+")",bypass:t}:null}else if(u.regex||u.regexes){if(u.enums){var Z=L();if(Z)return Z}for(var W=u.regexes?u.regexes:[u.regex],K=0;K<W.length;K++){var Q=new RegExp(W[K]),ne=Q.exec(e);if(ne)return{name:n,value:u.singleRegexMatchValue?ne[1]:ne,strValue:""+e,bypass:t}}return null}else return u.string?{name:n,value:""+e,strValue:""+e,bypass:t}:u.enums?L():null};var an=function n(e){if(!(this instanceof n))return new n(e);if(!Oc(e)){Lt("A style must have a core reference");return}this._private={cy:e,coreStyle:{}},this.length=0,this.resetToDefault()},on=an.prototype;on.instanceString=function(){return"style"};on.clear=function(){for(var n=this._private,e=n.cy,t=e.elements(),r=0;r<this.length;r++)this[r]=void 0;return this.length=0,n.contextStyles={},n.propDiffs={},this.cleanElements(t,!0),t.forEach(function(i){var a=i[0]._private;a.styleDirty=!0,a.appliedInitStyle=!1}),this};on.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};on.core=function(n){return this._private.coreStyle[n]||this.getDefaultProperty(n)};on.selector=function(n){var e=n==="core"?null:new Qr(n),t=this.length++;return this[t]={selector:e,properties:[],mappedProperties:[],index:t},this};on.css=function(){var n=this,e=arguments;if(e.length===1)for(var t=e[0],r=0;r<n.properties.length;r++){var i=n.properties[r],a=t[i.name];a===void 0&&(a=t[ul(i.name)]),a!==void 0&&this.cssRule(i.name,a)}else e.length===2&&this.cssRule(e[0],e[1]);return this};on.style=on.css;on.cssRule=function(n,e){var t=this.parse(n,e);if(t){var r=this.length-1;this[r].properties.push(t),this[r].properties[t.name]=t,t.name.match(/pie-(\d+)-background-size/)&&t.value&&(this._private.hasPie=!0),t.mapped&&this[r].mappedProperties.push(t);var i=!this[r].selector;i&&(this._private.coreStyle[t.name]=t)}return this};on.append=function(n){return vp(n)?n.appendToStyle(this):Mt(n)?this.appendFromJson(n):$e(n)&&this.appendFromString(n),this};an.fromJson=function(n,e){var t=new an(n);return t.fromJson(e),t};an.fromString=function(n,e){return new an(n).fromString(e)};[ln,Bs,Zc,lr,_l,Qc,Jt,bl].forEach(function(n){Je(on,n)});an.types=on.types;an.properties=on.properties;an.propertyGroups=on.propertyGroups;an.propertyGroupNames=on.propertyGroupNames;an.propertyGroupKeys=on.propertyGroupKeys;var j1={style:function(e){if(e){var t=this.setStyle(e);t.update()}return this._private.style},setStyle:function(e){var t=this._private;return vp(e)?t.style=e.generateStyle(this):Mt(e)?t.style=an.fromJson(this,e):$e(e)?t.style=an.fromString(this,e):t.style=an(this),t.style},updateStyle:function(){this.mutableElements().updateStyle()}},eA="single",Li={autolock:function(e){if(e!==void 0)this._private.autolock=!!e;else return this._private.autolock;return this},autoungrabify:function(e){if(e!==void 0)this._private.autoungrabify=!!e;else return this._private.autoungrabify;return this},autounselectify:function(e){if(e!==void 0)this._private.autounselectify=!!e;else return this._private.autounselectify;return this},selectionType:function(e){var t=this._private;if(t.selectionType==null&&(t.selectionType=eA),e!==void 0)(e==="additive"||e==="single")&&(t.selectionType=e);else return t.selectionType;return this},panningEnabled:function(e){if(e!==void 0)this._private.panningEnabled=!!e;else return this._private.panningEnabled;return this},userPanningEnabled:function(e){if(e!==void 0)this._private.userPanningEnabled=!!e;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(e){if(e!==void 0)this._private.zoomingEnabled=!!e;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(e){if(e!==void 0)this._private.userZoomingEnabled=!!e;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(e){if(e!==void 0)this._private.boxSelectionEnabled=!!e;else return this._private.boxSelectionEnabled;return this},pan:function(){var e=arguments,t=this._private.pan,r,i,a,s,o;switch(e.length){case 0:return t;case 1:if($e(e[0]))return r=e[0],t[r];if(dt(e[0])){if(!this._private.panningEnabled)return this;a=e[0],s=a.x,o=a.y,ke(s)&&(t.x=s),ke(o)&&(t.y=o),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;r=e[0],i=e[1],(r==="x"||r==="y")&&ke(i)&&(t[r]=i),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(e,t){var r=arguments,i=this._private.pan,a,s,o,l,u;if(!this._private.panningEnabled)return this;switch(r.length){case 1:dt(e)&&(o=r[0],l=o.x,u=o.y,ke(l)&&(i.x+=l),ke(u)&&(i.y+=u),this.emit("pan viewport"));break;case 2:a=e,s=t,(a==="x"||a==="y")&&ke(s)&&(i[a]+=s),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(e,t){var r=this.getFitViewport(e,t);if(r){var i=this._private;i.zoom=r.zoom,i.pan=r.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,t){if(ke(e)&&t===void 0&&(t=e,e=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var r;if($e(e)){var i=e;e=this.$(i)}else if(ab(e)){var a=e;r={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},r.w=r.x2-r.x1,r.h=r.y2-r.y1}else An(e)||(e=this.mutableElements());if(!(An(e)&&e.empty())){r=r||e.boundingBox();var s=this.width(),o=this.height(),l;if(t=ke(t)?t:0,!isNaN(s)&&!isNaN(o)&&s>0&&o>0&&!isNaN(r.w)&&!isNaN(r.h)&&r.w>0&&r.h>0){l=Math.min((s-2*t)/r.w,(o-2*t)/r.h),l=l>this._private.maxZoom?this._private.maxZoom:l,l=l<this._private.minZoom?this._private.minZoom:l;var u={x:(s-l*(r.x1+r.x2))/2,y:(o-l*(r.y1+r.y2))/2};return{zoom:l,pan:u}}}}},zoomRange:function(e,t){var r=this._private;if(t==null){var i=e;e=i.min,t=i.max}return ke(e)&&ke(t)&&e<=t?(r.minZoom=e,r.maxZoom=t):ke(e)&&t===void 0&&e<=r.maxZoom?r.minZoom=e:ke(t)&&e===void 0&&t>=r.minZoom&&(r.maxZoom=t),this},minZoom:function(e){return e===void 0?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return e===void 0?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var t=this._private,r=t.pan,i=t.zoom,a,s,o=!1;if(t.zoomingEnabled||(o=!0),ke(e)?s=e:dt(e)&&(s=e.level,e.position!=null?a=hl(e.position,i,r):e.renderedPosition!=null&&(a=e.renderedPosition),a!=null&&!t.panningEnabled&&(o=!0)),s=s>t.maxZoom?t.maxZoom:s,s=s<t.minZoom?t.minZoom:s,o||!ke(s)||s===i||a!=null&&(!ke(a.x)||!ke(a.y)))return null;if(a!=null){var l=r,u=i,c=s,f={x:-c/u*(a.x-l.x)+a.x,y:-c/u*(a.y-l.y)+a.y};return{zoomed:!0,panned:!0,zoom:c,pan:f}}else return{zoomed:!0,panned:!1,zoom:s,pan:r}},zoom:function(e){if(e===void 0)return this._private.zoom;var t=this.getZoomedViewport(e),r=this._private;return t==null||!t.zoomed?this:(r.zoom=t.zoom,t.panned&&(r.pan.x=t.pan.x,r.pan.y=t.pan.y),this.emit("zoom"+(t.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(e){var t=this._private,r=!0,i=!0,a=[],s=!1,o=!1;if(!e)return this;if(ke(e.zoom)||(r=!1),dt(e.pan)||(i=!1),!r&&!i)return this;if(r){var l=e.zoom;l<t.minZoom||l>t.maxZoom||!t.zoomingEnabled?s=!0:(t.zoom=l,a.push("zoom"))}if(i&&(!s||!e.cancelOnFailedZoom)&&t.panningEnabled){var u=e.pan;ke(u.x)&&(t.pan.x=u.x,o=!1),ke(u.y)&&(t.pan.y=u.y,o=!1),o||a.push("pan")}return a.length>0&&(a.push("viewport"),this.emit(a.join(" ")),this.notify("viewport")),this},center:function(e){var t=this.getCenterPan(e);return t&&(this._private.pan=t,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,t){if(this._private.panningEnabled){if($e(e)){var r=e;e=this.mutableElements().filter(r)}else An(e)||(e=this.mutableElements());if(e.length!==0){var i=e.boundingBox(),a=this.width(),s=this.height();t=t===void 0?this._private.zoom:t;var o={x:(a-t*(i.x1+i.x2))/2,y:(s-t*(i.y1+i.y2))/2};return o}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e=this._private,t=e.container,r=this;return e.sizeCache=e.sizeCache||(t?function(){var i=r.window().getComputedStyle(t),a=function(o){return parseFloat(i.getPropertyValue(o))};return{width:t.clientWidth-a("padding-left")-a("padding-right"),height:t.clientHeight-a("padding-top")-a("padding-bottom")}}():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,t=this._private.zoom,r=this.renderedExtent(),i={x1:(r.x1-e.x)/t,x2:(r.x2-e.x)/t,y1:(r.y1-e.y)/t,y2:(r.y2-e.y)/t};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var e=this.width(),t=this.height();return{x1:0,y1:0,x2:e,y2:t,w:e,h:t}},multiClickDebounceTime:function(e){if(e)this._private.multiClickDebounceTime=e;else return this._private.multiClickDebounceTime;return this}};Li.centre=Li.center;Li.autolockNodes=Li.autolock;Li.autoungrabifyNodes=Li.autoungrabify;var Ms={data:xt.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:xt.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:xt.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:xt.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};Ms.attr=Ms.data;Ms.removeAttr=Ms.removeData;var ws=function(e){var t=this;e=Je({},e);var r=e.container;r&&!Ko(r)&&Ko(r[0])&&(r=r[0]);var i=r?r._cyreg:null;i=i||{},i&&i.cy&&(i.cy.destroy(),i={});var a=i.readies=i.readies||[];r&&(r._cyreg=i),i.cy=t;var s=zt!==void 0&&r!==void 0&&!e.headless,o=e;o.layout=Je({name:s?"grid":"null"},o.layout),o.renderer=Je({name:s?"canvas":"null"},o.renderer);var l=function(v,m,g){return m!==void 0?m:g!==void 0?g:v},u=this._private={container:r,ready:!1,options:o,elements:new en(this),listeners:[],aniEles:new en(this),data:o.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:l(!0,o.zoomingEnabled),userZoomingEnabled:l(!0,o.userZoomingEnabled),panningEnabled:l(!0,o.panningEnabled),userPanningEnabled:l(!0,o.userPanningEnabled),boxSelectionEnabled:l(!0,o.boxSelectionEnabled),autolock:l(!1,o.autolock,o.autolockNodes),autoungrabify:l(!1,o.autoungrabify,o.autoungrabifyNodes),autounselectify:l(!1,o.autounselectify),styleEnabled:o.styleEnabled===void 0?s:o.styleEnabled,zoom:ke(o.zoom)?o.zoom:1,pan:{x:dt(o.pan)&&ke(o.pan.x)?o.pan.x:0,y:dt(o.pan)&&ke(o.pan.y)?o.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:l(250,o.multiClickDebounceTime)};this.createEmitter(),this.selectionType(o.selectionType),this.zoomRange({min:o.minZoom,max:o.maxZoom});var c=function(v,m){var g=v.some(sb);if(g)return Ia.all(v).then(m);m(v)};u.styleEnabled&&t.setStyle([]);var f=Je({},o,o.renderer);t.initRenderer(f);var d=function(v,m,g){t.notifications(!1);var p=t.mutableElements();p.length>0&&p.remove(),v!=null&&(dt(v)||Mt(v))&&t.add(v),t.one("layoutready",function(y){t.notifications(!0),t.emit(y),t.one("load",m),t.emitAndNotify("load")}).one("layoutstop",function(){t.one("done",g),t.emit("done")});var x=Je({},t._private.options.layout);x.eles=t.elements(),t.layout(x).run()};c([o.style,o.elements],function(h){var v=h[0],m=h[1];u.styleEnabled&&t.style().append(v),d(m,function(){t.startAnimationLoop(),u.ready=!0,Pt(o.ready)&&t.on("ready",o.ready);for(var g=0;g<a.length;g++){var p=a[g];t.on("ready",p)}i&&(i.readies=[]),t.emit("ready")},o.done)})},tl=ws.prototype;Je(tl,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){var e=this;if(!e.destroyed())return e.stopAnimationLoop(),e.destroyRenderer(),this.emit("destroy"),e._private.destroyed=!0,e},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},window:function(){var e=this._private.container;if(e==null)return zt;var t=this._private.container.ownerDocument;return t===void 0||t==null?zt:t.defaultView||zt},mount:function(e){if(e!=null){var t=this,r=t._private,i=r.options;return!Ko(e)&&Ko(e[0])&&(e=e[0]),t.stopAnimationLoop(),t.destroyRenderer(),r.container=e,r.styleEnabled=!0,t.invalidateSize(),t.initRenderer(Je({},i,i.renderer,{name:i.renderer.name==="null"?"canvas":i.renderer.name})),t.startAnimationLoop(),t.style(i.style),t.emit("mount"),t}},unmount:function(){var e=this;return e.stopAnimationLoop(),e.destroyRenderer(),e.initRenderer({name:"null"}),e.emit("unmount"),e},options:function(){return ir(this._private.options)},json:function(e){var t=this,r=t._private,i=t.mutableElements(),a=function(E){return t.getElementById(E.id())};if(dt(e)){if(t.startBatch(),e.elements){var s={},o=function(E,M){for(var w=[],b=[],C=0;C<E.length;C++){var T=E[C];if(!T.data.id){Et("cy.json() cannot handle elements without an ID attribute");continue}var S=""+T.data.id,L=t.getElementById(S);s[S]=!0,L.length!==0?b.push({ele:L,json:T}):(M&&(T.group=M),w.push(T))}t.add(w);for(var N=0;N<b.length;N++){var I=b[N],_=I.ele,P=I.json;_.json(P)}};if(Mt(e.elements))o(e.elements);else for(var l=["nodes","edges"],u=0;u<l.length;u++){var c=l[u],f=e.elements[c];Mt(f)&&o(f,c)}var d=t.collection();i.filter(function(y){return!s[y.id()]}).forEach(function(y){y.isParent()?d.merge(y):y.remove()}),d.forEach(function(y){return y.children().move({parent:null})}),d.forEach(function(y){return a(y).remove()})}e.style&&t.style(e.style),e.zoom!=null&&e.zoom!==r.zoom&&t.zoom(e.zoom),e.pan&&(e.pan.x!==r.pan.x||e.pan.y!==r.pan.y)&&t.pan(e.pan),e.data&&t.data(e.data);for(var h=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],v=0;v<h.length;v++){var m=h[v];e[m]!=null&&t[m](e[m])}return t.endBatch(),this}else{var g=!!e,p={};g?p.elements=this.elements().map(function(y){return y.json()}):(p.elements={},i.forEach(function(y){var E=y.group();p.elements[E]||(p.elements[E]=[]),p.elements[E].push(y.json())})),this._private.styleEnabled&&(p.style=t.style().json()),p.data=ir(t.data());var x=r.options;return p.zoomingEnabled=r.zoomingEnabled,p.userZoomingEnabled=r.userZoomingEnabled,p.zoom=r.zoom,p.minZoom=r.minZoom,p.maxZoom=r.maxZoom,p.panningEnabled=r.panningEnabled,p.userPanningEnabled=r.userPanningEnabled,p.pan=ir(r.pan),p.boxSelectionEnabled=r.boxSelectionEnabled,p.renderer=ir(x.renderer),p.hideEdgesOnViewport=x.hideEdgesOnViewport,p.textureOnViewport=x.textureOnViewport,p.wheelSensitivity=x.wheelSensitivity,p.motionBlur=x.motionBlur,p.multiClickDebounceTime=x.multiClickDebounceTime,p}}});tl.$id=tl.getElementById;[H1,K1,mv,cc,Bo,Z1,fc,ko,j1,Li,Ms].forEach(function(n){Je(tl,n)});var tA={fit:!0,directed:!1,padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}},nA={maximal:!1,acyclic:!1},na=function(e){return e.scratch("breadthfirst")},jh=function(e,t){return e.scratch("breadthfirst",t)};function yv(n){this.options=Je({},tA,nA,n)}yv.prototype.run=function(){var n=this.options,e=n.cy,t=n.eles,r=t.nodes().filter(function(de){return de.isChildless()}),i=t,a=n.directed,s=n.acyclic||n.maximal||n.maximalAdjustments>0,o=!!n.boundingBox,l=e.extent(),u=En(o?n.boundingBox:{x1:l.x1,y1:l.y1,w:l.w,h:l.h}),c;if(An(n.roots))c=n.roots;else if(Mt(n.roots)){for(var f=[],d=0;d<n.roots.length;d++){var h=n.roots[d],v=e.getElementById(h);f.push(v)}c=e.collection(f)}else if($e(n.roots))c=e.$(n.roots);else if(a)c=r.roots();else{var m=t.components();c=e.collection();for(var g=function(we){var Me=m[we],z=Me.maxDegree(!1),O=Me.filter(function(re){return re.degree(!1)===z});c=c.add(O)},p=0;p<m.length;p++)g(p)}var x=[],y={},E=function(we,Me){x[Me]==null&&(x[Me]=[]);var z=x[Me].length;x[Me].push(we),jh(we,{index:z,depth:Me})},M=function(we,Me){var z=na(we),O=z.depth,re=z.index;x[O][re]=null,we.isChildless()&&E(we,Me)};i.bfs({roots:c,directed:n.directed,visit:function(we,Me,z,O,re){var ve=we[0],Ee=ve.id();ve.isChildless()&&E(ve,re),y[Ee]=!0}});for(var w=[],b=0;b<r.length;b++){var C=r[b];y[C.id()]||w.push(C)}var T=function(we){for(var Me=x[we],z=0;z<Me.length;z++){var O=Me[z];if(O==null){Me.splice(z,1),z--;continue}jh(O,{depth:we,index:z})}},S=function(we,Me){for(var z=na(we),O=we.incomers().filter(function(ce){return ce.isNode()&&t.has(ce)}),re=-1,ve=we.id(),Ee=0;Ee<O.length;Ee++){var ae=O[Ee],F=na(ae);re=Math.max(re,F.depth)}if(z.depth<=re){if(!n.acyclic&&Me[ve])return null;var j=re+1;return M(we,j),Me[ve]=j,!0}return!1};if(a&&s){var L=[],N={},I=function(we){return L.push(we)},_=function(){return L.shift()};for(r.forEach(function(de){return L.push(de)});L.length>0;){var P=_(),A=S(P,N);if(A)P.outgoers().filter(function(de){return de.isNode()&&t.has(de)}).forEach(I);else if(A===null){Et("Detected double maximal shift for node `"+P.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var D=0;if(n.avoidOverlap)for(var R=0;R<r.length;R++){var B=r[R],k=B.layoutDimensions(n),V=k.w,Y=k.h;D=Math.max(D,V,Y)}var Z={},W=function(we){if(Z[we.id()])return Z[we.id()];for(var Me=na(we).depth,z=we.neighborhood(),O=0,re=0,ve=0;ve<z.length;ve++){var Ee=z[ve];if(!(Ee.isEdge()||Ee.isParent()||!r.has(Ee))){var ae=na(Ee);if(ae!=null){var F=ae.index,j=ae.depth;if(!(F==null||j==null)){var ce=x[j].length;j<Me&&(O+=F/ce,re++)}}}}return re=Math.max(1,re),O=O/re,re===0&&(O=0),Z[we.id()]=O,O},K=function(we,Me){var z=W(we),O=W(Me),re=z-O;return re===0?mp(we.id(),Me.id()):re};n.depthSort!==void 0&&(K=n.depthSort);for(var Q=x.length,ne=0;ne<Q;ne++)x[ne].sort(K),T(ne);for(var ie=[],H=0;H<w.length;H++)ie.push(w[H]);var X=function(){for(var we=0;we<Q;we++)T(we)};ie.length&&(x.unshift(ie),Q=x.length,X());for(var te=0,ue=0;ue<Q;ue++)te=Math.max(x[ue].length,te);var Se={x:u.x1+u.w/2,y:u.y1+u.h/2},U=r.reduce(function(de,we){return function(Me){return{w:de.w===-1?Me.w:(de.w+Me.w)/2,h:de.h===-1?Me.h:(de.h+Me.h)/2}}(we.boundingBox({includeLabels:n.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),Ge=Math.max(Q===1?0:o?(u.h-n.padding*2-U.h)/(Q-1):(u.h-n.padding*2-U.h)/(Q+1),D),Le=x.reduce(function(de,we){return Math.max(de,we.length)},0),De=function(we){var Me=na(we),z=Me.depth,O=Me.index;if(n.circle){var re=Math.min(u.w/2/Q,u.h/2/Q);re=Math.max(re,D);var ve=re*z+re-(Q>0&&x[0].length<=3?re/2:0),Ee=2*Math.PI/x[z].length*O;return z===0&&x[0].length===1&&(ve=1),{x:Se.x+ve*Math.cos(Ee),y:Se.y+ve*Math.sin(Ee)}}else{var ae=x[z].length,F=Math.max(ae===1?0:o?(u.w-n.padding*2-U.w)/((n.grid?Le:ae)-1):(u.w-n.padding*2-U.w)/((n.grid?Le:ae)+1),D),j={x:Se.x+(O+1-(ae+1)/2)*F,y:Se.y+(z+1-(Q+1)/2)*Ge};return j}};return t.nodes().layoutPositions(this,n,De),this};var rA={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function xv(n){this.options=Je({},rA,n)}xv.prototype.run=function(){var n=this.options,e=n,t=n.cy,r=e.eles,i=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,a=r.nodes().not(":parent");e.sort&&(a=a.sort(e.sort));for(var s=En(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=e.sweep===void 0?2*Math.PI-2*Math.PI/a.length:e.sweep,u=l/Math.max(1,a.length-1),c,f=0,d=0;d<a.length;d++){var h=a[d],v=h.layoutDimensions(e),m=v.w,g=v.h;f=Math.max(f,m,g)}if(ke(e.radius)?c=e.radius:a.length<=1?c=0:c=Math.min(s.h,s.w)/2-f,a.length>1&&e.avoidOverlap){f*=1.75;var p=Math.cos(u)-Math.cos(0),x=Math.sin(u)-Math.sin(0),y=Math.sqrt(f*f/(p*p+x*x));c=Math.max(y,c)}var E=function(w,b){var C=e.startAngle+b*u*(i?1:-1),T=c*Math.cos(C),S=c*Math.sin(C),L={x:o.x+T,y:o.y+S};return L};return r.nodes().layoutPositions(this,e,E),this};var iA={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function Ev(n){this.options=Je({},iA,n)}Ev.prototype.run=function(){for(var n=this.options,e=n,t=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,r=n.cy,i=e.eles,a=i.nodes().not(":parent"),s=En(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:r.width(),h:r.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=[],u=0,c=0;c<a.length;c++){var f=a[c],d=void 0;d=e.concentric(f),l.push({value:d,node:f}),f._private.scratch.concentric=d}a.updateStyle();for(var h=0;h<a.length;h++){var v=a[h],m=v.layoutDimensions(e);u=Math.max(u,m.w,m.h)}l.sort(function(U,Ge){return Ge.value-U.value});for(var g=e.levelWidth(a),p=[[]],x=p[0],y=0;y<l.length;y++){var E=l[y];if(x.length>0){var M=Math.abs(x[0].value-E.value);M>=g&&(x=[],p.push(x))}x.push(E)}var w=u+e.minNodeSpacing;if(!e.avoidOverlap){var b=p.length>0&&p[0].length>1,C=Math.min(s.w,s.h)/2-w,T=C/(p.length+b?1:0);w=Math.min(w,T)}for(var S=0,L=0;L<p.length;L++){var N=p[L],I=e.sweep===void 0?2*Math.PI-2*Math.PI/N.length:e.sweep,_=N.dTheta=I/Math.max(1,N.length-1);if(N.length>1&&e.avoidOverlap){var P=Math.cos(_)-Math.cos(0),A=Math.sin(_)-Math.sin(0),D=Math.sqrt(w*w/(P*P+A*A));S=Math.max(D,S)}N.r=S,S+=w}if(e.equidistant){for(var R=0,B=0,k=0;k<p.length;k++){var V=p[k],Y=V.r-B;R=Math.max(R,Y)}B=0;for(var Z=0;Z<p.length;Z++){var W=p[Z];Z===0&&(B=W.r),W.r=B,B+=R}}for(var K={},Q=0;Q<p.length;Q++)for(var ne=p[Q],ie=ne.dTheta,H=ne.r,X=0;X<ne.length;X++){var te=ne[X],ue=e.startAngle+(t?1:-1)*ie*X,Se={x:o.x+H*Math.cos(ue),y:o.y+H*Math.sin(ue)};K[te.node.id()]=Se}return i.nodes().layoutPositions(this,e,function(U){var Ge=U.id();return K[Ge]}),this};var fu,aA={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,t){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function Tl(n){this.options=Je({},aA,n),this.options.layout=this;var e=this.options.eles.nodes(),t=this.options.eles.edges(),r=t.filter(function(i){var a=i.source().data("id"),s=i.target().data("id"),o=e.some(function(u){return u.data("id")===a}),l=e.some(function(u){return u.data("id")===s});return!o||!l});this.options.eles=this.options.eles.not(r)}Tl.prototype.run=function(){var n=this.options,e=n.cy,t=this;t.stopped=!1,(n.animate===!0||n.animate===!1)&&t.emit({type:"layoutstart",layout:t}),n.debug===!0?fu=!0:fu=!1;var r=sA(e,t,n);fu&&uA(r),n.randomize&&cA(r);var i=Sr(),a=function(){fA(r,e,n),n.fit===!0&&e.fit(n.padding)},s=function(d){return!(t.stopped||d>=n.numIter||(hA(r,n),r.temperature=r.temperature*n.coolingFactor,r.temperature<n.minTemp))},o=function(){if(n.animate===!0||n.animate===!1)a(),t.one("layoutstop",n.stop),t.emit({type:"layoutstop",layout:t});else{var d=n.eles.nodes(),h=_v(r,n,d);d.layoutPositions(t,n,h)}},l=0,u=!0;if(n.animate===!0){var c=function f(){for(var d=0;u&&d<n.refresh;)u=s(l),l++,d++;if(!u)td(r,n),o();else{var h=Sr();h-i>=n.animationThreshold&&a(),$o(f)}};c()}else{for(;u;)u=s(l),l++;td(r,n),o()}return this};Tl.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};Tl.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var sA=function(e,t,r){for(var i=r.eles.edges(),a=r.eles.nodes(),s=En(r.boundingBox?r.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),o={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:a.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:r.initialTemp,clientWidth:s.w,clientHeight:s.h,boundingBox:s},l=r.eles.components(),u={},c=0;c<l.length;c++)for(var f=l[c],d=0;d<f.length;d++){var h=f[d];u[h.id()]=c}for(var c=0;c<o.nodeSize;c++){var v=a[c],m=v.layoutDimensions(r),g={};g.isLocked=v.locked(),g.id=v.data("id"),g.parentId=v.data("parent"),g.cmptId=u[v.id()],g.children=[],g.positionX=v.position("x"),g.positionY=v.position("y"),g.offsetX=0,g.offsetY=0,g.height=m.w,g.width=m.h,g.maxX=g.positionX+g.width/2,g.minX=g.positionX-g.width/2,g.maxY=g.positionY+g.height/2,g.minY=g.positionY-g.height/2,g.padLeft=parseFloat(v.style("padding")),g.padRight=parseFloat(v.style("padding")),g.padTop=parseFloat(v.style("padding")),g.padBottom=parseFloat(v.style("padding")),g.nodeRepulsion=Pt(r.nodeRepulsion)?r.nodeRepulsion(v):r.nodeRepulsion,o.layoutNodes.push(g),o.idToIndex[g.id]=c}for(var p=[],x=0,y=-1,E=[],c=0;c<o.nodeSize;c++){var v=o.layoutNodes[c],M=v.parentId;M!=null?o.layoutNodes[o.idToIndex[M]].children.push(v.id):(p[++y]=v.id,E.push(v.id))}for(o.graphSet.push(E);x<=y;){var w=p[x++],b=o.idToIndex[w],h=o.layoutNodes[b],C=h.children;if(C.length>0){o.graphSet.push(C);for(var c=0;c<C.length;c++)p[++y]=C[c]}}for(var c=0;c<o.graphSet.length;c++)for(var T=o.graphSet[c],d=0;d<T.length;d++){var S=o.idToIndex[T[d]];o.indexToGraph[S]=c}for(var c=0;c<o.edgeSize;c++){var L=i[c],N={};N.id=L.data("id"),N.sourceId=L.data("source"),N.targetId=L.data("target");var I=Pt(r.idealEdgeLength)?r.idealEdgeLength(L):r.idealEdgeLength,_=Pt(r.edgeElasticity)?r.edgeElasticity(L):r.edgeElasticity,P=o.idToIndex[N.sourceId],A=o.idToIndex[N.targetId],D=o.indexToGraph[P],R=o.indexToGraph[A];if(D!=R){for(var B=oA(N.sourceId,N.targetId,o),k=o.graphSet[B],V=0,g=o.layoutNodes[P];k.indexOf(g.id)===-1;)g=o.layoutNodes[o.idToIndex[g.parentId]],V++;for(g=o.layoutNodes[A];k.indexOf(g.id)===-1;)g=o.layoutNodes[o.idToIndex[g.parentId]],V++;I*=V*r.nestingFactor}N.idealLength=I,N.elasticity=_,o.layoutEdges.push(N)}return o},oA=function(e,t,r){var i=lA(e,t,0,r);return 2>i.count?0:i.graph},lA=function n(e,t,r,i){var a=i.graphSet[r];if(-1<a.indexOf(e)&&-1<a.indexOf(t))return{count:2,graph:r};for(var s=0,o=0;o<a.length;o++){var l=a[o],u=i.idToIndex[l],c=i.layoutNodes[u].children;if(c.length!==0){var f=i.indexToGraph[i.idToIndex[c[0]]],d=n(e,t,f,i);if(d.count!==0)if(d.count===1){if(s++,s===2)break}else return d}}return{count:s,graph:r}},uA,cA=function(e,t){for(var r=e.clientWidth,i=e.clientHeight,a=0;a<e.nodeSize;a++){var s=e.layoutNodes[a];s.children.length===0&&!s.isLocked&&(s.positionX=Math.random()*r,s.positionY=Math.random()*i)}},_v=function(e,t,r){var i=e.boundingBox,a={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return t.boundingBox&&(r.forEach(function(s){var o=e.layoutNodes[e.idToIndex[s.data("id")]];a.x1=Math.min(a.x1,o.positionX),a.x2=Math.max(a.x2,o.positionX),a.y1=Math.min(a.y1,o.positionY),a.y2=Math.max(a.y2,o.positionY)}),a.w=a.x2-a.x1,a.h=a.y2-a.y1),function(s,o){var l=e.layoutNodes[e.idToIndex[s.data("id")]];if(t.boundingBox){var u=(l.positionX-a.x1)/a.w,c=(l.positionY-a.y1)/a.h;return{x:i.x1+u*i.w,y:i.y1+c*i.h}}else return{x:l.positionX,y:l.positionY}}},fA=function(e,t,r){var i=r.layout,a=r.eles.nodes(),s=_v(e,r,a);a.positions(s),e.ready!==!0&&(e.ready=!0,i.one("layoutready",r.ready),i.emit({type:"layoutready",layout:this}))},hA=function(e,t,r){dA(e,t),gA(e),mA(e,t),yA(e),xA(e)},dA=function(e,t){for(var r=0;r<e.graphSet.length;r++)for(var i=e.graphSet[r],a=i.length,s=0;s<a;s++)for(var o=e.layoutNodes[e.idToIndex[i[s]]],l=s+1;l<a;l++){var u=e.layoutNodes[e.idToIndex[i[l]]];pA(o,u,e,t)}},ed=function(e){return-1+2*e*Math.random()},pA=function(e,t,r,i){var a=e.cmptId,s=t.cmptId;if(!(a!==s&&!r.isCompound)){var o=t.positionX-e.positionX,l=t.positionY-e.positionY,u=1;o===0&&l===0&&(o=ed(u),l=ed(u));var c=vA(e,t,o,l);if(c>0)var f=i.nodeOverlap*c,d=Math.sqrt(o*o+l*l),h=f*o/d,v=f*l/d;else var m=nl(e,o,l),g=nl(t,-1*o,-1*l),p=g.x-m.x,x=g.y-m.y,y=p*p+x*x,d=Math.sqrt(y),f=(e.nodeRepulsion+t.nodeRepulsion)/y,h=f*p/d,v=f*x/d;e.isLocked||(e.offsetX-=h,e.offsetY-=v),t.isLocked||(t.offsetX+=h,t.offsetY+=v)}},vA=function(e,t,r,i){if(r>0)var a=e.maxX-t.minX;else var a=t.maxX-e.minX;if(i>0)var s=e.maxY-t.minY;else var s=t.maxY-e.minY;return a>=0&&s>=0?Math.sqrt(a*a+s*s):0},nl=function(e,t,r){var i=e.positionX,a=e.positionY,s=e.height||1,o=e.width||1,l=r/t,u=s/o,c={};return t===0&&0<r||t===0&&0>r?(c.x=i,c.y=a+s/2,c):0<t&&-1*u<=l&&l<=u?(c.x=i+o/2,c.y=a+o*r/2/t,c):0>t&&-1*u<=l&&l<=u?(c.x=i-o/2,c.y=a-o*r/2/t,c):0<r&&(l<=-1*u||l>=u)?(c.x=i+s*t/2/r,c.y=a+s/2,c):(0>r&&(l<=-1*u||l>=u)&&(c.x=i-s*t/2/r,c.y=a-s/2),c)},gA=function(e,t){for(var r=0;r<e.edgeSize;r++){var i=e.layoutEdges[r],a=e.idToIndex[i.sourceId],s=e.layoutNodes[a],o=e.idToIndex[i.targetId],l=e.layoutNodes[o],u=l.positionX-s.positionX,c=l.positionY-s.positionY;if(!(u===0&&c===0)){var f=nl(s,u,c),d=nl(l,-1*u,-1*c),h=d.x-f.x,v=d.y-f.y,m=Math.sqrt(h*h+v*v),g=Math.pow(i.idealLength-m,2)/i.elasticity;if(m!==0)var p=g*h/m,x=g*v/m;else var p=0,x=0;s.isLocked||(s.offsetX+=p,s.offsetY+=x),l.isLocked||(l.offsetX-=p,l.offsetY-=x)}}},mA=function(e,t){if(t.gravity!==0)for(var r=1,i=0;i<e.graphSet.length;i++){var a=e.graphSet[i],s=a.length;if(i===0)var o=e.clientHeight/2,l=e.clientWidth/2;else var u=e.layoutNodes[e.idToIndex[a[0]]],c=e.layoutNodes[e.idToIndex[u.parentId]],o=c.positionX,l=c.positionY;for(var f=0;f<s;f++){var d=e.layoutNodes[e.idToIndex[a[f]]];if(!d.isLocked){var h=o-d.positionX,v=l-d.positionY,m=Math.sqrt(h*h+v*v);if(m>r){var g=t.gravity*h/m,p=t.gravity*v/m;d.offsetX+=g,d.offsetY+=p}}}}},yA=function(e,t){var r=[],i=0,a=-1;for(r.push.apply(r,e.graphSet[0]),a+=e.graphSet[0].length;i<=a;){var s=r[i++],o=e.idToIndex[s],l=e.layoutNodes[o],u=l.children;if(0<u.length&&!l.isLocked){for(var c=l.offsetX,f=l.offsetY,d=0;d<u.length;d++){var h=e.layoutNodes[e.idToIndex[u[d]]];h.offsetX+=c,h.offsetY+=f,r[++a]=u[d]}l.offsetX=0,l.offsetY=0}}},xA=function(e,t){for(var r=0;r<e.nodeSize;r++){var i=e.layoutNodes[r];0<i.children.length&&(i.maxX=void 0,i.minX=void 0,i.maxY=void 0,i.minY=void 0)}for(var r=0;r<e.nodeSize;r++){var i=e.layoutNodes[r];if(!(0<i.children.length||i.isLocked)){var a=EA(i.offsetX,i.offsetY,e.temperature);i.positionX+=a.x,i.positionY+=a.y,i.offsetX=0,i.offsetY=0,i.minX=i.positionX-i.width,i.maxX=i.positionX+i.width,i.minY=i.positionY-i.height,i.maxY=i.positionY+i.height,_A(i,e)}}for(var r=0;r<e.nodeSize;r++){var i=e.layoutNodes[r];0<i.children.length&&!i.isLocked&&(i.positionX=(i.maxX+i.minX)/2,i.positionY=(i.maxY+i.minY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY)}},EA=function(e,t,r){var i=Math.sqrt(e*e+t*t);if(i>r)var a={x:r*e/i,y:r*t/i};else var a={x:e,y:t};return a},_A=function n(e,t){var r=e.parentId;if(r!=null){var i=t.layoutNodes[t.idToIndex[r]],a=!1;if((i.maxX==null||e.maxX+i.padRight>i.maxX)&&(i.maxX=e.maxX+i.padRight,a=!0),(i.minX==null||e.minX-i.padLeft<i.minX)&&(i.minX=e.minX-i.padLeft,a=!0),(i.maxY==null||e.maxY+i.padBottom>i.maxY)&&(i.maxY=e.maxY+i.padBottom,a=!0),(i.minY==null||e.minY-i.padTop<i.minY)&&(i.minY=e.minY-i.padTop,a=!0),a)return n(i,t)}},td=function(e,t){for(var r=e.layoutNodes,i=[],a=0;a<r.length;a++){var s=r[a],o=s.cmptId,l=i[o]=i[o]||[];l.push(s)}for(var u=0,a=0;a<i.length;a++){var c=i[a];if(c){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var f=0;f<c.length;f++){var d=c[f];c.x1=Math.min(c.x1,d.positionX-d.width/2),c.x2=Math.max(c.x2,d.positionX+d.width/2),c.y1=Math.min(c.y1,d.positionY-d.height/2),c.y2=Math.max(c.y2,d.positionY+d.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,u+=c.w*c.h}}i.sort(function(x,y){return y.w*y.h-x.w*x.h});for(var h=0,v=0,m=0,g=0,p=Math.sqrt(u)*e.clientWidth/e.clientHeight,a=0;a<i.length;a++){var c=i[a];if(c){for(var f=0;f<c.length;f++){var d=c[f];d.isLocked||(d.positionX+=h-c.x1,d.positionY+=v-c.y1)}h+=c.w+t.componentSpacing,m+=c.w+t.componentSpacing,g=Math.max(g,c.h),m>p&&(v+=g+t.componentSpacing,h=0,m=0,g=0)}}},bA={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function bv(n){this.options=Je({},bA,n)}bv.prototype.run=function(){var n=this.options,e=n,t=n.cy,r=e.eles,i=r.nodes().not(":parent");e.sort&&(i=i.sort(e.sort));var a=En(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()});if(a.h===0||a.w===0)r.nodes().layoutPositions(this,e,function(Z){return{x:a.x1,y:a.y1}});else{var s=i.size(),o=Math.sqrt(s*a.h/a.w),l=Math.round(o),u=Math.round(a.w/a.h*o),c=function(W){if(W==null)return Math.min(l,u);var K=Math.min(l,u);K==l?l=W:u=W},f=function(W){if(W==null)return Math.max(l,u);var K=Math.max(l,u);K==l?l=W:u=W},d=e.rows,h=e.cols!=null?e.cols:e.columns;if(d!=null&&h!=null)l=d,u=h;else if(d!=null&&h==null)l=d,u=Math.ceil(s/l);else if(d==null&&h!=null)u=h,l=Math.ceil(s/u);else if(u*l>s){var v=c(),m=f();(v-1)*m>=s?c(v-1):(m-1)*v>=s&&f(m-1)}else for(;u*l<s;){var g=c(),p=f();(p+1)*g>=s?f(p+1):c(g+1)}var x=a.w/u,y=a.h/l;if(e.condense&&(x=0,y=0),e.avoidOverlap)for(var E=0;E<i.length;E++){var M=i[E],w=M._private.position;(w.x==null||w.y==null)&&(w.x=0,w.y=0);var b=M.layoutDimensions(e),C=e.avoidOverlapPadding,T=b.w+C,S=b.h+C;x=Math.max(x,T),y=Math.max(y,S)}for(var L={},N=function(W,K){return!!L["c-"+W+"-"+K]},I=function(W,K){L["c-"+W+"-"+K]=!0},_=0,P=0,A=function(){P++,P>=u&&(P=0,_++)},D={},R=0;R<i.length;R++){var B=i[R],k=e.position(B);if(k&&(k.row!==void 0||k.col!==void 0)){var V={row:k.row,col:k.col};if(V.col===void 0)for(V.col=0;N(V.row,V.col);)V.col++;else if(V.row===void 0)for(V.row=0;N(V.row,V.col);)V.row++;D[B.id()]=V,I(V.row,V.col)}}var Y=function(W,K){var Q,ne;if(W.locked()||W.isParent())return!1;var ie=D[W.id()];if(ie)Q=ie.col*x+x/2+a.x1,ne=ie.row*y+y/2+a.y1;else{for(;N(_,P);)A();Q=P*x+x/2+a.x1,ne=_*y+y/2+a.y1,I(_,P),A()}return{x:Q,y:ne}};i.layoutPositions(this,e,Y)}return this};var TA={ready:function(){},stop:function(){}};function Jc(n){this.options=Je({},TA,n)}Jc.prototype.run=function(){var n=this.options,e=n.eles,t=this;return n.cy,t.emit("layoutstart"),e.nodes().positions(function(){return{x:0,y:0}}),t.one("layoutready",n.ready),t.emit("layoutready"),t.one("layoutstop",n.stop),t.emit("layoutstop"),this};Jc.prototype.stop=function(){return this};var SA={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function Tv(n){this.options=Je({},SA,n)}Tv.prototype.run=function(){var n=this.options,e=n.eles,t=e.nodes(),r=Pt(n.positions);function i(a){if(n.positions==null)return DT(a.position());if(r)return n.positions(a);var s=n.positions[a._private.data.id];return s??null}return t.layoutPositions(this,n,function(a,s){var o=i(a);return a.locked()||o==null?!1:o}),this};var MA={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function Sv(n){this.options=Je({},MA,n)}Sv.prototype.run=function(){var n=this.options,e=n.cy,t=n.eles,r=En(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),i=function(s,o){return{x:r.x1+Math.round(Math.random()*r.w),y:r.y1+Math.round(Math.random()*r.h)}};return t.nodes().layoutPositions(this,n,i),this};var wA=[{name:"breadthfirst",impl:yv},{name:"circle",impl:xv},{name:"concentric",impl:Ev},{name:"cose",impl:Tl},{name:"grid",impl:bv},{name:"null",impl:Jc},{name:"preset",impl:Tv},{name:"random",impl:Sv}];function Mv(n){this.options=n,this.notifications=0}var nd=function(){},rd=function(){throw new Error("A headless instance can not render images")};Mv.prototype={recalculateRenderedStyle:nd,notify:function(){this.notifications++},init:nd,isHeadless:function(){return!0},png:rd,jpg:rd};var jc={};jc.arrowShapeWidth=.3;jc.registerArrowShapes=function(){var n=this.arrowShapes={},e=this,t=function(u,c,f,d,h,v,m){var g=h.x-f/2-m,p=h.x+f/2+m,x=h.y-f/2-m,y=h.y+f/2+m,E=g<=u&&u<=p&&x<=c&&c<=y;return E},r=function(u,c,f,d,h){var v=u*Math.cos(d)-c*Math.sin(d),m=u*Math.sin(d)+c*Math.cos(d),g=v*f,p=m*f,x=g+h.x,y=p+h.y;return{x,y}},i=function(u,c,f,d){for(var h=[],v=0;v<u.length;v+=2){var m=u[v],g=u[v+1];h.push(r(m,g,c,f,d))}return h},a=function(u){for(var c=[],f=0;f<u.length;f++){var d=u[f];c.push(d.x,d.y)}return c},s=function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").pfValue*2},o=function(u,c){$e(c)&&(c=n[c]),n[u]=Je({name:u,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(d,h,v,m,g,p){var x=a(i(this.points,v+2*p,m,g)),y=yn(d,h,x);return y},roughCollide:t,draw:function(d,h,v,m){var g=i(this.points,h,v,m);e.arrowShapeImpl("polygon")(d,g)},spacing:function(d){return 0},gap:s},c)};o("none",{collide:Zo,roughCollide:Zo,draw:Bc,spacing:dh,gap:dh}),o("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),o("arrow","triangle"),o("triangle-backcurve",{points:n.triangle.points,controlPoint:[0,-.15],roughCollide:t,draw:function(u,c,f,d,h){var v=i(this.points,c,f,d),m=this.controlPoint,g=r(m[0],m[1],c,f,d);e.arrowShapeImpl(this.name)(u,v,g)},gap:function(u){return s(u)*.8}}),o("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(u,c,f,d,h,v,m){var g=a(i(this.points,f+2*m,d,h)),p=a(i(this.pointsTee,f+2*m,d,h)),x=yn(u,c,g)||yn(u,c,p);return x},draw:function(u,c,f,d,h){var v=i(this.points,c,f,d),m=i(this.pointsTee,c,f,d);e.arrowShapeImpl(this.name)(u,v,m)}}),o("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(u,c,f,d,h,v,m){var g=h,p=Math.pow(g.x-u,2)+Math.pow(g.y-c,2)<=Math.pow((f+2*m)*this.radius,2),x=a(i(this.points,f+2*m,d,h));return yn(u,c,x)||p},draw:function(u,c,f,d,h){var v=i(this.pointsTr,c,f,d);e.arrowShapeImpl(this.name)(u,v,d.x,d.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(u,c){var f=this.baseCrossLinePts.slice(),d=c/u,h=3,v=5;return f[h]=f[h]-d,f[v]=f[v]-d,f},collide:function(u,c,f,d,h,v,m){var g=a(i(this.points,f+2*m,d,h)),p=a(i(this.crossLinePts(f,v),f+2*m,d,h)),x=yn(u,c,g)||yn(u,c,p);return x},draw:function(u,c,f,d,h){var v=i(this.points,c,f,d),m=i(this.crossLinePts(c,h),c,f,d);e.arrowShapeImpl(this.name)(u,v,m)}}),o("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(u){return s(u)*.525}}),o("circle",{radius:.15,collide:function(u,c,f,d,h,v,m){var g=h,p=Math.pow(g.x-u,2)+Math.pow(g.y-c,2)<=Math.pow((f+2*m)*this.radius,2);return p},draw:function(u,c,f,d,h){e.arrowShapeImpl(this.name)(u,d.x,d.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(u){return 1},gap:function(u){return 1}}),o("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),o("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}}),o("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(u){return .95*u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}})};var Oi={};Oi.projectIntoViewport=function(n,e){var t=this.cy,r=this.findContainerClientCoords(),i=r[0],a=r[1],s=r[4],o=t.pan(),l=t.zoom(),u=((n-i)/s-o.x)/l,c=((e-a)/s-o.y)/l;return[u,c]};Oi.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var n=this.container,e=n.getBoundingClientRect(),t=this.cy.window().getComputedStyle(n),r=function(p){return parseFloat(t.getPropertyValue(p))},i={left:r("padding-left"),right:r("padding-right"),top:r("padding-top"),bottom:r("padding-bottom")},a={left:r("border-left-width"),right:r("border-right-width"),top:r("border-top-width"),bottom:r("border-bottom-width")},s=n.clientWidth,o=n.clientHeight,l=i.left+i.right,u=i.top+i.bottom,c=a.left+a.right,f=e.width/(s+c),d=s-l,h=o-u,v=e.left+i.left+a.left,m=e.top+i.top+a.top;return this.containerBB=[v,m,d,h,f]};Oi.invalidateContainerClientCoordsCache=function(){this.containerBB=null};Oi.findNearestElement=function(n,e,t,r){return this.findNearestElements(n,e,t,r)[0]};Oi.findNearestElements=function(n,e,t,r){var i=this,a=this,s=a.getCachedZSortedEles(),o=[],l=a.cy.zoom(),u=a.cy.hasCompoundNodes(),c=(r?24:8)/l,f=(r?8:2)/l,d=(r?8:2)/l,h=1/0,v,m;t&&(s=s.interactive);function g(b,C){if(b.isNode()){if(m)return;m=b,o.push(b)}if(b.isEdge()&&(C==null||C<h))if(v){if(v.pstyle("z-compound-depth").value===b.pstyle("z-compound-depth").value&&v.pstyle("z-compound-depth").value===b.pstyle("z-compound-depth").value){for(var T=0;T<o.length;T++)if(o[T].isEdge()){o[T]=b,v=b,h=C??h;break}}}else o.push(b),v=b,h=C??h}function p(b){var C=b.outerWidth()+2*f,T=b.outerHeight()+2*f,S=C/2,L=T/2,N=b.position(),I=b.pstyle("corner-radius").value==="auto"?"auto":b.pstyle("corner-radius").pfValue,_=b._private.rscratch;if(N.x-S<=n&&n<=N.x+S&&N.y-L<=e&&e<=N.y+L){var P=a.nodeShapes[i.getNodeShape(b)];if(P.checkPoint(n,e,0,C,T,N.x,N.y,I,_))return g(b,0),!0}}function x(b){var C=b._private,T=C.rscratch,S=b.pstyle("width").pfValue,L=b.pstyle("arrow-scale").value,N=S/2+c,I=N*N,_=N*2,R=C.source,B=C.target,P;if(T.edgeType==="segments"||T.edgeType==="straight"||T.edgeType==="haystack"){for(var A=T.allpts,D=0;D+3<A.length;D+=2)if(HT(n,e,A[D],A[D+1],A[D+2],A[D+3],_)&&I>(P=KT(n,e,A[D],A[D+1],A[D+2],A[D+3])))return g(b,P),!0}else if(T.edgeType==="bezier"||T.edgeType==="multibezier"||T.edgeType==="self"||T.edgeType==="compound"){for(var A=T.allpts,D=0;D+5<T.allpts.length;D+=4)if(WT(n,e,A[D],A[D+1],A[D+2],A[D+3],A[D+4],A[D+5],_)&&I>(P=qT(n,e,A[D],A[D+1],A[D+2],A[D+3],A[D+4],A[D+5])))return g(b,P),!0}for(var R=R||C.source,B=B||C.target,k=i.getArrowWidth(S,L),V=[{name:"source",x:T.arrowStartX,y:T.arrowStartY,angle:T.srcArrowAngle},{name:"target",x:T.arrowEndX,y:T.arrowEndY,angle:T.tgtArrowAngle},{name:"mid-source",x:T.midX,y:T.midY,angle:T.midsrcArrowAngle},{name:"mid-target",x:T.midX,y:T.midY,angle:T.midtgtArrowAngle}],D=0;D<V.length;D++){var Y=V[D],Z=a.arrowShapes[b.pstyle(Y.name+"-arrow-shape").value],W=b.pstyle("width").pfValue;if(Z.roughCollide(n,e,k,Y.angle,{x:Y.x,y:Y.y},W,c)&&Z.collide(n,e,k,Y.angle,{x:Y.x,y:Y.y},W,c))return g(b),!0}u&&o.length>0&&(p(R),p(B))}function y(b,C,T){return Hn(b,C,T)}function E(b,C){var T=b._private,S=d,L;C?L=C+"-":L="",b.boundingBox();var N=T.labelBounds[C||"main"],I=b.pstyle(L+"label").value,_=b.pstyle("text-events").strValue==="yes";if(!(!_||!I)){var P=y(T.rscratch,"labelX",C),A=y(T.rscratch,"labelY",C),D=y(T.rscratch,"labelAngle",C),R=b.pstyle(L+"text-margin-x").pfValue,B=b.pstyle(L+"text-margin-y").pfValue,k=N.x1-S-R,V=N.x2+S-R,Y=N.y1-S-B,Z=N.y2+S-B;if(D){var W=Math.cos(D),K=Math.sin(D),Q=function(Se,U){return Se=Se-P,U=U-A,{x:Se*W-U*K+P,y:Se*K+U*W+A}},ne=Q(k,Y),ie=Q(k,Z),H=Q(V,Y),X=Q(V,Z),te=[ne.x+R,ne.y+B,H.x+R,H.y+B,X.x+R,X.y+B,ie.x+R,ie.y+B];if(yn(n,e,te))return g(b),!0}else if(Ca(N,n,e))return g(b),!0}}for(var M=s.length-1;M>=0;M--){var w=s[M];w.isNode()?p(w)||E(w):x(w)||E(w)||E(w,"source")||E(w,"target")}return o};Oi.getAllInBox=function(n,e,t,r){var i=this.getCachedZSortedEles().interactive,a=[],s=Math.min(n,t),o=Math.max(n,t),l=Math.min(e,r),u=Math.max(e,r);n=s,t=o,e=l,r=u;for(var c=En({x1:n,y1:e,x2:t,y2:r}),f=0;f<i.length;f++){var d=i[f];if(d.isNode()){var h=d,v=h.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:!1});Gc(c,v)&&!Ip(v,c)&&a.push(h)}else{var m=d,g=m._private,p=g.rscratch;if(p.startX!=null&&p.startY!=null&&!Ca(c,p.startX,p.startY)||p.endX!=null&&p.endY!=null&&!Ca(c,p.endX,p.endY))continue;if(p.edgeType==="bezier"||p.edgeType==="multibezier"||p.edgeType==="self"||p.edgeType==="compound"||p.edgeType==="segments"||p.edgeType==="haystack"){for(var x=g.rstyle.bezierPts||g.rstyle.linePts||g.rstyle.haystackPts,y=!0,E=0;E<x.length;E++)if(!VT(c,x[E])){y=!1;break}y&&a.push(m)}else(p.edgeType==="haystack"||p.edgeType==="straight")&&a.push(m)}}return a};var rl={};rl.calculateArrowAngles=function(n){var e=n._private.rscratch,t=e.edgeType==="haystack",r=e.edgeType==="bezier",i=e.edgeType==="multibezier",a=e.edgeType==="segments",s=e.edgeType==="compound",o=e.edgeType==="self",l,u,c,f,d,h,p,x;if(t?(c=e.haystackPts[0],f=e.haystackPts[1],d=e.haystackPts[2],h=e.haystackPts[3]):(c=e.arrowStartX,f=e.arrowStartY,d=e.arrowEndX,h=e.arrowEndY),p=e.midX,x=e.midY,a)l=c-e.segpts[0],u=f-e.segpts[1];else if(i||s||o||r){var v=e.allpts,m=Kt(v[0],v[2],v[4],.1),g=Kt(v[1],v[3],v[5],.1);l=c-m,u=f-g}else l=c-p,u=f-x;e.srcArrowAngle=po(l,u);var p=e.midX,x=e.midY;if(t&&(p=(c+d)/2,x=(f+h)/2),l=d-c,u=h-f,a){var v=e.allpts;if(v.length/2%2===0){var y=v.length/2,E=y-2;l=v[y]-v[E],u=v[y+1]-v[E+1]}else if(e.isRound)l=e.midVector[1],u=-e.midVector[0];else{var y=v.length/2-1,E=y-2;l=v[y]-v[E],u=v[y+1]-v[E+1]}}else if(i||s||o){var v=e.allpts,M=e.ctrlpts,w,b,C,T;if(M.length/2%2===0){var S=v.length/2-1,L=S+2,N=L+2;w=Kt(v[S],v[L],v[N],0),b=Kt(v[S+1],v[L+1],v[N+1],0),C=Kt(v[S],v[L],v[N],1e-4),T=Kt(v[S+1],v[L+1],v[N+1],1e-4)}else{var L=v.length/2-1,S=L-2,N=L+2;w=Kt(v[S],v[L],v[N],.4999),b=Kt(v[S+1],v[L+1],v[N+1],.4999),C=Kt(v[S],v[L],v[N],.5),T=Kt(v[S+1],v[L+1],v[N+1],.5)}l=C-w,u=T-b}if(e.midtgtArrowAngle=po(l,u),e.midDispX=l,e.midDispY=u,l*=-1,u*=-1,a){var v=e.allpts;if(v.length/2%2!==0){if(!e.isRound){var y=v.length/2-1,I=y+2;l=-(v[I]-v[y]),u=-(v[I+1]-v[y+1])}}}if(e.midsrcArrowAngle=po(l,u),a)l=d-e.segpts[e.segpts.length-2],u=h-e.segpts[e.segpts.length-1];else if(i||s||o||r){var v=e.allpts,_=v.length,m=Kt(v[_-6],v[_-4],v[_-2],.9),g=Kt(v[_-5],v[_-3],v[_-1],.9);l=d-m,u=h-g}else l=d-p,u=h-x;e.tgtArrowAngle=po(l,u)};rl.getArrowWidth=rl.getArrowHeight=function(n,e){var t=this.arrowWidthCache=this.arrowWidthCache||{},r=t[n+", "+e];return r||(r=Math.max(Math.pow(n*13.37,.9),29)*e,t[n+", "+e]=r,r)};var hc,dc,er={},Pn={},id,ad,xi,zo,mr,hi,gi,jn,ra,To,wv,Av,pc,vc,sd,od=function(e,t,r){r.x=t.x-e.x,r.y=t.y-e.y,r.len=Math.sqrt(r.x*r.x+r.y*r.y),r.nx=r.x/r.len,r.ny=r.y/r.len,r.ang=Math.atan2(r.ny,r.nx)},AA=function(e,t){t.x=e.x*-1,t.y=e.y*-1,t.nx=e.nx*-1,t.ny=e.ny*-1,t.ang=e.ang>0?-(Math.PI-e.ang):Math.PI+e.ang},CA=function(e,t,r,i,a){if(e!==sd?od(t,e,er):AA(Pn,er),od(t,r,Pn),id=er.nx*Pn.ny-er.ny*Pn.nx,ad=er.nx*Pn.nx-er.ny*-Pn.ny,mr=Math.asin(Math.max(-1,Math.min(1,id))),Math.abs(mr)<1e-6){hc=t.x,dc=t.y,gi=ra=0;return}xi=1,zo=!1,ad<0?mr<0?mr=Math.PI+mr:(mr=Math.PI-mr,xi=-1,zo=!0):mr>0&&(xi=-1,zo=!0),t.radius!==void 0?ra=t.radius:ra=i,hi=mr/2,To=Math.min(er.len/2,Pn.len/2),a?(jn=Math.abs(Math.cos(hi)*ra/Math.sin(hi)),jn>To?(jn=To,gi=Math.abs(jn*Math.sin(hi)/Math.cos(hi))):gi=ra):(jn=Math.min(To,ra),gi=Math.abs(jn*Math.sin(hi)/Math.cos(hi))),pc=t.x+Pn.nx*jn,vc=t.y+Pn.ny*jn,hc=pc-Pn.ny*gi*xi,dc=vc+Pn.nx*gi*xi,wv=t.x+er.nx*jn,Av=t.y+er.ny*jn,sd=t};function Cv(n,e){e.radius===0?n.lineTo(e.cx,e.cy):n.arc(e.cx,e.cy,e.radius,e.startAngle,e.endAngle,e.counterClockwise)}function ef(n,e,t,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return r===0||e.radius===0?{cx:e.x,cy:e.y,radius:0,startX:e.x,startY:e.y,stopX:e.x,stopY:e.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(CA(n,e,t,r,i),{cx:hc,cy:dc,radius:gi,startX:wv,startY:Av,stopX:pc,stopY:vc,startAngle:er.ang+Math.PI/2*xi,endAngle:Pn.ang-Math.PI/2*xi,counterClockwise:zo})}var un={};un.findMidptPtsEtc=function(n,e){var t=e.posPts,r=e.intersectionPts,i=e.vectorNormInverse,a,s=n.pstyle("source-endpoint"),o=n.pstyle("target-endpoint"),l=s.units!=null&&o.units!=null,u=function(M,w,b,C){var T=C-w,S=b-M,L=Math.sqrt(S*S+T*T);return{x:-T/L,y:S/L}},c=n.pstyle("edge-distances").value;switch(c){case"node-position":a=t;break;case"intersection":a=r;break;case"endpoints":{if(l){var f=this.manualEndptToPx(n.source()[0],s),d=$t(f,2),h=d[0],v=d[1],m=this.manualEndptToPx(n.target()[0],o),g=$t(m,2),p=g[0],x=g[1],y={x1:h,y1:v,x2:p,y2:x};i=u(h,v,p,x),a=y}else Et("Edge ".concat(n.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),a=r;break}}return{midptPts:a,vectorNormInverse:i}};un.findHaystackPoints=function(n){for(var e=0;e<n.length;e++){var t=n[e],r=t._private,i=r.rscratch;if(!i.haystack){var a=Math.random()*2*Math.PI;i.source={x:Math.cos(a),y:Math.sin(a)},a=Math.random()*2*Math.PI,i.target={x:Math.cos(a),y:Math.sin(a)}}var s=r.source,o=r.target,l=s.position(),u=o.position(),c=s.width(),f=o.width(),d=s.height(),h=o.height(),v=t.pstyle("haystack-radius").value,m=v/2;i.haystackPts=i.allpts=[i.source.x*c*m+l.x,i.source.y*d*m+l.y,i.target.x*f*m+u.x,i.target.y*h*m+u.y],i.midX=(i.allpts[0]+i.allpts[2])/2,i.midY=(i.allpts[1]+i.allpts[3])/2,i.edgeType="haystack",i.haystack=!0,this.storeEdgeProjections(t),this.calculateArrowAngles(t),this.recalculateEdgeLabelProjections(t),this.calculateLabelAngles(t)}};un.findSegmentsPoints=function(n,e){var t=n._private.rscratch,r=n.pstyle("segment-weights"),i=n.pstyle("segment-distances"),a=n.pstyle("segment-radii"),s=n.pstyle("radius-type"),o=Math.min(r.pfValue.length,i.pfValue.length),l=a.pfValue[a.pfValue.length-1],u=s.pfValue[s.pfValue.length-1];t.edgeType="segments",t.segpts=[],t.radii=[],t.isArcRadius=[];for(var c=0;c<o;c++){var f=r.pfValue[c],d=i.pfValue[c],h=1-f,v=f,m=this.findMidptPtsEtc(n,e),g=m.midptPts,p=m.vectorNormInverse,x={x:g.x1*h+g.x2*v,y:g.y1*h+g.y2*v};t.segpts.push(x.x+p.x*d,x.y+p.y*d),t.radii.push(a.pfValue[c]!==void 0?a.pfValue[c]:l),t.isArcRadius.push((s.pfValue[c]!==void 0?s.pfValue[c]:u)==="arc-radius")}};un.findLoopPoints=function(n,e,t,r){var i=n._private.rscratch,a=e.dirCounts,s=e.srcPos,o=n.pstyle("control-point-distances"),l=o?o.pfValue[0]:void 0,u=n.pstyle("loop-direction").pfValue,c=n.pstyle("loop-sweep").pfValue,f=n.pstyle("control-point-step-size").pfValue;i.edgeType="self";var d=t,h=f;r&&(d=0,h=l);var v=u-Math.PI/2,m=v-c/2,g=v+c/2,p=u+"_"+c;d=a[p]===void 0?a[p]=0:++a[p],i.ctrlpts=[s.x+Math.cos(m)*1.4*h*(d/3+1),s.y+Math.sin(m)*1.4*h*(d/3+1),s.x+Math.cos(g)*1.4*h*(d/3+1),s.y+Math.sin(g)*1.4*h*(d/3+1)]};un.findCompoundLoopPoints=function(n,e,t,r){var i=n._private.rscratch;i.edgeType="compound";var a=e.srcPos,s=e.tgtPos,o=e.srcW,l=e.srcH,u=e.tgtW,c=e.tgtH,f=n.pstyle("control-point-step-size").pfValue,d=n.pstyle("control-point-distances"),h=d?d.pfValue[0]:void 0,v=t,m=f;r&&(v=0,m=h);var g=50,p={x:a.x-o/2,y:a.y-l/2},x={x:s.x-u/2,y:s.y-c/2},y={x:Math.min(p.x,x.x),y:Math.min(p.y,x.y)},E=.5,M=Math.max(E,Math.log(o*.01)),w=Math.max(E,Math.log(u*.01));i.ctrlpts=[y.x,y.y-(1+Math.pow(g,1.12)/100)*m*(v/3+1)*M,y.x-(1+Math.pow(g,1.12)/100)*m*(v/3+1)*w,y.y]};un.findStraightEdgePoints=function(n){n._private.rscratch.edgeType="straight"};un.findBezierPoints=function(n,e,t,r,i){var a=n._private.rscratch,s=n.pstyle("control-point-step-size").pfValue,o=n.pstyle("control-point-distances"),l=n.pstyle("control-point-weights"),u=o&&l?Math.min(o.value.length,l.value.length):1,c=o?o.pfValue[0]:void 0,f=l.value[0],d=r;a.edgeType=d?"multibezier":"bezier",a.ctrlpts=[];for(var h=0;h<u;h++){var v=(.5-e.eles.length/2+t)*s*(i?-1:1),m=void 0,g=Pp(v);d&&(c=o?o.pfValue[h]:s,f=l.value[h]),r?m=c:m=c!==void 0?g*c:void 0;var p=m!==void 0?m:v,x=1-f,y=f,E=this.findMidptPtsEtc(n,e),M=E.midptPts,w=E.vectorNormInverse,b={x:M.x1*x+M.x2*y,y:M.y1*x+M.y2*y};a.ctrlpts.push(b.x+w.x*p,b.y+w.y*p)}};un.findTaxiPoints=function(n,e){var t=n._private.rscratch;t.edgeType="segments";var r="vertical",i="horizontal",a="leftward",s="rightward",o="downward",l="upward",u="auto",c=e.posPts,f=e.srcW,d=e.srcH,h=e.tgtW,v=e.tgtH,m=n.pstyle("edge-distances").value,g=m!=="node-position",p=n.pstyle("taxi-direction").value,x=p,y=n.pstyle("taxi-turn"),E=y.units==="%",M=y.pfValue,w=M<0,b=n.pstyle("taxi-turn-min-distance").pfValue,C=g?(f+h)/2:0,T=g?(d+v)/2:0,S=c.x2-c.x1,L=c.y2-c.y1,N=function($,oe){return $>0?Math.max($-oe,0):Math.min($+oe,0)},I=N(S,C),_=N(L,T),P=!1;x===u?p=Math.abs(I)>Math.abs(_)?i:r:x===l||x===o?(p=r,P=!0):(x===a||x===s)&&(p=i,P=!0);var A=p===r,D=A?_:I,R=A?L:S,B=Pp(R),k=!1;!(P&&(E||w))&&(x===o&&R<0||x===l&&R>0||x===a&&R>0||x===s&&R<0)&&(B*=-1,D=B*Math.abs(D),k=!0);var V;if(E){var Y=M<0?1+M:M;V=Y*D}else{var Z=M<0?D:0;V=Z+M*B}var W=function($){return Math.abs($)<b||Math.abs($)>=Math.abs(D)},K=W(V),Q=W(Math.abs(D)-Math.abs(V)),ne=K||Q;if(ne&&!k)if(A){var ie=Math.abs(R)<=d/2,H=Math.abs(S)<=h/2;if(ie){var X=(c.x1+c.x2)/2,te=c.y1,ue=c.y2;t.segpts=[X,te,X,ue]}else if(H){var Se=(c.y1+c.y2)/2,U=c.x1,Ge=c.x2;t.segpts=[U,Se,Ge,Se]}else t.segpts=[c.x1,c.y2]}else{var Le=Math.abs(R)<=f/2,De=Math.abs(L)<=v/2;if(Le){var de=(c.y1+c.y2)/2,we=c.x1,Me=c.x2;t.segpts=[we,de,Me,de]}else if(De){var z=(c.x1+c.x2)/2,O=c.y1,re=c.y2;t.segpts=[z,O,z,re]}else t.segpts=[c.x2,c.y1]}else if(A){var ve=c.y1+V+(g?d/2*B:0),Ee=c.x1,ae=c.x2;t.segpts=[Ee,ve,ae,ve]}else{var F=c.x1+V+(g?f/2*B:0),j=c.y1,ce=c.y2;t.segpts=[F,j,F,ce]}if(t.isRound){var le=n.pstyle("taxi-radius").value,ee=n.pstyle("radius-type").value[0]==="arc-radius";t.radii=new Array(t.segpts.length/2).fill(le),t.isArcRadius=new Array(t.segpts.length/2).fill(ee)}};un.tryToCorrectInvalidPoints=function(n,e){var t=n._private.rscratch;if(t.edgeType==="bezier"){var r=e.srcPos,i=e.tgtPos,a=e.srcW,s=e.srcH,o=e.tgtW,l=e.tgtH,u=e.srcShape,c=e.tgtShape,f=e.srcCornerRadius,d=e.tgtCornerRadius,h=e.srcRs,v=e.tgtRs,m=!ke(t.startX)||!ke(t.startY),g=!ke(t.arrowStartX)||!ke(t.arrowStartY),p=!ke(t.endX)||!ke(t.endY),x=!ke(t.arrowEndX)||!ke(t.arrowEndY),y=3,E=this.getArrowWidth(n.pstyle("width").pfValue,n.pstyle("arrow-scale").value)*this.arrowShapeWidth,M=y*E,w=Ci({x:t.ctrlpts[0],y:t.ctrlpts[1]},{x:t.startX,y:t.startY}),b=w<M,C=Ci({x:t.ctrlpts[0],y:t.ctrlpts[1]},{x:t.endX,y:t.endY}),T=C<M,S=!1;if(m||g||b){S=!0;var L={x:t.ctrlpts[0]-r.x,y:t.ctrlpts[1]-r.y},N=Math.sqrt(L.x*L.x+L.y*L.y),I={x:L.x/N,y:L.y/N},_=Math.max(a,s),P={x:t.ctrlpts[0]+I.x*2*_,y:t.ctrlpts[1]+I.y*2*_},A=u.intersectLine(r.x,r.y,a,s,P.x,P.y,0,f,h);b?(t.ctrlpts[0]=t.ctrlpts[0]+I.x*(M-w),t.ctrlpts[1]=t.ctrlpts[1]+I.y*(M-w)):(t.ctrlpts[0]=A[0]+I.x*M,t.ctrlpts[1]=A[1]+I.y*M)}if(p||x||T){S=!0;var D={x:t.ctrlpts[0]-i.x,y:t.ctrlpts[1]-i.y},R=Math.sqrt(D.x*D.x+D.y*D.y),B={x:D.x/R,y:D.y/R},k=Math.max(a,s),V={x:t.ctrlpts[0]+B.x*2*k,y:t.ctrlpts[1]+B.y*2*k},Y=c.intersectLine(i.x,i.y,o,l,V.x,V.y,0,d,v);T?(t.ctrlpts[0]=t.ctrlpts[0]+B.x*(M-C),t.ctrlpts[1]=t.ctrlpts[1]+B.y*(M-C)):(t.ctrlpts[0]=Y[0]+B.x*M,t.ctrlpts[1]=Y[1]+B.y*M)}S&&this.findEndpoints(n)}};un.storeAllpts=function(n){var e=n._private.rscratch;if(e.edgeType==="multibezier"||e.edgeType==="bezier"||e.edgeType==="self"||e.edgeType==="compound"){e.allpts=[],e.allpts.push(e.startX,e.startY);for(var t=0;t+1<e.ctrlpts.length;t+=2)e.allpts.push(e.ctrlpts[t],e.ctrlpts[t+1]),t+3<e.ctrlpts.length&&e.allpts.push((e.ctrlpts[t]+e.ctrlpts[t+2])/2,(e.ctrlpts[t+1]+e.ctrlpts[t+3])/2);e.allpts.push(e.endX,e.endY);var r,i;e.ctrlpts.length/2%2===0?(r=e.allpts.length/2-1,e.midX=e.allpts[r],e.midY=e.allpts[r+1]):(r=e.allpts.length/2-3,i=.5,e.midX=Kt(e.allpts[r],e.allpts[r+2],e.allpts[r+4],i),e.midY=Kt(e.allpts[r+1],e.allpts[r+3],e.allpts[r+5],i))}else if(e.edgeType==="straight")e.allpts=[e.startX,e.startY,e.endX,e.endY],e.midX=(e.startX+e.endX+e.arrowStartX+e.arrowEndX)/4,e.midY=(e.startY+e.endY+e.arrowStartY+e.arrowEndY)/4;else if(e.edgeType==="segments"){if(e.allpts=[],e.allpts.push(e.startX,e.startY),e.allpts.push.apply(e.allpts,e.segpts),e.allpts.push(e.endX,e.endY),e.isRound){e.roundCorners=[];for(var a=2;a+3<e.allpts.length;a+=2){var s=e.radii[a/2-1],o=e.isArcRadius[a/2-1];e.roundCorners.push(ef({x:e.allpts[a-2],y:e.allpts[a-1]},{x:e.allpts[a],y:e.allpts[a+1],radius:s},{x:e.allpts[a+2],y:e.allpts[a+3]},s,o))}}if(e.segpts.length%4===0){var l=e.segpts.length/2,u=l-2;e.midX=(e.segpts[u]+e.segpts[l])/2,e.midY=(e.segpts[u+1]+e.segpts[l+1])/2}else{var c=e.segpts.length/2-1;if(!e.isRound)e.midX=e.segpts[c],e.midY=e.segpts[c+1];else{var f={x:e.segpts[c],y:e.segpts[c+1]},d=e.roundCorners[c/2],h=[f.x-d.cx,f.y-d.cy],v=d.radius/Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2));h=h.map(function(m){return m*v}),e.midX=d.cx+h[0],e.midY=d.cy+h[1],e.midVector=h}}}};un.checkForInvalidEdgeWarning=function(n){var e=n[0]._private.rscratch;e.nodesOverlap||ke(e.startX)&&ke(e.startY)&&ke(e.endX)&&ke(e.endY)?e.loggedErr=!1:e.loggedErr||(e.loggedErr=!0,Et("Edge `"+n.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};un.findEdgeControlPoints=function(n){var e=this;if(!(!n||n.length===0)){for(var t=this,r=t.cy,i=r.hasCompoundNodes(),a={map:new ar,get:function(b){var C=this.map.get(b[0]);return C!=null?C.get(b[1]):null},set:function(b,C){var T=this.map.get(b[0]);T==null&&(T=new ar,this.map.set(b[0],T)),T.set(b[1],C)}},s=[],o=[],l=0;l<n.length;l++){var u=n[l],c=u._private,f=u.pstyle("curve-style").value;if(!(u.removed()||!u.takesUpSpace())){if(f==="haystack"){o.push(u);continue}var d=f==="unbundled-bezier"||f.endsWith("segments")||f==="straight"||f==="straight-triangle"||f.endsWith("taxi"),h=f==="unbundled-bezier"||f==="bezier",v=c.source,m=c.target,g=v.poolIndex(),p=m.poolIndex(),x=[g,p].sort(),y=a.get(x);y==null&&(y={eles:[]},a.set(x,y),s.push(x)),y.eles.push(u),d&&(y.hasUnbundled=!0),h&&(y.hasBezier=!0)}}for(var E=function(b){var C=s[b],T=a.get(C),S=void 0;if(!T.hasUnbundled){var L=T.eles[0].parallelEdges().filter(function(F){return F.isBundledBezier()});kc(T.eles),L.forEach(function(F){return T.eles.push(F)}),T.eles.sort(function(F,j){return F.poolIndex()-j.poolIndex()})}var N=T.eles[0],I=N.source(),_=N.target();if(I.poolIndex()>_.poolIndex()){var P=I;I=_,_=P}var A=T.srcPos=I.position(),D=T.tgtPos=_.position(),R=T.srcW=I.outerWidth(),B=T.srcH=I.outerHeight(),k=T.tgtW=_.outerWidth(),V=T.tgtH=_.outerHeight(),Y=T.srcShape=t.nodeShapes[e.getNodeShape(I)],Z=T.tgtShape=t.nodeShapes[e.getNodeShape(_)],W=T.srcCornerRadius=I.pstyle("corner-radius").value==="auto"?"auto":I.pstyle("corner-radius").pfValue,K=T.tgtCornerRadius=_.pstyle("corner-radius").value==="auto"?"auto":_.pstyle("corner-radius").pfValue,Q=T.tgtRs=_._private.rscratch,ne=T.srcRs=I._private.rscratch;T.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var ie=0;ie<T.eles.length;ie++){var H=T.eles[ie],X=H[0]._private.rscratch,te=H.pstyle("curve-style").value,ue=te==="unbundled-bezier"||te.endsWith("segments")||te.endsWith("taxi"),Se=!I.same(H.source());if(!T.calculatedIntersection&&I!==_&&(T.hasBezier||T.hasUnbundled)){T.calculatedIntersection=!0;var U=Y.intersectLine(A.x,A.y,R,B,D.x,D.y,0,W,ne),Ge=T.srcIntn=U,Le=Z.intersectLine(D.x,D.y,k,V,A.x,A.y,0,K,Q),De=T.tgtIntn=Le,de=T.intersectionPts={x1:U[0],x2:Le[0],y1:U[1],y2:Le[1]},we=T.posPts={x1:A.x,x2:D.x,y1:A.y,y2:D.y},Me=Le[1]-U[1],z=Le[0]-U[0],O=Math.sqrt(z*z+Me*Me),re=T.vector={x:z,y:Me},ve=T.vectorNorm={x:re.x/O,y:re.y/O},Ee={x:-ve.y,y:ve.x};T.nodesOverlap=!ke(O)||Z.checkPoint(U[0],U[1],0,k,V,D.x,D.y,K,Q)||Y.checkPoint(Le[0],Le[1],0,R,B,A.x,A.y,W,ne),T.vectorNormInverse=Ee,S={nodesOverlap:T.nodesOverlap,dirCounts:T.dirCounts,calculatedIntersection:!0,hasBezier:T.hasBezier,hasUnbundled:T.hasUnbundled,eles:T.eles,srcPos:D,srcRs:Q,tgtPos:A,tgtRs:ne,srcW:k,srcH:V,tgtW:R,tgtH:B,srcIntn:De,tgtIntn:Ge,srcShape:Z,tgtShape:Y,posPts:{x1:we.x2,y1:we.y2,x2:we.x1,y2:we.y1},intersectionPts:{x1:de.x2,y1:de.y2,x2:de.x1,y2:de.y1},vector:{x:-re.x,y:-re.y},vectorNorm:{x:-ve.x,y:-ve.y},vectorNormInverse:{x:-Ee.x,y:-Ee.y}}}var ae=Se?S:T;X.nodesOverlap=ae.nodesOverlap,X.srcIntn=ae.srcIntn,X.tgtIntn=ae.tgtIntn,X.isRound=te.startsWith("round"),i&&(I.isParent()||I.isChild()||_.isParent()||_.isChild())&&(I.parents().anySame(_)||_.parents().anySame(I)||I.same(_)&&I.isParent())?e.findCompoundLoopPoints(H,ae,ie,ue):I===_?e.findLoopPoints(H,ae,ie,ue):te.endsWith("segments")?e.findSegmentsPoints(H,ae):te.endsWith("taxi")?e.findTaxiPoints(H,ae):te==="straight"||!ue&&T.eles.length%2===1&&ie===Math.floor(T.eles.length/2)?e.findStraightEdgePoints(H):e.findBezierPoints(H,ae,ie,ue,Se),e.findEndpoints(H),e.tryToCorrectInvalidPoints(H,ae),e.checkForInvalidEdgeWarning(H),e.storeAllpts(H),e.storeEdgeProjections(H),e.calculateArrowAngles(H),e.recalculateEdgeLabelProjections(H),e.calculateLabelAngles(H)}},M=0;M<s.length;M++)E(M);this.findHaystackPoints(o)}};function Rv(n){var e=[];if(n!=null){for(var t=0;t<n.length;t+=2){var r=n[t],i=n[t+1];e.push({x:r,y:i})}return e}}un.getSegmentPoints=function(n){var e=n[0]._private.rscratch;this.recalculateRenderedStyle(n);var t=e.edgeType;if(t==="segments")return Rv(e.segpts)};un.getControlPoints=function(n){var e=n[0]._private.rscratch;this.recalculateRenderedStyle(n);var t=e.edgeType;if(t==="bezier"||t==="multibezier"||t==="self"||t==="compound")return Rv(e.ctrlpts)};un.getEdgeMidpoint=function(n){var e=n[0]._private.rscratch;return this.recalculateRenderedStyle(n),{x:e.midX,y:e.midY}};var ks={};ks.manualEndptToPx=function(n,e){var t=this,r=n.position(),i=n.outerWidth(),a=n.outerHeight(),s=n._private.rscratch;if(e.value.length===2){var o=[e.pfValue[0],e.pfValue[1]];return e.units[0]==="%"&&(o[0]=o[0]*i),e.units[1]==="%"&&(o[1]=o[1]*a),o[0]+=r.x,o[1]+=r.y,o}else{var l=e.pfValue[0];l=-Math.PI/2+l;var u=2*Math.max(i,a),c=[r.x+Math.cos(l)*u,r.y+Math.sin(l)*u];return t.nodeShapes[this.getNodeShape(n)].intersectLine(r.x,r.y,i,a,c[0],c[1],0,n.pstyle("corner-radius").value==="auto"?"auto":n.pstyle("corner-radius").pfValue,s)}};ks.findEndpoints=function(n){var e=this,t,r=n.source()[0],i=n.target()[0],a=r.position(),s=i.position(),o=n.pstyle("target-arrow-shape").value,l=n.pstyle("source-arrow-shape").value,u=n.pstyle("target-distance-from-node").pfValue,c=n.pstyle("source-distance-from-node").pfValue,f=r._private.rscratch,d=i._private.rscratch,h=n.pstyle("curve-style").value,v=n._private.rscratch,m=v.edgeType,g=h==="taxi",p=m==="self"||m==="compound",x=m==="bezier"||m==="multibezier"||p,y=m!=="bezier",E=m==="straight"||m==="segments",M=m==="segments",w=x||y||E,b=p||g,C=n.pstyle("source-endpoint"),T=b?"outside-to-node":C.value,S=r.pstyle("corner-radius").value==="auto"?"auto":r.pstyle("corner-radius").pfValue,L=n.pstyle("target-endpoint"),N=b?"outside-to-node":L.value,I=i.pstyle("corner-radius").value==="auto"?"auto":i.pstyle("corner-radius").pfValue;v.srcManEndpt=C,v.tgtManEndpt=L;var _,P,A,D;if(x){var R=[v.ctrlpts[0],v.ctrlpts[1]],B=y?[v.ctrlpts[v.ctrlpts.length-2],v.ctrlpts[v.ctrlpts.length-1]]:R;_=B,P=R}else if(E){var k=M?v.segpts.slice(0,2):[s.x,s.y],V=M?v.segpts.slice(v.segpts.length-2):[a.x,a.y];_=V,P=k}if(N==="inside-to-node")t=[s.x,s.y];else if(L.units)t=this.manualEndptToPx(i,L);else if(N==="outside-to-line")t=v.tgtIntn;else if(N==="outside-to-node"||N==="outside-to-node-or-label"?A=_:(N==="outside-to-line"||N==="outside-to-line-or-label")&&(A=[a.x,a.y]),t=e.nodeShapes[this.getNodeShape(i)].intersectLine(s.x,s.y,i.outerWidth(),i.outerHeight(),A[0],A[1],0,I,d),N==="outside-to-node-or-label"||N==="outside-to-line-or-label"){var Y=i._private.rscratch,Z=Y.labelWidth,W=Y.labelHeight,K=Y.labelX,Q=Y.labelY,ne=Z/2,ie=W/2,H=i.pstyle("text-valign").value;H==="top"?Q-=ie:H==="bottom"&&(Q+=ie);var X=i.pstyle("text-halign").value;X==="left"?K-=ne:X==="right"&&(K+=ne);var te=_s(A[0],A[1],[K-ne,Q-ie,K+ne,Q-ie,K+ne,Q+ie,K-ne,Q+ie],s.x,s.y);if(te.length>0){var ue=a,Se=pi(ue,ca(t)),U=pi(ue,ca(te)),Ge=Se;if(U<Se&&(t=te,Ge=U),te.length>2){var Le=pi(ue,{x:te[2],y:te[3]});Le<Ge&&(t=[te[2],te[3]])}}}var De=vo(t,_,e.arrowShapes[o].spacing(n)+u),de=vo(t,_,e.arrowShapes[o].gap(n)+u);if(v.endX=de[0],v.endY=de[1],v.arrowEndX=De[0],v.arrowEndY=De[1],T==="inside-to-node")t=[a.x,a.y];else if(C.units)t=this.manualEndptToPx(r,C);else if(T==="outside-to-line")t=v.srcIntn;else if(T==="outside-to-node"||T==="outside-to-node-or-label"?D=P:(T==="outside-to-line"||T==="outside-to-line-or-label")&&(D=[s.x,s.y]),t=e.nodeShapes[this.getNodeShape(r)].intersectLine(a.x,a.y,r.outerWidth(),r.outerHeight(),D[0],D[1],0,S,f),T==="outside-to-node-or-label"||T==="outside-to-line-or-label"){var we=r._private.rscratch,Me=we.labelWidth,z=we.labelHeight,O=we.labelX,re=we.labelY,ve=Me/2,Ee=z/2,ae=r.pstyle("text-valign").value;ae==="top"?re-=Ee:ae==="bottom"&&(re+=Ee);var F=r.pstyle("text-halign").value;F==="left"?O-=ve:F==="right"&&(O+=ve);var j=_s(D[0],D[1],[O-ve,re-Ee,O+ve,re-Ee,O+ve,re+Ee,O-ve,re+Ee],a.x,a.y);if(j.length>0){var ce=s,le=pi(ce,ca(t)),ee=pi(ce,ca(j)),J=le;if(ee<le&&(t=[j[0],j[1]],J=ee),j.length>2){var $=pi(ce,{x:j[2],y:j[3]});$<J&&(t=[j[2],j[3]])}}}var oe=vo(t,P,e.arrowShapes[l].spacing(n)+c),fe=vo(t,P,e.arrowShapes[l].gap(n)+c);v.startX=fe[0],v.startY=fe[1],v.arrowStartX=oe[0],v.arrowStartY=oe[1],w&&(!ke(v.startX)||!ke(v.startY)||!ke(v.endX)||!ke(v.endY)?v.badLine=!0:v.badLine=!1)};ks.getSourceEndpoint=function(n){var e=n[0]._private.rscratch;switch(this.recalculateRenderedStyle(n),e.edgeType){case"haystack":return{x:e.haystackPts[0],y:e.haystackPts[1]};default:return{x:e.arrowStartX,y:e.arrowStartY}}};ks.getTargetEndpoint=function(n){var e=n[0]._private.rscratch;switch(this.recalculateRenderedStyle(n),e.edgeType){case"haystack":return{x:e.haystackPts[2],y:e.haystackPts[3]};default:return{x:e.arrowEndX,y:e.arrowEndY}}};var tf={};function RA(n,e,t){for(var r=function(u,c,f,d){return Kt(u,c,f,d)},i=e._private,a=i.rstyle.bezierPts,s=0;s<n.bezierProjPcts.length;s++){var o=n.bezierProjPcts[s];a.push({x:r(t[0],t[2],t[4],o),y:r(t[1],t[3],t[5],o)})}}tf.storeEdgeProjections=function(n){var e=n._private,t=e.rscratch,r=t.edgeType;if(e.rstyle.bezierPts=null,e.rstyle.linePts=null,e.rstyle.haystackPts=null,r==="multibezier"||r==="bezier"||r==="self"||r==="compound"){e.rstyle.bezierPts=[];for(var i=0;i+5<t.allpts.length;i+=4)RA(this,n,t.allpts.slice(i,i+6))}else if(r==="segments")for(var a=e.rstyle.linePts=[],i=0;i+1<t.allpts.length;i+=2)a.push({x:t.allpts[i],y:t.allpts[i+1]});else if(r==="haystack"){var s=t.haystackPts;e.rstyle.haystackPts=[{x:s[0],y:s[1]},{x:s[2],y:s[3]}]}e.rstyle.arrowWidth=this.getArrowWidth(n.pstyle("width").pfValue,n.pstyle("arrow-scale").value)*this.arrowShapeWidth};tf.recalculateEdgeProjections=function(n){this.findEdgeControlPoints(n)};var ur={};ur.recalculateNodeLabelProjection=function(n){var e=n.pstyle("label").strValue;if(!Kr(e)){var t,r,i=n._private,a=n.width(),s=n.height(),o=n.padding(),l=n.position(),u=n.pstyle("text-halign").strValue,c=n.pstyle("text-valign").strValue,f=i.rscratch,d=i.rstyle;switch(u){case"left":t=l.x-a/2-o;break;case"right":t=l.x+a/2+o;break;default:t=l.x}switch(c){case"top":r=l.y-s/2-o;break;case"bottom":r=l.y+s/2+o;break;default:r=l.y}f.labelX=t,f.labelY=r,d.labelX=t,d.labelY=r,this.calculateLabelAngles(n),this.applyLabelDimensions(n)}};var Dv=function(e,t){var r=Math.atan(t/e);return e===0&&r<0&&(r=r*-1),r},Lv=function(e,t){var r=t.x-e.x,i=t.y-e.y;return Dv(r,i)},DA=function(e,t,r,i){var a=Es(0,i-.001,1),s=Es(0,i+.001,1),o=ga(e,t,r,a),l=ga(e,t,r,s);return Lv(o,l)};ur.recalculateEdgeLabelProjections=function(n){var e,t=n._private,r=t.rscratch,i=this,a={mid:n.pstyle("label").strValue,source:n.pstyle("source-label").strValue,target:n.pstyle("target-label").strValue};if(a.mid||a.source||a.target){e={x:r.midX,y:r.midY};var s=function(f,d,h){zr(t.rscratch,f,d,h),zr(t.rstyle,f,d,h)};s("labelX",null,e.x),s("labelY",null,e.y);var o=Dv(r.midDispX,r.midDispY);s("labelAutoAngle",null,o);var l=function c(){if(c.cache)return c.cache;for(var f=[],d=0;d+5<r.allpts.length;d+=4){var h={x:r.allpts[d],y:r.allpts[d+1]},v={x:r.allpts[d+2],y:r.allpts[d+3]},m={x:r.allpts[d+4],y:r.allpts[d+5]};f.push({p0:h,p1:v,p2:m,startDist:0,length:0,segments:[]})}var g=t.rstyle.bezierPts,p=i.bezierProjPcts.length;function x(b,C,T,S,L){var N=Ci(C,T),I=b.segments[b.segments.length-1],_={p0:C,p1:T,t0:S,t1:L,startDist:I?I.startDist+I.length:0,length:N};b.segments.push(_),b.length+=N}for(var y=0;y<f.length;y++){var E=f[y],M=f[y-1];M&&(E.startDist=M.startDist+M.length),x(E,E.p0,g[y*p],0,i.bezierProjPcts[0]);for(var w=0;w<p-1;w++)x(E,g[y*p+w],g[y*p+w+1],i.bezierProjPcts[w],i.bezierProjPcts[w+1]);x(E,g[y*p+p-1],E.p2,i.bezierProjPcts[p-1],1)}return c.cache=f},u=function(f){var d,h=f==="source";if(a[f]){var v=n.pstyle(f+"-text-offset").pfValue;switch(r.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var m=l(),g,p=0,x=0,y=0;y<m.length;y++){for(var E=m[h?y:m.length-1-y],M=0;M<E.segments.length;M++){var w=E.segments[h?M:E.segments.length-1-M],b=y===m.length-1&&M===E.segments.length-1;if(p=x,x+=w.length,x>=v||b){g={cp:E,segment:w};break}}if(g)break}var C=g.cp,T=g.segment,S=(v-p)/T.length,L=T.t1-T.t0,N=h?T.t0+L*S:T.t1-L*S;N=Es(0,N,1),e=ga(C.p0,C.p1,C.p2,N),d=DA(C.p0,C.p1,C.p2,N);break}case"straight":case"segments":case"haystack":{for(var I=0,_,P,A,D,R=r.allpts.length,B=0;B+3<R&&(h?(A={x:r.allpts[B],y:r.allpts[B+1]},D={x:r.allpts[B+2],y:r.allpts[B+3]}):(A={x:r.allpts[R-2-B],y:r.allpts[R-1-B]},D={x:r.allpts[R-4-B],y:r.allpts[R-3-B]}),_=Ci(A,D),P=I,I+=_,!(I>=v));B+=2);var k=v-P,V=k/_;V=Es(0,V,1),e=UT(A,D,V),d=Lv(A,D);break}}s("labelX",f,e.x),s("labelY",f,e.y),s("labelAutoAngle",f,d)}};u("source"),u("target"),this.applyLabelDimensions(n)}};ur.applyLabelDimensions=function(n){this.applyPrefixedLabelDimensions(n),n.isEdge()&&(this.applyPrefixedLabelDimensions(n,"source"),this.applyPrefixedLabelDimensions(n,"target"))};ur.applyPrefixedLabelDimensions=function(n,e){var t=n._private,r=this.getLabelText(n,e),i=this.calculateLabelDimensions(n,r),a=n.pstyle("line-height").pfValue,s=n.pstyle("text-wrap").strValue,o=Hn(t.rscratch,"labelWrapCachedLines",e)||[],l=s!=="wrap"?1:Math.max(o.length,1),u=i.height/l,c=u*a,f=i.width,d=i.height+(l-1)*(a-1)*u;zr(t.rstyle,"labelWidth",e,f),zr(t.rscratch,"labelWidth",e,f),zr(t.rstyle,"labelHeight",e,d),zr(t.rscratch,"labelHeight",e,d),zr(t.rscratch,"labelLineHeight",e,c)};ur.getLabelText=function(n,e){var t=n._private,r=e?e+"-":"",i=n.pstyle(r+"label").strValue,a=n.pstyle("text-transform").value,s=function(Z,W){return W?(zr(t.rscratch,Z,e,W),W):Hn(t.rscratch,Z,e)};if(!i)return"";a=="none"||(a=="uppercase"?i=i.toUpperCase():a=="lowercase"&&(i=i.toLowerCase()));var o=n.pstyle("text-wrap").value;if(o==="wrap"){var l=s("labelKey");if(l!=null&&s("labelWrapKey")===l)return s("labelWrapCachedText");for(var u="",c=i.split(`
`),f=n.pstyle("text-max-width").pfValue,d=n.pstyle("text-overflow-wrap").value,h=d==="anywhere",v=[],m=/[\s\u200b]+|$/g,g=0;g<c.length;g++){var p=c[g],x=this.calculateLabelDimensions(n,p),y=x.width;if(h){var E=p.split("").join(u);p=E}if(y>f){var M=p.matchAll(m),w="",b=0,C=Mn(M),T;try{for(C.s();!(T=C.n()).done;){var S=T.value,L=S[0],N=p.substring(b,S.index);b=S.index+L.length;var I=w.length===0?N:w+N+L,_=this.calculateLabelDimensions(n,I),P=_.width;P<=f?w+=N+L:(w&&v.push(w),w=N+L)}}catch(Y){C.e(Y)}finally{C.f()}w.match(/^[\s\u200b]+$/)||v.push(w)}else v.push(p)}s("labelWrapCachedLines",v),i=s("labelWrapCachedText",v.join(`
`)),s("labelWrapKey",l)}else if(o==="ellipsis"){var A=n.pstyle("text-max-width").pfValue,D="",R="",B=!1;if(this.calculateLabelDimensions(n,i).width<A)return i;for(var k=0;k<i.length;k++){var V=this.calculateLabelDimensions(n,D+i[k]+R).width;if(V>A)break;D+=i[k],k===i.length-1&&(B=!0)}return B||(D+=R),D}return i};ur.getLabelJustification=function(n){var e=n.pstyle("text-justification").strValue,t=n.pstyle("text-halign").strValue;if(e==="auto")if(n.isNode())switch(t){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return e};ur.calculateLabelDimensions=function(n,e){var t=this,r=t.cy.window(),i=r.document,a=$r(e,n._private.labelDimsKey),s=t.labelDimCache||(t.labelDimCache=[]),o=s[a];if(o!=null)return o;var l=0,u=n.pstyle("font-style").strValue,c=n.pstyle("font-size").pfValue,f=n.pstyle("font-family").strValue,d=n.pstyle("font-weight").strValue,h=this.labelCalcCanvas,v=this.labelCalcCanvasContext;if(!h){h=this.labelCalcCanvas=i.createElement("canvas"),v=this.labelCalcCanvasContext=h.getContext("2d");var m=h.style;m.position="absolute",m.left="-9999px",m.top="-9999px",m.zIndex="-1",m.visibility="hidden",m.pointerEvents="none"}v.font="".concat(u," ").concat(d," ").concat(c,"px ").concat(f);for(var g=0,p=0,x=e.split(`
`),y=0;y<x.length;y++){var E=x[y],M=v.measureText(E),w=Math.ceil(M.width),b=c;g=Math.max(w,g),p+=b}return g+=l,p+=l,s[a]={width:g,height:p}};ur.calculateLabelAngle=function(n,e){var t=n._private,r=t.rscratch,i=n.isEdge(),a=e?e+"-":"",s=n.pstyle(a+"text-rotation"),o=s.strValue;return o==="none"?0:i&&o==="autorotate"?r.labelAutoAngle:o==="autorotate"?0:s.pfValue};ur.calculateLabelAngles=function(n){var e=this,t=n.isEdge(),r=n._private,i=r.rscratch;i.labelAngle=e.calculateLabelAngle(n),t&&(i.sourceLabelAngle=e.calculateLabelAngle(n,"source"),i.targetLabelAngle=e.calculateLabelAngle(n,"target"))};var Pv={},ld=28,ud=!1;Pv.getNodeShape=function(n){var e=this,t=n.pstyle("shape").value;if(t==="cutrectangle"&&(n.width()<ld||n.height()<ld))return ud||(Et("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),ud=!0),"rectangle";if(n.isParent())return t==="rectangle"||t==="roundrectangle"||t==="round-rectangle"||t==="cutrectangle"||t==="cut-rectangle"||t==="barrel"?t:"rectangle";if(t==="polygon"){var r=n.pstyle("shape-polygon-points").value;return e.nodeShapes.makePolygon(r).name}return t};var Sl={};Sl.registerCalculationListeners=function(){var n=this.cy,e=n.collection(),t=this,r=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.merge(s),o)for(var l=0;l<s.length;l++){var u=s[l],c=u._private,f=c.rstyle;f.clean=!1,f.cleanConnected=!1}};t.binder(n).on("bounds.* dirty.*",function(s){var o=s.target;r(o)}).on("style.* background.*",function(s){var o=s.target;r(o,!1)});var i=function(s){if(s){var o=t.onUpdateEleCalcsFns;e.cleanStyle();for(var l=0;l<e.length;l++){var u=e[l],c=u._private.rstyle;u.isNode()&&!c.cleanConnected&&(r(u.connectedEdges()),c.cleanConnected=!0)}if(o)for(var f=0;f<o.length;f++){var d=o[f];d(s,e)}t.recalculateRenderedStyle(e),e=n.collection()}};t.flushRenderedStyleQueue=function(){i(!0)},t.beforeRender(i,t.beforeRenderPriorities.eleCalcs)};Sl.onUpdateEleCalcs=function(n){var e=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];e.push(n)};Sl.recalculateRenderedStyle=function(n,e){var t=function(E){return E._private.rstyle.cleanConnected},r=[],i=[];if(!this.destroyed){e===void 0&&(e=!0);for(var a=0;a<n.length;a++){var s=n[a],o=s._private,l=o.rstyle;s.isEdge()&&(!t(s.source())||!t(s.target()))&&(l.clean=!1),!(e&&l.clean||s.removed())&&s.pstyle("display").value!=="none"&&(o.group==="nodes"?i.push(s):r.push(s),l.clean=!0)}for(var u=0;u<i.length;u++){var c=i[u],f=c._private,d=f.rstyle,h=c.position();this.recalculateNodeLabelProjection(c),d.nodeX=h.x,d.nodeY=h.y,d.nodeW=c.pstyle("width").pfValue,d.nodeH=c.pstyle("height").pfValue}this.recalculateEdgeProjections(r);for(var v=0;v<r.length;v++){var m=r[v],g=m._private,p=g.rstyle,x=g.rscratch;p.srcX=x.arrowStartX,p.srcY=x.arrowStartY,p.tgtX=x.arrowEndX,p.tgtY=x.arrowEndY,p.midX=x.midX,p.midY=x.midY,p.labelAngle=x.labelAngle,p.sourceLabelAngle=x.sourceLabelAngle,p.targetLabelAngle=x.targetLabelAngle}}};var Ml={};Ml.updateCachedGrabbedEles=function(){var n=this.cachedZSortedEles;if(n){n.drag=[],n.nondrag=[];for(var e=[],t=0;t<n.length;t++){var r=n[t],i=r._private.rscratch;r.grabbed()&&!r.isParent()?e.push(r):i.inDragLayer?n.drag.push(r):n.nondrag.push(r)}for(var t=0;t<e.length;t++){var r=e[t];n.drag.push(r)}}};Ml.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};Ml.getCachedZSortedEles=function(n){if(n||!this.cachedZSortedEles){var e=this.cy.mutableElements().toArray();e.sort(vv),e.interactive=e.filter(function(t){return t.interactive()}),this.cachedZSortedEles=e,this.updateCachedGrabbedEles()}else e=this.cachedZSortedEles;return e};var Nv={};[Oi,rl,un,ks,tf,ur,Pv,Sl,Ml].forEach(function(n){Je(Nv,n)});var Iv={};Iv.getCachedImage=function(n,e,t){var r=this,i=r.imageCache=r.imageCache||{},a=i[n];if(a)return a.image.complete||a.image.addEventListener("load",t),a.image;a=i[n]=i[n]||{};var s=a.image=new Image;s.addEventListener("load",t),s.addEventListener("error",function(){s.error=!0});var o="data:",l=n.substring(0,o.length).toLowerCase()===o;return l||(e=e==="null"?null:e,s.crossOrigin=e),s.src=n,s};var za={};za.registerBinding=function(n,e,t,r){var i=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(n)){for(var a=[],s=0;s<n.length;s++){var o=n[s];if(o!==void 0){var l=this.binder(o);a.push(l.on.apply(l,i))}}return a}var l=this.binder(n);return l.on.apply(l,i)};za.binder=function(n){var e=this,t=e.cy.window(),r=n===t||n===t.document||n===t.document.body||ib(n);if(e.supportsPassiveEvents==null){var i=!1;try{var a=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});t.addEventListener("test",null,a)}catch{}e.supportsPassiveEvents=i}var s=function(l,u,c){var f=Array.prototype.slice.call(arguments);return r&&e.supportsPassiveEvents&&(f[2]={capture:c??!1,passive:!1,once:!1}),e.bindings.push({target:n,args:f}),(n.addEventListener||n.on).apply(n,f),this};return{on:s,addEventListener:s,addListener:s,bind:s}};za.nodeIsDraggable=function(n){return n&&n.isNode()&&!n.locked()&&n.grabbable()};za.nodeIsGrabbable=function(n){return this.nodeIsDraggable(n)&&n.interactive()};za.load=function(){var n=this,e=n.cy.window(),t=function(F){return F.selected()},r=function(F){var j=F.getRootNode();if(j&&j.nodeType===11&&j.host!==void 0)return j},i=function(F,j,ce,le){F==null&&(F=n.cy);for(var ee=0;ee<j.length;ee++){var J=j[ee];F.emit({originalEvent:ce,type:J,position:le})}},a=function(F){return F.shiftKey||F.metaKey||F.ctrlKey},s=function(F,j){var ce=!0;if(n.cy.hasCompoundNodes()&&F&&F.pannable())for(var le=0;j&&le<j.length;le++){var F=j[le];if(F.isNode()&&F.isParent()&&!F.pannable()){ce=!1;break}}else ce=!0;return ce},o=function(F){F[0]._private.grabbed=!0},l=function(F){F[0]._private.grabbed=!1},u=function(F){F[0]._private.rscratch.inDragLayer=!0},c=function(F){F[0]._private.rscratch.inDragLayer=!1},f=function(F){F[0]._private.rscratch.isGrabTarget=!0},d=function(F){F[0]._private.rscratch.isGrabTarget=!1},h=function(F,j){var ce=j.addToList,le=ce.has(F);!le&&F.grabbable()&&!F.locked()&&(ce.merge(F),o(F))},v=function(F,j){if(F.cy().hasCompoundNodes()&&!(j.inDragLayer==null&&j.addToList==null)){var ce=F.descendants();j.inDragLayer&&(ce.forEach(u),ce.connectedEdges().forEach(u)),j.addToList&&h(ce,j)}},m=function(F,j){j=j||{};var ce=F.cy().hasCompoundNodes();j.inDragLayer&&(F.forEach(u),F.neighborhood().stdFilter(function(le){return!ce||le.isEdge()}).forEach(u)),j.addToList&&F.forEach(function(le){h(le,j)}),v(F,j),x(F,{inDragLayer:j.inDragLayer}),n.updateCachedGrabbedEles()},g=m,p=function(F){F&&(n.getCachedZSortedEles().forEach(function(j){l(j),c(j),d(j)}),n.updateCachedGrabbedEles())},x=function(F,j){if(!(j.inDragLayer==null&&j.addToList==null)&&F.cy().hasCompoundNodes()){var ce=F.ancestors().orphans();if(!ce.same(F)){var le=ce.descendants().spawnSelf().merge(ce).unmerge(F).unmerge(F.descendants()),ee=le.connectedEdges();j.inDragLayer&&(ee.forEach(u),le.forEach(u)),j.addToList&&le.forEach(function(J){h(J,j)})}}},y=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},E=typeof MutationObserver<"u",M=typeof ResizeObserver<"u";E?(n.removeObserver=new MutationObserver(function(ae){for(var F=0;F<ae.length;F++){var j=ae[F],ce=j.removedNodes;if(ce)for(var le=0;le<ce.length;le++){var ee=ce[le];if(ee===n.container){n.destroy();break}}}}),n.container.parentNode&&n.removeObserver.observe(n.container.parentNode,{childList:!0})):n.registerBinding(n.container,"DOMNodeRemoved",function(ae){n.destroy()});var w=Os(function(){n.cy.resize()},100);E&&(n.styleObserver=new MutationObserver(w),n.styleObserver.observe(n.container,{attributes:!0})),n.registerBinding(e,"resize",w),M&&(n.resizeObserver=new ResizeObserver(w),n.resizeObserver.observe(n.container));var b=function(F,j){for(;F!=null;)j(F),F=F.parentNode},C=function(){n.invalidateContainerClientCoordsCache()};b(n.container,function(ae){n.registerBinding(ae,"transitionend",C),n.registerBinding(ae,"animationend",C),n.registerBinding(ae,"scroll",C)}),n.registerBinding(n.container,"contextmenu",function(ae){ae.preventDefault()});var T=function(){return n.selection[4]!==0},S=function(F){for(var j=n.findContainerClientCoords(),ce=j[0],le=j[1],ee=j[2],J=j[3],$=F.touches?F.touches:[F],oe=!1,fe=0;fe<$.length;fe++){var ye=$[fe];if(ce<=ye.clientX&&ye.clientX<=ce+ee&&le<=ye.clientY&&ye.clientY<=le+J){oe=!0;break}}if(!oe)return!1;for(var xe=n.container,Ce=F.target,q=Ce.parentNode,he=!1;q;){if(q===xe){he=!0;break}q=q.parentNode}return!!he};n.registerBinding(n.container,"mousedown",function(F){if(S(F)&&!(n.hoverData.which===1&&F.which!==1)){F.preventDefault(),y(),n.hoverData.capture=!0,n.hoverData.which=F.which;var j=n.cy,ce=[F.clientX,F.clientY],le=n.projectIntoViewport(ce[0],ce[1]),ee=n.selection,J=n.findNearestElements(le[0],le[1],!0,!1),$=J[0],oe=n.dragData.possibleDragElements;n.hoverData.mdownPos=le,n.hoverData.mdownGPos=ce;var fe=function(){n.hoverData.tapholdCancelled=!1,clearTimeout(n.hoverData.tapholdTimeout),n.hoverData.tapholdTimeout=setTimeout(function(){if(!n.hoverData.tapholdCancelled){var se=n.hoverData.down;se?se.emit({originalEvent:F,type:"taphold",position:{x:le[0],y:le[1]}}):j.emit({originalEvent:F,type:"taphold",position:{x:le[0],y:le[1]}})}},n.tapholdDuration)};if(F.which==3){n.hoverData.cxtStarted=!0;var ye={originalEvent:F,type:"cxttapstart",position:{x:le[0],y:le[1]}};$?($.activate(),$.emit(ye),n.hoverData.down=$):j.emit(ye),n.hoverData.downTime=new Date().getTime(),n.hoverData.cxtDragged=!1}else if(F.which==1){$&&$.activate();{if($!=null&&n.nodeIsGrabbable($)){var xe=function(se){return{originalEvent:F,type:se,position:{x:le[0],y:le[1]}}},Ce=function(se){se.emit(xe("grab"))};if(f($),!$.selected())oe=n.dragData.possibleDragElements=j.collection(),g($,{addToList:oe}),$.emit(xe("grabon")).emit(xe("grab"));else{oe=n.dragData.possibleDragElements=j.collection();var q=j.$(function(he){return he.isNode()&&he.selected()&&n.nodeIsGrabbable(he)});m(q,{addToList:oe}),$.emit(xe("grabon")),q.forEach(Ce)}n.redrawHint("eles",!0),n.redrawHint("drag",!0)}n.hoverData.down=$,n.hoverData.downs=J,n.hoverData.downTime=new Date().getTime()}i($,["mousedown","tapstart","vmousedown"],F,{x:le[0],y:le[1]}),$==null?(ee[4]=1,n.data.bgActivePosistion={x:le[0],y:le[1]},n.redrawHint("select",!0),n.redraw()):$.pannable()&&(ee[4]=1),fe()}ee[0]=ee[2]=le[0],ee[1]=ee[3]=le[1]}},!1);var L=r(n.container);n.registerBinding([e,L],"mousemove",function(F){var j=n.hoverData.capture;if(!(!j&&!S(F))){var ce=!1,le=n.cy,ee=le.zoom(),J=[F.clientX,F.clientY],$=n.projectIntoViewport(J[0],J[1]),oe=n.hoverData.mdownPos,fe=n.hoverData.mdownGPos,ye=n.selection,xe=null;!n.hoverData.draggingEles&&!n.hoverData.dragging&&!n.hoverData.selecting&&(xe=n.findNearestElement($[0],$[1],!0,!1));var Ce=n.hoverData.last,q=n.hoverData.down,he=[$[0]-ye[2],$[1]-ye[3]],se=n.dragData.possibleDragElements,ge;if(fe){var Re=J[0]-fe[0],Ae=Re*Re,Fe=J[1]-fe[1],Ie=Fe*Fe,Oe=Ae+Ie;n.hoverData.isOverThresholdDrag=ge=Oe>=n.desktopTapThreshold2}var Be=a(F);ge&&(n.hoverData.tapholdCancelled=!0);var ze=function(){var Nt=n.hoverData.dragDelta=n.hoverData.dragDelta||[];Nt.length===0?(Nt.push(he[0]),Nt.push(he[1])):(Nt[0]+=he[0],Nt[1]+=he[1])};ce=!0,i(xe,["mousemove","vmousemove","tapdrag"],F,{x:$[0],y:$[1]});var We=function(){n.data.bgActivePosistion=void 0,n.hoverData.selecting||le.emit({originalEvent:F,type:"boxstart",position:{x:$[0],y:$[1]}}),ye[4]=1,n.hoverData.selecting=!0,n.redrawHint("select",!0),n.redraw()};if(n.hoverData.which===3){if(ge){var pt={originalEvent:F,type:"cxtdrag",position:{x:$[0],y:$[1]}};q?q.emit(pt):le.emit(pt),n.hoverData.cxtDragged=!0,(!n.hoverData.cxtOver||xe!==n.hoverData.cxtOver)&&(n.hoverData.cxtOver&&n.hoverData.cxtOver.emit({originalEvent:F,type:"cxtdragout",position:{x:$[0],y:$[1]}}),n.hoverData.cxtOver=xe,xe&&xe.emit({originalEvent:F,type:"cxtdragover",position:{x:$[0],y:$[1]}}))}}else if(n.hoverData.dragging){if(ce=!0,le.panningEnabled()&&le.userPanningEnabled()){var je;if(n.hoverData.justStartedPan){var Qe=n.hoverData.mdownPos;je={x:($[0]-Qe[0])*ee,y:($[1]-Qe[1])*ee},n.hoverData.justStartedPan=!1}else je={x:he[0]*ee,y:he[1]*ee};le.panBy(je),le.emit("dragpan"),n.hoverData.dragged=!0}$=n.projectIntoViewport(F.clientX,F.clientY)}else if(ye[4]==1&&(q==null||q.pannable())){if(ge){if(!n.hoverData.dragging&&le.boxSelectionEnabled()&&(Be||!le.panningEnabled()||!le.userPanningEnabled()))We();else if(!n.hoverData.selecting&&le.panningEnabled()&&le.userPanningEnabled()){var wt=s(q,n.hoverData.downs);wt&&(n.hoverData.dragging=!0,n.hoverData.justStartedPan=!0,ye[4]=0,n.data.bgActivePosistion=ca(oe),n.redrawHint("select",!0),n.redraw())}q&&q.pannable()&&q.active()&&q.unactivate()}}else{if(q&&q.pannable()&&q.active()&&q.unactivate(),(!q||!q.grabbed())&&xe!=Ce&&(Ce&&i(Ce,["mouseout","tapdragout"],F,{x:$[0],y:$[1]}),xe&&i(xe,["mouseover","tapdragover"],F,{x:$[0],y:$[1]}),n.hoverData.last=xe),q)if(ge){if(le.boxSelectionEnabled()&&Be)q&&q.grabbed()&&(p(se),q.emit("freeon"),se.emit("free"),n.dragData.didDrag&&(q.emit("dragfreeon"),se.emit("dragfree"))),We();else if(q&&q.grabbed()&&n.nodeIsDraggable(q)){var st=!n.dragData.didDrag;st&&n.redrawHint("eles",!0),n.dragData.didDrag=!0,n.hoverData.draggingEles||m(se,{inDragLayer:!0});var ut={x:0,y:0};if(ke(he[0])&&ke(he[1])&&(ut.x+=he[0],ut.y+=he[1],st)){var tt=n.hoverData.dragDelta;tt&&ke(tt[0])&&ke(tt[1])&&(ut.x+=tt[0],ut.y+=tt[1])}n.hoverData.draggingEles=!0,se.silentShift(ut).emit("position drag"),n.redrawHint("drag",!0),n.redraw()}}else ze();ce=!0}if(ye[2]=$[0],ye[3]=$[1],ce)return F.stopPropagation&&F.stopPropagation(),F.preventDefault&&F.preventDefault(),!1}},!1);var N,I,_;n.registerBinding(e,"mouseup",function(F){if(!(n.hoverData.which===1&&F.which!==1&&n.hoverData.capture)){var j=n.hoverData.capture;if(j){n.hoverData.capture=!1;var ce=n.cy,le=n.projectIntoViewport(F.clientX,F.clientY),ee=n.selection,J=n.findNearestElement(le[0],le[1],!0,!1),$=n.dragData.possibleDragElements,oe=n.hoverData.down,fe=a(F);if(n.data.bgActivePosistion&&(n.redrawHint("select",!0),n.redraw()),n.hoverData.tapholdCancelled=!0,n.data.bgActivePosistion=void 0,oe&&oe.unactivate(),n.hoverData.which===3){var ye={originalEvent:F,type:"cxttapend",position:{x:le[0],y:le[1]}};if(oe?oe.emit(ye):ce.emit(ye),!n.hoverData.cxtDragged){var xe={originalEvent:F,type:"cxttap",position:{x:le[0],y:le[1]}};oe?oe.emit(xe):ce.emit(xe)}n.hoverData.cxtDragged=!1,n.hoverData.which=null}else if(n.hoverData.which===1){if(i(J,["mouseup","tapend","vmouseup"],F,{x:le[0],y:le[1]}),!n.dragData.didDrag&&!n.hoverData.dragged&&!n.hoverData.selecting&&!n.hoverData.isOverThresholdDrag&&(i(oe,["click","tap","vclick"],F,{x:le[0],y:le[1]}),I=!1,F.timeStamp-_<=ce.multiClickDebounceTime()?(N&&clearTimeout(N),I=!0,_=null,i(oe,["dblclick","dbltap","vdblclick"],F,{x:le[0],y:le[1]})):(N=setTimeout(function(){I||i(oe,["oneclick","onetap","voneclick"],F,{x:le[0],y:le[1]})},ce.multiClickDebounceTime()),_=F.timeStamp)),oe==null&&!n.dragData.didDrag&&!n.hoverData.selecting&&!n.hoverData.dragged&&!a(F)&&(ce.$(t).unselect(["tapunselect"]),$.length>0&&n.redrawHint("eles",!0),n.dragData.possibleDragElements=$=ce.collection()),J==oe&&!n.dragData.didDrag&&!n.hoverData.selecting&&J!=null&&J._private.selectable&&(n.hoverData.dragging||(ce.selectionType()==="additive"||fe?J.selected()?J.unselect(["tapunselect"]):J.select(["tapselect"]):fe||(ce.$(t).unmerge(J).unselect(["tapunselect"]),J.select(["tapselect"]))),n.redrawHint("eles",!0)),n.hoverData.selecting){var Ce=ce.collection(n.getAllInBox(ee[0],ee[1],ee[2],ee[3]));n.redrawHint("select",!0),Ce.length>0&&n.redrawHint("eles",!0),ce.emit({type:"boxend",originalEvent:F,position:{x:le[0],y:le[1]}});var q=function(ge){return ge.selectable()&&!ge.selected()};ce.selectionType()==="additive"||fe||ce.$(t).unmerge(Ce).unselect(),Ce.emit("box").stdFilter(q).select().emit("boxselect"),n.redraw()}if(n.hoverData.dragging&&(n.hoverData.dragging=!1,n.redrawHint("select",!0),n.redrawHint("eles",!0),n.redraw()),!ee[4]){n.redrawHint("drag",!0),n.redrawHint("eles",!0);var he=oe&&oe.grabbed();p($),he&&(oe.emit("freeon"),$.emit("free"),n.dragData.didDrag&&(oe.emit("dragfreeon"),$.emit("dragfree")))}}ee[4]=0,n.hoverData.down=null,n.hoverData.cxtStarted=!1,n.hoverData.draggingEles=!1,n.hoverData.selecting=!1,n.hoverData.isOverThresholdDrag=!1,n.dragData.didDrag=!1,n.hoverData.dragged=!1,n.hoverData.dragDelta=[],n.hoverData.mdownPos=null,n.hoverData.mdownGPos=null,n.hoverData.which=null}}},!1);var P=function(F){if(!n.scrollingPage){var j=n.cy,ce=j.zoom(),le=j.pan(),ee=n.projectIntoViewport(F.clientX,F.clientY),J=[ee[0]*ce+le.x,ee[1]*ce+le.y];if(n.hoverData.draggingEles||n.hoverData.dragging||n.hoverData.cxtStarted||T()){F.preventDefault();return}if(j.panningEnabled()&&j.userPanningEnabled()&&j.zoomingEnabled()&&j.userZoomingEnabled()){F.preventDefault(),n.data.wheelZooming=!0,clearTimeout(n.data.wheelTimeout),n.data.wheelTimeout=setTimeout(function(){n.data.wheelZooming=!1,n.redrawHint("eles",!0),n.redraw()},150);var $;F.deltaY!=null?$=F.deltaY/-250:F.wheelDeltaY!=null?$=F.wheelDeltaY/1e3:$=F.wheelDelta/1e3,$=$*n.wheelSensitivity;var oe=F.deltaMode===1;oe&&($*=33);var fe=j.zoom()*Math.pow(10,$);F.type==="gesturechange"&&(fe=n.gestureStartZoom*F.scale),j.zoom({level:fe,renderedPosition:{x:J[0],y:J[1]}}),j.emit(F.type==="gesturechange"?"pinchzoom":"scrollzoom")}}};n.registerBinding(n.container,"wheel",P,!0),n.registerBinding(e,"scroll",function(F){n.scrollingPage=!0,clearTimeout(n.scrollingPageTimeout),n.scrollingPageTimeout=setTimeout(function(){n.scrollingPage=!1},250)},!0),n.registerBinding(n.container,"gesturestart",function(F){n.gestureStartZoom=n.cy.zoom(),n.hasTouchStarted||F.preventDefault()},!0),n.registerBinding(n.container,"gesturechange",function(ae){n.hasTouchStarted||P(ae)},!0),n.registerBinding(n.container,"mouseout",function(F){var j=n.projectIntoViewport(F.clientX,F.clientY);n.cy.emit({originalEvent:F,type:"mouseout",position:{x:j[0],y:j[1]}})},!1),n.registerBinding(n.container,"mouseover",function(F){var j=n.projectIntoViewport(F.clientX,F.clientY);n.cy.emit({originalEvent:F,type:"mouseover",position:{x:j[0],y:j[1]}})},!1);var A,D,R,B,k,V,Y,Z,W,K,Q,ne,ie,H=function(F,j,ce,le){return Math.sqrt((ce-F)*(ce-F)+(le-j)*(le-j))},X=function(F,j,ce,le){return(ce-F)*(ce-F)+(le-j)*(le-j)},te;n.registerBinding(n.container,"touchstart",te=function(F){if(n.hasTouchStarted=!0,!!S(F)){y(),n.touchData.capture=!0,n.data.bgActivePosistion=void 0;var j=n.cy,ce=n.touchData.now,le=n.touchData.earlier;if(F.touches[0]){var ee=n.projectIntoViewport(F.touches[0].clientX,F.touches[0].clientY);ce[0]=ee[0],ce[1]=ee[1]}if(F.touches[1]){var ee=n.projectIntoViewport(F.touches[1].clientX,F.touches[1].clientY);ce[2]=ee[0],ce[3]=ee[1]}if(F.touches[2]){var ee=n.projectIntoViewport(F.touches[2].clientX,F.touches[2].clientY);ce[4]=ee[0],ce[5]=ee[1]}if(F.touches[1]){n.touchData.singleTouchMoved=!0,p(n.dragData.touchDragEles);var J=n.findContainerClientCoords();W=J[0],K=J[1],Q=J[2],ne=J[3],A=F.touches[0].clientX-W,D=F.touches[0].clientY-K,R=F.touches[1].clientX-W,B=F.touches[1].clientY-K,ie=0<=A&&A<=Q&&0<=R&&R<=Q&&0<=D&&D<=ne&&0<=B&&B<=ne;var $=j.pan(),oe=j.zoom();k=H(A,D,R,B),V=X(A,D,R,B),Y=[(A+R)/2,(D+B)/2],Z=[(Y[0]-$.x)/oe,(Y[1]-$.y)/oe];var fe=200,ye=fe*fe;if(V<ye&&!F.touches[2]){var xe=n.findNearestElement(ce[0],ce[1],!0,!0),Ce=n.findNearestElement(ce[2],ce[3],!0,!0);xe&&xe.isNode()?(xe.activate().emit({originalEvent:F,type:"cxttapstart",position:{x:ce[0],y:ce[1]}}),n.touchData.start=xe):Ce&&Ce.isNode()?(Ce.activate().emit({originalEvent:F,type:"cxttapstart",position:{x:ce[0],y:ce[1]}}),n.touchData.start=Ce):j.emit({originalEvent:F,type:"cxttapstart",position:{x:ce[0],y:ce[1]}}),n.touchData.start&&(n.touchData.start._private.grabbed=!1),n.touchData.cxt=!0,n.touchData.cxtDragged=!1,n.data.bgActivePosistion=void 0,n.redraw();return}}if(F.touches[2])j.boxSelectionEnabled()&&F.preventDefault();else if(!F.touches[1]){if(F.touches[0]){var q=n.findNearestElements(ce[0],ce[1],!0,!0),he=q[0];if(he!=null&&(he.activate(),n.touchData.start=he,n.touchData.starts=q,n.nodeIsGrabbable(he))){var se=n.dragData.touchDragEles=j.collection(),ge=null;n.redrawHint("eles",!0),n.redrawHint("drag",!0),he.selected()?(ge=j.$(function(Oe){return Oe.selected()&&n.nodeIsGrabbable(Oe)}),m(ge,{addToList:se})):g(he,{addToList:se}),f(he);var Re=function(Be){return{originalEvent:F,type:Be,position:{x:ce[0],y:ce[1]}}};he.emit(Re("grabon")),ge?ge.forEach(function(Oe){Oe.emit(Re("grab"))}):he.emit(Re("grab"))}i(he,["touchstart","tapstart","vmousedown"],F,{x:ce[0],y:ce[1]}),he==null&&(n.data.bgActivePosistion={x:ee[0],y:ee[1]},n.redrawHint("select",!0),n.redraw()),n.touchData.singleTouchMoved=!1,n.touchData.singleTouchStartTime=+new Date,clearTimeout(n.touchData.tapholdTimeout),n.touchData.tapholdTimeout=setTimeout(function(){n.touchData.singleTouchMoved===!1&&!n.pinching&&!n.touchData.selecting&&i(n.touchData.start,["taphold"],F,{x:ce[0],y:ce[1]})},n.tapholdDuration)}}if(F.touches.length>=1){for(var Ae=n.touchData.startPosition=[null,null,null,null,null,null],Fe=0;Fe<ce.length;Fe++)Ae[Fe]=le[Fe]=ce[Fe];var Ie=F.touches[0];n.touchData.startGPosition=[Ie.clientX,Ie.clientY]}}},!1);var ue;n.registerBinding(e,"touchmove",ue=function(F){var j=n.touchData.capture;if(!(!j&&!S(F))){var ce=n.selection,le=n.cy,ee=n.touchData.now,J=n.touchData.earlier,$=le.zoom();if(F.touches[0]){var oe=n.projectIntoViewport(F.touches[0].clientX,F.touches[0].clientY);ee[0]=oe[0],ee[1]=oe[1]}if(F.touches[1]){var oe=n.projectIntoViewport(F.touches[1].clientX,F.touches[1].clientY);ee[2]=oe[0],ee[3]=oe[1]}if(F.touches[2]){var oe=n.projectIntoViewport(F.touches[2].clientX,F.touches[2].clientY);ee[4]=oe[0],ee[5]=oe[1]}var fe=n.touchData.startGPosition,ye;if(j&&F.touches[0]&&fe){for(var xe=[],Ce=0;Ce<ee.length;Ce++)xe[Ce]=ee[Ce]-J[Ce];var q=F.touches[0].clientX-fe[0],he=q*q,se=F.touches[0].clientY-fe[1],ge=se*se,Re=he+ge;ye=Re>=n.touchTapThreshold2}if(j&&n.touchData.cxt){F.preventDefault();var Ae=F.touches[0].clientX-W,Fe=F.touches[0].clientY-K,Ie=F.touches[1].clientX-W,Oe=F.touches[1].clientY-K,Be=X(Ae,Fe,Ie,Oe),ze=Be/V,We=150,pt=We*We,je=1.5,Qe=je*je;if(ze>=Qe||Be>=pt){n.touchData.cxt=!1,n.data.bgActivePosistion=void 0,n.redrawHint("select",!0);var wt={originalEvent:F,type:"cxttapend",position:{x:ee[0],y:ee[1]}};n.touchData.start?(n.touchData.start.unactivate().emit(wt),n.touchData.start=null):le.emit(wt)}}if(j&&n.touchData.cxt){var wt={originalEvent:F,type:"cxtdrag",position:{x:ee[0],y:ee[1]}};n.data.bgActivePosistion=void 0,n.redrawHint("select",!0),n.touchData.start?n.touchData.start.emit(wt):le.emit(wt),n.touchData.start&&(n.touchData.start._private.grabbed=!1),n.touchData.cxtDragged=!0;var st=n.findNearestElement(ee[0],ee[1],!0,!0);(!n.touchData.cxtOver||st!==n.touchData.cxtOver)&&(n.touchData.cxtOver&&n.touchData.cxtOver.emit({originalEvent:F,type:"cxtdragout",position:{x:ee[0],y:ee[1]}}),n.touchData.cxtOver=st,st&&st.emit({originalEvent:F,type:"cxtdragover",position:{x:ee[0],y:ee[1]}}))}else if(j&&F.touches[2]&&le.boxSelectionEnabled())F.preventDefault(),n.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,n.touchData.selecting||le.emit({originalEvent:F,type:"boxstart",position:{x:ee[0],y:ee[1]}}),n.touchData.selecting=!0,n.touchData.didSelect=!0,ce[4]=1,!ce||ce.length===0||ce[0]===void 0?(ce[0]=(ee[0]+ee[2]+ee[4])/3,ce[1]=(ee[1]+ee[3]+ee[5])/3,ce[2]=(ee[0]+ee[2]+ee[4])/3+1,ce[3]=(ee[1]+ee[3]+ee[5])/3+1):(ce[2]=(ee[0]+ee[2]+ee[4])/3,ce[3]=(ee[1]+ee[3]+ee[5])/3),n.redrawHint("select",!0),n.redraw();else if(j&&F.touches[1]&&!n.touchData.didSelect&&le.zoomingEnabled()&&le.panningEnabled()&&le.userZoomingEnabled()&&le.userPanningEnabled()){F.preventDefault(),n.data.bgActivePosistion=void 0,n.redrawHint("select",!0);var ut=n.dragData.touchDragEles;if(ut){n.redrawHint("drag",!0);for(var tt=0;tt<ut.length;tt++){var Yt=ut[tt]._private;Yt.grabbed=!1,Yt.rscratch.inDragLayer=!1}}var Nt=n.touchData.start,Ae=F.touches[0].clientX-W,Fe=F.touches[0].clientY-K,Ie=F.touches[1].clientX-W,Oe=F.touches[1].clientY-K,fr=H(Ae,Fe,Ie,Oe),Cn=fr/k;if(ie){var $n=Ae-A,Zn=Fe-D,Fn=Ie-R,Rr=Oe-B,Qn=($n+Fn)/2,Jn=(Zn+Rr)/2,G=le.zoom(),pe=G*Cn,_e=le.pan(),be=Z[0]*G+_e.x,me=Z[1]*G+_e.y,Pe={x:-pe/G*(be-_e.x-Qn)+be,y:-pe/G*(me-_e.y-Jn)+me};if(Nt&&Nt.active()){var ut=n.dragData.touchDragEles;p(ut),n.redrawHint("drag",!0),n.redrawHint("eles",!0),Nt.unactivate().emit("freeon"),ut.emit("free"),n.dragData.didDrag&&(Nt.emit("dragfreeon"),ut.emit("dragfree"))}le.viewport({zoom:pe,pan:Pe,cancelOnFailedZoom:!0}),le.emit("pinchzoom"),k=fr,A=Ae,D=Fe,R=Ie,B=Oe,n.pinching=!0}if(F.touches[0]){var oe=n.projectIntoViewport(F.touches[0].clientX,F.touches[0].clientY);ee[0]=oe[0],ee[1]=oe[1]}if(F.touches[1]){var oe=n.projectIntoViewport(F.touches[1].clientX,F.touches[1].clientY);ee[2]=oe[0],ee[3]=oe[1]}if(F.touches[2]){var oe=n.projectIntoViewport(F.touches[2].clientX,F.touches[2].clientY);ee[4]=oe[0],ee[5]=oe[1]}}else if(F.touches[0]&&!n.touchData.didSelect){var Ue=n.touchData.start,Xe=n.touchData.last,st;if(!n.hoverData.draggingEles&&!n.swipePanning&&(st=n.findNearestElement(ee[0],ee[1],!0,!0)),j&&Ue!=null&&F.preventDefault(),j&&Ue!=null&&n.nodeIsDraggable(Ue))if(ye){var ut=n.dragData.touchDragEles,Ye=!n.dragData.didDrag;Ye&&m(ut,{inDragLayer:!0}),n.dragData.didDrag=!0;var Ze={x:0,y:0};if(ke(xe[0])&&ke(xe[1])&&(Ze.x+=xe[0],Ze.y+=xe[1],Ye)){n.redrawHint("eles",!0);var He=n.touchData.dragDelta;He&&ke(He[0])&&ke(He[1])&&(Ze.x+=He[0],Ze.y+=He[1])}n.hoverData.draggingEles=!0,ut.silentShift(Ze).emit("position drag"),n.redrawHint("drag",!0),n.touchData.startPosition[0]==J[0]&&n.touchData.startPosition[1]==J[1]&&n.redrawHint("eles",!0),n.redraw()}else{var He=n.touchData.dragDelta=n.touchData.dragDelta||[];He.length===0?(He.push(xe[0]),He.push(xe[1])):(He[0]+=xe[0],He[1]+=xe[1])}if(i(Ue||st,["touchmove","tapdrag","vmousemove"],F,{x:ee[0],y:ee[1]}),(!Ue||!Ue.grabbed())&&st!=Xe&&(Xe&&Xe.emit({originalEvent:F,type:"tapdragout",position:{x:ee[0],y:ee[1]}}),st&&st.emit({originalEvent:F,type:"tapdragover",position:{x:ee[0],y:ee[1]}})),n.touchData.last=st,j)for(var tt=0;tt<ee.length;tt++)ee[tt]&&n.touchData.startPosition[tt]&&ye&&(n.touchData.singleTouchMoved=!0);if(j&&(Ue==null||Ue.pannable())&&le.panningEnabled()&&le.userPanningEnabled()){var Ne=s(Ue,n.touchData.starts);Ne&&(F.preventDefault(),n.data.bgActivePosistion||(n.data.bgActivePosistion=ca(n.touchData.startPosition)),n.swipePanning?(le.panBy({x:xe[0]*$,y:xe[1]*$}),le.emit("dragpan")):ye&&(n.swipePanning=!0,le.panBy({x:q*$,y:se*$}),le.emit("dragpan"),Ue&&(Ue.unactivate(),n.redrawHint("select",!0),n.touchData.start=null)));var oe=n.projectIntoViewport(F.touches[0].clientX,F.touches[0].clientY);ee[0]=oe[0],ee[1]=oe[1]}}for(var Ce=0;Ce<ee.length;Ce++)J[Ce]=ee[Ce];j&&F.touches.length>0&&!n.hoverData.draggingEles&&!n.swipePanning&&n.data.bgActivePosistion!=null&&(n.data.bgActivePosistion=void 0,n.redrawHint("select",!0),n.redraw())}},!1);var Se;n.registerBinding(e,"touchcancel",Se=function(F){var j=n.touchData.start;n.touchData.capture=!1,j&&j.unactivate()});var U,Ge,Le,De;if(n.registerBinding(e,"touchend",U=function(F){var j=n.touchData.start,ce=n.touchData.capture;if(ce)F.touches.length===0&&(n.touchData.capture=!1),F.preventDefault();else return;var le=n.selection;n.swipePanning=!1,n.hoverData.draggingEles=!1;var ee=n.cy,J=ee.zoom(),$=n.touchData.now,oe=n.touchData.earlier;if(F.touches[0]){var fe=n.projectIntoViewport(F.touches[0].clientX,F.touches[0].clientY);$[0]=fe[0],$[1]=fe[1]}if(F.touches[1]){var fe=n.projectIntoViewport(F.touches[1].clientX,F.touches[1].clientY);$[2]=fe[0],$[3]=fe[1]}if(F.touches[2]){var fe=n.projectIntoViewport(F.touches[2].clientX,F.touches[2].clientY);$[4]=fe[0],$[5]=fe[1]}j&&j.unactivate();var ye;if(n.touchData.cxt){if(ye={originalEvent:F,type:"cxttapend",position:{x:$[0],y:$[1]}},j?j.emit(ye):ee.emit(ye),!n.touchData.cxtDragged){var xe={originalEvent:F,type:"cxttap",position:{x:$[0],y:$[1]}};j?j.emit(xe):ee.emit(xe)}n.touchData.start&&(n.touchData.start._private.grabbed=!1),n.touchData.cxt=!1,n.touchData.start=null,n.redraw();return}if(!F.touches[2]&&ee.boxSelectionEnabled()&&n.touchData.selecting){n.touchData.selecting=!1;var Ce=ee.collection(n.getAllInBox(le[0],le[1],le[2],le[3]));le[0]=void 0,le[1]=void 0,le[2]=void 0,le[3]=void 0,le[4]=0,n.redrawHint("select",!0),ee.emit({type:"boxend",originalEvent:F,position:{x:$[0],y:$[1]}});var q=function(pt){return pt.selectable()&&!pt.selected()};Ce.emit("box").stdFilter(q).select().emit("boxselect"),Ce.nonempty()&&n.redrawHint("eles",!0),n.redraw()}if(j!=null&&j.unactivate(),F.touches[2])n.data.bgActivePosistion=void 0,n.redrawHint("select",!0);else if(!F.touches[1]){if(!F.touches[0]){if(!F.touches[0]){n.data.bgActivePosistion=void 0,n.redrawHint("select",!0);var he=n.dragData.touchDragEles;if(j!=null){var se=j._private.grabbed;p(he),n.redrawHint("drag",!0),n.redrawHint("eles",!0),se&&(j.emit("freeon"),he.emit("free"),n.dragData.didDrag&&(j.emit("dragfreeon"),he.emit("dragfree"))),i(j,["touchend","tapend","vmouseup","tapdragout"],F,{x:$[0],y:$[1]}),j.unactivate(),n.touchData.start=null}else{var ge=n.findNearestElement($[0],$[1],!0,!0);i(ge,["touchend","tapend","vmouseup","tapdragout"],F,{x:$[0],y:$[1]})}var Re=n.touchData.startPosition[0]-$[0],Ae=Re*Re,Fe=n.touchData.startPosition[1]-$[1],Ie=Fe*Fe,Oe=Ae+Ie,Be=Oe*J*J;n.touchData.singleTouchMoved||(j||ee.$(":selected").unselect(["tapunselect"]),i(j,["tap","vclick"],F,{x:$[0],y:$[1]}),Ge=!1,F.timeStamp-De<=ee.multiClickDebounceTime()?(Le&&clearTimeout(Le),Ge=!0,De=null,i(j,["dbltap","vdblclick"],F,{x:$[0],y:$[1]})):(Le=setTimeout(function(){Ge||i(j,["onetap","voneclick"],F,{x:$[0],y:$[1]})},ee.multiClickDebounceTime()),De=F.timeStamp)),j!=null&&!n.dragData.didDrag&&j._private.selectable&&Be<n.touchTapThreshold2&&!n.pinching&&(ee.selectionType()==="single"?(ee.$(t).unmerge(j).unselect(["tapunselect"]),j.select(["tapselect"])):j.selected()?j.unselect(["tapunselect"]):j.select(["tapselect"]),n.redrawHint("eles",!0)),n.touchData.singleTouchMoved=!0}}}for(var ze=0;ze<$.length;ze++)oe[ze]=$[ze];n.dragData.didDrag=!1,F.touches.length===0&&(n.touchData.dragDelta=[],n.touchData.startPosition=[null,null,null,null,null,null],n.touchData.startGPosition=null,n.touchData.didSelect=!1),F.touches.length<2&&(F.touches.length===1&&(n.touchData.startGPosition=[F.touches[0].clientX,F.touches[0].clientY]),n.pinching=!1,n.redrawHint("eles",!0),n.redraw())},!1),typeof TouchEvent>"u"){var de=[],we=function(F){return{clientX:F.clientX,clientY:F.clientY,force:1,identifier:F.pointerId,pageX:F.pageX,pageY:F.pageY,radiusX:F.width/2,radiusY:F.height/2,screenX:F.screenX,screenY:F.screenY,target:F.target}},Me=function(F){return{event:F,touch:we(F)}},z=function(F){de.push(Me(F))},O=function(F){for(var j=0;j<de.length;j++){var ce=de[j];if(ce.event.pointerId===F.pointerId){de.splice(j,1);return}}},re=function(F){var j=de.filter(function(ce){return ce.event.pointerId===F.pointerId})[0];j.event=F,j.touch=we(F)},ve=function(F){F.touches=de.map(function(j){return j.touch})},Ee=function(F){return F.pointerType==="mouse"||F.pointerType===4};n.registerBinding(n.container,"pointerdown",function(ae){Ee(ae)||(ae.preventDefault(),z(ae),ve(ae),te(ae))}),n.registerBinding(n.container,"pointerup",function(ae){Ee(ae)||(O(ae),ve(ae),U(ae))}),n.registerBinding(n.container,"pointercancel",function(ae){Ee(ae)||(O(ae),ve(ae),Se(ae))}),n.registerBinding(n.container,"pointermove",function(ae){Ee(ae)||(ae.preventDefault(),re(ae),ve(ae),ue(ae))})}};var Ar={};Ar.generatePolygon=function(n,e){return this.nodeShapes[n]={renderer:this,name:n,points:e,draw:function(r,i,a,s,o,l){this.renderer.nodeShapeImpl("polygon",r,i,a,s,o,this.points)},intersectLine:function(r,i,a,s,o,l,u,c){return _s(o,l,this.points,r,i,a/2,s/2,u)},checkPoint:function(r,i,a,s,o,l,u,c){return Mr(r,i,this.points,l,u,s,o,[0,-1],a)}}};Ar.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,t,r,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,r,i,a)},intersectLine:function(e,t,r,i,a,s,o,l){return ZT(a,s,e,t,r/2+o,i/2+o)},checkPoint:function(e,t,r,i,a,s,o,l){return bi(e,t,i,a,s,o,r)}}};Ar.generateRoundPolygon=function(n,e){return this.nodeShapes[n]={renderer:this,name:n,points:e,getOrCreateCorners:function(r,i,a,s,o,l,u){if(l[u]!==void 0&&l[u+"-cx"]===r&&l[u+"-cy"]===i)return l[u];l[u]=new Array(e.length/2),l[u+"-cx"]=r,l[u+"-cy"]=i;var c=a/2,f=s/2;o=o==="auto"?Up(a,s):o;for(var d=new Array(e.length/2),h=0;h<e.length/2;h++)d[h]={x:r+c*e[h*2],y:i+f*e[h*2+1]};var v,m,g,p,x=d.length;for(m=d[x-1],v=0;v<x;v++)g=d[v%x],p=d[(v+1)%x],l[u][v]=ef(m,g,p,o),m=g,g=p;return l[u]},draw:function(r,i,a,s,o,l,u){this.renderer.nodeShapeImpl("round-polygon",r,i,a,s,o,this.points,this.getOrCreateCorners(i,a,s,o,l,u,"drawCorners"))},intersectLine:function(r,i,a,s,o,l,u,c,f){return QT(o,l,this.points,r,i,a,s,u,this.getOrCreateCorners(r,i,a,s,c,f,"corners"))},checkPoint:function(r,i,a,s,o,l,u,c,f){return $T(r,i,this.points,l,u,s,o,this.getOrCreateCorners(l,u,s,o,c,f,"corners"))}}};Ar.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:dn(4,0),draw:function(e,t,r,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,r,i,a,this.points,s)},intersectLine:function(e,t,r,i,a,s,o,l){return Op(a,s,e,t,r,i,o,l)},checkPoint:function(e,t,r,i,a,s,o,l){var u=i/2,c=a/2;l=l==="auto"?Ri(i,a):l,l=Math.min(u,c,l);var f=l*2;return!!(Mr(e,t,this.points,s,o,i,a-f,[0,-1],r)||Mr(e,t,this.points,s,o,i-f,a,[0,-1],r)||bi(e,t,f,f,s-u+l,o-c+l,r)||bi(e,t,f,f,s+u-l,o-c+l,r)||bi(e,t,f,f,s+u-l,o+c-l,r)||bi(e,t,f,f,s-u+l,o+c-l,r))}}};Ar.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:Vc(),points:dn(4,0),draw:function(e,t,r,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,r,i,a,null,s)},generateCutTrianglePts:function(e,t,r,i,a){var s=a==="auto"?this.cornerLength:a,o=t/2,l=e/2,u=r-l,c=r+l,f=i-o,d=i+o;return{topLeft:[u,f+s,u+s,f,u+s,f+s],topRight:[c-s,f,c,f+s,c-s,f+s],bottomRight:[c,d-s,c-s,d,c-s,d-s],bottomLeft:[u+s,d,u,d-s,u+s,d-s]}},intersectLine:function(e,t,r,i,a,s,o,l){var u=this.generateCutTrianglePts(r+2*o,i+2*o,e,t,l),c=[].concat.apply([],[u.topLeft.splice(0,4),u.topRight.splice(0,4),u.bottomRight.splice(0,4),u.bottomLeft.splice(0,4)]);return _s(a,s,c,e,t)},checkPoint:function(e,t,r,i,a,s,o,l){var u=l==="auto"?this.cornerLength:l;if(Mr(e,t,this.points,s,o,i,a-2*u,[0,-1],r)||Mr(e,t,this.points,s,o,i-2*u,a,[0,-1],r))return!0;var c=this.generateCutTrianglePts(i,a,s,o);return yn(e,t,c.topLeft)||yn(e,t,c.topRight)||yn(e,t,c.bottomRight)||yn(e,t,c.bottomLeft)}}};Ar.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:dn(4,0),draw:function(e,t,r,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,r,i,a)},intersectLine:function(e,t,r,i,a,s,o,l){var u=.15,c=.5,f=.85,d=this.generateBarrelBezierPts(r+2*o,i+2*o,e,t),h=function(g){var p=ga({x:g[0],y:g[1]},{x:g[2],y:g[3]},{x:g[4],y:g[5]},u),x=ga({x:g[0],y:g[1]},{x:g[2],y:g[3]},{x:g[4],y:g[5]},c),y=ga({x:g[0],y:g[1]},{x:g[2],y:g[3]},{x:g[4],y:g[5]},f);return[g[0],g[1],p.x,p.y,x.x,x.y,y.x,y.y,g[4],g[5]]},v=[].concat(h(d.topLeft),h(d.topRight),h(d.bottomRight),h(d.bottomLeft));return _s(a,s,v,e,t)},generateBarrelBezierPts:function(e,t,r,i){var a=t/2,s=e/2,o=r-s,l=r+s,u=i-a,c=i+a,f=ac(e,t),d=f.heightOffset,h=f.widthOffset,v=f.ctrlPtOffsetPct*e,m={topLeft:[o,u+d,o+v,u,o+h,u],topRight:[l-h,u,l-v,u,l,u+d],bottomRight:[l,c-d,l-v,c,l-h,c],bottomLeft:[o+h,c,o+v,c,o,c-d]};return m.topLeft.isTop=!0,m.topRight.isTop=!0,m.bottomLeft.isBottom=!0,m.bottomRight.isBottom=!0,m},checkPoint:function(e,t,r,i,a,s,o,l){var u=ac(i,a),c=u.heightOffset,f=u.widthOffset;if(Mr(e,t,this.points,s,o,i,a-2*c,[0,-1],r)||Mr(e,t,this.points,s,o,i-2*f,a,[0,-1],r))return!0;for(var d=this.generateBarrelBezierPts(i,a,s,o),h=function(C,T,S){var L=S[4],N=S[2],I=S[0],_=S[5],P=S[1],A=Math.min(L,I),D=Math.max(L,I),R=Math.min(_,P),B=Math.max(_,P);if(A<=C&&C<=D&&R<=T&&T<=B){var k=JT(L,N,I),V=XT(k[0],k[1],k[2],C),Y=V.filter(function(Z){return 0<=Z&&Z<=1});if(Y.length>0)return Y[0]}return null},v=Object.keys(d),m=0;m<v.length;m++){var g=v[m],p=d[g],x=h(e,t,p);if(x!=null){var y=p[5],E=p[3],M=p[1],w=Kt(y,E,M,x);if(p.isTop&&w<=t||p.isBottom&&t<=w)return!0}}return!1}}};Ar.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:dn(4,0),draw:function(e,t,r,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,r,i,a,this.points,s)},intersectLine:function(e,t,r,i,a,s,o,l){var u=e-(r/2+o),c=t-(i/2+o),f=c,d=e+(r/2+o),h=Gr(a,s,e,t,u,c,d,f,!1);return h.length>0?h:Op(a,s,e,t,r,i,o,l)},checkPoint:function(e,t,r,i,a,s,o,l){l=l==="auto"?Ri(i,a):l;var u=2*l;if(Mr(e,t,this.points,s,o,i,a-u,[0,-1],r)||Mr(e,t,this.points,s,o,i-u,a,[0,-1],r))return!0;var c=i/2+2*r,f=a/2+2*r,d=[s-c,o-f,s-c,o,s+c,o,s+c,o-f];return!!(yn(e,t,d)||bi(e,t,u,u,s+i/2-l,o+a/2-l,r)||bi(e,t,u,u,s-i/2+l,o+a/2-l,r))}}};Ar.registerNodeShapes=function(){var n=this.nodeShapes={},e=this;this.generateEllipse(),this.generatePolygon("triangle",dn(3,0)),this.generateRoundPolygon("round-triangle",dn(3,0)),this.generatePolygon("rectangle",dn(4,0)),n.square=n.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var t=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",t),this.generateRoundPolygon("round-diamond",t)}this.generatePolygon("pentagon",dn(5,0)),this.generateRoundPolygon("round-pentagon",dn(5,0)),this.generatePolygon("hexagon",dn(6,0)),this.generateRoundPolygon("round-hexagon",dn(6,0)),this.generatePolygon("heptagon",dn(7,0)),this.generateRoundPolygon("round-heptagon",dn(7,0)),this.generatePolygon("octagon",dn(8,0)),this.generateRoundPolygon("round-octagon",dn(8,0));var r=new Array(20);{var i=ic(5,0),a=ic(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<a.length/2;o++)a[o*2]*=s,a[o*2+1]*=s;for(var o=0;o<20/4;o++)r[o*4]=i[o*2],r[o*4+1]=i[o*2+1],r[o*4+2]=a[o*2],r[o*4+3]=a[o*2+1]}r=Fp(r),this.generatePolygon("star",r),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var l=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",l),this.generateRoundPolygon("round-tag",l)}n.makePolygon=function(u){var c=u.join("$"),f="polygon-"+c,d;return(d=this[f])?d:e.generatePolygon(f,u)}};var zs={};zs.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};zs.redraw=function(n){n=n||Dp();var e=this;e.averageRedrawTime===void 0&&(e.averageRedrawTime=0),e.lastRedrawTime===void 0&&(e.lastRedrawTime=0),e.lastDrawTime===void 0&&(e.lastDrawTime=0),e.requestedFrame=!0,e.renderOptions=n};zs.beforeRender=function(n,e){if(!this.destroyed){e==null&&Lt("Priority is not optional for beforeRender");var t=this.beforeRenderCallbacks;t.push({fn:n,priority:e}),t.sort(function(r,i){return i.priority-r.priority})}};var cd=function(e,t,r){for(var i=e.beforeRenderCallbacks,a=0;a<i.length;a++)i[a].fn(t,r)};zs.startRenderLoop=function(){var n=this,e=n.cy;if(!n.renderLoopStarted){n.renderLoopStarted=!0;var t=function r(i){if(!n.destroyed){if(!e.batching())if(n.requestedFrame&&!n.skipFrame){cd(n,!0,i);var a=Sr();n.render(n.renderOptions);var s=n.lastDrawTime=Sr();n.averageRedrawTime===void 0&&(n.averageRedrawTime=s-a),n.redrawCount===void 0&&(n.redrawCount=0),n.redrawCount++,n.redrawTotalTime===void 0&&(n.redrawTotalTime=0);var o=s-a;n.redrawTotalTime+=o,n.lastRedrawTime=o,n.averageRedrawTime=n.averageRedrawTime/2+o/2,n.requestedFrame=!1}else cd(n,!1,i);n.skipFrame=!1,$o(r)}};$o(t)}};var LA=function(e){this.init(e)},Ov=LA,Ga=Ov.prototype;Ga.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];Ga.init=function(n){var e=this;e.options=n,e.cy=n.cy;var t=e.container=n.cy.container(),r=e.cy.window();if(r){var i=r.document,a=i.head,s="__________cytoscape_stylesheet",o="__________cytoscape_container",l=i.getElementById(s)!=null;if(t.className.indexOf(o)<0&&(t.className=(t.className||"")+" "+o),!l){var u=i.createElement("style");u.id=s,u.textContent="."+o+" { position: relative; }",a.insertBefore(u,a.children[0])}var c=r.getComputedStyle(t),f=c.getPropertyValue("position");f==="static"&&Et("A Cytoscape container has style position:static and so can not use UI extensions properly")}e.selection=[void 0,void 0,void 0,void 0,0],e.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],e.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},e.dragData={possibleDragElements:[]},e.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},e.redraws=0,e.showFps=n.showFps,e.debug=n.debug,e.webgl=n.webgl,e.hideEdgesOnViewport=n.hideEdgesOnViewport,e.textureOnViewport=n.textureOnViewport,e.wheelSensitivity=n.wheelSensitivity,e.motionBlurEnabled=n.motionBlur,e.forcedPixelRatio=ke(n.pixelRatio)?n.pixelRatio:null,e.motionBlur=n.motionBlur,e.motionBlurOpacity=n.motionBlurOpacity,e.motionBlurTransparency=1-e.motionBlurOpacity,e.motionBlurPxRatio=1,e.mbPxRBlurry=1,e.minMbLowQualFrames=4,e.fullQualityMb=!1,e.clearedForMotionBlur=[],e.desktopTapThreshold=n.desktopTapThreshold,e.desktopTapThreshold2=n.desktopTapThreshold*n.desktopTapThreshold,e.touchTapThreshold=n.touchTapThreshold,e.touchTapThreshold2=n.touchTapThreshold*n.touchTapThreshold,e.tapholdDuration=500,e.bindings=[],e.beforeRenderCallbacks=[],e.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},e.registerNodeShapes(),e.registerArrowShapes(),e.registerCalculationListeners()};Ga.notify=function(n,e){var t=this,r=t.cy;if(!this.destroyed){if(n==="init"){t.load();return}if(n==="destroy"){t.destroy();return}(n==="add"||n==="remove"||n==="move"&&r.hasCompoundNodes()||n==="load"||n==="zorder"||n==="mount")&&t.invalidateCachedZSortedEles(),n==="viewport"&&t.redrawHint("select",!0),n==="gc"&&t.redrawHint("gc",!0),(n==="load"||n==="resize"||n==="mount")&&(t.invalidateContainerClientCoordsCache(),t.matchCanvasSize(t.container)),t.redrawHint("eles",!0),t.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};Ga.destroy=function(){var n=this;n.destroyed=!0,n.cy.stopAnimationLoop();for(var e=0;e<n.bindings.length;e++){var t=n.bindings[e],r=t,i=r.target;(i.off||i.removeEventListener).apply(i,r.args)}if(n.bindings=[],n.beforeRenderCallbacks=[],n.onUpdateEleCalcsFns=[],n.removeObserver&&n.removeObserver.disconnect(),n.styleObserver&&n.styleObserver.disconnect(),n.resizeObserver&&n.resizeObserver.disconnect(),n.labelCalcDiv)try{document.body.removeChild(n.labelCalcDiv)}catch{}};Ga.isHeadless=function(){return!1};[jc,Nv,Iv,za,Ar,zs].forEach(function(n){Je(Ga,n)});var hu=1e3/60,Fv={setupDequeueing:function(e){return function(){var r=this,i=this.renderer;if(!r.dequeueingSetup){r.dequeueingSetup=!0;var a=Os(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},e.deqRedrawThreshold),s=function(u,c){var f=Sr(),d=i.averageRedrawTime,h=i.lastRedrawTime,v=[],m=i.cy.extent(),g=i.getPixelRatio();for(u||i.flushRenderedStyleQueue();;){var p=Sr(),x=p-f,y=p-c;if(h<hu){var E=hu-(u?d:0);if(y>=e.deqFastCost*E)break}else if(u){if(x>=e.deqCost*h||x>=e.deqAvgCost*d)break}else if(y>=e.deqNoDrawCost*hu)break;var M=e.deq(r,g,m);if(M.length>0)for(var w=0;w<M.length;w++)v.push(M[w]);else break}v.length>0&&(e.onDeqd(r,v),!u&&e.shouldRedraw(r,v,g,m)&&a())},o=e.priority||Bc;i.beforeRender(s,o(r))}}}},PA=function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Zo;ti(this,n),this.idsByKey=new ar,this.keyForId=new ar,this.cachesByLvl=new ar,this.lvls=[],this.getKey=e,this.doesEleInvalidateKey=t}return ni(n,[{key:"getIdsFor",value:function(t){t==null&&Lt("Can not get id list for null key");var r=this.idsByKey,i=this.idsByKey.get(t);return i||(i=new Na,r.set(t,i)),i}},{key:"addIdForKey",value:function(t,r){t!=null&&this.getIdsFor(t).add(r)}},{key:"deleteIdForKey",value:function(t,r){t!=null&&this.getIdsFor(t).delete(r)}},{key:"getNumberOfIdsForKey",value:function(t){return t==null?0:this.getIdsFor(t).size}},{key:"updateKeyMappingFor",value:function(t){var r=t.id(),i=this.keyForId.get(r),a=this.getKey(t);this.deleteIdForKey(i,r),this.addIdForKey(a,r),this.keyForId.set(r,a)}},{key:"deleteKeyMappingFor",value:function(t){var r=t.id(),i=this.keyForId.get(r);this.deleteIdForKey(i,r),this.keyForId.delete(r)}},{key:"keyHasChangedFor",value:function(t){var r=t.id(),i=this.keyForId.get(r),a=this.getKey(t);return i!==a}},{key:"isInvalid",value:function(t){return this.keyHasChangedFor(t)||this.doesEleInvalidateKey(t)}},{key:"getCachesAt",value:function(t){var r=this.cachesByLvl,i=this.lvls,a=r.get(t);return a||(a=new ar,r.set(t,a),i.push(t)),a}},{key:"getCache",value:function(t,r){return this.getCachesAt(r).get(t)}},{key:"get",value:function(t,r){var i=this.getKey(t),a=this.getCache(i,r);return a!=null&&this.updateKeyMappingFor(t),a}},{key:"getForCachedKey",value:function(t,r){var i=this.keyForId.get(t.id()),a=this.getCache(i,r);return a}},{key:"hasCache",value:function(t,r){return this.getCachesAt(r).has(t)}},{key:"has",value:function(t,r){var i=this.getKey(t);return this.hasCache(i,r)}},{key:"setCache",value:function(t,r,i){i.key=t,this.getCachesAt(r).set(t,i)}},{key:"set",value:function(t,r,i){var a=this.getKey(t);this.setCache(a,r,i),this.updateKeyMappingFor(t)}},{key:"deleteCache",value:function(t,r){this.getCachesAt(r).delete(t)}},{key:"delete",value:function(t,r){var i=this.getKey(t);this.deleteCache(i,r)}},{key:"invalidateKey",value:function(t){var r=this;this.lvls.forEach(function(i){return r.deleteCache(t,i)})}},{key:"invalidate",value:function(t){var r=t.id(),i=this.keyForId.get(r);this.deleteKeyMappingFor(t);var a=this.doesEleInvalidateKey(t);return a&&this.invalidateKey(i),a||this.getNumberOfIdsForKey(i)===0}}]),n}(),fd=25,So=50,Go=-4,gc=3,Uv=7.99,NA=8,IA=1024,OA=1024,FA=1024,UA=.2,BA=.8,kA=10,zA=.15,GA=.1,VA=.9,HA=.9,WA=100,XA=1,fa={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},YA=Zt({getKey:null,doesEleInvalidateKey:Zo,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:Ap,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),os=function(e,t){var r=this;r.renderer=e,r.onDequeues=[];var i=YA(t);Je(r,i),r.lookup=new PA(i.getKey,i.doesEleInvalidateKey),r.setupDequeueing()},Xt=os.prototype;Xt.reasons=fa;Xt.getTextureQueue=function(n){var e=this;return e.eleImgCaches=e.eleImgCaches||{},e.eleImgCaches[n]=e.eleImgCaches[n]||[]};Xt.getRetiredTextureQueue=function(n){var e=this,t=e.eleImgCaches.retired=e.eleImgCaches.retired||{},r=t[n]=t[n]||[];return r};Xt.getElementQueue=function(){var n=this,e=n.eleCacheQueue=n.eleCacheQueue||new Fs(function(t,r){return r.reqs-t.reqs});return e};Xt.getElementKeyToQueue=function(){var n=this,e=n.eleKeyToCacheQueue=n.eleKeyToCacheQueue||{};return e};Xt.getElement=function(n,e,t,r,i){var a=this,s=this.renderer,o=s.cy.zoom(),l=this.lookup;if(!e||e.w===0||e.h===0||isNaN(e.w)||isNaN(e.h)||!n.visible()||n.removed()||!a.allowEdgeTxrCaching&&n.isEdge()||!a.allowParentTxrCaching&&n.isParent())return null;if(r==null&&(r=Math.ceil(zc(o*t))),r<Go)r=Go;else if(o>=Uv||r>gc)return null;var u=Math.pow(2,r),c=e.h*u,f=e.w*u,d=s.eleTextBiggerThanMin(n,u);if(!this.isVisible(n,d))return null;var h=l.get(n,r);if(h&&h.invalidated&&(h.invalidated=!1,h.texture.invalidatedWidth-=h.width),h)return h;var v;if(c<=fd?v=fd:c<=So?v=So:v=Math.ceil(c/So)*So,c>FA||f>OA)return null;var m=a.getTextureQueue(v),g=m[m.length-2],p=function(){return a.recycleTexture(v,f)||a.addTexture(v,f)};g||(g=m[m.length-1]),g||(g=p()),g.width-g.usedWidth<f&&(g=p());for(var x=function(A){return A&&A.scaledLabelShown===d},y=i&&i===fa.dequeue,E=i&&i===fa.highQuality,M=i&&i===fa.downscale,w,b=r+1;b<=gc;b++){var C=l.get(n,b);if(C){w=C;break}}var T=w&&w.level===r+1?w:null,S=function(){g.context.drawImage(T.texture.canvas,T.x,0,T.width,T.height,g.usedWidth,0,f,c)};if(g.context.setTransform(1,0,0,1,0,0),g.context.clearRect(g.usedWidth,0,f,v),x(T))S();else if(x(w))if(E){for(var L=w.level;L>r;L--)T=a.getElement(n,e,t,L,fa.downscale);S()}else return a.queueElement(n,w.level-1),w;else{var N;if(!y&&!E&&!M)for(var I=r-1;I>=Go;I--){var _=l.get(n,I);if(_){N=_;break}}if(x(N))return a.queueElement(n,r),N;g.context.translate(g.usedWidth,0),g.context.scale(u,u),this.drawElement(g.context,n,e,d,!1),g.context.scale(1/u,1/u),g.context.translate(-g.usedWidth,0)}return h={x:g.usedWidth,texture:g,level:r,scale:u,width:f,height:c,scaledLabelShown:d},g.usedWidth+=Math.ceil(f+NA),g.eleCaches.push(h),l.set(n,r,h),a.checkTextureFullness(g),h};Xt.invalidateElements=function(n){for(var e=0;e<n.length;e++)this.invalidateElement(n[e])};Xt.invalidateElement=function(n){var e=this,t=e.lookup,r=[],i=t.isInvalid(n);if(i){for(var a=Go;a<=gc;a++){var s=t.getForCachedKey(n,a);s&&r.push(s)}var o=t.invalidate(n);if(o)for(var l=0;l<r.length;l++){var u=r[l],c=u.texture;c.invalidatedWidth+=u.width,u.invalidated=!0,e.checkTextureUtility(c)}e.removeFromQueue(n)}};Xt.checkTextureUtility=function(n){n.invalidatedWidth>=UA*n.width&&this.retireTexture(n)};Xt.checkTextureFullness=function(n){var e=this,t=e.getTextureQueue(n.height);n.usedWidth/n.width>BA&&n.fullnessChecks>=kA?Zr(t,n):n.fullnessChecks++};Xt.retireTexture=function(n){var e=this,t=n.height,r=e.getTextureQueue(t),i=this.lookup;Zr(r,n),n.retired=!0;for(var a=n.eleCaches,s=0;s<a.length;s++){var o=a[s];i.deleteCache(o.key,o.level)}kc(a);var l=e.getRetiredTextureQueue(t);l.push(n)};Xt.addTexture=function(n,e){var t=this,r=t.getTextureQueue(n),i={};return r.push(i),i.eleCaches=[],i.height=n,i.width=Math.max(IA,e),i.usedWidth=0,i.invalidatedWidth=0,i.fullnessChecks=0,i.canvas=t.renderer.makeOffscreenCanvas(i.width,i.height),i.context=i.canvas.getContext("2d"),i};Xt.recycleTexture=function(n,e){for(var t=this,r=t.getTextureQueue(n),i=t.getRetiredTextureQueue(n),a=0;a<i.length;a++){var s=i[a];if(s.width>=e)return s.retired=!1,s.usedWidth=0,s.invalidatedWidth=0,s.fullnessChecks=0,kc(s.eleCaches),s.context.setTransform(1,0,0,1,0,0),s.context.clearRect(0,0,s.width,s.height),Zr(i,s),r.push(s),s}};Xt.queueElement=function(n,e){var t=this,r=t.getElementQueue(),i=t.getElementKeyToQueue(),a=this.getKey(n),s=i[a];if(s)s.level=Math.max(s.level,e),s.eles.merge(n),s.reqs++,r.updateItem(s);else{var o={eles:n.spawn().merge(n),level:e,reqs:1,key:a};r.push(o),i[a]=o}};Xt.dequeue=function(n){for(var e=this,t=e.getElementQueue(),r=e.getElementKeyToQueue(),i=[],a=e.lookup,s=0;s<XA&&t.size()>0;s++){var o=t.pop(),l=o.key,u=o.eles[0],c=a.hasCache(u,o.level);if(r[l]=null,c)continue;i.push(o);var f=e.getBoundingBox(u);e.getElement(u,f,n,o.level,fa.dequeue)}return i};Xt.removeFromQueue=function(n){var e=this,t=e.getElementQueue(),r=e.getElementKeyToQueue(),i=this.getKey(n),a=r[i];a!=null&&(a.eles.length===1?(a.reqs=Uc,t.updateItem(a),t.pop(),r[i]=null):a.eles.unmerge(n))};Xt.onDequeue=function(n){this.onDequeues.push(n)};Xt.offDequeue=function(n){Zr(this.onDequeues,n)};Xt.setupDequeueing=Fv.setupDequeueing({deqRedrawThreshold:WA,deqCost:zA,deqAvgCost:GA,deqNoDrawCost:VA,deqFastCost:HA,deq:function(e,t,r){return e.dequeue(t,r)},onDeqd:function(e,t){for(var r=0;r<e.onDequeues.length;r++){var i=e.onDequeues[r];i(t)}},shouldRedraw:function(e,t,r,i){for(var a=0;a<t.length;a++)for(var s=t[a].eles,o=0;o<s.length;o++){var l=s[o].boundingBox();if(Gc(l,i))return!0}return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var qA=1,fs=-4,il=2,KA=3.99,$A=50,ZA=50,QA=.15,JA=.1,jA=.9,eC=.9,tC=1,hd=250,nC=4e3*4e3,dd=32767,rC=!0,Bv=function(e){var t=this,r=t.renderer=e,i=r.cy;t.layersByLevel={},t.firstGet=!0,t.lastInvalidationTime=Sr()-2*hd,t.skipping=!1,t.eleTxrDeqs=i.collection(),t.scheduleElementRefinement=Os(function(){t.refineElementTextures(t.eleTxrDeqs),t.eleTxrDeqs.unmerge(t.eleTxrDeqs)},ZA),r.beforeRender(function(s,o){o-t.lastInvalidationTime<=hd?t.skipping=!0:t.skipping=!1},r.beforeRenderPriorities.lyrTxrSkip);var a=function(o,l){return l.reqs-o.reqs};t.layersQueue=new Fs(a),t.setupDequeueing()},tn=Bv.prototype,pd=0,iC=Math.pow(2,53)-1;tn.makeLayer=function(n,e){var t=Math.pow(2,e),r=Math.ceil(n.w*t),i=Math.ceil(n.h*t),a=this.renderer.makeOffscreenCanvas(r,i),s={id:pd=++pd%iC,bb:n,level:e,width:r,height:i,canvas:a,context:a.getContext("2d"),eles:[],elesQueue:[],reqs:0},o=s.context,l=-s.bb.x1,u=-s.bb.y1;return o.scale(t,t),o.translate(l,u),s};tn.getLayers=function(n,e,t){var r=this,i=r.renderer,a=i.cy,s=a.zoom(),o=r.firstGet;if(r.firstGet=!1,t==null){if(t=Math.ceil(zc(s*e)),t<fs)t=fs;else if(s>=KA||t>il)return null}r.validateLayersElesOrdering(t,n);var l=r.layersByLevel,u=Math.pow(2,t),c=l[t]=l[t]||[],f,d=r.levelIsComplete(t,n),h,v=function(){var S=function(P){if(r.validateLayersElesOrdering(P,n),r.levelIsComplete(P,n))return h=l[P],!0},L=function(P){if(!h)for(var A=t+P;fs<=A&&A<=il&&!S(A);A+=P);};L(1),L(-1);for(var N=c.length-1;N>=0;N--){var I=c[N];I.invalid&&Zr(c,I)}};if(!d)v();else return c;var m=function(){if(!f){f=En();for(var S=0;S<n.length;S++)Np(f,n[S].boundingBox())}return f},g=function(S){S=S||{};var L=S.after;m();var N=Math.ceil(f.w*u),I=Math.ceil(f.h*u);if(N>dd||I>dd)return null;var _=N*I;if(_>nC)return null;var P=r.makeLayer(f,t);if(L!=null){var A=c.indexOf(L)+1;c.splice(A,0,P)}else(S.insert===void 0||S.insert)&&c.unshift(P);return P};if(r.skipping&&!o)return null;for(var p=null,x=n.length/qA,y=!o,E=0;E<n.length;E++){var M=n[E],w=M._private.rscratch,b=w.imgLayerCaches=w.imgLayerCaches||{},C=b[t];if(C){p=C;continue}if((!p||p.eles.length>=x||!Ip(p.bb,M.boundingBox()))&&(p=g({insert:!0,after:p}),!p))return null;h||y?r.queueLayer(p,M):r.drawEleInLayer(p,M,t,e),p.eles.push(M),b[t]=p}return h||(y?null:c)};tn.getEleLevelForLayerLevel=function(n,e){return n};tn.drawEleInLayer=function(n,e,t,r){var i=this,a=this.renderer,s=n.context,o=e.boundingBox();o.w===0||o.h===0||!e.visible()||(t=i.getEleLevelForLayerLevel(t,r),a.setImgSmoothing(s,!1),a.drawCachedElement(s,e,null,null,t,rC),a.setImgSmoothing(s,!0))};tn.levelIsComplete=function(n,e){var t=this,r=t.layersByLevel[n];if(!r||r.length===0)return!1;for(var i=0,a=0;a<r.length;a++){var s=r[a];if(s.reqs>0||s.invalid)return!1;i+=s.eles.length}return i===e.length};tn.validateLayersElesOrdering=function(n,e){var t=this.layersByLevel[n];if(t)for(var r=0;r<t.length;r++){for(var i=t[r],a=-1,s=0;s<e.length;s++)if(i.eles[0]===e[s]){a=s;break}if(a<0){this.invalidateLayer(i);continue}for(var o=a,s=0;s<i.eles.length;s++)if(i.eles[s]!==e[o+s]){this.invalidateLayer(i);break}}};tn.updateElementsInLayers=function(n,e){for(var t=this,r=Ns(n[0]),i=0;i<n.length;i++)for(var a=r?null:n[i],s=r?n[i]:n[i].ele,o=s._private.rscratch,l=o.imgLayerCaches=o.imgLayerCaches||{},u=fs;u<=il;u++){var c=l[u];c&&(a&&t.getEleLevelForLayerLevel(c.level)!==a.level||e(c,s,a))}};tn.haveLayers=function(){for(var n=this,e=!1,t=fs;t<=il;t++){var r=n.layersByLevel[t];if(r&&r.length>0){e=!0;break}}return e};tn.invalidateElements=function(n){var e=this;n.length!==0&&(e.lastInvalidationTime=Sr(),!(n.length===0||!e.haveLayers())&&e.updateElementsInLayers(n,function(r,i,a){e.invalidateLayer(r)}))};tn.invalidateLayer=function(n){if(this.lastInvalidationTime=Sr(),!n.invalid){var e=n.level,t=n.eles,r=this.layersByLevel[e];Zr(r,n),n.elesQueue=[],n.invalid=!0,n.replacement&&(n.replacement.invalid=!0);for(var i=0;i<t.length;i++){var a=t[i]._private.rscratch.imgLayerCaches;a&&(a[e]=null)}}};tn.refineElementTextures=function(n){var e=this;e.updateElementsInLayers(n,function(r,i,a){var s=r.replacement;if(s||(s=r.replacement=e.makeLayer(r.bb,r.level),s.replaces=r,s.eles=r.eles),!s.reqs)for(var o=0;o<s.eles.length;o++)e.queueLayer(s,s.eles[o])})};tn.enqueueElementRefinement=function(n){this.eleTxrDeqs.merge(n),this.scheduleElementRefinement()};tn.queueLayer=function(n,e){var t=this,r=t.layersQueue,i=n.elesQueue,a=i.hasId=i.hasId||{};if(!n.replacement){if(e){if(a[e.id()])return;i.push(e),a[e.id()]=!0}n.reqs?(n.reqs++,r.updateItem(n)):(n.reqs=1,r.push(n))}};tn.dequeue=function(n){for(var e=this,t=e.layersQueue,r=[],i=0;i<tC&&t.size()!==0;){var a=t.peek();if(a.replacement){t.pop();continue}if(a.replaces&&a!==a.replaces.replacement){t.pop();continue}if(a.invalid){t.pop();continue}var s=a.elesQueue.shift();s&&(e.drawEleInLayer(a,s,a.level,n),i++),r.length===0&&r.push(!0),a.elesQueue.length===0&&(t.pop(),a.reqs=0,a.replaces&&e.applyLayerReplacement(a),e.requestRedraw())}return r};tn.applyLayerReplacement=function(n){var e=this,t=e.layersByLevel[n.level],r=n.replaces,i=t.indexOf(r);if(!(i<0||r.invalid)){t[i]=n;for(var a=0;a<n.eles.length;a++){var s=n.eles[a]._private,o=s.imgLayerCaches=s.imgLayerCaches||{};o&&(o[n.level]=n)}e.requestRedraw()}};tn.requestRedraw=Os(function(){var n=this.renderer;n.redrawHint("eles",!0),n.redrawHint("drag",!0),n.redraw()},100);tn.setupDequeueing=Fv.setupDequeueing({deqRedrawThreshold:$A,deqCost:QA,deqAvgCost:JA,deqNoDrawCost:jA,deqFastCost:eC,deq:function(e,t){return e.dequeue(t)},onDeqd:Bc,shouldRedraw:Ap,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var kv={},vd;function aC(n,e){for(var t=0;t<e.length;t++){var r=e[t];n.lineTo(r.x,r.y)}}function sC(n,e,t){for(var r,i=0;i<e.length;i++){var a=e[i];i===0&&(r=a),n.lineTo(a.x,a.y)}n.quadraticCurveTo(t.x,t.y,r.x,r.y)}function gd(n,e,t){n.beginPath&&n.beginPath();for(var r=e,i=0;i<r.length;i++){var a=r[i];n.lineTo(a.x,a.y)}var s=t,o=t[0];n.moveTo(o.x,o.y);for(var i=1;i<s.length;i++){var a=s[i];n.lineTo(a.x,a.y)}n.closePath&&n.closePath()}function oC(n,e,t,r,i){n.beginPath&&n.beginPath(),n.arc(t,r,i,0,Math.PI*2,!1);var a=e,s=a[0];n.moveTo(s.x,s.y);for(var o=0;o<a.length;o++){var l=a[o];n.lineTo(l.x,l.y)}n.closePath&&n.closePath()}function lC(n,e,t,r){n.arc(e,t,r,0,Math.PI*2,!1)}kv.arrowShapeImpl=function(n){return(vd||(vd={polygon:aC,"triangle-backcurve":sC,"triangle-tee":gd,"circle-triangle":oC,"triangle-cross":gd,circle:lC}))[n]};var cr={};cr.drawElement=function(n,e,t,r,i,a){var s=this;e.isNode()?s.drawNode(n,e,t,r,i,a):s.drawEdge(n,e,t,r,i,a)};cr.drawElementOverlay=function(n,e){var t=this;e.isNode()?t.drawNodeOverlay(n,e):t.drawEdgeOverlay(n,e)};cr.drawElementUnderlay=function(n,e){var t=this;e.isNode()?t.drawNodeUnderlay(n,e):t.drawEdgeUnderlay(n,e)};cr.drawCachedElementPortion=function(n,e,t,r,i,a,s,o){var l=this,u=t.getBoundingBox(e);if(!(u.w===0||u.h===0)){var c=t.getElement(e,u,r,i,a);if(c!=null){var f=o(l,e);if(f===0)return;var d=s(l,e),h=u.x1,v=u.y1,m=u.w,g=u.h,p,x,y,E,M;if(d!==0){var w=t.getRotationPoint(e);y=w.x,E=w.y,n.translate(y,E),n.rotate(d),M=l.getImgSmoothing(n),M||l.setImgSmoothing(n,!0);var b=t.getRotationOffset(e);p=b.x,x=b.y}else p=h,x=v;var C;f!==1&&(C=n.globalAlpha,n.globalAlpha=C*f),n.drawImage(c.texture.canvas,c.x,0,c.width,c.height,p,x,m,g),f!==1&&(n.globalAlpha=C),d!==0&&(n.rotate(-d),n.translate(-y,-E),M||l.setImgSmoothing(n,!1))}else t.drawElement(n,e)}};var uC=function(){return 0},cC=function(e,t){return e.getTextAngle(t,null)},fC=function(e,t){return e.getTextAngle(t,"source")},hC=function(e,t){return e.getTextAngle(t,"target")},dC=function(e,t){return t.effectiveOpacity()},du=function(e,t){return t.pstyle("text-opacity").pfValue*t.effectiveOpacity()};cr.drawCachedElement=function(n,e,t,r,i,a){var s=this,o=s.data,l=o.eleTxrCache,u=o.lblTxrCache,c=o.slbTxrCache,f=o.tlbTxrCache,d=e.boundingBox(),h=a===!0?l.reasons.highQuality:null;if(!(d.w===0||d.h===0||!e.visible())&&(!r||Gc(d,r))){var v=e.isEdge(),m=e.element()._private.rscratch.badLine;s.drawElementUnderlay(n,e),s.drawCachedElementPortion(n,e,l,t,i,h,uC,dC),(!v||!m)&&s.drawCachedElementPortion(n,e,u,t,i,h,cC,du),v&&!m&&(s.drawCachedElementPortion(n,e,c,t,i,h,fC,du),s.drawCachedElementPortion(n,e,f,t,i,h,hC,du)),s.drawElementOverlay(n,e)}};cr.drawElements=function(n,e){for(var t=this,r=0;r<e.length;r++){var i=e[r];t.drawElement(n,i)}};cr.drawCachedElements=function(n,e,t,r){for(var i=this,a=0;a<e.length;a++){var s=e[a];i.drawCachedElement(n,s,t,r)}};cr.drawCachedNodes=function(n,e,t,r){for(var i=this,a=0;a<e.length;a++){var s=e[a];s.isNode()&&i.drawCachedElement(n,s,t,r)}};cr.drawLayeredElements=function(n,e,t,r){var i=this,a=i.data.lyrTxrCache.getLayers(e,t);if(a)for(var s=0;s<a.length;s++){var o=a[s],l=o.bb;l.w===0||l.h===0||n.drawImage(o.canvas,l.x1,l.y1,l.w,l.h)}else i.drawCachedElements(n,e,t,r)};var Cr={};Cr.drawEdge=function(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o=e._private.rscratch;if(!(a&&!e.visible())&&!(o.badLine||o.allpts==null||isNaN(o.allpts[0]))){var l;t&&(l=t,n.translate(-l.x1,-l.y1));var u=a?e.pstyle("opacity").value:1,c=a?e.pstyle("line-opacity").value:1,f=e.pstyle("curve-style").value,d=e.pstyle("line-style").value,h=e.pstyle("width").pfValue,v=e.pstyle("line-cap").value,m=e.pstyle("line-outline-width").value,g=e.pstyle("line-outline-color").value,p=u*c,x=u*c,y=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p;f==="straight-triangle"?(s.eleStrokeStyle(n,e,P),s.drawEdgeTrianglePath(e,n,o.allpts)):(n.lineWidth=h,n.lineCap=v,s.eleStrokeStyle(n,e,P),s.drawEdgePath(e,n,o.allpts,d),n.lineCap="butt")},E=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p;if(n.lineWidth=h+m,n.lineCap=v,m>0)s.colorStrokeStyle(n,g[0],g[1],g[2],P);else{n.lineCap="butt";return}f==="straight-triangle"?s.drawEdgeTrianglePath(e,n,o.allpts):(s.drawEdgePath(e,n,o.allpts,d),n.lineCap="butt")},M=function(){i&&s.drawEdgeOverlay(n,e)},w=function(){i&&s.drawEdgeUnderlay(n,e)},b=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:x;s.drawArrowheads(n,e,P)},C=function(){s.drawElementText(n,e,null,r)};n.lineJoin="round";var T=e.pstyle("ghost").value==="yes";if(T){var S=e.pstyle("ghost-offset-x").pfValue,L=e.pstyle("ghost-offset-y").pfValue,N=e.pstyle("ghost-opacity").value,I=p*N;n.translate(S,L),y(I),b(I),n.translate(-S,-L)}else E();w(),y(),b(),M(),C(),t&&n.translate(l.x1,l.y1)}};var zv=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(t,r){if(r.visible()){var i=r.pstyle("".concat(e,"-opacity")).value;if(i!==0){var a=this,s=a.usePaths(),o=r._private.rscratch,l=r.pstyle("".concat(e,"-padding")).pfValue,u=2*l,c=r.pstyle("".concat(e,"-color")).value;t.lineWidth=u,o.edgeType==="self"&&!s?t.lineCap="butt":t.lineCap="round",a.colorStrokeStyle(t,c[0],c[1],c[2],i),a.drawEdgePath(r,t,o.allpts,"solid")}}}};Cr.drawEdgeOverlay=zv("overlay");Cr.drawEdgeUnderlay=zv("underlay");Cr.drawEdgePath=function(n,e,t,r){var i=n._private.rscratch,a=e,s,o=!1,l=this.usePaths(),u=n.pstyle("line-dash-pattern").pfValue,c=n.pstyle("line-dash-offset").pfValue;if(l){var f=t.join("$"),d=i.pathCacheKey&&i.pathCacheKey===f;d?(s=e=i.pathCache,o=!0):(s=e=new Path2D,i.pathCacheKey=f,i.pathCache=s)}if(a.setLineDash)switch(r){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(u),a.lineDashOffset=c;break;case"solid":a.setLineDash([]);break}if(!o&&!i.badLine)switch(e.beginPath&&e.beginPath(),e.moveTo(t[0],t[1]),i.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var h=2;h+3<t.length;h+=4)e.quadraticCurveTo(t[h],t[h+1],t[h+2],t[h+3]);break;case"straight":case"haystack":for(var v=2;v+1<t.length;v+=2)e.lineTo(t[v],t[v+1]);break;case"segments":if(i.isRound){var m=Mn(i.roundCorners),g;try{for(m.s();!(g=m.n()).done;){var p=g.value;Cv(e,p)}}catch(y){m.e(y)}finally{m.f()}e.lineTo(t[t.length-2],t[t.length-1])}else for(var x=2;x+1<t.length;x+=2)e.lineTo(t[x],t[x+1]);break}e=a,l?e.stroke(s):e.stroke(),e.setLineDash&&e.setLineDash([])};Cr.drawEdgeTrianglePath=function(n,e,t){e.fillStyle=e.strokeStyle;for(var r=n.pstyle("width").pfValue,i=0;i+1<t.length;i+=2){var a=[t[i+2]-t[i],t[i+3]-t[i+1]],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=[a[1]/s,-a[0]/s],l=[o[0]*r/2,o[1]*r/2];e.beginPath(),e.moveTo(t[i]-l[0],t[i+1]-l[1]),e.lineTo(t[i]+l[0],t[i+1]+l[1]),e.lineTo(t[i+2],t[i+3]),e.closePath(),e.fill()}};Cr.drawArrowheads=function(n,e,t){var r=e._private.rscratch,i=r.edgeType==="haystack";i||this.drawArrowhead(n,e,"source",r.arrowStartX,r.arrowStartY,r.srcArrowAngle,t),this.drawArrowhead(n,e,"mid-target",r.midX,r.midY,r.midtgtArrowAngle,t),this.drawArrowhead(n,e,"mid-source",r.midX,r.midY,r.midsrcArrowAngle,t),i||this.drawArrowhead(n,e,"target",r.arrowEndX,r.arrowEndY,r.tgtArrowAngle,t)};Cr.drawArrowhead=function(n,e,t,r,i,a,s){if(!(isNaN(r)||r==null||isNaN(i)||i==null||isNaN(a)||a==null)){var o=this,l=e.pstyle(t+"-arrow-shape").value;if(l!=="none"){var u=e.pstyle(t+"-arrow-fill").value==="hollow"?"both":"filled",c=e.pstyle(t+"-arrow-fill").value,f=e.pstyle("width").pfValue,d=e.pstyle(t+"-arrow-width"),h=d.value==="match-line"?f:d.pfValue;d.units==="%"&&(h*=f);var v=e.pstyle("opacity").value;s===void 0&&(s=v);var m=n.globalCompositeOperation;(s!==1||c==="hollow")&&(n.globalCompositeOperation="destination-out",o.colorFillStyle(n,255,255,255,1),o.colorStrokeStyle(n,255,255,255,1),o.drawArrowShape(e,n,u,f,l,h,r,i,a),n.globalCompositeOperation=m);var g=e.pstyle(t+"-arrow-color").value;o.colorFillStyle(n,g[0],g[1],g[2],s),o.colorStrokeStyle(n,g[0],g[1],g[2],s),o.drawArrowShape(e,n,c,f,l,h,r,i,a)}}};Cr.drawArrowShape=function(n,e,t,r,i,a,s,o,l){var u=this,c=this.usePaths()&&i!=="triangle-cross",f=!1,d,h=e,v={x:s,y:o},m=n.pstyle("arrow-scale").value,g=this.getArrowWidth(r,m),p=u.arrowShapes[i];if(c){var x=u.arrowPathCache=u.arrowPathCache||[],y=$r(i),E=x[y];E!=null?(d=e=E,f=!0):(d=e=new Path2D,x[y]=d)}f||(e.beginPath&&e.beginPath(),c?p.draw(e,1,0,{x:0,y:0},1):p.draw(e,g,l,v,r),e.closePath&&e.closePath()),e=h,c&&(e.translate(s,o),e.rotate(l),e.scale(g,g)),(t==="filled"||t==="both")&&(c?e.fill(d):e.fill()),(t==="hollow"||t==="both")&&(e.lineWidth=a/(c?g:1),e.lineJoin="miter",c?e.stroke(d):e.stroke()),c&&(e.scale(1/g,1/g),e.rotate(-l),e.translate(-s,-o))};var nf={};nf.safeDrawImage=function(n,e,t,r,i,a,s,o,l,u){if(!(i<=0||a<=0||l<=0||u<=0))try{n.drawImage(e,t,r,i,a,s,o,l,u)}catch(c){Et(c)}};nf.drawInscribedImage=function(n,e,t,r,i){var a=this,s=t.position(),o=s.x,l=s.y,u=t.cy().style(),c=u.getIndexedStyle.bind(u),f=c(t,"background-fit","value",r),d=c(t,"background-repeat","value",r),h=t.width(),v=t.height(),m=t.padding()*2,g=h+(c(t,"background-width-relative-to","value",r)==="inner"?0:m),p=v+(c(t,"background-height-relative-to","value",r)==="inner"?0:m),x=t._private.rscratch,y=c(t,"background-clip","value",r),E=y==="node",M=c(t,"background-image-opacity","value",r)*i,w=c(t,"background-image-smoothing","value",r),b=t.pstyle("corner-radius").value;b!=="auto"&&(b=t.pstyle("corner-radius").pfValue);var C=e.width||e.cachedW,T=e.height||e.cachedH;(C==null||T==null)&&(document.body.appendChild(e),C=e.cachedW=e.width||e.offsetWidth,T=e.cachedH=e.height||e.offsetHeight,document.body.removeChild(e));var S=C,L=T;if(c(t,"background-width","value",r)!=="auto"&&(c(t,"background-width","units",r)==="%"?S=c(t,"background-width","pfValue",r)*g:S=c(t,"background-width","pfValue",r)),c(t,"background-height","value",r)!=="auto"&&(c(t,"background-height","units",r)==="%"?L=c(t,"background-height","pfValue",r)*p:L=c(t,"background-height","pfValue",r)),!(S===0||L===0)){if(f==="contain"){var N=Math.min(g/S,p/L);S*=N,L*=N}else if(f==="cover"){var N=Math.max(g/S,p/L);S*=N,L*=N}var I=o-g/2,_=c(t,"background-position-x","units",r),P=c(t,"background-position-x","pfValue",r);_==="%"?I+=(g-S)*P:I+=P;var A=c(t,"background-offset-x","units",r),D=c(t,"background-offset-x","pfValue",r);A==="%"?I+=(g-S)*D:I+=D;var R=l-p/2,B=c(t,"background-position-y","units",r),k=c(t,"background-position-y","pfValue",r);B==="%"?R+=(p-L)*k:R+=k;var V=c(t,"background-offset-y","units",r),Y=c(t,"background-offset-y","pfValue",r);V==="%"?R+=(p-L)*Y:R+=Y,x.pathCache&&(I-=o,R-=l,o=0,l=0);var Z=n.globalAlpha;n.globalAlpha=M;var W=a.getImgSmoothing(n),K=!1;if(w==="no"&&W?(a.setImgSmoothing(n,!1),K=!0):w==="yes"&&!W&&(a.setImgSmoothing(n,!0),K=!0),d==="no-repeat")E&&(n.save(),x.pathCache?n.clip(x.pathCache):(a.nodeShapes[a.getNodeShape(t)].draw(n,o,l,g,p,b,x),n.clip())),a.safeDrawImage(n,e,0,0,C,T,I,R,S,L),E&&n.restore();else{var Q=n.createPattern(e,d);n.fillStyle=Q,a.nodeShapes[a.getNodeShape(t)].draw(n,o,l,g,p,b,x),n.translate(I,R),n.fill(),n.translate(-I,-R)}n.globalAlpha=Z,K&&a.setImgSmoothing(n,W)}};var Fi={};Fi.eleTextBiggerThanMin=function(n,e){if(!e){var t=n.cy().zoom(),r=this.getPixelRatio(),i=Math.ceil(zc(t*r));e=Math.pow(2,i)}var a=n.pstyle("font-size").pfValue*e,s=n.pstyle("min-zoomed-font-size").pfValue;return!(a<s)};Fi.drawElementText=function(n,e,t,r,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this;if(r==null){if(a&&!s.eleTextBiggerThanMin(e))return}else if(r===!1)return;if(e.isNode()){var o=e.pstyle("label");if(!o||!o.value)return;var l=s.getLabelJustification(e);n.textAlign=l,n.textBaseline="bottom"}else{var u=e.element()._private.rscratch.badLine,c=e.pstyle("label"),f=e.pstyle("source-label"),d=e.pstyle("target-label");if(u||(!c||!c.value)&&(!f||!f.value)&&(!d||!d.value))return;n.textAlign="center",n.textBaseline="bottom"}var h=!t,v;t&&(v=t,n.translate(-v.x1,-v.y1)),i==null?(s.drawText(n,e,null,h,a),e.isEdge()&&(s.drawText(n,e,"source",h,a),s.drawText(n,e,"target",h,a))):s.drawText(n,e,i,h,a),t&&n.translate(v.x1,v.y1)};Fi.getFontCache=function(n){var e;this.fontCaches=this.fontCaches||[];for(var t=0;t<this.fontCaches.length;t++)if(e=this.fontCaches[t],e.context===n)return e;return e={context:n},this.fontCaches.push(e),e};Fi.setupTextStyle=function(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=e.pstyle("font-style").strValue,i=e.pstyle("font-size").pfValue+"px",a=e.pstyle("font-family").strValue,s=e.pstyle("font-weight").strValue,o=t?e.effectiveOpacity()*e.pstyle("text-opacity").value:1,l=e.pstyle("text-outline-opacity").value*o,u=e.pstyle("color").value,c=e.pstyle("text-outline-color").value;n.font=r+" "+s+" "+i+" "+a,n.lineJoin="round",this.colorFillStyle(n,u[0],u[1],u[2],o),this.colorStrokeStyle(n,c[0],c[1],c[2],l)};function pu(n,e,t,r,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,s=arguments.length>6?arguments[6]:void 0;n.beginPath(),n.moveTo(e+a,t),n.lineTo(e+r-a,t),n.quadraticCurveTo(e+r,t,e+r,t+a),n.lineTo(e+r,t+i-a),n.quadraticCurveTo(e+r,t+i,e+r-a,t+i),n.lineTo(e+a,t+i),n.quadraticCurveTo(e,t+i,e,t+i-a),n.lineTo(e,t+a),n.quadraticCurveTo(e,t,e+a,t),n.closePath(),s?n.stroke():n.fill()}Fi.getTextAngle=function(n,e){var t,r=n._private,i=r.rscratch,a=e?e+"-":"",s=n.pstyle(a+"text-rotation");if(s.strValue==="autorotate"){var o=Hn(i,"labelAngle",e);t=n.isEdge()?o:0}else s.strValue==="none"?t=0:t=s.pfValue;return t};Fi.drawText=function(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=e._private,s=a.rscratch,o=i?e.effectiveOpacity():1;if(!(i&&(o===0||e.pstyle("text-opacity").value===0))){t==="main"&&(t=null);var l=Hn(s,"labelX",t),u=Hn(s,"labelY",t),c,f,d=this.getLabelText(e,t);if(d!=null&&d!==""&&!isNaN(l)&&!isNaN(u)){this.setupTextStyle(n,e,i);var h=t?t+"-":"",v=Hn(s,"labelWidth",t),m=Hn(s,"labelHeight",t),g=e.pstyle(h+"text-margin-x").pfValue,p=e.pstyle(h+"text-margin-y").pfValue,x=e.isEdge(),y=e.pstyle("text-halign").value,E=e.pstyle("text-valign").value;x&&(y="center",E="center"),l+=g,u+=p;var M;switch(r?M=this.getTextAngle(e,t):M=0,M!==0&&(c=l,f=u,n.translate(c,f),n.rotate(M),l=0,u=0),E){case"top":break;case"center":u+=m/2;break;case"bottom":u+=m;break}var w=e.pstyle("text-background-opacity").value,b=e.pstyle("text-border-opacity").value,C=e.pstyle("text-border-width").pfValue,T=e.pstyle("text-background-padding").pfValue,S=e.pstyle("text-background-shape").strValue,L=S.indexOf("round")===0,N=2;if(w>0||C>0&&b>0){var I=l-T;switch(y){case"left":I-=v;break;case"center":I-=v/2;break}var _=u-m-T,P=v+2*T,A=m+2*T;if(w>0){var D=n.fillStyle,R=e.pstyle("text-background-color").value;n.fillStyle="rgba("+R[0]+","+R[1]+","+R[2]+","+w*o+")",L?pu(n,I,_,P,A,N):n.fillRect(I,_,P,A),n.fillStyle=D}if(C>0&&b>0){var B=n.strokeStyle,k=n.lineWidth,V=e.pstyle("text-border-color").value,Y=e.pstyle("text-border-style").value;if(n.strokeStyle="rgba("+V[0]+","+V[1]+","+V[2]+","+b*o+")",n.lineWidth=C,n.setLineDash)switch(Y){case"dotted":n.setLineDash([1,1]);break;case"dashed":n.setLineDash([4,2]);break;case"double":n.lineWidth=C/4,n.setLineDash([]);break;case"solid":n.setLineDash([]);break}if(L?pu(n,I,_,P,A,N,"stroke"):n.strokeRect(I,_,P,A),Y==="double"){var Z=C/2;L?pu(n,I+Z,_+Z,P-Z*2,A-Z*2,N,"stroke"):n.strokeRect(I+Z,_+Z,P-Z*2,A-Z*2)}n.setLineDash&&n.setLineDash([]),n.lineWidth=k,n.strokeStyle=B}}var W=2*e.pstyle("text-outline-width").pfValue;if(W>0&&(n.lineWidth=W),e.pstyle("text-wrap").value==="wrap"){var K=Hn(s,"labelWrapCachedLines",t),Q=Hn(s,"labelLineHeight",t),ne=v/2,ie=this.getLabelJustification(e);switch(ie==="auto"||(y==="left"?ie==="left"?l+=-v:ie==="center"&&(l+=-ne):y==="center"?ie==="left"?l+=-ne:ie==="right"&&(l+=ne):y==="right"&&(ie==="center"?l+=ne:ie==="right"&&(l+=v))),E){case"top":u-=(K.length-1)*Q;break;case"center":case"bottom":u-=(K.length-1)*Q;break}for(var H=0;H<K.length;H++)W>0&&n.strokeText(K[H],l,u),n.fillText(K[H],l,u),u+=Q}else W>0&&n.strokeText(d,l,u),n.fillText(d,l,u);M!==0&&(n.rotate(-M),n.translate(-c,-f))}}};var Va={};Va.drawNode=function(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o,l,u=e._private,c=u.rscratch,f=e.position();if(!(!ke(f.x)||!ke(f.y))&&!(a&&!e.visible())){var d=a?e.effectiveOpacity():1,h=s.usePaths(),v,m=!1,g=e.padding();o=e.width()+2*g,l=e.height()+2*g;var p;t&&(p=t,n.translate(-p.x1,-p.y1));for(var x=e.pstyle("background-image"),y=x.value,E=new Array(y.length),M=new Array(y.length),w=0,b=0;b<y.length;b++){var C=y[b],T=E[b]=C!=null&&C!=="none";if(T){var S=e.cy().style().getIndexedStyle(e,"background-image-crossorigin","value",b);w++,M[b]=s.getCachedImage(C,S,function(){u.backgroundTimestamp=Date.now(),e.emitAndNotify("background")})}}var L=e.pstyle("background-blacken").value,N=e.pstyle("border-width").pfValue,I=e.pstyle("background-opacity").value*d,_=e.pstyle("border-color").value,P=e.pstyle("border-style").value,A=e.pstyle("border-join").value,D=e.pstyle("border-cap").value,R=e.pstyle("border-position").value,B=e.pstyle("border-dash-pattern").pfValue,k=e.pstyle("border-dash-offset").pfValue,V=e.pstyle("border-opacity").value*d,Y=e.pstyle("outline-width").pfValue,Z=e.pstyle("outline-color").value,W=e.pstyle("outline-style").value,K=e.pstyle("outline-opacity").value*d,Q=e.pstyle("outline-offset").value,ne=e.pstyle("corner-radius").value;ne!=="auto"&&(ne=e.pstyle("corner-radius").pfValue);var ie=function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I;s.eleFillStyle(n,e,le)},H=function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:V;s.colorStrokeStyle(n,_[0],_[1],_[2],le)},X=function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:K;s.colorStrokeStyle(n,Z[0],Z[1],Z[2],le)},te=function(le,ee,J,$){var oe=s.nodePathCache=s.nodePathCache||[],fe=wp(J==="polygon"?J+","+$.join(","):J,""+ee,""+le,""+ne),ye=oe[fe],xe,Ce=!1;return ye!=null?(xe=ye,Ce=!0,c.pathCache=xe):(xe=new Path2D,oe[fe]=c.pathCache=xe),{path:xe,cacheHit:Ce}},ue=e.pstyle("shape").strValue,Se=e.pstyle("shape-polygon-points").pfValue;if(h){n.translate(f.x,f.y);var U=te(o,l,ue,Se);v=U.path,m=U.cacheHit}var Ge=function(){if(!m){var le=f;h&&(le={x:0,y:0}),s.nodeShapes[s.getNodeShape(e)].draw(v||n,le.x,le.y,o,l,ne,c)}h?n.fill(v):n.fill()},Le=function(){for(var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:d,ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,J=u.backgrounding,$=0,oe=0;oe<M.length;oe++){var fe=e.cy().style().getIndexedStyle(e,"background-image-containment","value",oe);if(ee&&fe==="over"||!ee&&fe==="inside"){$++;continue}E[oe]&&M[oe].complete&&!M[oe].error&&($++,s.drawInscribedImage(n,M[oe],e,oe,le))}u.backgrounding=$!==w,J!==u.backgrounding&&e.updateStyle(!1)},De=function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:d;s.hasPie(e)&&(s.drawPie(n,e,ee),le&&(h||s.nodeShapes[s.getNodeShape(e)].draw(n,f.x,f.y,o,l,ne,c)))},de=function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:d,ee=(L>0?L:-L)*le,J=L>0?0:255;L!==0&&(s.colorFillStyle(n,J,J,J,ee),h?n.fill(v):n.fill())},we=function(){if(N>0){if(n.lineWidth=N,n.lineCap=D,n.lineJoin=A,n.setLineDash)switch(P){case"dotted":n.setLineDash([1,1]);break;case"dashed":n.setLineDash(B),n.lineDashOffset=k;break;case"solid":case"double":n.setLineDash([]);break}if(R!=="center"){if(n.save(),n.lineWidth*=2,R==="inside")h?n.clip(v):n.clip();else{var le=new Path2D;le.rect(-o/2-N,-l/2-N,o+2*N,l+2*N),le.addPath(v),n.clip(le,"evenodd")}h?n.stroke(v):n.stroke(),n.restore()}else h?n.stroke(v):n.stroke();if(P==="double"){n.lineWidth=N/3;var ee=n.globalCompositeOperation;n.globalCompositeOperation="destination-out",h?n.stroke(v):n.stroke(),n.globalCompositeOperation=ee}n.setLineDash&&n.setLineDash([])}},Me=function(){if(Y>0){if(n.lineWidth=Y,n.lineCap="butt",n.setLineDash)switch(W){case"dotted":n.setLineDash([1,1]);break;case"dashed":n.setLineDash([4,2]);break;case"solid":case"double":n.setLineDash([]);break}var le=f;h&&(le={x:0,y:0});var ee=s.getNodeShape(e),J=N;R==="inside"&&(J=0),R==="outside"&&(J*=2);var $=(o+J+(Y+Q))/o,oe=(l+J+(Y+Q))/l,fe=o*$,ye=l*oe,xe=s.nodeShapes[ee].points,Ce;if(h){var q=te(fe,ye,ee,xe);Ce=q.path}if(ee==="ellipse")s.drawEllipsePath(Ce||n,le.x,le.y,fe,ye);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(ee)){var he=0,se=0,ge=0;ee==="round-diamond"?he=(J+Q+Y)*1.4:ee==="round-heptagon"?(he=(J+Q+Y)*1.075,ge=-(J/2+Q+Y)/35):ee==="round-hexagon"?he=(J+Q+Y)*1.12:ee==="round-pentagon"?(he=(J+Q+Y)*1.13,ge=-(J/2+Q+Y)/15):ee==="round-tag"?(he=(J+Q+Y)*1.12,se=(J/2+Y+Q)*.07):ee==="round-triangle"&&(he=(J+Q+Y)*(Math.PI/2),ge=-(J+Q/2+Y)/Math.PI),he!==0&&($=(o+he)/o,fe=o*$,["round-hexagon","round-tag"].includes(ee)||(oe=(l+he)/l,ye=l*oe)),ne=ne==="auto"?Up(fe,ye):ne;for(var Re=fe/2,Ae=ye/2,Fe=ne+(J+Y+Q)/2,Ie=new Array(xe.length/2),Oe=new Array(xe.length/2),Be=0;Be<xe.length/2;Be++)Ie[Be]={x:le.x+se+Re*xe[Be*2],y:le.y+ge+Ae*xe[Be*2+1]};var ze,We,pt,je,Qe=Ie.length;for(We=Ie[Qe-1],ze=0;ze<Qe;ze++)pt=Ie[ze%Qe],je=Ie[(ze+1)%Qe],Oe[ze]=ef(We,pt,je,Fe),We=pt,pt=je;s.drawRoundPolygonPath(Ce||n,le.x+se,le.y+ge,o*$,l*oe,xe,Oe)}else if(["roundrectangle","round-rectangle"].includes(ee))ne=ne==="auto"?Ri(fe,ye):ne,s.drawRoundRectanglePath(Ce||n,le.x,le.y,fe,ye,ne+(J+Y+Q)/2);else if(["cutrectangle","cut-rectangle"].includes(ee))ne=ne==="auto"?Vc():ne,s.drawCutRectanglePath(Ce||n,le.x,le.y,fe,ye,null,ne+(J+Y+Q)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(ee))ne=ne==="auto"?Ri(fe,ye):ne,s.drawBottomRoundRectanglePath(Ce||n,le.x,le.y,fe,ye,ne+(J+Y+Q)/2);else if(ee==="barrel")s.drawBarrelPath(Ce||n,le.x,le.y,fe,ye);else if(ee.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(ee)){var wt=(J+Y+Q)/o;xe=Qo(Jo(xe,wt)),s.drawPolygonPath(Ce||n,le.x,le.y,o,l,xe)}else{var st=(J+Y+Q)/o;xe=Qo(Jo(xe,-st)),s.drawPolygonPath(Ce||n,le.x,le.y,o,l,xe)}if(h?n.stroke(Ce):n.stroke(),W==="double"){n.lineWidth=J/3;var ut=n.globalCompositeOperation;n.globalCompositeOperation="destination-out",h?n.stroke(Ce):n.stroke(),n.globalCompositeOperation=ut}n.setLineDash&&n.setLineDash([])}},z=function(){i&&s.drawNodeOverlay(n,e,f,o,l)},O=function(){i&&s.drawNodeUnderlay(n,e,f,o,l)},re=function(){s.drawElementText(n,e,null,r)},ve=e.pstyle("ghost").value==="yes";if(ve){var Ee=e.pstyle("ghost-offset-x").pfValue,ae=e.pstyle("ghost-offset-y").pfValue,F=e.pstyle("ghost-opacity").value,j=F*d;n.translate(Ee,ae),X(),Me(),ie(F*I),Ge(),Le(j,!0),H(F*V),we(),De(L!==0||N!==0),Le(j,!1),de(j),n.translate(-Ee,-ae)}h&&n.translate(-f.x,-f.y),O(),h&&n.translate(f.x,f.y),X(),Me(),ie(),Ge(),Le(d,!0),H(),we(),De(L!==0||N!==0),Le(d,!1),de(),h&&n.translate(-f.x,-f.y),re(),z(),t&&n.translate(p.x1,p.y1)}};var Gv=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(t,r,i,a,s){var o=this;if(r.visible()){var l=r.pstyle("".concat(e,"-padding")).pfValue,u=r.pstyle("".concat(e,"-opacity")).value,c=r.pstyle("".concat(e,"-color")).value,f=r.pstyle("".concat(e,"-shape")).value,d=r.pstyle("".concat(e,"-corner-radius")).value;if(u>0){if(i=i||r.position(),a==null||s==null){var h=r.padding();a=r.width()+2*h,s=r.height()+2*h}o.colorFillStyle(t,c[0],c[1],c[2],u),o.nodeShapes[f].draw(t,i.x,i.y,a+l*2,s+l*2,d),t.fill()}}}};Va.drawNodeOverlay=Gv("overlay");Va.drawNodeUnderlay=Gv("underlay");Va.hasPie=function(n){return n=n[0],n._private.hasPie};Va.drawPie=function(n,e,t,r){e=e[0],r=r||e.position();var i=e.cy().style(),a=e.pstyle("pie-size"),s=r.x,o=r.y,l=e.width(),u=e.height(),c=Math.min(l,u)/2,f=0,d=this.usePaths();d&&(s=0,o=0),a.units==="%"?c=c*a.pfValue:a.pfValue!==void 0&&(c=a.pfValue/2);for(var h=1;h<=i.pieBackgroundN;h++){var v=e.pstyle("pie-"+h+"-background-size").value,m=e.pstyle("pie-"+h+"-background-color").value,g=e.pstyle("pie-"+h+"-background-opacity").value*t,p=v/100;p+f>1&&(p=1-f);var x=1.5*Math.PI+2*Math.PI*f,y=2*Math.PI*p,E=x+y;v===0||f>=1||f+p>1||(n.beginPath(),n.moveTo(s,o),n.arc(s,o,c,x,E),n.closePath(),this.colorFillStyle(n,m[0],m[1],m[2],g),n.fill(),f+=p)}};var vn={},pC=100;vn.getPixelRatio=function(){var n=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var e=this.cy.window(),t=n.backingStorePixelRatio||n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;return(e.devicePixelRatio||1)/t};vn.paintCache=function(n){for(var e=this.paintCaches=this.paintCaches||[],t=!0,r,i=0;i<e.length;i++)if(r=e[i],r.context===n){t=!1;break}return t&&(r={context:n},e.push(r)),r};vn.createGradientStyleFor=function(n,e,t,r,i){var a,s=this.usePaths(),o=t.pstyle(e+"-gradient-stop-colors").value,l=t.pstyle(e+"-gradient-stop-positions").pfValue;if(r==="radial-gradient")if(t.isEdge()){var u=t.sourceEndpoint(),c=t.targetEndpoint(),f=t.midpoint(),d=Ci(u,f),h=Ci(c,f);a=n.createRadialGradient(f.x,f.y,0,f.x,f.y,Math.max(d,h))}else{var v=s?{x:0,y:0}:t.position(),m=t.paddedWidth(),g=t.paddedHeight();a=n.createRadialGradient(v.x,v.y,0,v.x,v.y,Math.max(m,g))}else if(t.isEdge()){var p=t.sourceEndpoint(),x=t.targetEndpoint();a=n.createLinearGradient(p.x,p.y,x.x,x.y)}else{var y=s?{x:0,y:0}:t.position(),E=t.paddedWidth(),M=t.paddedHeight(),w=E/2,b=M/2,C=t.pstyle("background-gradient-direction").value;switch(C){case"to-bottom":a=n.createLinearGradient(y.x,y.y-b,y.x,y.y+b);break;case"to-top":a=n.createLinearGradient(y.x,y.y+b,y.x,y.y-b);break;case"to-left":a=n.createLinearGradient(y.x+w,y.y,y.x-w,y.y);break;case"to-right":a=n.createLinearGradient(y.x-w,y.y,y.x+w,y.y);break;case"to-bottom-right":case"to-right-bottom":a=n.createLinearGradient(y.x-w,y.y-b,y.x+w,y.y+b);break;case"to-top-right":case"to-right-top":a=n.createLinearGradient(y.x-w,y.y+b,y.x+w,y.y-b);break;case"to-bottom-left":case"to-left-bottom":a=n.createLinearGradient(y.x+w,y.y-b,y.x-w,y.y+b);break;case"to-top-left":case"to-left-top":a=n.createLinearGradient(y.x+w,y.y+b,y.x-w,y.y-b);break}}if(!a)return null;for(var T=l.length===o.length,S=o.length,L=0;L<S;L++)a.addColorStop(T?l[L]:L/(S-1),"rgba("+o[L][0]+","+o[L][1]+","+o[L][2]+","+i+")");return a};vn.gradientFillStyle=function(n,e,t,r){var i=this.createGradientStyleFor(n,"background",e,t,r);if(!i)return null;n.fillStyle=i};vn.colorFillStyle=function(n,e,t,r,i){n.fillStyle="rgba("+e+","+t+","+r+","+i+")"};vn.eleFillStyle=function(n,e,t){var r=e.pstyle("background-fill").value;if(r==="linear-gradient"||r==="radial-gradient")this.gradientFillStyle(n,e,r,t);else{var i=e.pstyle("background-color").value;this.colorFillStyle(n,i[0],i[1],i[2],t)}};vn.gradientStrokeStyle=function(n,e,t,r){var i=this.createGradientStyleFor(n,"line",e,t,r);if(!i)return null;n.strokeStyle=i};vn.colorStrokeStyle=function(n,e,t,r,i){n.strokeStyle="rgba("+e+","+t+","+r+","+i+")"};vn.eleStrokeStyle=function(n,e,t){var r=e.pstyle("line-fill").value;if(r==="linear-gradient"||r==="radial-gradient")this.gradientStrokeStyle(n,e,r,t);else{var i=e.pstyle("line-color").value;this.colorStrokeStyle(n,i[0],i[1],i[2],t)}};vn.matchCanvasSize=function(n){var e=this,t=e.data,r=e.findContainerClientCoords(),i=r[2],a=r[3],s=e.getPixelRatio(),o=e.motionBlurPxRatio;(n===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE]||n===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG])&&(s=o);var l=i*s,u=a*s,c;if(!(l===e.canvasWidth&&u===e.canvasHeight)){e.fontCaches=null;var f=t.canvasContainer;f.style.width=i+"px",f.style.height=a+"px";for(var d=0;d<e.CANVAS_LAYERS;d++)c=t.canvases[d],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";for(var d=0;d<e.BUFFER_COUNT;d++)c=t.bufferCanvases[d],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";e.textureMult=1,s<=1&&(c=t.bufferCanvases[e.TEXTURE_BUFFER],e.textureMult=2,c.width=l*e.textureMult,c.height=u*e.textureMult),e.canvasWidth=l,e.canvasHeight=u,e.pixelRatio=s}};vn.renderTo=function(n,e,t,r){this.render({forcedContext:n,forcedZoom:e,forcedPan:t,drawAllLayers:!0,forcedPxRatio:r})};vn.clearCanvas=function(){var n=this,e=n.data;function t(r){r.clearRect(0,0,n.canvasWidth,n.canvasHeight)}t(e.contexts[n.NODE]),t(e.contexts[n.DRAG])};vn.render=function(n){var e=this;n=n||Dp();var t=e.cy,r=n.forcedContext,i=n.drawAllLayers,a=n.drawOnlyNodeLayer,s=n.forcedZoom,o=n.forcedPan,l=n.forcedPxRatio===void 0?this.getPixelRatio():n.forcedPxRatio,u=e.data,c=u.canvasNeedsRedraw,f=e.textureOnViewport&&!r&&(e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming),d=n.motionBlur!==void 0?n.motionBlur:e.motionBlur,h=e.motionBlurPxRatio,v=t.hasCompoundNodes(),m=e.hoverData.draggingEles,g=!!(e.hoverData.selecting||e.touchData.selecting);d=d&&!r&&e.motionBlurEnabled&&!g;var p=d;r||(e.prevPxRatio!==l&&(e.invalidateContainerClientCoordsCache(),e.matchCanvasSize(e.container),e.redrawHint("eles",!0),e.redrawHint("drag",!0)),e.prevPxRatio=l),!r&&e.motionBlurTimeout&&clearTimeout(e.motionBlurTimeout),d&&(e.mbFrames==null&&(e.mbFrames=0),e.mbFrames++,e.mbFrames<3&&(p=!1),e.mbFrames>e.minMbLowQualFrames&&(e.motionBlurPxRatio=e.mbPxRBlurry)),e.clearingMotionBlur&&(e.motionBlurPxRatio=1),e.textureDrawLastFrame&&!f&&(c[e.NODE]=!0,c[e.SELECT_BOX]=!0);var x=t.style(),y=t.zoom(),E=s!==void 0?s:y,M=t.pan(),w={x:M.x,y:M.y},b={zoom:y,pan:{x:M.x,y:M.y}},C=e.prevViewport,T=C===void 0||b.zoom!==C.zoom||b.pan.x!==C.pan.x||b.pan.y!==C.pan.y;!T&&!(m&&!v)&&(e.motionBlurPxRatio=1),o&&(w=o),E*=l,w.x*=l,w.y*=l;var S=e.getCachedZSortedEles();function L(H,X,te,ue,Se){var U=H.globalCompositeOperation;H.globalCompositeOperation="destination-out",e.colorFillStyle(H,255,255,255,e.motionBlurTransparency),H.fillRect(X,te,ue,Se),H.globalCompositeOperation=U}function N(H,X){var te,ue,Se,U;!e.clearingMotionBlur&&(H===u.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]||H===u.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG])?(te={x:M.x*h,y:M.y*h},ue=y*h,Se=e.canvasWidth*h,U=e.canvasHeight*h):(te=w,ue=E,Se=e.canvasWidth,U=e.canvasHeight),H.setTransform(1,0,0,1,0,0),X==="motionBlur"?L(H,0,0,Se,U):!r&&(X===void 0||X)&&H.clearRect(0,0,Se,U),i||(H.translate(te.x,te.y),H.scale(ue,ue)),o&&H.translate(o.x,o.y),s&&H.scale(s,s)}if(f||(e.textureDrawLastFrame=!1),f){if(e.textureDrawLastFrame=!0,!e.textureCache){e.textureCache={},e.textureCache.bb=t.mutableElements().boundingBox(),e.textureCache.texture=e.data.bufferCanvases[e.TEXTURE_BUFFER];var I=e.data.bufferContexts[e.TEXTURE_BUFFER];I.setTransform(1,0,0,1,0,0),I.clearRect(0,0,e.canvasWidth*e.textureMult,e.canvasHeight*e.textureMult),e.render({forcedContext:I,drawOnlyNodeLayer:!0,forcedPxRatio:l*e.textureMult});var b=e.textureCache.viewport={zoom:t.zoom(),pan:t.pan(),width:e.canvasWidth,height:e.canvasHeight};b.mpan={x:(0-b.pan.x)/b.zoom,y:(0-b.pan.y)/b.zoom}}c[e.DRAG]=!1,c[e.NODE]=!1;var _=u.contexts[e.NODE],P=e.textureCache.texture,b=e.textureCache.viewport;_.setTransform(1,0,0,1,0,0),d?L(_,0,0,b.width,b.height):_.clearRect(0,0,b.width,b.height);var A=x.core("outside-texture-bg-color").value,D=x.core("outside-texture-bg-opacity").value;e.colorFillStyle(_,A[0],A[1],A[2],D),_.fillRect(0,0,b.width,b.height);var y=t.zoom();N(_,!1),_.clearRect(b.mpan.x,b.mpan.y,b.width/b.zoom/l,b.height/b.zoom/l),_.drawImage(P,b.mpan.x,b.mpan.y,b.width/b.zoom/l,b.height/b.zoom/l)}else e.textureOnViewport&&!r&&(e.textureCache=null);var R=t.extent(),B=e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming||e.hoverData.draggingEles||e.cy.animated(),k=e.hideEdgesOnViewport&&B,V=[];if(V[e.NODE]=!c[e.NODE]&&d&&!e.clearedForMotionBlur[e.NODE]||e.clearingMotionBlur,V[e.NODE]&&(e.clearedForMotionBlur[e.NODE]=!0),V[e.DRAG]=!c[e.DRAG]&&d&&!e.clearedForMotionBlur[e.DRAG]||e.clearingMotionBlur,V[e.DRAG]&&(e.clearedForMotionBlur[e.DRAG]=!0),c[e.NODE]||i||a||V[e.NODE]){var Y=d&&!V[e.NODE]&&h!==1,_=r||(Y?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]:u.contexts[e.NODE]),Z=d&&!Y?"motionBlur":void 0;N(_,Z),k?e.drawCachedNodes(_,S.nondrag,l,R):e.drawLayeredElements(_,S.nondrag,l,R),e.debug&&e.drawDebugPoints(_,S.nondrag),!i&&!d&&(c[e.NODE]=!1)}if(!a&&(c[e.DRAG]||i||V[e.DRAG])){var Y=d&&!V[e.DRAG]&&h!==1,_=r||(Y?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG]:u.contexts[e.DRAG]);N(_,d&&!Y?"motionBlur":void 0),k?e.drawCachedNodes(_,S.drag,l,R):e.drawCachedElements(_,S.drag,l,R),e.debug&&e.drawDebugPoints(_,S.drag),!i&&!d&&(c[e.DRAG]=!1)}if(this.drawSelectionRectangle(n,N),d&&h!==1){var W=u.contexts[e.NODE],K=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE],Q=u.contexts[e.DRAG],ne=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG],ie=function(X,te,ue){X.setTransform(1,0,0,1,0,0),ue||!p?X.clearRect(0,0,e.canvasWidth,e.canvasHeight):L(X,0,0,e.canvasWidth,e.canvasHeight);var Se=h;X.drawImage(te,0,0,e.canvasWidth*Se,e.canvasHeight*Se,0,0,e.canvasWidth,e.canvasHeight)};(c[e.NODE]||V[e.NODE])&&(ie(W,K,V[e.NODE]),c[e.NODE]=!1),(c[e.DRAG]||V[e.DRAG])&&(ie(Q,ne,V[e.DRAG]),c[e.DRAG]=!1)}e.prevViewport=b,e.clearingMotionBlur&&(e.clearingMotionBlur=!1,e.motionBlurCleared=!0,e.motionBlur=!0),d&&(e.motionBlurTimeout=setTimeout(function(){e.motionBlurTimeout=null,e.clearedForMotionBlur[e.NODE]=!1,e.clearedForMotionBlur[e.DRAG]=!1,e.motionBlur=!1,e.clearingMotionBlur=!f,e.mbFrames=0,c[e.NODE]=!0,c[e.DRAG]=!0,e.redraw()},pC)),r||t.emit("render")};var es;vn.drawSelectionRectangle=function(n,e){var t=this,r=t.cy,i=t.data,a=r.style(),s=n.drawOnlyNodeLayer,o=n.drawAllLayers,l=i.canvasNeedsRedraw,u=n.forcedContext;if(t.showFps||!s&&l[t.SELECT_BOX]&&!o){var c=u||i.contexts[t.SELECT_BOX];if(e(c),t.selection[4]==1&&(t.hoverData.selecting||t.touchData.selecting)){var f=t.cy.zoom(),d=a.core("selection-box-border-width").value/f;c.lineWidth=d,c.fillStyle="rgba("+a.core("selection-box-color").value[0]+","+a.core("selection-box-color").value[1]+","+a.core("selection-box-color").value[2]+","+a.core("selection-box-opacity").value+")",c.fillRect(t.selection[0],t.selection[1],t.selection[2]-t.selection[0],t.selection[3]-t.selection[1]),d>0&&(c.strokeStyle="rgba("+a.core("selection-box-border-color").value[0]+","+a.core("selection-box-border-color").value[1]+","+a.core("selection-box-border-color").value[2]+","+a.core("selection-box-opacity").value+")",c.strokeRect(t.selection[0],t.selection[1],t.selection[2]-t.selection[0],t.selection[3]-t.selection[1]))}if(i.bgActivePosistion&&!t.hoverData.selecting){var f=t.cy.zoom(),h=i.bgActivePosistion;c.fillStyle="rgba("+a.core("active-bg-color").value[0]+","+a.core("active-bg-color").value[1]+","+a.core("active-bg-color").value[2]+","+a.core("active-bg-opacity").value+")",c.beginPath(),c.arc(h.x,h.y,a.core("active-bg-size").pfValue/f,0,2*Math.PI),c.fill()}var v=t.lastRedrawTime;if(t.showFps&&v){v=Math.round(v);var m=Math.round(1e3/v),g="1 frame = "+v+" ms = "+m+" fps";if(c.setTransform(1,0,0,1,0,0),c.fillStyle="rgba(255, 0, 0, 0.75)",c.strokeStyle="rgba(255, 0, 0, 0.75)",c.font="30px Arial",!es){var p=c.measureText(g);es=p.actualBoundingBoxAscent}c.fillText(g,0,es);var x=60;c.strokeRect(0,es+10,250,20),c.fillRect(0,es+10,250*Math.min(m/x,1),20)}o||(l[t.SELECT_BOX]=!1)}};function md(n,e,t){var r=n.createShader(e);if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))throw new Error(n.getShaderInfoLog(r));return r}function vC(n,e,t){var r=md(n,n.VERTEX_SHADER,e),i=md(n,n.FRAGMENT_SHADER,t),a=n.createProgram();if(n.attachShader(a,r),n.attachShader(a,i),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS))throw new Error("Could not initialize shaders");return a}function gC(n,e,t){t===void 0&&(t=e);var r=n.makeOffscreenCanvas(e,t),i=r.context=r.getContext("2d");return r.clear=function(){return i.clearRect(0,0,r.width,r.height)},r.clear(),r}function rf(n){var e=n.pixelRatio,t=n.cy.zoom(),r=n.cy.pan();return{zoom:t*e,pan:{x:r.x*e,y:r.y*e}}}function mC(n,e,t,r,i){var a=r*t+e.x,s=i*t+e.y;return s=Math.round(n.canvasHeight-s),[a,s]}function Mo(n,e,t){var r=n[0]/255,i=n[1]/255,a=n[2]/255,s=e,o=t||new Array(4);return o[0]=r*s,o[1]=i*s,o[2]=a*s,o[3]=s,o}function wo(n,e){var t=e||new Array(4);return t[0]=(n>>0&255)/255,t[1]=(n>>8&255)/255,t[2]=(n>>16&255)/255,t[3]=(n>>24&255)/255,t}function yC(n){return n[0]+(n[1]<<8)+(n[2]<<16)+(n[3]<<24)}function xC(n,e){var t=n.createTexture();return t.buffer=function(r){n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_NEAREST),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null)},t.deleteTexture=function(){n.deleteTexture(t)},t}function Vv(n,e){switch(e){case"float":return[1,n.FLOAT,4];case"vec2":return[2,n.FLOAT,4];case"vec3":return[3,n.FLOAT,4];case"vec4":return[4,n.FLOAT,4];case"int":return[1,n.INT,4];case"ivec2":return[2,n.INT,4]}}function Hv(n,e,t){switch(e){case n.FLOAT:return new Float32Array(t);case n.INT:return new Int32Array(t)}}function EC(n,e,t,r,i,a){switch(e){case n.FLOAT:return new Float32Array(t.buffer,a*r,i);case n.INT:return new Int32Array(t.buffer,a*r,i)}}function _C(n,e,t,r){var i=Vv(n,e),a=$t(i,2),s=a[0],o=a[1],l=Hv(n,o,r),u=n.createBuffer();return n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,l,n.STATIC_DRAW),o===n.FLOAT?n.vertexAttribPointer(t,s,o,!1,0,0):o===n.INT&&n.vertexAttribIPointer(t,s,o,0,0),n.enableVertexAttribArray(t),n.bindBuffer(n.ARRAY_BUFFER,null),u}function Sn(n,e,t,r){var i=Vv(n,t),a=$t(i,3),s=a[0],o=a[1],l=a[2],u=Hv(n,o,e*s),c=s*l,f=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,f),n.bufferData(n.ARRAY_BUFFER,e*c,n.DYNAMIC_DRAW),n.enableVertexAttribArray(r),o===n.FLOAT?n.vertexAttribPointer(r,s,o,!1,c,0):o===n.INT&&n.vertexAttribIPointer(r,s,o,c,0),n.vertexAttribDivisor(r,1),n.bindBuffer(n.ARRAY_BUFFER,null);for(var d=new Array(e),h=0;h<e;h++)d[h]=EC(n,o,u,c,s,h);return f.dataArray=u,f.stride=c,f.size=s,f.getView=function(v){return d[v]},f.setPoint=function(v,m,g){var p=d[v];p[0]=m,p[1]=g},f.bufferSubData=function(v){n.bindBuffer(n.ARRAY_BUFFER,f),v?n.bufferSubData(n.ARRAY_BUFFER,0,u,0,v*s):n.bufferSubData(n.ARRAY_BUFFER,0,u)},f}function bC(n){var e=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,e);var t=n.createTexture();return n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),n.bindFramebuffer(n.FRAMEBUFFER,null),e.setFramebufferAttachmentSizes=function(r,i){n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r,i,0,n.RGBA,n.UNSIGNED_BYTE,null)},e}var yd=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function hs(){var n=new yd(9);return yd!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Wv(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function TC(n,e,t){var r=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],d=t[0],h=t[1],v=t[2],m=t[3],g=t[4],p=t[5],x=t[6],y=t[7],E=t[8];return n[0]=d*r+h*s+v*u,n[1]=d*i+h*o+v*c,n[2]=d*a+h*l+v*f,n[3]=m*r+g*s+p*u,n[4]=m*i+g*o+p*c,n[5]=m*a+g*l+p*f,n[6]=x*r+y*s+E*u,n[7]=x*i+y*o+E*c,n[8]=x*a+y*l+E*f,n}function al(n,e,t){var r=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],d=t[0],h=t[1];return n[0]=r,n[1]=i,n[2]=a,n[3]=s,n[4]=o,n[5]=l,n[6]=d*r+h*s+u,n[7]=d*i+h*o+c,n[8]=d*a+h*l+f,n}function Xv(n,e,t){var r=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],f=e[8],d=Math.sin(t),h=Math.cos(t);return n[0]=h*r+d*s,n[1]=h*i+d*o,n[2]=h*a+d*l,n[3]=h*s-d*r,n[4]=h*o-d*i,n[5]=h*l-d*a,n[6]=u,n[7]=c,n[8]=f,n}function af(n,e,t){var r=t[0],i=t[1];return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=i*e[3],n[4]=i*e[4],n[5]=i*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function SC(n,e,t){return n[0]=2/e,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/t,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n}var ds={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},ts=Zt({getKey:null,drawElement:null,getBoundingBox:null,getRotation:null,getRotationPoint:null,getRotationOffset:null,isVisible:null,getPadding:null}),MC=function(){function n(e,t){ti(this,n),this.debugID=Math.floor(Math.random()*1e4),this.r=e,this.atlasSize=t.webglTexSize,this.rows=t.webglTexRows,this.enableWrapping=t.enableWrapping,this.texHeight=Math.floor(this.atlasSize/this.rows),this.maxTexWidth=this.atlasSize,this.texture=null,this.canvas=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=t.createTextureCanvas(e,this.atlasSize,this.atlasSize),this.scratch=t.createTextureCanvas(e,this.atlasSize,this.texHeight,"scratch")}return ni(n,[{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(t){var r=t.w,i=t.h,a=this.texHeight,s=this.maxTexWidth,o=a/i,l=r*o,u=i*o;return l>s&&(o=s/r,l=r*o,u=i*o),{scale:o,texW:l,texH:u}}},{key:"draw",value:function(t,r,i){var a=this,s=this.atlasSize,o=this.rows,l=this.texHeight,u=this.getScale(r),c=u.scale,f=u.texW,d=u.texH,h=[null,null],v=function(y,E){if(i&&E){var M=E.context,w=y.x,b=y.row,C=w,T=l*b;M.save(),M.translate(C,T),M.scale(c,c),i(M,r),M.restore()}},m=function(){v(a.freePointer,a.canvas),h[0]={x:a.freePointer.x,y:a.freePointer.row*l,w:f,h:d},h[1]={x:a.freePointer.x+f,y:a.freePointer.row*l,w:0,h:d},a.freePointer.x+=f,a.freePointer.x==s&&(a.freePointer.x=0,a.freePointer.row++)},g=function(){var y=a.scratch,E=a.canvas;y.clear(),v({x:0,row:0},y);var M=s-a.freePointer.x,w=f-M,b=l;{var C=a.freePointer.x,T=a.freePointer.row*l,S=M;E.context.drawImage(y,0,0,S,b,C,T,S,b),h[0]={x:C,y:T,w:S,h:d}}{var L=M,N=(a.freePointer.row+1)*l,I=w;E&&E.context.drawImage(y,L,0,I,b,0,N,I,b),h[1]={x:0,y:N,w:I,h:d}}a.freePointer.x=w,a.freePointer.row++},p=function(){a.freePointer.x=0,a.freePointer.row++};if(this.freePointer.x+f<=s)m();else{if(this.freePointer.row>=o-1)return!1;this.freePointer.x===s?(p(),m()):this.enableWrapping?g():(p(),m())}return this.keyToLocation.set(t,h),this.needsBuffer=!0,h}},{key:"getOffsets",value:function(t){return this.keyToLocation.get(t)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(t){var r=this.atlasSize,i=this.rows,a=this.getScale(t),s=a.texW;return this.freePointer.x+s>r?this.freePointer.row<i-1:!0}},{key:"bufferIfNeeded",value:function(t){this.texture||(this.texture=xC(t,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1)}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null,this.needsBuffer=!0)}}]),n}(),wC=function(){function n(e,t){ti(this,n),this.r=e,this.opts=t,this.keyToIds=new Map,this.idToKey=new Map,this.atlases=[],this.styleKeyToAtlas=new Map,this.styleKeyNeedsRedraw=new Set,this.forceGC=!1}return ni(n,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"getIdsFor",value:function(t){var r=this.keyToIds.get(t);return r||(r=new Set,this.keyToIds.set(t,r)),r}},{key:"_createAtlas",value:function(){var t=this.r,r=this.opts;return new MC(t,r)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var t=this.r,r=this.opts,i=r.webglTexSize,a=Math.floor(i/r.webglTexRows);this.scratch=r.createTextureCanvas(t,i,a,"scratch")}return this.scratch}},{key:"draw",value:function(t,r,i,a){if(this.styleKeyNeedsRedraw.has(r)){this.styleKeyNeedsRedraw.delete(r),this.deleteKey(t,r);var s=this.styleKeyToAtlas.get(r);s&&(s.forceGC=!0),this.styleKeyToAtlas.delete(r)}var o=this.styleKeyToAtlas.get(r);return o||(o=this.atlases[this.atlases.length-1],(!o||!o.canFit(i))&&(o=this._createAtlas(),this.atlases.push(o)),o.draw(r,i,a),this.styleKeyToAtlas.set(r,o),this.getIdsFor(r).add(t),this.idToKey.set(t,r)),o}},{key:"getAtlas",value:function(t){return this.styleKeyToAtlas.get(t)}},{key:"hasAtlas",value:function(t){return this.styleKeyToAtlas.has(t)}},{key:"deleteKey",value:function(t,r){this.idToKey.delete(t),this.getIdsFor(r).delete(t)}},{key:"checkKeyIsInvalid",value:function(t,r){if(!this.idToKey.has(t))return!1;var i=this.idToKey.get(t);return i!=r?(this.deleteKey(t,i),!0):!1}},{key:"_getKeysToCollect",value:function(){var t=new Set,r=Mn(this.styleKeyToAtlas.keys()),i;try{for(r.s();!(i=r.n()).done;){var a=i.value;this.getIdsFor(a).size==0&&t.add(a)}}catch(s){r.e(s)}finally{r.f()}return t}},{key:"gc",value:function(){var t=this,r=this.atlases.some(function(d){return d.forceGC}),i=this._getKeysToCollect();if(i.size===0&&!r){console.log("nothing to garbage collect");return}var a=[],s=new Map,o=null,l=Mn(this.atlases),u;try{var c=function(){var h=u.value,v=h.getKeys(),m=AC(i,v);if(m.size===0&&!h.forceGC)return a.push(h),v.forEach(function(b){return s.set(b,h)}),"continue";o||(o=t._createAtlas(),a.push(o));var g=Mn(v),p;try{for(g.s();!(p=g.n()).done;){var x=p.value;if(!m.has(x)){var y=h.getOffsets(x),E=$t(y,2),M=E[0],w=E[1];o.canFit({w:M.w+w.w,h:M.h})||(o=t._createAtlas(),a.push(o)),t._copyTextureToNewAtlas(x,h,o),s.set(x,o)}}}catch(b){g.e(b)}finally{g.f()}};for(l.s();!(u=l.n()).done;)var f=c()}catch(d){l.e(d)}finally{l.f()}this.atlases=a,this.styleKeyToAtlas=s}},{key:"_copyTextureToNewAtlas",value:function(t,r,i){var a=r.getOffsets(t),s=$t(a,2),o=s[0],l=s[1];if(l.w===0)i.draw(t,o,function(d){d.drawImage(r.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h)});else{var u=this._getScratchCanvas();u.clear(),u.context.drawImage(r.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h),u.context.drawImage(r.canvas,l.x,l.y,l.w,l.h,o.w,0,l.w,l.h);var c=o.w+l.w,f=o.h;i.draw(t,{w:c,h:f},function(d){d.drawImage(u,0,0,c,f,0,0,c,f)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}]),n}();function AC(n,e){return n.intersection?n.intersection(e):new Set(hp(n).filter(function(t){return e.has(t)}))}var CC=function(){function n(e,t){ti(this,n),this.r=e;var r=t;this.globalOptions=r,this.maxAtlases=r.webglTexPerBatch,this.atlasSize=r.webglTexSize,this.renderTypes=new Map,this.maxAtlasesPerBatch=t.webglTexPerBatch,this.batchAtlases=[],this._cacheScratchCanvas(r)}return ni(n,[{key:"_cacheScratchCanvas",value:function(t){var r=-1,i=-1,a=null,s=t.createTextureCanvas;t.createTextureCanvas=function(o,l,u,c){return c?((!a||l!=r||u!=i)&&(r=l,i=u,a=s(o,l,u)),a):s(o,l,u)}}},{key:"addRenderType",value:function(t,r){var i=new wC(this.r,this.globalOptions),a=r;this.renderTypes.set(t,Je({type:t,atlasCollection:i},a))}},{key:"getRenderTypes",value:function(){return hp(this.renderTypes.values())}},{key:"getRenderTypeOpts",value:function(t){return this.renderTypes.get(t)}},{key:"invalidate",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.forceRedraw,a=i===void 0?!1:i,s=r.filterEle,o=s===void 0?function(){return!0}:s,l=r.filterType,u=l===void 0?function(){return!0}:l,c=!1,f=Mn(t),d;try{for(f.s();!(d=f.n()).done;){var h=d.value;if(o(h)){var v=h.id(),m=Mn(this.getRenderTypes()),g;try{for(m.s();!(g=m.n()).done;){var p=g.value;if(u(p.type)){var x=p.getKey(h);a?(p.atlasCollection.deleteKey(v,x),p.atlasCollection.styleKeyNeedsRedraw.add(x),c=!0):c|=p.atlasCollection.checkKeyIsInvalid(v,x)}}}catch(y){m.e(y)}finally{m.f()}}}}catch(y){f.e(y)}finally{f.f()}return c}},{key:"gc",value:function(){var t=Mn(this.getRenderTypes()),r;try{for(t.s();!(r=t.n()).done;){var i=r.value;i.atlasCollection.gc()}}catch(a){t.e(a)}finally{t.f()}}},{key:"isRenderable",value:function(t,r){var i=this.getRenderTypeOpts(r);return i&&i.isVisible(t)}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"getOrCreateAtlas",value:function(t,r,i){var a=this.renderTypes.get(i),s=a.getKey(t),o=t.id();return a.atlasCollection.draw(o,s,r,function(l){a.drawElement(l,t,r,!0,!0)})}},{key:"getAtlasIndexForBatch",value:function(t){var r=this.batchAtlases.indexOf(t);if(r<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)return;this.batchAtlases.push(t),r=this.batchAtlases.length-1}return r}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlases},function(t,r){return r})}},{key:"getAtlasInfo",value:function(t,r){var i=this.renderTypes.get(r),a=i.getBoundingBox(t),s=this.getOrCreateAtlas(t,a,r),o=this.getAtlasIndexForBatch(s);if(o!==void 0){var l=i.getKey(t),u=s.getOffsets(l),c=$t(u,2),f=c[0],d=c[1];return{atlasID:o,tex:f,tex1:f,tex2:d,bb:a,type:r,styleKey:l}}}},{key:"canAddToCurrentBatch",value:function(t,r){if(this.batchAtlases.length===this.maxAtlasesPerBatch){var i=this.renderTypes.get(r),a=i.getKey(t),s=i.atlasCollection.getAtlas(a);return s&&this.batchAtlases.includes(s)}return!0}},{key:"setTransformMatrix",value:function(t,r,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,s=r.bb,o=r.type,l=r.tex1,u=r.tex2,c=this.getRenderTypeOpts(o),f=c.getPadding?c.getPadding(i):0,d=l.w/(l.w+u.w);a||(d=1-d);var h=this.getAdjustedBB(s,f,a,d),v,m;Wv(t);var g=c.getRotation?c.getRotation(i):0;if(g!==0){var p=c.getRotationPoint(i),x=p.x,y=p.y;al(t,t,[x,y]),Xv(t,t,g);var E=c.getRotationOffset(i);v=E.x+h.xOffset,m=E.y}else v=h.x1,m=h.y1;al(t,t,[v,m]),af(t,t,[h.w,h.h])}},{key:"getTransformMatrix",value:function(t,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=hs();return this.setTransformMatrix(a,t,r,i),a}},{key:"getAdjustedBB",value:function(t,r,i,a){var s=t.x1,o=t.y1,l=t.w,u=t.h;r&&(s-=r,o-=r,l+=2*r,u+=2*r);var c=0,f=l*a;return i&&a<1?l=f:!i&&a<1&&(c=l-f,s+=c,l=f),{x1:s,y1:o,w:l,h:u,xOffset:c}}},{key:"getDebugInfo",value:function(){var t=[],r=Mn(this.renderTypes),i;try{for(r.s();!(i=r.n()).done;){var a=$t(i.value,2),s=a[0],o=a[1],l=o.atlasCollection.getCounts(),u=l.keyCount,c=l.atlasCount;t.push({type:s,keyCount:u,atlasCount:c})}}catch(f){r.e(f)}finally{r.f()}return t}}]),n}(),vu=0,xd=1,Ed=2,gu=3,RC=function(){function n(e,t,r){ti(this,n),this.r=e,this.gl=t,this.maxInstances=r.webglBatchSize,this.maxAtlases=r.webglTexPerBatch,this.atlasSize=r.webglTexSize,this.bgColor=r.bgColor,r.enableWrapping=!0,r.createTextureCanvas=gC,this.atlasManager=new CC(e,r),this.program=this.createShaderProgram(ds.SCREEN),this.pickingProgram=this.createShaderProgram(ds.PICKING),this.vao=this.createVAO(),this.debugInfo=[]}return ni(n,[{key:"addTextureRenderType",value:function(t,r){this.atlasManager.addRenderType(t,r)}},{key:"invalidate",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.type,a=this.atlasManager;return i?a.invalidate(t,{filterType:function(o){return o===i},forceRedraw:!0}):a.invalidate(t)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"createShaderProgram",value:function(t){var r=this.gl,i=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; 

      // what are we rendering?
      in int aVertType;

      // for picking
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex1; // x/y/w/h of texture in atlas
      in vec4 aTex2; 

      // for any transforms that are needed
      in vec4 aScaleRotate1;  // vectors use fewer attributes than matrices
      in vec2 aTranslate1;
      in vec4 aScaleRotate2;
      in vec2 aTranslate2;

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in float aLineWidth;
      in vec4 aEdgeColor;

      out vec2 vTexCoord;
      out vec4 vEdgeColor;
      flat out int vAtlasId;
      flat out vec4 vIndex;
      flat out int vVertType;

      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition;

        if(aVertType == `.concat(vu,`) {
          float texX;
          float texY;
          float texW;
          float texH;
          mat3  texMatrix;

          int vid = gl_VertexID;
          if(vid <= 5) {
            texX = aTex1.x;
            texY = aTex1.y;
            texW = aTex1.z;
            texH = aTex1.w;
            texMatrix = mat3(
              vec3(aScaleRotate1.xy, 0.0),
              vec3(aScaleRotate2.zw, 0.0),
              vec3(aTranslate1,      1.0)
            );
          } else {
            texX = aTex2.x;
            texY = aTex2.y;
            texW = aTex2.z;
            texH = aTex2.w;
            texMatrix = mat3(
              vec3(aScaleRotate2.xy, 0.0),
              vec3(aScaleRotate2.zw, 0.0),
              vec3(aTranslate2,      1.0)
            );
          }

          if(vid == 1 || vid == 2 || vid == 4 || vid == 7 || vid == 8 || vid == 10) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5 || vid == 8 || vid == 10 || vid == 11) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * texMatrix * vec3(position, 1.0), 1.0);
        } 
        else if(aVertType == `).concat(xd,` && vid < 6) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vEdgeColor = aEdgeColor;
        } 
        else if(aVertType == `).concat(Ed,` && vid < 6) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0 = pointA;
          vec2 p1 = pointB;
          vec2 p2 = pointC;
          vec2 pos = position;
          if(position.x == 1.0) {
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth;

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vEdgeColor = aEdgeColor;
        } 
        else if(aVertType == `).concat(gu,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2( 0.0,   0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          mat3 transform = mat3(
            vec3(aScaleRotate1.xy, 0.0),
            vec3(aScaleRotate1.zw, 0.0),
            vec3(aTranslate1,      1.0)
          );
          gl_Position = vec4(uPanZoomMatrix * transform * vec3(position, 1.0), 1.0);
          vEdgeColor = aEdgeColor;
        } else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vIndex = aIndex;
        vVertType = aVertType;
      }
    `),a=this.atlasManager.getIndexArray(),s=`#version 300 es
      precision highp float;

      // define texture unit for each node in the batch
      `.concat(a.map(function(u){return"uniform sampler2D uTexture".concat(u,";")}).join(`
	`),`

      uniform vec4 uBGColor;

      in vec2 vTexCoord;
      in vec4 vEdgeColor;
      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;

      out vec4 outColor;

      void main(void) {
        if(vVertType == `).concat(vu,`) {
          `).concat(a.map(function(u){return"if(vAtlasId == ".concat(u,") outColor = texture(uTexture").concat(u,", vTexCoord);")}).join(`
	else `),`
        } else if(vVertType == `).concat(gu,`) {
          // blend arrow color with background (using premultiplied alpha)
          outColor.rgb = vEdgeColor.rgb + (uBGColor.rgb * (1.0 - vEdgeColor.a)); 
          outColor.a = 1.0; // make opaque, masks out line under arrow
        } else {
          outColor = vEdgeColor;
        }

        `).concat(t.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),o=vC(r,i,s);o.aPosition=r.getAttribLocation(o,"aPosition"),o.aIndex=r.getAttribLocation(o,"aIndex"),o.aVertType=r.getAttribLocation(o,"aVertType"),o.aAtlasId=r.getAttribLocation(o,"aAtlasId"),o.aTex1=r.getAttribLocation(o,"aTex1"),o.aTex2=r.getAttribLocation(o,"aTex2"),o.aScaleRotate1=r.getAttribLocation(o,"aScaleRotate1"),o.aTranslate1=r.getAttribLocation(o,"aTranslate1"),o.aScaleRotate2=r.getAttribLocation(o,"aScaleRotate2"),o.aTranslate2=r.getAttribLocation(o,"aTranslate2"),o.aPointAPointB=r.getAttribLocation(o,"aPointAPointB"),o.aPointCPointD=r.getAttribLocation(o,"aPointCPointD"),o.aLineWidth=r.getAttribLocation(o,"aLineWidth"),o.aEdgeColor=r.getAttribLocation(o,"aEdgeColor"),o.uPanZoomMatrix=r.getUniformLocation(o,"uPanZoomMatrix"),o.uAtlasSize=r.getUniformLocation(o,"uAtlasSize"),o.uBGColor=r.getUniformLocation(o,"uBGColor"),o.uTextures=[];for(var l=0;l<this.atlasManager.maxAtlases;l++)o.uTextures.push(r.getUniformLocation(o,"uTexture".concat(l)));return o}},{key:"createVAO",value:function(){var t=[0,0,1,0,1,1,0,0,1,1,0,1],r=[].concat(t,t);this.vertexCount=r.length/2;var i=this.maxInstances,a=this.gl,s=this.program,o=a.createVertexArray();return a.bindVertexArray(o),_C(a,"vec2",s.aPosition,r),this.indexBuffer=Sn(a,i,"vec4",s.aIndex),this.vertTypeBuffer=Sn(a,i,"int",s.aVertType),this.atlasIdBuffer=Sn(a,i,"int",s.aAtlasId),this.tex1Buffer=Sn(a,i,"vec4",s.aTex1),this.tex2Buffer=Sn(a,i,"vec4",s.aTex2),this.scaleRotate1Buffer=Sn(a,i,"vec4",s.aScaleRotate1),this.translate1Buffer=Sn(a,i,"vec2",s.aTranslate1),this.scaleRotate2Buffer=Sn(a,i,"vec4",s.aScaleRotate2),this.translate2Buffer=Sn(a,i,"vec2",s.aTranslate2),this.pointAPointBBuffer=Sn(a,i,"vec4",s.aPointAPointB),this.pointCPointDBuffer=Sn(a,i,"vec4",s.aPointCPointD),this.lineWidthBuffer=Sn(a,i,"float",s.aLineWidth),this.edgeColorBuffer=Sn(a,i,"vec4",s.aEdgeColor),a.bindVertexArray(null),o}},{key:"buffers",get:function(){var t=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(r){return r.endsWith("Buffer")}).map(function(r){return t[r]})),this._buffers}},{key:"startFrame",value:function(t,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ds.SCREEN;this.panZoomMatrix=t,this.debugInfo=r,this.renderTarget=i,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.atlasManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"getTempMatrix",value:function(){return this.tempMatrix=this.tempMatrix||hs()}},{key:"drawTexture",value:function(t,r,i){var a=this.atlasManager;if(a.isRenderable(t,i)){a.canAddToCurrentBatch(t,i)||this.endBatch();var s=this.instanceCount;this.vertTypeBuffer.getView(s)[0]=vu;var o=this.indexBuffer.getView(s);wo(r,o);var l=a.getAtlasInfo(t,i,l),u=l.atlasID,c=l.tex1,f=l.tex2,d=this.atlasIdBuffer.getView(s);d[0]=u;var h=this.tex1Buffer.getView(s);h[0]=c.x,h[1]=c.y,h[2]=c.w,h[3]=c.h;var v=this.tex2Buffer.getView(s);v[0]=f.x,v[1]=f.y,v[2]=f.w,v[3]=f.h;for(var m=this.getTempMatrix(),g=0,p=[1,2];g<p.length;g++){var x=p[g];a.setTransformMatrix(m,l,t,x===1);var y=this["scaleRotate".concat(x,"Buffer")].getView(s);y[0]=m[0],y[1]=m[1],y[2]=m[3],y[3]=m[4];var E=this["translate".concat(x,"Buffer")].getView(s);E[0]=m[6],E[1]=m[7]}this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"drawEdgeArrow",value:function(t,r,i){var a=t._private.rscratch,s,o,l;if(i==="source"?(s=a.arrowStartX,o=a.arrowStartY,l=a.srcArrowAngle):(s=a.arrowEndX,o=a.arrowEndY,l=a.tgtArrowAngle),!(isNaN(s)||s==null||isNaN(o)||o==null||isNaN(l)||l==null)){var u=t.pstyle(i+"-arrow-shape").value;if(u!=="none"){var c=t.pstyle(i+"-arrow-color").value,f=t.pstyle("opacity").value,d=t.pstyle("line-opacity").value,h=f*d,v=t.pstyle("width").pfValue,m=t.pstyle("arrow-scale").value,g=this.r.getArrowWidth(v,m),p=this.getTempMatrix();Wv(p),al(p,p,[s,o]),af(p,p,[g,g]),Xv(p,p,l);var x=this.instanceCount;this.vertTypeBuffer.getView(x)[0]=gu;var y=this.indexBuffer.getView(x);wo(r,y);var E=this.edgeColorBuffer.getView(x);Mo(c,h,E);var M=this.scaleRotate1Buffer.getView(x);M[0]=p[0],M[1]=p[1],M[2]=p[3],M[3]=p[4];var w=this.translate1Buffer.getView(x);w[0]=p[6],w[1]=p[7],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}},{key:"drawEdgeLine",value:function(t,r){var i=t.pstyle("opacity").value,a=t.pstyle("line-opacity").value,s=t.pstyle("width").pfValue,o=t.pstyle("line-color").value,l=i*a,u=this.getEdgePoints(t);if(u.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),u.length==4){var c=this.instanceCount;this.vertTypeBuffer.getView(c)[0]=xd;var f=this.indexBuffer.getView(c);wo(r,f);var d=this.edgeColorBuffer.getView(c);Mo(o,l,d);var h=this.lineWidthBuffer.getView(c);h[0]=s;var v=this.pointAPointBBuffer.getView(c);v[0]=u[0],v[1]=u[1],v[2]=u[2],v[3]=u[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var m=0;m<u.length-2;m+=2){var g=this.instanceCount;this.vertTypeBuffer.getView(g)[0]=Ed;var p=this.indexBuffer.getView(g);wo(r,p);var x=this.edgeColorBuffer.getView(g);Mo(o,l,x);var y=this.lineWidthBuffer.getView(g);y[0]=s;var E=u[m-2],M=u[m-1],w=u[m],b=u[m+1],C=u[m+2],T=u[m+3],S=u[m+4],L=u[m+5];m==0&&(E=2*w-C+.001,M=2*b-T+.001),m==u.length-4&&(S=2*C-w+.001,L=2*T-b+.001);var N=this.pointAPointBBuffer.getView(g);N[0]=E,N[1]=M,N[2]=w,N[3]=b;var I=this.pointCPointDBuffer.getView(g);I[0]=C,I[1]=T,I[2]=S,I[3]=L,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"getEdgePoints",value:function(t){var r=t._private.rscratch,i=r.allpts;if(i.length==4)return i;var a=this.getNumSegments(t);return this.getCurveSegmentPoints(i,a)}},{key:"getNumSegments",value:function(t){var r=15;return Math.min(Math.max(r,5),this.maxInstances)}},{key:"getCurveSegmentPoints",value:function(t,r){if(t.length==4)return t;for(var i=Array((r+1)*2),a=0;a<=r;a++)if(a==0)i[0]=t[0],i[1]=t[1];else if(a==r)i[a*2]=t[t.length-2],i[a*2+1]=t[t.length-1];else{var s=a/r;this.setCurvePoint(t,s,i,a*2)}return i}},{key:"setCurvePoint",value:function(t,r,i,a){if(t.length<=2)i[a]=t[0],i[a+1]=t[1];else{for(var s=Array(t.length-2),o=0;o<s.length;o+=2){var l=(1-r)*t[o]+r*t[o+2],u=(1-r)*t[o+1]+r*t[o+3];s[o]=l,s[o+1]=u}return this.setCurvePoint(s,r,i,a)}}},{key:"endBatch",value:function(){var t=this.gl,r=this.vao,i=this.vertexCount,a=this.instanceCount;if(a!==0){var s=this.renderTarget.picking?this.pickingProgram:this.program;t.useProgram(s),t.bindVertexArray(r);var o=Mn(this.buffers),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.bufferSubData(a)}}catch(v){o.e(v)}finally{o.f()}for(var c=this.atlasManager.getAtlases(),f=0;f<c.length;f++)c[f].bufferIfNeeded(t);for(var d=0;d<c.length;d++)t.activeTexture(t.TEXTURE0+d),t.bindTexture(t.TEXTURE_2D,c[d].texture),t.uniform1i(s.uTextures[d],d);t.uniformMatrix3fv(s.uPanZoomMatrix,!1,this.panZoomMatrix),t.uniform1i(s.uAtlasSize,this.atlasManager.atlasSize);var h=Mo(this.bgColor,1);t.uniform4fv(s.uBGColor,h),t.drawArraysInstanced(t.TRIANGLES,0,i,a),t.bindVertexArray(null),t.bindTexture(t.TEXTURE_2D,null),this.debugInfo&&this.debugInfo.push({count:a,atlasCount:c.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){return this.debugInfo}},{key:"getAtlasDebugInfo",value:function(){return this.atlasManager.getDebugInfo()}}]),n}();function _d(n,e){return"rgba(".concat(n[0],", ").concat(n[1],", ").concat(n[2],", ").concat(e,")")}var DC=function(){function n(e){ti(this,n),this.r=e}return ni(n,[{key:"getStyleKey",value:function(t,r){var i=this.getStyle(t,r),a=i.shape,s=i.opacity,o=i.color;if(!a)return null;var l=r.width(),u=r.height(),c=_d(o,s);return $r("".concat(a,"-").concat(l,"-").concat(u,"-").concat(c))}},{key:"isVisible",value:function(t,r){var i=r.pstyle("".concat(t,"-opacity")).value;return i>0}},{key:"getStyle",value:function(t,r){var i=r.pstyle("".concat(t,"-opacity")).value,a=r.pstyle("".concat(t,"-color")).value,s=r.pstyle("".concat(t,"-shape")).value;return{opacity:i,color:a,shape:s}}},{key:"getPadding",value:function(t,r){return r.pstyle("".concat(t,"-padding")).pfValue}},{key:"draw",value:function(t,r,i,a){if(this.isVisible(t,i)){var s=this.r,o=a.w,l=a.h,u=o/2,c=l/2,f=this.getStyle(t,i),d=f.shape,h=f.color,v=f.opacity;r.save(),r.fillStyle=_d(h,v),d==="round-rectangle"||d==="roundrectangle"?s.drawRoundRectanglePath(r,u,c,o,l,"auto"):d==="ellipse"&&s.drawEllipsePath(r,u,c,o,l),r.fill(),r.restore()}}}]),n}();function LC(n){var e=n&&n.style&&n.style.backgroundColor||"white";return yp(e)}var Yv={};Yv.initWebgl=function(n,e){var t=this,r=t.data.contexts[t.WEBGL],i=n.cy.container();n.bgColor=LC(i),n.webglTexSize=Math.min(n.webglTexSize,r.getParameter(r.MAX_TEXTURE_SIZE)),n.webglTexRows=Math.min(n.webglTexRows,54),n.webglBatchSize=Math.min(n.webglBatchSize,16384),n.webglTexPerBatch=Math.min(n.webglTexPerBatch,r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS)),t.webglDebug=n.webglDebug,t.webglDebugShowAtlases=n.webglDebugShowAtlases,console.log("max texture units",r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS)),console.log("max texture size",r.getParameter(r.MAX_TEXTURE_SIZE)),console.log("webgl options",n),t.pickingFrameBuffer=bC(r),t.pickingFrameBuffer.needsDraw=!0;var a=function(c){return t.getTextAngle(c,null)},s=function(c){var f=c.pstyle("label");return f&&f.value};t.eleDrawing=new RC(t,r,n);var o=new DC(t);t.eleDrawing.addTextureRenderType("node-body",ts({getKey:e.getStyleKey,getBoundingBox:e.getElementBox,drawElement:e.drawElement,isVisible:function(c){return c.visible()}})),t.eleDrawing.addTextureRenderType("node-label",ts({getKey:e.getLabelKey,getBoundingBox:e.getLabelBox,drawElement:e.drawLabel,getRotation:a,getRotationPoint:e.getLabelRotationPoint,getRotationOffset:e.getLabelRotationOffset,isVisible:s})),t.eleDrawing.addTextureRenderType("node-overlay",ts({getBoundingBox:e.getElementBox,getKey:function(c){return o.getStyleKey("overlay",c)},drawElement:function(c,f,d){return o.draw("overlay",c,f,d)},isVisible:function(c){return o.isVisible("overlay",c)},getPadding:function(c){return o.getPadding("overlay",c)}})),t.eleDrawing.addTextureRenderType("node-underlay",ts({getBoundingBox:e.getElementBox,getKey:function(c){return o.getStyleKey("underlay",c)},drawElement:function(c,f,d){return o.draw("underlay",c,f,d)},isVisible:function(c){return o.isVisible("underlay",c)},getPadding:function(c){return o.getPadding("underlay",c)}})),t.eleDrawing.addTextureRenderType("edge-label",ts({getKey:e.getLabelKey,getBoundingBox:e.getLabelBox,drawElement:e.drawLabel,getRotation:a,getRotationPoint:e.getLabelRotationPoint,getRotationOffset:e.getLabelRotationOffset,isVisible:s}));var l=Os(function(){console.log("garbage collect flag set"),t.data.gc=!0},1e4);t.onUpdateEleCalcs(function(u,c){var f=!1;c&&c.length>0&&(f|=t.eleDrawing.invalidate(c)),f&&l()}),PC(t)};function PC(n){{var e=n.render;n.render=function(a){a=a||{};var s=n.cy;n.webgl&&(s.zoom()>Uv?(NC(n),e.call(n,a)):(IC(n),Kv(n,a,ds.SCREEN)))}}{var t=n.matchCanvasSize;n.matchCanvasSize=function(a){t.call(n,a),n.pickingFrameBuffer.setFramebufferAttachmentSizes(n.canvasWidth,n.canvasHeight),n.pickingFrameBuffer.needsDraw=!0}}n.findNearestElements=function(a,s,o,l){return zC(n,a,s)};{var r=n.invalidateCachedZSortedEles;n.invalidateCachedZSortedEles=function(){r.call(n),n.pickingFrameBuffer.needsDraw=!0}}{var i=n.notify;n.notify=function(a,s){i.call(n,a,s),a==="viewport"||a==="bounds"?n.pickingFrameBuffer.needsDraw=!0:a==="background"&&n.eleDrawing.invalidate(s,{type:"node-body"})}}}function NC(n){var e=n.data.contexts[n.WEBGL];e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function IC(n){var e=function(r){r.save(),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,n.canvasWidth,n.canvasHeight),r.restore()};e(n.data.contexts[n.NODE]),e(n.data.contexts[n.DRAG])}function OC(n){var e=n.canvasWidth,t=n.canvasHeight,r=rf(n),i=r.pan,a=r.zoom,s=hs();al(s,s,[i.x,i.y]),af(s,s,[a,a]);var o=hs();SC(o,e,t);var l=hs();return TC(l,o,s),l}function qv(n,e){var t=n.canvasWidth,r=n.canvasHeight,i=rf(n),a=i.pan,s=i.zoom;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t,r),e.translate(a.x,a.y),e.scale(s,s)}function FC(n,e){n.drawSelectionRectangle(e,function(t){return qv(n,t)})}function UC(n){var e=n.data.contexts[n.NODE];e.save(),qv(n,e),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(-1e3,0),e.lineTo(1e3,0),e.stroke(),e.beginPath(),e.moveTo(0,-1e3),e.lineTo(0,1e3),e.stroke(),e.restore()}function BC(n){var e=function(i,a,s){for(var o=i.atlasManager.getRenderTypeOpts(a),l=n.data.contexts[n.NODE],u=.125,c=o.atlasCollection.atlases,f=0;f<c.length;f++){var d=c[f],h=d.canvas,v=h.width,m=h.height,g=v*f,p=h.height*s;l.save(),l.scale(u,u),l.drawImage(h,g,p),l.strokeStyle="black",l.rect(g,p,v,m),l.stroke(),l.restore()}},t=0;e(n.eleDrawing,"node-body",t++),e(n.eleDrawing,"node-label",t++)}function kC(n,e,t,r,i){var a,s,o,l,u=rf(n),c=u.pan,f=u.zoom;{var d=mC(n,c,f,e,t),h=$t(d,2),v=h[0],m=h[1],g=6;a=v-g/2,s=m-g/2,o=g,l=g}if(o===0||l===0)return[];var p=n.data.contexts[n.WEBGL];p.bindFramebuffer(p.FRAMEBUFFER,n.pickingFrameBuffer),n.pickingFrameBuffer.needsDraw&&(p.viewport(0,0,p.canvas.width,p.canvas.height),Kv(n,null,ds.PICKING),n.pickingFrameBuffer.needsDraw=!1);var x=o*l,y=new Uint8Array(x*4);p.readPixels(a,s,o,l,p.RGBA,p.UNSIGNED_BYTE,y),p.bindFramebuffer(p.FRAMEBUFFER,null);for(var E=new Set,M=0;M<x;M++){var w=y.slice(M*4,M*4+4),b=yC(w)-1;b>=0&&E.add(b)}return E}function zC(n,e,t){var r=kC(n,e,t),i=n.getCachedZSortedEles(),a,s,o=Mn(r),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=i[u];if(!a&&c.isNode()&&(a=c),!s&&c.isEdge()&&(s=c),a&&s)break}}catch(f){o.e(f)}finally{o.f()}return[a,s].filter(Boolean)}function Kv(n,e,t){var r,i;n.webglDebug&&(i=[],r=performance.now());var a=n.eleDrawing,s=0;if(t.screen&&n.data.canvasNeedsRedraw[n.SELECT_BOX]&&FC(n,e),n.data.canvasNeedsRedraw[n.NODE]||t.picking){var o=function(N,I){I+=1,N.isNode()?(a.drawTexture(N,I,"node-underlay"),a.drawTexture(N,I,"node-body"),a.drawTexture(N,I,"node-label"),a.drawTexture(N,I,"node-overlay")):(a.drawEdgeLine(N,I),a.drawEdgeArrow(N,I,"source"),a.drawEdgeArrow(N,I,"target"),a.drawTexture(N,I,"edge-label"))},l=n.data.contexts[n.WEBGL];t.screen?(l.clearColor(0,0,0,0),l.enable(l.BLEND),l.blendFunc(l.ONE,l.ONE_MINUS_SRC_ALPHA)):l.disable(l.BLEND),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),l.viewport(0,0,l.canvas.width,l.canvas.height);var u=OC(n),c=n.getCachedZSortedEles();if(s=c.length,a.startFrame(u,i,t),t.screen){for(var f=0;f<c.nondrag.length;f++)o(c.nondrag[f],f);for(var d=0;d<c.drag.length;d++)o(c.drag[d],-1)}else if(t.picking)for(var h=0;h<c.length;h++)o(c[h],h);a.endFrame(),n.data.gc&&(console.log("Garbage Collect!"),n.data.gc=!1,a.gc()),t.screen&&n.webglDebugShowAtlases&&(UC(n),BC(n)),n.data.canvasNeedsRedraw[n.NODE]=!1,n.data.canvasNeedsRedraw[n.DRAG]=!1}if(n.webglDebug){var v=performance.now(),m=!0,g=0,p=0,x=Mn(i),y;try{for(x.s();!(y=x.n()).done;){var E=y.value;g++,p+=E.count}}catch(L){x.e(L)}finally{x.f()}var M=Math.ceil(v-r),w="".concat(s," elements, ").concat(p," rectangles, ").concat(g," batches");if(m)console.log("WebGL (".concat(t.name,") - ").concat(w));else{console.log("WebGL render (".concat(t.name,") - frame time ").concat(M,"ms")),console.log("  ".concat(w)),console.log("Texture Atlases Used:");var b=a.getAtlasDebugInfo(),C=Mn(b),T;try{for(C.s();!(T=C.n()).done;){var S=T.value;console.log("  ".concat(S.type,": ").concat(S.keyCount," keys, ").concat(S.atlasCount," atlases"))}}catch(L){C.e(L)}finally{C.f()}console.log("")}}}var ii={};ii.drawPolygonPath=function(n,e,t,r,i,a){var s=r/2,o=i/2;n.beginPath&&n.beginPath(),n.moveTo(e+s*a[0],t+o*a[1]);for(var l=1;l<a.length/2;l++)n.lineTo(e+s*a[l*2],t+o*a[l*2+1]);n.closePath()};ii.drawRoundPolygonPath=function(n,e,t,r,i,a,s){s.forEach(function(o){return Cv(n,o)}),n.closePath()};ii.drawRoundRectanglePath=function(n,e,t,r,i,a){var s=r/2,o=i/2,l=a==="auto"?Ri(r,i):Math.min(a,o,s);n.beginPath&&n.beginPath(),n.moveTo(e,t-o),n.arcTo(e+s,t-o,e+s,t,l),n.arcTo(e+s,t+o,e,t+o,l),n.arcTo(e-s,t+o,e-s,t,l),n.arcTo(e-s,t-o,e,t-o,l),n.lineTo(e,t-o),n.closePath()};ii.drawBottomRoundRectanglePath=function(n,e,t,r,i,a){var s=r/2,o=i/2,l=a==="auto"?Ri(r,i):a;n.beginPath&&n.beginPath(),n.moveTo(e,t-o),n.lineTo(e+s,t-o),n.lineTo(e+s,t),n.arcTo(e+s,t+o,e,t+o,l),n.arcTo(e-s,t+o,e-s,t,l),n.lineTo(e-s,t-o),n.lineTo(e,t-o),n.closePath()};ii.drawCutRectanglePath=function(n,e,t,r,i,a,s){var o=r/2,l=i/2,u=s==="auto"?Vc():s;n.beginPath&&n.beginPath(),n.moveTo(e-o+u,t-l),n.lineTo(e+o-u,t-l),n.lineTo(e+o,t-l+u),n.lineTo(e+o,t+l-u),n.lineTo(e+o-u,t+l),n.lineTo(e-o+u,t+l),n.lineTo(e-o,t+l-u),n.lineTo(e-o,t-l+u),n.closePath()};ii.drawBarrelPath=function(n,e,t,r,i){var a=r/2,s=i/2,o=e-a,l=e+a,u=t-s,c=t+s,f=ac(r,i),d=f.widthOffset,h=f.heightOffset,v=f.ctrlPtOffsetPct*d;n.beginPath&&n.beginPath(),n.moveTo(o,u+h),n.lineTo(o,c-h),n.quadraticCurveTo(o+v,c,o+d,c),n.lineTo(l-d,c),n.quadraticCurveTo(l-v,c,l,c-h),n.lineTo(l,u+h),n.quadraticCurveTo(l-v,u,l-d,u),n.lineTo(o+d,u),n.quadraticCurveTo(o+v,u,o,u+h),n.closePath()};var bd=Math.sin(0),Td=Math.cos(0),mc={},yc={},$v=Math.PI/40;for(var ia=0*Math.PI;ia<2*Math.PI;ia+=$v)mc[ia]=Math.sin(ia),yc[ia]=Math.cos(ia);ii.drawEllipsePath=function(n,e,t,r,i){if(n.beginPath&&n.beginPath(),n.ellipse)n.ellipse(e,t,r/2,i/2,0,0,2*Math.PI);else for(var a,s,o=r/2,l=i/2,u=0*Math.PI;u<2*Math.PI;u+=$v)a=e-o*mc[u]*bd+o*yc[u]*Td,s=t+l*yc[u]*bd+l*mc[u]*Td,u===0?n.moveTo(a,s):n.lineTo(a,s);n.closePath()};var Gs={};Gs.createBuffer=function(n,e){var t=document.createElement("canvas");return t.width=n,t.height=e,[t,t.getContext("2d")]};Gs.bufferCanvasImage=function(n){var e=this.cy,t=e.mutableElements(),r=t.boundingBox(),i=this.findContainerClientCoords(),a=n.full?Math.ceil(r.w):i[2],s=n.full?Math.ceil(r.h):i[3],o=ke(n.maxWidth)||ke(n.maxHeight),l=this.getPixelRatio(),u=1;if(n.scale!==void 0)a*=n.scale,s*=n.scale,u=n.scale;else if(o){var c=1/0,f=1/0;ke(n.maxWidth)&&(c=u*n.maxWidth/a),ke(n.maxHeight)&&(f=u*n.maxHeight/s),u=Math.min(c,f),a*=u,s*=u}o||(a*=l,s*=l,u*=l);var d=document.createElement("canvas");d.width=a,d.height=s,d.style.width=a+"px",d.style.height=s+"px";var h=d.getContext("2d");if(a>0&&s>0){h.clearRect(0,0,a,s),h.globalCompositeOperation="source-over";var v=this.getCachedZSortedEles();if(n.full)h.translate(-r.x1*u,-r.y1*u),h.scale(u,u),this.drawElements(h,v),h.scale(1/u,1/u),h.translate(r.x1*u,r.y1*u);else{var m=e.pan(),g={x:m.x*u,y:m.y*u};u*=e.zoom(),h.translate(g.x,g.y),h.scale(u,u),this.drawElements(h,v),h.scale(1/u,1/u),h.translate(-g.x,-g.y)}n.bg&&(h.globalCompositeOperation="destination-over",h.fillStyle=n.bg,h.rect(0,0,a,s),h.fill())}return d};function GC(n,e){for(var t=atob(n),r=new ArrayBuffer(t.length),i=new Uint8Array(r),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([r],{type:e})}function Sd(n){var e=n.indexOf(",");return n.substr(e+1)}function Zv(n,e,t){var r=function(){return e.toDataURL(t,n.quality)};switch(n.output){case"blob-promise":return new Ia(function(i,a){try{e.toBlob(function(s){s!=null?i(s):a(new Error("`canvas.toBlob()` sent a null value in its callback"))},t,n.quality)}catch(s){a(s)}});case"blob":return GC(Sd(r()),t);case"base64":return Sd(r());case"base64uri":default:return r()}}Gs.png=function(n){return Zv(n,this.bufferCanvasImage(n),"image/png")};Gs.jpg=function(n){return Zv(n,this.bufferCanvasImage(n),"image/jpeg")};var Qv={};Qv.nodeShapeImpl=function(n,e,t,r,i,a,s,o){switch(n){case"ellipse":return this.drawEllipsePath(e,t,r,i,a);case"polygon":return this.drawPolygonPath(e,t,r,i,a,s);case"round-polygon":return this.drawRoundPolygonPath(e,t,r,i,a,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(e,t,r,i,a,o);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(e,t,r,i,a,s,o);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(e,t,r,i,a,o);case"barrel":return this.drawBarrelPath(e,t,r,i,a)}};var VC=Jv,at=Jv.prototype;at.CANVAS_LAYERS=3;at.SELECT_BOX=0;at.DRAG=1;at.NODE=2;at.WEBGL=3;at.CANVAS_TYPES=["2d","2d","2d","webgl2"];at.BUFFER_COUNT=3;at.TEXTURE_BUFFER=0;at.MOTIONBLUR_BUFFER_NODE=1;at.MOTIONBLUR_BUFFER_DRAG=2;function Jv(n){var e=this,t=e.cy.window(),r=t.document;n.webgl&&(at.CANVAS_LAYERS=e.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),e.data={canvases:new Array(at.CANVAS_LAYERS),contexts:new Array(at.CANVAS_LAYERS),canvasNeedsRedraw:new Array(at.CANVAS_LAYERS),bufferCanvases:new Array(at.BUFFER_COUNT),bufferContexts:new Array(at.CANVAS_LAYERS)};var i="-webkit-tap-highlight-color",a="rgba(0,0,0,0)";e.data.canvasContainer=r.createElement("div");var s=e.data.canvasContainer.style;e.data.canvasContainer.style[i]=a,s.position="relative",s.zIndex="0",s.overflow="hidden";var o=n.cy.container();o.appendChild(e.data.canvasContainer),o.style[i]=a;var l={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};ob()&&(l["-ms-touch-action"]="none",l["touch-action"]="none");for(var u=0;u<at.CANVAS_LAYERS;u++){var c=e.data.canvases[u]=r.createElement("canvas"),f=at.CANVAS_TYPES[u];e.data.contexts[u]=c.getContext(f),e.data.contexts[u]||Lt("Could not create canvas of type "+f),Object.keys(l).forEach(function(H){c.style[H]=l[H]}),c.style.position="absolute",c.setAttribute("data-id","layer"+u),c.style.zIndex=String(at.CANVAS_LAYERS-u),e.data.canvasContainer.appendChild(c),e.data.canvasNeedsRedraw[u]=!1}e.data.topCanvas=e.data.canvases[0],e.data.canvases[at.NODE].setAttribute("data-id","layer"+at.NODE+"-node"),e.data.canvases[at.SELECT_BOX].setAttribute("data-id","layer"+at.SELECT_BOX+"-selectbox"),e.data.canvases[at.DRAG].setAttribute("data-id","layer"+at.DRAG+"-drag"),e.data.canvases[at.WEBGL]&&e.data.canvases[at.WEBGL].setAttribute("data-id","layer"+at.WEBGL+"-webgl");for(var u=0;u<at.BUFFER_COUNT;u++)e.data.bufferCanvases[u]=r.createElement("canvas"),e.data.bufferContexts[u]=e.data.bufferCanvases[u].getContext("2d"),e.data.bufferCanvases[u].style.position="absolute",e.data.bufferCanvases[u].setAttribute("data-id","buffer"+u),e.data.bufferCanvases[u].style.zIndex=String(-u-1),e.data.bufferCanvases[u].style.visibility="hidden";e.pathsEnabled=!0;var d=En(),h=function(X){return{x:(X.x1+X.x2)/2,y:(X.y1+X.y2)/2}},v=function(X){return{x:-X.w/2,y:-X.h/2}},m=function(X){var te=X[0]._private,ue=te.oldBackgroundTimestamp===te.backgroundTimestamp;return!ue},g=function(X){return X[0]._private.nodeKey},p=function(X){return X[0]._private.labelStyleKey},x=function(X){return X[0]._private.sourceLabelStyleKey},y=function(X){return X[0]._private.targetLabelStyleKey},E=function(X,te,ue,Se,U){return e.drawElement(X,te,ue,!1,!1,U)},M=function(X,te,ue,Se,U){return e.drawElementText(X,te,ue,Se,"main",U)},w=function(X,te,ue,Se,U){return e.drawElementText(X,te,ue,Se,"source",U)},b=function(X,te,ue,Se,U){return e.drawElementText(X,te,ue,Se,"target",U)},C=function(X){return X.boundingBox(),X[0]._private.bodyBounds},T=function(X){return X.boundingBox(),X[0]._private.labelBounds.main||d},S=function(X){return X.boundingBox(),X[0]._private.labelBounds.source||d},L=function(X){return X.boundingBox(),X[0]._private.labelBounds.target||d},N=function(X,te){return te},I=function(X){return h(C(X))},_=function(X,te,ue){var Se=X?X+"-":"";return{x:te.x+ue.pstyle(Se+"text-margin-x").pfValue,y:te.y+ue.pstyle(Se+"text-margin-y").pfValue}},P=function(X,te,ue){var Se=X[0]._private.rscratch;return{x:Se[te],y:Se[ue]}},A=function(X){return _("",P(X,"labelX","labelY"),X)},D=function(X){return _("source",P(X,"sourceLabelX","sourceLabelY"),X)},R=function(X){return _("target",P(X,"targetLabelX","targetLabelY"),X)},B=function(X){return v(C(X))},k=function(X){return v(S(X))},V=function(X){return v(L(X))},Y=function(X){var te=T(X),ue=v(T(X));if(X.isNode()){switch(X.pstyle("text-halign").value){case"left":ue.x=-te.w-(te.leftPad||0);break;case"right":ue.x=-(te.rightPad||0);break}switch(X.pstyle("text-valign").value){case"top":ue.y=-te.h-(te.topPad||0);break;case"bottom":ue.y=-(te.botPad||0);break}}return ue},Z=e.data.eleTxrCache=new os(e,{getKey:g,doesEleInvalidateKey:m,drawElement:E,getBoundingBox:C,getRotationPoint:I,getRotationOffset:B,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),W=e.data.lblTxrCache=new os(e,{getKey:p,drawElement:M,getBoundingBox:T,getRotationPoint:A,getRotationOffset:Y,isVisible:N}),K=e.data.slbTxrCache=new os(e,{getKey:x,drawElement:w,getBoundingBox:S,getRotationPoint:D,getRotationOffset:k,isVisible:N}),Q=e.data.tlbTxrCache=new os(e,{getKey:y,drawElement:b,getBoundingBox:L,getRotationPoint:R,getRotationOffset:V,isVisible:N}),ne=e.data.lyrTxrCache=new Bv(e);e.onUpdateEleCalcs(function(X,te){Z.invalidateElements(te),W.invalidateElements(te),K.invalidateElements(te),Q.invalidateElements(te),ne.invalidateElements(te);for(var ue=0;ue<te.length;ue++){var Se=te[ue]._private;Se.oldBackgroundTimestamp=Se.backgroundTimestamp}});var ie=function(X){for(var te=0;te<X.length;te++)ne.enqueueElementRefinement(X[te].ele)};Z.onDequeue(ie),W.onDequeue(ie),K.onDequeue(ie),Q.onDequeue(ie),n.webgl&&e.initWebgl(n,{getStyleKey:g,getLabelKey:p,drawElement:E,drawLabel:M,getElementBox:C,getLabelBox:T,getElementRotationPoint:I,getElementRotationOffset:B,getLabelRotationPoint:A,getLabelRotationOffset:Y})}at.redrawHint=function(n,e){var t=this;switch(n){case"eles":t.data.canvasNeedsRedraw[at.NODE]=e;break;case"drag":t.data.canvasNeedsRedraw[at.DRAG]=e;break;case"select":t.data.canvasNeedsRedraw[at.SELECT_BOX]=e;break;case"gc":t.data.gc=!0;break}};var HC=typeof Path2D<"u";at.path2dEnabled=function(n){if(n===void 0)return this.pathsEnabled;this.pathsEnabled=!!n};at.usePaths=function(){return HC&&this.pathsEnabled};at.setImgSmoothing=function(n,e){n.imageSmoothingEnabled!=null?n.imageSmoothingEnabled=e:(n.webkitImageSmoothingEnabled=e,n.mozImageSmoothingEnabled=e,n.msImageSmoothingEnabled=e)};at.getImgSmoothing=function(n){return n.imageSmoothingEnabled!=null?n.imageSmoothingEnabled:n.webkitImageSmoothingEnabled||n.mozImageSmoothingEnabled||n.msImageSmoothingEnabled};at.makeOffscreenCanvas=function(n,e){var t;if((typeof OffscreenCanvas>"u"?"undefined":Wt(OffscreenCanvas))!=="undefined")t=new OffscreenCanvas(n,e);else{var r=this.cy.window(),i=r.document;t=i.createElement("canvas"),t.width=n,t.height=e}return t};[kv,cr,Cr,nf,Fi,Va,vn,Yv,ii,Gs,Qv].forEach(function(n){Je(at,n)});var WC=[{name:"null",impl:Mv},{name:"base",impl:Ov},{name:"canvas",impl:VC}],XC=[{type:"layout",extensions:wA},{type:"renderer",extensions:WC}],jv={},eg={};function tg(n,e,t){var r=t,i=function(C){Et("Can not register `"+e+"` for `"+n+"` since `"+C+"` already exists in the prototype and can not be overridden")};if(n==="core"){if(ws.prototype[e])return i(e);ws.prototype[e]=t}else if(n==="collection"){if(en.prototype[e])return i(e);en.prototype[e]=t}else if(n==="layout"){for(var a=function(C){this.options=C,t.call(this,C),dt(this._private)||(this._private={}),this._private.cy=C.cy,this._private.listeners=[],this.createEmitter()},s=a.prototype=Object.create(t.prototype),o=[],l=0;l<o.length;l++){var u=o[l];s[u]=s[u]||function(){return this}}s.start&&!s.run?s.run=function(){return this.start(),this}:!s.start&&s.run&&(s.start=function(){return this.run(),this});var c=t.prototype.stop;s.stop=function(){var b=this.options;if(b&&b.animate){var C=this.animations;if(C)for(var T=0;T<C.length;T++)C[T].stop()}return c?c.call(this):this.emit("layoutstop"),this},s.destroy||(s.destroy=function(){return this}),s.cy=function(){return this._private.cy};var f=function(C){return C._private.cy},d={addEventFields:function(C,T){T.layout=C,T.cy=f(C),T.target=C},bubble:function(){return!0},parent:function(C){return f(C)}};Je(s,{createEmitter:function(){return this._private.emitter=new yl(d,this),this},emitter:function(){return this._private.emitter},on:function(C,T){return this.emitter().on(C,T),this},one:function(C,T){return this.emitter().one(C,T),this},once:function(C,T){return this.emitter().one(C,T),this},removeListener:function(C,T){return this.emitter().removeListener(C,T),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(C,T){return this.emitter().emit(C,T),this}}),xt.eventAliasesOn(s),r=a}else if(n==="renderer"&&e!=="null"&&e!=="base"){var h=ng("renderer","base"),v=h.prototype,m=t,g=t.prototype,p=function(){h.apply(this,arguments),m.apply(this,arguments)},x=p.prototype;for(var y in v){var E=v[y],M=g[y]!=null;if(M)return i(y);x[y]=E}for(var w in g)x[w]=g[w];v.clientFunctions.forEach(function(b){x[b]=x[b]||function(){Lt("Renderer does not implement `renderer."+b+"()` on its prototype")}}),r=p}else if(n==="__proto__"||n==="constructor"||n==="prototype")return Lt(n+" is an illegal type to be registered, possibly lead to prototype pollutions");return xp({map:jv,keys:[n,e],value:r})}function ng(n,e){return Ep({map:jv,keys:[n,e]})}function YC(n,e,t,r,i){return xp({map:eg,keys:[n,e,t,r],value:i})}function qC(n,e,t,r){return Ep({map:eg,keys:[n,e,t,r]})}var xc=function(){if(arguments.length===2)return ng.apply(null,arguments);if(arguments.length===3)return tg.apply(null,arguments);if(arguments.length===4)return qC.apply(null,arguments);if(arguments.length===5)return YC.apply(null,arguments);Lt("Invalid extension access syntax")};ws.prototype.extension=xc;XC.forEach(function(n){n.extensions.forEach(function(e){tg(n.type,e.name,e.impl)})});var rg=function n(){if(!(this instanceof n))return new n;this.length=0},Pi=rg.prototype;Pi.instanceString=function(){return"stylesheet"};Pi.selector=function(n){var e=this.length++;return this[e]={selector:n,properties:[]},this};Pi.css=function(n,e){var t=this.length-1;if($e(n))this[t].properties.push({name:n,value:e});else if(dt(n))for(var r=n,i=Object.keys(r),a=0;a<i.length;a++){var s=i[a],o=r[s];if(o!=null){var l=an.properties[s]||an.properties[ul(s)];if(l!=null){var u=l.name,c=o;this[t].properties.push({name:u,value:c})}}}return this};Pi.style=Pi.css;Pi.generateStyle=function(n){var e=new an(n);return this.appendToStyle(e)};Pi.appendToStyle=function(n){for(var e=0;e<this.length;e++){var t=this[e],r=t.selector,i=t.properties;n.selector(r);for(var a=0;a<i.length;a++){var s=i[a];n.css(s.name,s.value)}}return n};var KC="3.31.0",ei=function(e){if(e===void 0&&(e={}),dt(e))return new ws(e);if($e(e))return xc.apply(xc,arguments)};ei.use=function(n){var e=Array.prototype.slice.call(arguments,1);return e.unshift(ei),n.apply(null,e),this};ei.warnings=function(n){return Cp(n)};ei.version=KC;ei.stylesheet=ei.Stylesheet=rg;function $C(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Vo={exports:{}},Ho={exports:{}},Wo={exports:{}},ZC=Wo.exports,Md;function QC(){return Md||(Md=1,function(n,e){(function(r,i){n.exports=i()})(ZC,function(){return function(t){var r={};function i(a){if(r[a])return r[a].exports;var s=r[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=r,i.i=function(a){return a},i.d=function(a,s,o){i.o(a,s)||Object.defineProperty(a,s,{configurable:!1,enumerable:!0,get:o})},i.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return i.d(s,"a",s),s},i.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)},i.p="",i(i.s=28)}([function(t,r,i){function a(){}a.QUALITY=1,a.DEFAULT_CREATE_BENDS_AS_NEEDED=!1,a.DEFAULT_INCREMENTAL=!1,a.DEFAULT_ANIMATION_ON_LAYOUT=!0,a.DEFAULT_ANIMATION_DURING_LAYOUT=!1,a.DEFAULT_ANIMATION_PERIOD=50,a.DEFAULT_UNIFORM_LEAF_NODE_SIZES=!1,a.DEFAULT_GRAPH_MARGIN=15,a.NODE_DIMENSIONS_INCLUDE_LABELS=!1,a.SIMPLE_NODE_SIZE=40,a.SIMPLE_NODE_HALF_SIZE=a.SIMPLE_NODE_SIZE/2,a.EMPTY_COMPOUND_NODE_SIZE=40,a.MIN_EDGE_LENGTH=1,a.WORLD_BOUNDARY=1e6,a.INITIAL_WORLD_BOUNDARY=a.WORLD_BOUNDARY/1e3,a.WORLD_CENTER_X=1200,a.WORLD_CENTER_Y=900,t.exports=a},function(t,r,i){var a=i(2),s=i(8),o=i(9);function l(c,f,d){a.call(this,d),this.isOverlapingSourceAndTarget=!1,this.vGraphObject=d,this.bendpoints=[],this.source=c,this.target=f}l.prototype=Object.create(a.prototype);for(var u in a)l[u]=a[u];l.prototype.getSource=function(){return this.source},l.prototype.getTarget=function(){return this.target},l.prototype.isInterGraph=function(){return this.isInterGraph},l.prototype.getLength=function(){return this.length},l.prototype.isOverlapingSourceAndTarget=function(){return this.isOverlapingSourceAndTarget},l.prototype.getBendpoints=function(){return this.bendpoints},l.prototype.getLca=function(){return this.lca},l.prototype.getSourceInLca=function(){return this.sourceInLca},l.prototype.getTargetInLca=function(){return this.targetInLca},l.prototype.getOtherEnd=function(c){if(this.source===c)return this.target;if(this.target===c)return this.source;throw"Node is not incident with this edge"},l.prototype.getOtherEndInGraph=function(c,f){for(var d=this.getOtherEnd(c),h=f.getGraphManager().getRoot();;){if(d.getOwner()==f)return d;if(d.getOwner()==h)break;d=d.getOwner().getParent()}return null},l.prototype.updateLength=function(){var c=new Array(4);this.isOverlapingSourceAndTarget=s.getIntersection(this.target.getRect(),this.source.getRect(),c),this.isOverlapingSourceAndTarget||(this.lengthX=c[0]-c[2],this.lengthY=c[1]-c[3],Math.abs(this.lengthX)<1&&(this.lengthX=o.sign(this.lengthX)),Math.abs(this.lengthY)<1&&(this.lengthY=o.sign(this.lengthY)),this.length=Math.sqrt(this.lengthX*this.lengthX+this.lengthY*this.lengthY))},l.prototype.updateLengthSimple=function(){this.lengthX=this.target.getCenterX()-this.source.getCenterX(),this.lengthY=this.target.getCenterY()-this.source.getCenterY(),Math.abs(this.lengthX)<1&&(this.lengthX=o.sign(this.lengthX)),Math.abs(this.lengthY)<1&&(this.lengthY=o.sign(this.lengthY)),this.length=Math.sqrt(this.lengthX*this.lengthX+this.lengthY*this.lengthY)},t.exports=l},function(t,r,i){function a(s){this.vGraphObject=s}t.exports=a},function(t,r,i){var a=i(2),s=i(10),o=i(13),l=i(0),u=i(16),c=i(5);function f(h,v,m,g){m==null&&g==null&&(g=v),a.call(this,g),h.graphManager!=null&&(h=h.graphManager),this.estimatedSize=s.MIN_VALUE,this.inclusionTreeDepth=s.MAX_VALUE,this.vGraphObject=g,this.edges=[],this.graphManager=h,m!=null&&v!=null?this.rect=new o(v.x,v.y,m.width,m.height):this.rect=new o}f.prototype=Object.create(a.prototype);for(var d in a)f[d]=a[d];f.prototype.getEdges=function(){return this.edges},f.prototype.getChild=function(){return this.child},f.prototype.getOwner=function(){return this.owner},f.prototype.getWidth=function(){return this.rect.width},f.prototype.setWidth=function(h){this.rect.width=h},f.prototype.getHeight=function(){return this.rect.height},f.prototype.setHeight=function(h){this.rect.height=h},f.prototype.getCenterX=function(){return this.rect.x+this.rect.width/2},f.prototype.getCenterY=function(){return this.rect.y+this.rect.height/2},f.prototype.getCenter=function(){return new c(this.rect.x+this.rect.width/2,this.rect.y+this.rect.height/2)},f.prototype.getLocation=function(){return new c(this.rect.x,this.rect.y)},f.prototype.getRect=function(){return this.rect},f.prototype.getDiagonal=function(){return Math.sqrt(this.rect.width*this.rect.width+this.rect.height*this.rect.height)},f.prototype.getHalfTheDiagonal=function(){return Math.sqrt(this.rect.height*this.rect.height+this.rect.width*this.rect.width)/2},f.prototype.setRect=function(h,v){this.rect.x=h.x,this.rect.y=h.y,this.rect.width=v.width,this.rect.height=v.height},f.prototype.setCenter=function(h,v){this.rect.x=h-this.rect.width/2,this.rect.y=v-this.rect.height/2},f.prototype.setLocation=function(h,v){this.rect.x=h,this.rect.y=v},f.prototype.moveBy=function(h,v){this.rect.x+=h,this.rect.y+=v},f.prototype.getEdgeListToNode=function(h){var v=[],m=this;return m.edges.forEach(function(g){if(g.target==h){if(g.source!=m)throw"Incorrect edge source!";v.push(g)}}),v},f.prototype.getEdgesBetween=function(h){var v=[],m=this;return m.edges.forEach(function(g){if(!(g.source==m||g.target==m))throw"Incorrect edge source and/or target";(g.target==h||g.source==h)&&v.push(g)}),v},f.prototype.getNeighborsList=function(){var h=new Set,v=this;return v.edges.forEach(function(m){if(m.source==v)h.add(m.target);else{if(m.target!=v)throw"Incorrect incidency!";h.add(m.source)}}),h},f.prototype.withChildren=function(){var h=new Set,v,m;if(h.add(this),this.child!=null)for(var g=this.child.getNodes(),p=0;p<g.length;p++)v=g[p],m=v.withChildren(),m.forEach(function(x){h.add(x)});return h},f.prototype.getNoOfChildren=function(){var h=0,v;if(this.child==null)h=1;else for(var m=this.child.getNodes(),g=0;g<m.length;g++)v=m[g],h+=v.getNoOfChildren();return h==0&&(h=1),h},f.prototype.getEstimatedSize=function(){if(this.estimatedSize==s.MIN_VALUE)throw"assert failed";return this.estimatedSize},f.prototype.calcEstimatedSize=function(){return this.child==null?this.estimatedSize=(this.rect.width+this.rect.height)/2:(this.estimatedSize=this.child.calcEstimatedSize(),this.rect.width=this.estimatedSize,this.rect.height=this.estimatedSize,this.estimatedSize)},f.prototype.scatter=function(){var h,v,m=-l.INITIAL_WORLD_BOUNDARY,g=l.INITIAL_WORLD_BOUNDARY;h=l.WORLD_CENTER_X+u.nextDouble()*(g-m)+m;var p=-l.INITIAL_WORLD_BOUNDARY,x=l.INITIAL_WORLD_BOUNDARY;v=l.WORLD_CENTER_Y+u.nextDouble()*(x-p)+p,this.rect.x=h,this.rect.y=v},f.prototype.updateBounds=function(){if(this.getChild()==null)throw"assert failed";if(this.getChild().getNodes().length!=0){var h=this.getChild();if(h.updateBounds(!0),this.rect.x=h.getLeft(),this.rect.y=h.getTop(),this.setWidth(h.getRight()-h.getLeft()),this.setHeight(h.getBottom()-h.getTop()),l.NODE_DIMENSIONS_INCLUDE_LABELS){var v=h.getRight()-h.getLeft(),m=h.getBottom()-h.getTop();this.labelWidth&&(this.labelPosHorizontal=="left"?(this.rect.x-=this.labelWidth,this.setWidth(v+this.labelWidth)):this.labelPosHorizontal=="center"&&this.labelWidth>v?(this.rect.x-=(this.labelWidth-v)/2,this.setWidth(this.labelWidth)):this.labelPosHorizontal=="right"&&this.setWidth(v+this.labelWidth)),this.labelHeight&&(this.labelPosVertical=="top"?(this.rect.y-=this.labelHeight,this.setHeight(m+this.labelHeight)):this.labelPosVertical=="center"&&this.labelHeight>m?(this.rect.y-=(this.labelHeight-m)/2,this.setHeight(this.labelHeight)):this.labelPosVertical=="bottom"&&this.setHeight(m+this.labelHeight))}}},f.prototype.getInclusionTreeDepth=function(){if(this.inclusionTreeDepth==s.MAX_VALUE)throw"assert failed";return this.inclusionTreeDepth},f.prototype.transform=function(h){var v=this.rect.x;v>l.WORLD_BOUNDARY?v=l.WORLD_BOUNDARY:v<-l.WORLD_BOUNDARY&&(v=-l.WORLD_BOUNDARY);var m=this.rect.y;m>l.WORLD_BOUNDARY?m=l.WORLD_BOUNDARY:m<-l.WORLD_BOUNDARY&&(m=-l.WORLD_BOUNDARY);var g=new c(v,m),p=h.inverseTransformPoint(g);this.setLocation(p.x,p.y)},f.prototype.getLeft=function(){return this.rect.x},f.prototype.getRight=function(){return this.rect.x+this.rect.width},f.prototype.getTop=function(){return this.rect.y},f.prototype.getBottom=function(){return this.rect.y+this.rect.height},f.prototype.getParent=function(){return this.owner==null?null:this.owner.getParent()},t.exports=f},function(t,r,i){var a=i(0);function s(){}for(var o in a)s[o]=a[o];s.MAX_ITERATIONS=2500,s.DEFAULT_EDGE_LENGTH=50,s.DEFAULT_SPRING_STRENGTH=.45,s.DEFAULT_REPULSION_STRENGTH=4500,s.DEFAULT_GRAVITY_STRENGTH=.4,s.DEFAULT_COMPOUND_GRAVITY_STRENGTH=1,s.DEFAULT_GRAVITY_RANGE_FACTOR=3.8,s.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=1.5,s.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION=!0,s.DEFAULT_USE_SMART_REPULSION_RANGE_CALCULATION=!0,s.DEFAULT_COOLING_FACTOR_INCREMENTAL=.3,s.COOLING_ADAPTATION_FACTOR=.33,s.ADAPTATION_LOWER_NODE_LIMIT=1e3,s.ADAPTATION_UPPER_NODE_LIMIT=5e3,s.MAX_NODE_DISPLACEMENT_INCREMENTAL=100,s.MAX_NODE_DISPLACEMENT=s.MAX_NODE_DISPLACEMENT_INCREMENTAL*3,s.MIN_REPULSION_DIST=s.DEFAULT_EDGE_LENGTH/10,s.CONVERGENCE_CHECK_PERIOD=100,s.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=.1,s.MIN_EDGE_LENGTH=1,s.GRID_CALCULATION_CHECK_PERIOD=10,t.exports=s},function(t,r,i){function a(s,o){s==null&&o==null?(this.x=0,this.y=0):(this.x=s,this.y=o)}a.prototype.getX=function(){return this.x},a.prototype.getY=function(){return this.y},a.prototype.setX=function(s){this.x=s},a.prototype.setY=function(s){this.y=s},a.prototype.getDifference=function(s){return new DimensionD(this.x-s.x,this.y-s.y)},a.prototype.getCopy=function(){return new a(this.x,this.y)},a.prototype.translate=function(s){return this.x+=s.width,this.y+=s.height,this},t.exports=a},function(t,r,i){var a=i(2),s=i(10),o=i(0),l=i(7),u=i(3),c=i(1),f=i(13),d=i(12),h=i(11);function v(g,p,x){a.call(this,x),this.estimatedSize=s.MIN_VALUE,this.margin=o.DEFAULT_GRAPH_MARGIN,this.edges=[],this.nodes=[],this.isConnected=!1,this.parent=g,p!=null&&p instanceof l?this.graphManager=p:p!=null&&p instanceof Layout&&(this.graphManager=p.graphManager)}v.prototype=Object.create(a.prototype);for(var m in a)v[m]=a[m];v.prototype.getNodes=function(){return this.nodes},v.prototype.getEdges=function(){return this.edges},v.prototype.getGraphManager=function(){return this.graphManager},v.prototype.getParent=function(){return this.parent},v.prototype.getLeft=function(){return this.left},v.prototype.getRight=function(){return this.right},v.prototype.getTop=function(){return this.top},v.prototype.getBottom=function(){return this.bottom},v.prototype.isConnected=function(){return this.isConnected},v.prototype.add=function(g,p,x){if(p==null&&x==null){var y=g;if(this.graphManager==null)throw"Graph has no graph mgr!";if(this.getNodes().indexOf(y)>-1)throw"Node already in graph!";return y.owner=this,this.getNodes().push(y),y}else{var E=g;if(!(this.getNodes().indexOf(p)>-1&&this.getNodes().indexOf(x)>-1))throw"Source or target not in graph!";if(!(p.owner==x.owner&&p.owner==this))throw"Both owners must be this graph!";return p.owner!=x.owner?null:(E.source=p,E.target=x,E.isInterGraph=!1,this.getEdges().push(E),p.edges.push(E),x!=p&&x.edges.push(E),E)}},v.prototype.remove=function(g){var p=g;if(g instanceof u){if(p==null)throw"Node is null!";if(!(p.owner!=null&&p.owner==this))throw"Owner graph is invalid!";if(this.graphManager==null)throw"Owner graph manager is invalid!";for(var x=p.edges.slice(),y,E=x.length,M=0;M<E;M++)y=x[M],y.isInterGraph?this.graphManager.remove(y):y.source.owner.remove(y);var w=this.nodes.indexOf(p);if(w==-1)throw"Node not in owner node list!";this.nodes.splice(w,1)}else if(g instanceof c){var y=g;if(y==null)throw"Edge is null!";if(!(y.source!=null&&y.target!=null))throw"Source and/or target is null!";if(!(y.source.owner!=null&&y.target.owner!=null&&y.source.owner==this&&y.target.owner==this))throw"Source and/or target owner is invalid!";var b=y.source.edges.indexOf(y),C=y.target.edges.indexOf(y);if(!(b>-1&&C>-1))throw"Source and/or target doesn't know this edge!";y.source.edges.splice(b,1),y.target!=y.source&&y.target.edges.splice(C,1);var w=y.source.owner.getEdges().indexOf(y);if(w==-1)throw"Not in owner's edge list!";y.source.owner.getEdges().splice(w,1)}},v.prototype.updateLeftTop=function(){for(var g=s.MAX_VALUE,p=s.MAX_VALUE,x,y,E,M=this.getNodes(),w=M.length,b=0;b<w;b++){var C=M[b];x=C.getTop(),y=C.getLeft(),g>x&&(g=x),p>y&&(p=y)}return g==s.MAX_VALUE?null:(M[0].getParent().paddingLeft!=null?E=M[0].getParent().paddingLeft:E=this.margin,this.left=p-E,this.top=g-E,new d(this.left,this.top))},v.prototype.updateBounds=function(g){for(var p=s.MAX_VALUE,x=-s.MAX_VALUE,y=s.MAX_VALUE,E=-s.MAX_VALUE,M,w,b,C,T,S=this.nodes,L=S.length,N=0;N<L;N++){var I=S[N];g&&I.child!=null&&I.updateBounds(),M=I.getLeft(),w=I.getRight(),b=I.getTop(),C=I.getBottom(),p>M&&(p=M),x<w&&(x=w),y>b&&(y=b),E<C&&(E=C)}var _=new f(p,y,x-p,E-y);p==s.MAX_VALUE&&(this.left=this.parent.getLeft(),this.right=this.parent.getRight(),this.top=this.parent.getTop(),this.bottom=this.parent.getBottom()),S[0].getParent().paddingLeft!=null?T=S[0].getParent().paddingLeft:T=this.margin,this.left=_.x-T,this.right=_.x+_.width+T,this.top=_.y-T,this.bottom=_.y+_.height+T},v.calculateBounds=function(g){for(var p=s.MAX_VALUE,x=-s.MAX_VALUE,y=s.MAX_VALUE,E=-s.MAX_VALUE,M,w,b,C,T=g.length,S=0;S<T;S++){var L=g[S];M=L.getLeft(),w=L.getRight(),b=L.getTop(),C=L.getBottom(),p>M&&(p=M),x<w&&(x=w),y>b&&(y=b),E<C&&(E=C)}var N=new f(p,y,x-p,E-y);return N},v.prototype.getInclusionTreeDepth=function(){return this==this.graphManager.getRoot()?1:this.parent.getInclusionTreeDepth()},v.prototype.getEstimatedSize=function(){if(this.estimatedSize==s.MIN_VALUE)throw"assert failed";return this.estimatedSize},v.prototype.calcEstimatedSize=function(){for(var g=0,p=this.nodes,x=p.length,y=0;y<x;y++){var E=p[y];g+=E.calcEstimatedSize()}return g==0?this.estimatedSize=o.EMPTY_COMPOUND_NODE_SIZE:this.estimatedSize=g/Math.sqrt(this.nodes.length),this.estimatedSize},v.prototype.updateConnected=function(){var g=this;if(this.nodes.length==0){this.isConnected=!0;return}var p=new h,x=new Set,y=this.nodes[0],E,M,w=y.withChildren();for(w.forEach(function(N){p.push(N),x.add(N)});p.length!==0;){y=p.shift(),E=y.getEdges();for(var b=E.length,C=0;C<b;C++){var T=E[C];if(M=T.getOtherEndInGraph(y,this),M!=null&&!x.has(M)){var S=M.withChildren();S.forEach(function(N){p.push(N),x.add(N)})}}}if(this.isConnected=!1,x.size>=this.nodes.length){var L=0;x.forEach(function(N){N.owner==g&&L++}),L==this.nodes.length&&(this.isConnected=!0)}},t.exports=v},function(t,r,i){var a,s=i(1);function o(l){a=i(6),this.layout=l,this.graphs=[],this.edges=[]}o.prototype.addRoot=function(){var l=this.layout.newGraph(),u=this.layout.newNode(null),c=this.add(l,u);return this.setRootGraph(c),this.rootGraph},o.prototype.add=function(l,u,c,f,d){if(c==null&&f==null&&d==null){if(l==null)throw"Graph is null!";if(u==null)throw"Parent node is null!";if(this.graphs.indexOf(l)>-1)throw"Graph already in this graph mgr!";if(this.graphs.push(l),l.parent!=null)throw"Already has a parent!";if(u.child!=null)throw"Already has a child!";return l.parent=u,u.child=l,l}else{d=c,f=u,c=l;var h=f.getOwner(),v=d.getOwner();if(!(h!=null&&h.getGraphManager()==this))throw"Source not in this graph mgr!";if(!(v!=null&&v.getGraphManager()==this))throw"Target not in this graph mgr!";if(h==v)return c.isInterGraph=!1,h.add(c,f,d);if(c.isInterGraph=!0,c.source=f,c.target=d,this.edges.indexOf(c)>-1)throw"Edge already in inter-graph edge list!";if(this.edges.push(c),!(c.source!=null&&c.target!=null))throw"Edge source and/or target is null!";if(!(c.source.edges.indexOf(c)==-1&&c.target.edges.indexOf(c)==-1))throw"Edge already in source and/or target incidency list!";return c.source.edges.push(c),c.target.edges.push(c),c}},o.prototype.remove=function(l){if(l instanceof a){var u=l;if(u.getGraphManager()!=this)throw"Graph not in this graph mgr";if(!(u==this.rootGraph||u.parent!=null&&u.parent.graphManager==this))throw"Invalid parent node!";var c=[];c=c.concat(u.getEdges());for(var f,d=c.length,h=0;h<d;h++)f=c[h],u.remove(f);var v=[];v=v.concat(u.getNodes());var m;d=v.length;for(var h=0;h<d;h++)m=v[h],u.remove(m);u==this.rootGraph&&this.setRootGraph(null);var g=this.graphs.indexOf(u);this.graphs.splice(g,1),u.parent=null}else if(l instanceof s){if(f=l,f==null)throw"Edge is null!";if(!f.isInterGraph)throw"Not an inter-graph edge!";if(!(f.source!=null&&f.target!=null))throw"Source and/or target is null!";if(!(f.source.edges.indexOf(f)!=-1&&f.target.edges.indexOf(f)!=-1))throw"Source and/or target doesn't know this edge!";var g=f.source.edges.indexOf(f);if(f.source.edges.splice(g,1),g=f.target.edges.indexOf(f),f.target.edges.splice(g,1),!(f.source.owner!=null&&f.source.owner.getGraphManager()!=null))throw"Edge owner graph or owner graph manager is null!";if(f.source.owner.getGraphManager().edges.indexOf(f)==-1)throw"Not in owner graph manager's edge list!";var g=f.source.owner.getGraphManager().edges.indexOf(f);f.source.owner.getGraphManager().edges.splice(g,1)}},o.prototype.updateBounds=function(){this.rootGraph.updateBounds(!0)},o.prototype.getGraphs=function(){return this.graphs},o.prototype.getAllNodes=function(){if(this.allNodes==null){for(var l=[],u=this.getGraphs(),c=u.length,f=0;f<c;f++)l=l.concat(u[f].getNodes());this.allNodes=l}return this.allNodes},o.prototype.resetAllNodes=function(){this.allNodes=null},o.prototype.resetAllEdges=function(){this.allEdges=null},o.prototype.resetAllNodesToApplyGravitation=function(){this.allNodesToApplyGravitation=null},o.prototype.getAllEdges=function(){if(this.allEdges==null){var l=[],u=this.getGraphs();u.length;for(var c=0;c<u.length;c++)l=l.concat(u[c].getEdges());l=l.concat(this.edges),this.allEdges=l}return this.allEdges},o.prototype.getAllNodesToApplyGravitation=function(){return this.allNodesToApplyGravitation},o.prototype.setAllNodesToApplyGravitation=function(l){if(this.allNodesToApplyGravitation!=null)throw"assert failed";this.allNodesToApplyGravitation=l},o.prototype.getRoot=function(){return this.rootGraph},o.prototype.setRootGraph=function(l){if(l.getGraphManager()!=this)throw"Root not in this graph mgr!";this.rootGraph=l,l.parent==null&&(l.parent=this.layout.newNode("Root node"))},o.prototype.getLayout=function(){return this.layout},o.prototype.isOneAncestorOfOther=function(l,u){if(!(l!=null&&u!=null))throw"assert failed";if(l==u)return!0;var c=l.getOwner(),f;do{if(f=c.getParent(),f==null)break;if(f==u)return!0;if(c=f.getOwner(),c==null)break}while(!0);c=u.getOwner();do{if(f=c.getParent(),f==null)break;if(f==l)return!0;if(c=f.getOwner(),c==null)break}while(!0);return!1},o.prototype.calcLowestCommonAncestors=function(){for(var l,u,c,f,d,h=this.getAllEdges(),v=h.length,m=0;m<v;m++){if(l=h[m],u=l.source,c=l.target,l.lca=null,l.sourceInLca=u,l.targetInLca=c,u==c){l.lca=u.getOwner();continue}for(f=u.getOwner();l.lca==null;){for(l.targetInLca=c,d=c.getOwner();l.lca==null;){if(d==f){l.lca=d;break}if(d==this.rootGraph)break;if(l.lca!=null)throw"assert failed";l.targetInLca=d.getParent(),d=l.targetInLca.getOwner()}if(f==this.rootGraph)break;l.lca==null&&(l.sourceInLca=f.getParent(),f=l.sourceInLca.getOwner())}if(l.lca==null)throw"assert failed"}},o.prototype.calcLowestCommonAncestor=function(l,u){if(l==u)return l.getOwner();var c=l.getOwner();do{if(c==null)break;var f=u.getOwner();do{if(f==null)break;if(f==c)return f;f=f.getParent().getOwner()}while(!0);c=c.getParent().getOwner()}while(!0);return c},o.prototype.calcInclusionTreeDepths=function(l,u){l==null&&u==null&&(l=this.rootGraph,u=1);for(var c,f=l.getNodes(),d=f.length,h=0;h<d;h++)c=f[h],c.inclusionTreeDepth=u,c.child!=null&&this.calcInclusionTreeDepths(c.child,u+1)},o.prototype.includesInvalidEdge=function(){for(var l,u=[],c=this.edges.length,f=0;f<c;f++)l=this.edges[f],this.isOneAncestorOfOther(l.source,l.target)&&u.push(l);for(var f=0;f<u.length;f++)this.remove(u[f]);return!1},t.exports=o},function(t,r,i){var a=i(12);function s(){}s.calcSeparationAmount=function(o,l,u,c){if(!o.intersects(l))throw"assert failed";var f=new Array(2);this.decideDirectionsForOverlappingNodes(o,l,f),u[0]=Math.min(o.getRight(),l.getRight())-Math.max(o.x,l.x),u[1]=Math.min(o.getBottom(),l.getBottom())-Math.max(o.y,l.y),o.getX()<=l.getX()&&o.getRight()>=l.getRight()?u[0]+=Math.min(l.getX()-o.getX(),o.getRight()-l.getRight()):l.getX()<=o.getX()&&l.getRight()>=o.getRight()&&(u[0]+=Math.min(o.getX()-l.getX(),l.getRight()-o.getRight())),o.getY()<=l.getY()&&o.getBottom()>=l.getBottom()?u[1]+=Math.min(l.getY()-o.getY(),o.getBottom()-l.getBottom()):l.getY()<=o.getY()&&l.getBottom()>=o.getBottom()&&(u[1]+=Math.min(o.getY()-l.getY(),l.getBottom()-o.getBottom()));var d=Math.abs((l.getCenterY()-o.getCenterY())/(l.getCenterX()-o.getCenterX()));l.getCenterY()===o.getCenterY()&&l.getCenterX()===o.getCenterX()&&(d=1);var h=d*u[0],v=u[1]/d;u[0]<v?v=u[0]:h=u[1],u[0]=-1*f[0]*(v/2+c),u[1]=-1*f[1]*(h/2+c)},s.decideDirectionsForOverlappingNodes=function(o,l,u){o.getCenterX()<l.getCenterX()?u[0]=-1:u[0]=1,o.getCenterY()<l.getCenterY()?u[1]=-1:u[1]=1},s.getIntersection2=function(o,l,u){var c=o.getCenterX(),f=o.getCenterY(),d=l.getCenterX(),h=l.getCenterY();if(o.intersects(l))return u[0]=c,u[1]=f,u[2]=d,u[3]=h,!0;var v=o.getX(),m=o.getY(),g=o.getRight(),p=o.getX(),x=o.getBottom(),y=o.getRight(),E=o.getWidthHalf(),M=o.getHeightHalf(),w=l.getX(),b=l.getY(),C=l.getRight(),T=l.getX(),S=l.getBottom(),L=l.getRight(),N=l.getWidthHalf(),I=l.getHeightHalf(),_=!1,P=!1;if(c===d){if(f>h)return u[0]=c,u[1]=m,u[2]=d,u[3]=S,!1;if(f<h)return u[0]=c,u[1]=x,u[2]=d,u[3]=b,!1}else if(f===h){if(c>d)return u[0]=v,u[1]=f,u[2]=C,u[3]=h,!1;if(c<d)return u[0]=g,u[1]=f,u[2]=w,u[3]=h,!1}else{var A=o.height/o.width,D=l.height/l.width,R=(h-f)/(d-c),B=void 0,k=void 0,V=void 0,Y=void 0,Z=void 0,W=void 0;if(-A===R?c>d?(u[0]=p,u[1]=x,_=!0):(u[0]=g,u[1]=m,_=!0):A===R&&(c>d?(u[0]=v,u[1]=m,_=!0):(u[0]=y,u[1]=x,_=!0)),-D===R?d>c?(u[2]=T,u[3]=S,P=!0):(u[2]=C,u[3]=b,P=!0):D===R&&(d>c?(u[2]=w,u[3]=b,P=!0):(u[2]=L,u[3]=S,P=!0)),_&&P)return!1;if(c>d?f>h?(B=this.getCardinalDirection(A,R,4),k=this.getCardinalDirection(D,R,2)):(B=this.getCardinalDirection(-A,R,3),k=this.getCardinalDirection(-D,R,1)):f>h?(B=this.getCardinalDirection(-A,R,1),k=this.getCardinalDirection(-D,R,3)):(B=this.getCardinalDirection(A,R,2),k=this.getCardinalDirection(D,R,4)),!_)switch(B){case 1:Y=m,V=c+-M/R,u[0]=V,u[1]=Y;break;case 2:V=y,Y=f+E*R,u[0]=V,u[1]=Y;break;case 3:Y=x,V=c+M/R,u[0]=V,u[1]=Y;break;case 4:V=p,Y=f+-E*R,u[0]=V,u[1]=Y;break}if(!P)switch(k){case 1:W=b,Z=d+-I/R,u[2]=Z,u[3]=W;break;case 2:Z=L,W=h+N*R,u[2]=Z,u[3]=W;break;case 3:W=S,Z=d+I/R,u[2]=Z,u[3]=W;break;case 4:Z=T,W=h+-N*R,u[2]=Z,u[3]=W;break}}return!1},s.getCardinalDirection=function(o,l,u){return o>l?u:1+u%4},s.getIntersection=function(o,l,u,c){if(c==null)return this.getIntersection2(o,l,u);var f=o.x,d=o.y,h=l.x,v=l.y,m=u.x,g=u.y,p=c.x,x=c.y,y=void 0,E=void 0,M=void 0,w=void 0,b=void 0,C=void 0,T=void 0,S=void 0,L=void 0;return M=v-d,b=f-h,T=h*d-f*v,w=x-g,C=m-p,S=p*g-m*x,L=M*C-w*b,L===0?null:(y=(b*S-C*T)/L,E=(w*T-M*S)/L,new a(y,E))},s.angleOfVector=function(o,l,u,c){var f=void 0;return o!==u?(f=Math.atan((c-l)/(u-o)),u<o?f+=Math.PI:c<l&&(f+=this.TWO_PI)):c<l?f=this.ONE_AND_HALF_PI:f=this.HALF_PI,f},s.doIntersect=function(o,l,u,c){var f=o.x,d=o.y,h=l.x,v=l.y,m=u.x,g=u.y,p=c.x,x=c.y,y=(h-f)*(x-g)-(p-m)*(v-d);if(y===0)return!1;var E=((x-g)*(p-f)+(m-p)*(x-d))/y,M=((d-v)*(p-f)+(h-f)*(x-d))/y;return 0<E&&E<1&&0<M&&M<1},s.findCircleLineIntersections=function(o,l,u,c,f,d,h){var v=(u-o)*(u-o)+(c-l)*(c-l),m=2*((o-f)*(u-o)+(l-d)*(c-l)),g=(o-f)*(o-f)+(l-d)*(l-d)-h*h,p=m*m-4*v*g;if(p>=0){var x=(-m+Math.sqrt(m*m-4*v*g))/(2*v),y=(-m-Math.sqrt(m*m-4*v*g))/(2*v),E=null;return x>=0&&x<=1?[x]:y>=0&&y<=1?[y]:E}else return null},s.HALF_PI=.5*Math.PI,s.ONE_AND_HALF_PI=1.5*Math.PI,s.TWO_PI=2*Math.PI,s.THREE_PI=3*Math.PI,t.exports=s},function(t,r,i){function a(){}a.sign=function(s){return s>0?1:s<0?-1:0},a.floor=function(s){return s<0?Math.ceil(s):Math.floor(s)},a.ceil=function(s){return s<0?Math.floor(s):Math.ceil(s)},t.exports=a},function(t,r,i){function a(){}a.MAX_VALUE=2147483647,a.MIN_VALUE=-2147483648,t.exports=a},function(t,r,i){var a=function(){function f(d,h){for(var v=0;v<h.length;v++){var m=h[v];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(d,m.key,m)}}return function(d,h,v){return h&&f(d.prototype,h),v&&f(d,v),d}}();function s(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")}var o=function(d){return{value:d,next:null,prev:null}},l=function(d,h,v,m){return d!==null?d.next=h:m.head=h,v!==null?v.prev=h:m.tail=h,h.prev=d,h.next=v,m.length++,h},u=function(d,h){var v=d.prev,m=d.next;return v!==null?v.next=m:h.head=m,m!==null?m.prev=v:h.tail=v,d.prev=d.next=null,h.length--,d},c=function(){function f(d){var h=this;s(this,f),this.length=0,this.head=null,this.tail=null,d!=null&&d.forEach(function(v){return h.push(v)})}return a(f,[{key:"size",value:function(){return this.length}},{key:"insertBefore",value:function(h,v){return l(v.prev,o(h),v,this)}},{key:"insertAfter",value:function(h,v){return l(v,o(h),v.next,this)}},{key:"insertNodeBefore",value:function(h,v){return l(v.prev,h,v,this)}},{key:"insertNodeAfter",value:function(h,v){return l(v,h,v.next,this)}},{key:"push",value:function(h){return l(this.tail,o(h),null,this)}},{key:"unshift",value:function(h){return l(null,o(h),this.head,this)}},{key:"remove",value:function(h){return u(h,this)}},{key:"pop",value:function(){return u(this.tail,this).value}},{key:"popNode",value:function(){return u(this.tail,this)}},{key:"shift",value:function(){return u(this.head,this).value}},{key:"shiftNode",value:function(){return u(this.head,this)}},{key:"get_object_at",value:function(h){if(h<=this.length()){for(var v=1,m=this.head;v<h;)m=m.next,v++;return m.value}}},{key:"set_object_at",value:function(h,v){if(h<=this.length()){for(var m=1,g=this.head;m<h;)g=g.next,m++;g.value=v}}}]),f}();t.exports=c},function(t,r,i){function a(s,o,l){this.x=null,this.y=null,s==null&&o==null&&l==null?(this.x=0,this.y=0):typeof s=="number"&&typeof o=="number"&&l==null?(this.x=s,this.y=o):s.constructor.name=="Point"&&o==null&&l==null&&(l=s,this.x=l.x,this.y=l.y)}a.prototype.getX=function(){return this.x},a.prototype.getY=function(){return this.y},a.prototype.getLocation=function(){return new a(this.x,this.y)},a.prototype.setLocation=function(s,o,l){s.constructor.name=="Point"&&o==null&&l==null?(l=s,this.setLocation(l.x,l.y)):typeof s=="number"&&typeof o=="number"&&l==null&&(parseInt(s)==s&&parseInt(o)==o?this.move(s,o):(this.x=Math.floor(s+.5),this.y=Math.floor(o+.5)))},a.prototype.move=function(s,o){this.x=s,this.y=o},a.prototype.translate=function(s,o){this.x+=s,this.y+=o},a.prototype.equals=function(s){if(s.constructor.name=="Point"){var o=s;return this.x==o.x&&this.y==o.y}return this==s},a.prototype.toString=function(){return new a().constructor.name+"[x="+this.x+",y="+this.y+"]"},t.exports=a},function(t,r,i){function a(s,o,l,u){this.x=0,this.y=0,this.width=0,this.height=0,s!=null&&o!=null&&l!=null&&u!=null&&(this.x=s,this.y=o,this.width=l,this.height=u)}a.prototype.getX=function(){return this.x},a.prototype.setX=function(s){this.x=s},a.prototype.getY=function(){return this.y},a.prototype.setY=function(s){this.y=s},a.prototype.getWidth=function(){return this.width},a.prototype.setWidth=function(s){this.width=s},a.prototype.getHeight=function(){return this.height},a.prototype.setHeight=function(s){this.height=s},a.prototype.getRight=function(){return this.x+this.width},a.prototype.getBottom=function(){return this.y+this.height},a.prototype.intersects=function(s){return!(this.getRight()<s.x||this.getBottom()<s.y||s.getRight()<this.x||s.getBottom()<this.y)},a.prototype.getCenterX=function(){return this.x+this.width/2},a.prototype.getMinX=function(){return this.getX()},a.prototype.getMaxX=function(){return this.getX()+this.width},a.prototype.getCenterY=function(){return this.y+this.height/2},a.prototype.getMinY=function(){return this.getY()},a.prototype.getMaxY=function(){return this.getY()+this.height},a.prototype.getWidthHalf=function(){return this.width/2},a.prototype.getHeightHalf=function(){return this.height/2},t.exports=a},function(t,r,i){var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};function s(){}s.lastID=0,s.createID=function(o){return s.isPrimitive(o)?o:(o.uniqueID!=null||(o.uniqueID=s.getString(),s.lastID++),o.uniqueID)},s.getString=function(o){return o==null&&(o=s.lastID),"Object#"+o},s.isPrimitive=function(o){var l=typeof o>"u"?"undefined":a(o);return o==null||l!="object"&&l!="function"},t.exports=s},function(t,r,i){function a(m){if(Array.isArray(m)){for(var g=0,p=Array(m.length);g<m.length;g++)p[g]=m[g];return p}else return Array.from(m)}var s=i(0),o=i(7),l=i(3),u=i(1),c=i(6),f=i(5),d=i(17),h=i(29);function v(m){h.call(this),this.layoutQuality=s.QUALITY,this.createBendsAsNeeded=s.DEFAULT_CREATE_BENDS_AS_NEEDED,this.incremental=s.DEFAULT_INCREMENTAL,this.animationOnLayout=s.DEFAULT_ANIMATION_ON_LAYOUT,this.animationDuringLayout=s.DEFAULT_ANIMATION_DURING_LAYOUT,this.animationPeriod=s.DEFAULT_ANIMATION_PERIOD,this.uniformLeafNodeSizes=s.DEFAULT_UNIFORM_LEAF_NODE_SIZES,this.edgeToDummyNodes=new Map,this.graphManager=new o(this),this.isLayoutFinished=!1,this.isSubLayout=!1,this.isRemoteUse=!1,m!=null&&(this.isRemoteUse=m)}v.RANDOM_SEED=1,v.prototype=Object.create(h.prototype),v.prototype.getGraphManager=function(){return this.graphManager},v.prototype.getAllNodes=function(){return this.graphManager.getAllNodes()},v.prototype.getAllEdges=function(){return this.graphManager.getAllEdges()},v.prototype.getAllNodesToApplyGravitation=function(){return this.graphManager.getAllNodesToApplyGravitation()},v.prototype.newGraphManager=function(){var m=new o(this);return this.graphManager=m,m},v.prototype.newGraph=function(m){return new c(null,this.graphManager,m)},v.prototype.newNode=function(m){return new l(this.graphManager,m)},v.prototype.newEdge=function(m){return new u(null,null,m)},v.prototype.checkLayoutSuccess=function(){return this.graphManager.getRoot()==null||this.graphManager.getRoot().getNodes().length==0||this.graphManager.includesInvalidEdge()},v.prototype.runLayout=function(){this.isLayoutFinished=!1,this.tilingPreLayout&&this.tilingPreLayout(),this.initParameters();var m;return this.checkLayoutSuccess()?m=!1:m=this.layout(),s.ANIMATE==="during"?!1:(m&&(this.isSubLayout||this.doPostLayout()),this.tilingPostLayout&&this.tilingPostLayout(),this.isLayoutFinished=!0,m)},v.prototype.doPostLayout=function(){this.incremental||this.transform(),this.update()},v.prototype.update2=function(){if(this.createBendsAsNeeded&&(this.createBendpointsFromDummyNodes(),this.graphManager.resetAllEdges()),!this.isRemoteUse){for(var m=this.graphManager.getAllEdges(),g=0;g<m.length;g++)m[g];for(var p=this.graphManager.getRoot().getNodes(),g=0;g<p.length;g++)p[g];this.update(this.graphManager.getRoot())}},v.prototype.update=function(m){if(m==null)this.update2();else if(m instanceof l){var g=m;if(g.getChild()!=null)for(var p=g.getChild().getNodes(),x=0;x<p.length;x++)update(p[x]);if(g.vGraphObject!=null){var y=g.vGraphObject;y.update(g)}}else if(m instanceof u){var E=m;if(E.vGraphObject!=null){var M=E.vGraphObject;M.update(E)}}else if(m instanceof c){var w=m;if(w.vGraphObject!=null){var b=w.vGraphObject;b.update(w)}}},v.prototype.initParameters=function(){this.isSubLayout||(this.layoutQuality=s.QUALITY,this.animationDuringLayout=s.DEFAULT_ANIMATION_DURING_LAYOUT,this.animationPeriod=s.DEFAULT_ANIMATION_PERIOD,this.animationOnLayout=s.DEFAULT_ANIMATION_ON_LAYOUT,this.incremental=s.DEFAULT_INCREMENTAL,this.createBendsAsNeeded=s.DEFAULT_CREATE_BENDS_AS_NEEDED,this.uniformLeafNodeSizes=s.DEFAULT_UNIFORM_LEAF_NODE_SIZES),this.animationDuringLayout&&(this.animationOnLayout=!1)},v.prototype.transform=function(m){if(m==null)this.transform(new f(0,0));else{var g=new d,p=this.graphManager.getRoot().updateLeftTop();if(p!=null){g.setWorldOrgX(m.x),g.setWorldOrgY(m.y),g.setDeviceOrgX(p.x),g.setDeviceOrgY(p.y);for(var x=this.getAllNodes(),y,E=0;E<x.length;E++)y=x[E],y.transform(g)}}},v.prototype.positionNodesRandomly=function(m){if(m==null)this.positionNodesRandomly(this.getGraphManager().getRoot()),this.getGraphManager().getRoot().updateBounds(!0);else for(var g,p,x=m.getNodes(),y=0;y<x.length;y++)g=x[y],p=g.getChild(),p==null||p.getNodes().length==0?g.scatter():(this.positionNodesRandomly(p),g.updateBounds())},v.prototype.getFlatForest=function(){for(var m=[],g=!0,p=this.graphManager.getRoot().getNodes(),x=!0,y=0;y<p.length;y++)p[y].getChild()!=null&&(x=!1);if(!x)return m;var E=new Set,M=[],w=new Map,b=[];for(b=b.concat(p);b.length>0&&g;){for(M.push(b[0]);M.length>0&&g;){var C=M[0];M.splice(0,1),E.add(C);for(var T=C.getEdges(),y=0;y<T.length;y++){var S=T[y].getOtherEnd(C);if(w.get(C)!=S)if(!E.has(S))M.push(S),w.set(S,C);else{g=!1;break}}}if(!g)m=[];else{var L=[].concat(a(E));m.push(L);for(var y=0;y<L.length;y++){var N=L[y],I=b.indexOf(N);I>-1&&b.splice(I,1)}E=new Set,w=new Map}}return m},v.prototype.createDummyNodesForBendpoints=function(m){for(var g=[],p=m.source,x=this.graphManager.calcLowestCommonAncestor(m.source,m.target),y=0;y<m.bendpoints.length;y++){var E=this.newNode(null);E.setRect(new Point(0,0),new Dimension(1,1)),x.add(E);var M=this.newEdge(null);this.graphManager.add(M,p,E),g.add(E),p=E}var M=this.newEdge(null);return this.graphManager.add(M,p,m.target),this.edgeToDummyNodes.set(m,g),m.isInterGraph()?this.graphManager.remove(m):x.remove(m),g},v.prototype.createBendpointsFromDummyNodes=function(){var m=[];m=m.concat(this.graphManager.getAllEdges()),m=[].concat(a(this.edgeToDummyNodes.keys())).concat(m);for(var g=0;g<m.length;g++){var p=m[g];if(p.bendpoints.length>0){for(var x=this.edgeToDummyNodes.get(p),y=0;y<x.length;y++){var E=x[y],M=new f(E.getCenterX(),E.getCenterY()),w=p.bendpoints.get(y);w.x=M.x,w.y=M.y,E.getOwner().remove(E)}this.graphManager.add(p,p.source,p.target)}}},v.transform=function(m,g,p,x){if(p!=null&&x!=null){var y=g;if(m<=50){var E=g/p;y-=(g-E)/50*(50-m)}else{var M=g*x;y+=(M-g)/50*(m-50)}return y}else{var w,b;return m<=50?(w=9*g/500,b=g/10):(w=9*g/50,b=-8*g),w*m+b}},v.findCenterOfTree=function(m){var g=[];g=g.concat(m);var p=[],x=new Map,y=!1,E=null;(g.length==1||g.length==2)&&(y=!0,E=g[0]);for(var M=0;M<g.length;M++){var w=g[M],b=w.getNeighborsList().size;x.set(w,w.getNeighborsList().size),b==1&&p.push(w)}var C=[];for(C=C.concat(p);!y;){var T=[];T=T.concat(C),C=[];for(var M=0;M<g.length;M++){var w=g[M],S=g.indexOf(w);S>=0&&g.splice(S,1);var L=w.getNeighborsList();L.forEach(function(_){if(p.indexOf(_)<0){var P=x.get(_),A=P-1;A==1&&C.push(_),x.set(_,A)}})}p=p.concat(C),(g.length==1||g.length==2)&&(y=!0,E=g[0])}return E},v.prototype.setGraphManager=function(m){this.graphManager=m},t.exports=v},function(t,r,i){function a(){}a.seed=1,a.x=0,a.nextDouble=function(){return a.x=Math.sin(a.seed++)*1e4,a.x-Math.floor(a.x)},t.exports=a},function(t,r,i){var a=i(5);function s(o,l){this.lworldOrgX=0,this.lworldOrgY=0,this.ldeviceOrgX=0,this.ldeviceOrgY=0,this.lworldExtX=1,this.lworldExtY=1,this.ldeviceExtX=1,this.ldeviceExtY=1}s.prototype.getWorldOrgX=function(){return this.lworldOrgX},s.prototype.setWorldOrgX=function(o){this.lworldOrgX=o},s.prototype.getWorldOrgY=function(){return this.lworldOrgY},s.prototype.setWorldOrgY=function(o){this.lworldOrgY=o},s.prototype.getWorldExtX=function(){return this.lworldExtX},s.prototype.setWorldExtX=function(o){this.lworldExtX=o},s.prototype.getWorldExtY=function(){return this.lworldExtY},s.prototype.setWorldExtY=function(o){this.lworldExtY=o},s.prototype.getDeviceOrgX=function(){return this.ldeviceOrgX},s.prototype.setDeviceOrgX=function(o){this.ldeviceOrgX=o},s.prototype.getDeviceOrgY=function(){return this.ldeviceOrgY},s.prototype.setDeviceOrgY=function(o){this.ldeviceOrgY=o},s.prototype.getDeviceExtX=function(){return this.ldeviceExtX},s.prototype.setDeviceExtX=function(o){this.ldeviceExtX=o},s.prototype.getDeviceExtY=function(){return this.ldeviceExtY},s.prototype.setDeviceExtY=function(o){this.ldeviceExtY=o},s.prototype.transformX=function(o){var l=0,u=this.lworldExtX;return u!=0&&(l=this.ldeviceOrgX+(o-this.lworldOrgX)*this.ldeviceExtX/u),l},s.prototype.transformY=function(o){var l=0,u=this.lworldExtY;return u!=0&&(l=this.ldeviceOrgY+(o-this.lworldOrgY)*this.ldeviceExtY/u),l},s.prototype.inverseTransformX=function(o){var l=0,u=this.ldeviceExtX;return u!=0&&(l=this.lworldOrgX+(o-this.ldeviceOrgX)*this.lworldExtX/u),l},s.prototype.inverseTransformY=function(o){var l=0,u=this.ldeviceExtY;return u!=0&&(l=this.lworldOrgY+(o-this.ldeviceOrgY)*this.lworldExtY/u),l},s.prototype.inverseTransformPoint=function(o){var l=new a(this.inverseTransformX(o.x),this.inverseTransformY(o.y));return l},t.exports=s},function(t,r,i){function a(h){if(Array.isArray(h)){for(var v=0,m=Array(h.length);v<h.length;v++)m[v]=h[v];return m}else return Array.from(h)}var s=i(15),o=i(4),l=i(0),u=i(8),c=i(9);function f(){s.call(this),this.useSmartIdealEdgeLengthCalculation=o.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION,this.gravityConstant=o.DEFAULT_GRAVITY_STRENGTH,this.compoundGravityConstant=o.DEFAULT_COMPOUND_GRAVITY_STRENGTH,this.gravityRangeFactor=o.DEFAULT_GRAVITY_RANGE_FACTOR,this.compoundGravityRangeFactor=o.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR,this.displacementThresholdPerNode=3*o.DEFAULT_EDGE_LENGTH/100,this.coolingFactor=o.DEFAULT_COOLING_FACTOR_INCREMENTAL,this.initialCoolingFactor=o.DEFAULT_COOLING_FACTOR_INCREMENTAL,this.totalDisplacement=0,this.oldTotalDisplacement=0,this.maxIterations=o.MAX_ITERATIONS}f.prototype=Object.create(s.prototype);for(var d in s)f[d]=s[d];f.prototype.initParameters=function(){s.prototype.initParameters.call(this,arguments),this.totalIterations=0,this.notAnimatedIterations=0,this.useFRGridVariant=o.DEFAULT_USE_SMART_REPULSION_RANGE_CALCULATION,this.grid=[]},f.prototype.calcIdealEdgeLengths=function(){for(var h,v,m,g,p,x,y,E=this.getGraphManager().getAllEdges(),M=0;M<E.length;M++)h=E[M],v=h.idealLength,h.isInterGraph&&(g=h.getSource(),p=h.getTarget(),x=h.getSourceInLca().getEstimatedSize(),y=h.getTargetInLca().getEstimatedSize(),this.useSmartIdealEdgeLengthCalculation&&(h.idealLength+=x+y-2*l.SIMPLE_NODE_SIZE),m=h.getLca().getInclusionTreeDepth(),h.idealLength+=v*o.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR*(g.getInclusionTreeDepth()+p.getInclusionTreeDepth()-2*m))},f.prototype.initSpringEmbedder=function(){var h=this.getAllNodes().length;this.incremental?(h>o.ADAPTATION_LOWER_NODE_LIMIT&&(this.coolingFactor=Math.max(this.coolingFactor*o.COOLING_ADAPTATION_FACTOR,this.coolingFactor-(h-o.ADAPTATION_LOWER_NODE_LIMIT)/(o.ADAPTATION_UPPER_NODE_LIMIT-o.ADAPTATION_LOWER_NODE_LIMIT)*this.coolingFactor*(1-o.COOLING_ADAPTATION_FACTOR))),this.maxNodeDisplacement=o.MAX_NODE_DISPLACEMENT_INCREMENTAL):(h>o.ADAPTATION_LOWER_NODE_LIMIT?this.coolingFactor=Math.max(o.COOLING_ADAPTATION_FACTOR,1-(h-o.ADAPTATION_LOWER_NODE_LIMIT)/(o.ADAPTATION_UPPER_NODE_LIMIT-o.ADAPTATION_LOWER_NODE_LIMIT)*(1-o.COOLING_ADAPTATION_FACTOR)):this.coolingFactor=1,this.initialCoolingFactor=this.coolingFactor,this.maxNodeDisplacement=o.MAX_NODE_DISPLACEMENT),this.maxIterations=Math.max(this.getAllNodes().length*5,this.maxIterations),this.displacementThresholdPerNode=3*o.DEFAULT_EDGE_LENGTH/100,this.totalDisplacementThreshold=this.displacementThresholdPerNode*this.getAllNodes().length,this.repulsionRange=this.calcRepulsionRange()},f.prototype.calcSpringForces=function(){for(var h=this.getAllEdges(),v,m=0;m<h.length;m++)v=h[m],this.calcSpringForce(v,v.idealLength)},f.prototype.calcRepulsionForces=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m,g,p,x,y=this.getAllNodes(),E;if(this.useFRGridVariant)for(this.totalIterations%o.GRID_CALCULATION_CHECK_PERIOD==1&&h&&this.updateGrid(),E=new Set,m=0;m<y.length;m++)p=y[m],this.calculateRepulsionForceOfANode(p,E,h,v),E.add(p);else for(m=0;m<y.length;m++)for(p=y[m],g=m+1;g<y.length;g++)x=y[g],p.getOwner()==x.getOwner()&&this.calcRepulsionForce(p,x)},f.prototype.calcGravitationalForces=function(){for(var h,v=this.getAllNodesToApplyGravitation(),m=0;m<v.length;m++)h=v[m],this.calcGravitationalForce(h)},f.prototype.moveNodes=function(){for(var h=this.getAllNodes(),v,m=0;m<h.length;m++)v=h[m],v.move()},f.prototype.calcSpringForce=function(h,v){var m=h.getSource(),g=h.getTarget(),p,x,y,E;if(this.uniformLeafNodeSizes&&m.getChild()==null&&g.getChild()==null)h.updateLengthSimple();else if(h.updateLength(),h.isOverlapingSourceAndTarget)return;p=h.getLength(),p!=0&&(x=h.edgeElasticity*(p-v),y=x*(h.lengthX/p),E=x*(h.lengthY/p),m.springForceX+=y,m.springForceY+=E,g.springForceX-=y,g.springForceY-=E)},f.prototype.calcRepulsionForce=function(h,v){var m=h.getRect(),g=v.getRect(),p=new Array(2),x=new Array(4),y,E,M,w,b,C,T;if(m.intersects(g)){u.calcSeparationAmount(m,g,p,o.DEFAULT_EDGE_LENGTH/2),C=2*p[0],T=2*p[1];var S=h.noOfChildren*v.noOfChildren/(h.noOfChildren+v.noOfChildren);h.repulsionForceX-=S*C,h.repulsionForceY-=S*T,v.repulsionForceX+=S*C,v.repulsionForceY+=S*T}else this.uniformLeafNodeSizes&&h.getChild()==null&&v.getChild()==null?(y=g.getCenterX()-m.getCenterX(),E=g.getCenterY()-m.getCenterY()):(u.getIntersection(m,g,x),y=x[2]-x[0],E=x[3]-x[1]),Math.abs(y)<o.MIN_REPULSION_DIST&&(y=c.sign(y)*o.MIN_REPULSION_DIST),Math.abs(E)<o.MIN_REPULSION_DIST&&(E=c.sign(E)*o.MIN_REPULSION_DIST),M=y*y+E*E,w=Math.sqrt(M),b=(h.nodeRepulsion/2+v.nodeRepulsion/2)*h.noOfChildren*v.noOfChildren/M,C=b*y/w,T=b*E/w,h.repulsionForceX-=C,h.repulsionForceY-=T,v.repulsionForceX+=C,v.repulsionForceY+=T},f.prototype.calcGravitationalForce=function(h){var v,m,g,p,x,y,E,M;v=h.getOwner(),m=(v.getRight()+v.getLeft())/2,g=(v.getTop()+v.getBottom())/2,p=h.getCenterX()-m,x=h.getCenterY()-g,y=Math.abs(p)+h.getWidth()/2,E=Math.abs(x)+h.getHeight()/2,h.getOwner()==this.graphManager.getRoot()?(M=v.getEstimatedSize()*this.gravityRangeFactor,(y>M||E>M)&&(h.gravitationForceX=-this.gravityConstant*p,h.gravitationForceY=-this.gravityConstant*x)):(M=v.getEstimatedSize()*this.compoundGravityRangeFactor,(y>M||E>M)&&(h.gravitationForceX=-this.gravityConstant*p*this.compoundGravityConstant,h.gravitationForceY=-this.gravityConstant*x*this.compoundGravityConstant))},f.prototype.isConverged=function(){var h,v=!1;return this.totalIterations>this.maxIterations/3&&(v=Math.abs(this.totalDisplacement-this.oldTotalDisplacement)<2),h=this.totalDisplacement<this.totalDisplacementThreshold,this.oldTotalDisplacement=this.totalDisplacement,h||v},f.prototype.animate=function(){this.animationDuringLayout&&!this.isSubLayout&&(this.notAnimatedIterations==this.animationPeriod?(this.update(),this.notAnimatedIterations=0):this.notAnimatedIterations++)},f.prototype.calcNoOfChildrenForAllNodes=function(){for(var h,v=this.graphManager.getAllNodes(),m=0;m<v.length;m++)h=v[m],h.noOfChildren=h.getNoOfChildren()},f.prototype.calcGrid=function(h){var v=0,m=0;v=parseInt(Math.ceil((h.getRight()-h.getLeft())/this.repulsionRange)),m=parseInt(Math.ceil((h.getBottom()-h.getTop())/this.repulsionRange));for(var g=new Array(v),p=0;p<v;p++)g[p]=new Array(m);for(var p=0;p<v;p++)for(var x=0;x<m;x++)g[p][x]=new Array;return g},f.prototype.addNodeToGrid=function(h,v,m){var g=0,p=0,x=0,y=0;g=parseInt(Math.floor((h.getRect().x-v)/this.repulsionRange)),p=parseInt(Math.floor((h.getRect().width+h.getRect().x-v)/this.repulsionRange)),x=parseInt(Math.floor((h.getRect().y-m)/this.repulsionRange)),y=parseInt(Math.floor((h.getRect().height+h.getRect().y-m)/this.repulsionRange));for(var E=g;E<=p;E++)for(var M=x;M<=y;M++)this.grid[E][M].push(h),h.setGridCoordinates(g,p,x,y)},f.prototype.updateGrid=function(){var h,v,m=this.getAllNodes();for(this.grid=this.calcGrid(this.graphManager.getRoot()),h=0;h<m.length;h++)v=m[h],this.addNodeToGrid(v,this.graphManager.getRoot().getLeft(),this.graphManager.getRoot().getTop())},f.prototype.calculateRepulsionForceOfANode=function(h,v,m,g){if(this.totalIterations%o.GRID_CALCULATION_CHECK_PERIOD==1&&m||g){var p=new Set;h.surrounding=new Array;for(var x,y=this.grid,E=h.startX-1;E<h.finishX+2;E++)for(var M=h.startY-1;M<h.finishY+2;M++)if(!(E<0||M<0||E>=y.length||M>=y[0].length)){for(var w=0;w<y[E][M].length;w++)if(x=y[E][M][w],!(h.getOwner()!=x.getOwner()||h==x)&&!v.has(x)&&!p.has(x)){var b=Math.abs(h.getCenterX()-x.getCenterX())-(h.getWidth()/2+x.getWidth()/2),C=Math.abs(h.getCenterY()-x.getCenterY())-(h.getHeight()/2+x.getHeight()/2);b<=this.repulsionRange&&C<=this.repulsionRange&&p.add(x)}}h.surrounding=[].concat(a(p))}for(E=0;E<h.surrounding.length;E++)this.calcRepulsionForce(h,h.surrounding[E])},f.prototype.calcRepulsionRange=function(){return 0},t.exports=f},function(t,r,i){var a=i(1),s=i(4);function o(u,c,f){a.call(this,u,c,f),this.idealLength=s.DEFAULT_EDGE_LENGTH,this.edgeElasticity=s.DEFAULT_SPRING_STRENGTH}o.prototype=Object.create(a.prototype);for(var l in a)o[l]=a[l];t.exports=o},function(t,r,i){var a=i(3),s=i(4);function o(u,c,f,d){a.call(this,u,c,f,d),this.nodeRepulsion=s.DEFAULT_REPULSION_STRENGTH,this.springForceX=0,this.springForceY=0,this.repulsionForceX=0,this.repulsionForceY=0,this.gravitationForceX=0,this.gravitationForceY=0,this.displacementX=0,this.displacementY=0,this.startX=0,this.finishX=0,this.startY=0,this.finishY=0,this.surrounding=[]}o.prototype=Object.create(a.prototype);for(var l in a)o[l]=a[l];o.prototype.setGridCoordinates=function(u,c,f,d){this.startX=u,this.finishX=c,this.startY=f,this.finishY=d},t.exports=o},function(t,r,i){function a(s,o){this.width=0,this.height=0,s!==null&&o!==null&&(this.height=o,this.width=s)}a.prototype.getWidth=function(){return this.width},a.prototype.setWidth=function(s){this.width=s},a.prototype.getHeight=function(){return this.height},a.prototype.setHeight=function(s){this.height=s},t.exports=a},function(t,r,i){var a=i(14);function s(){this.map={},this.keys=[]}s.prototype.put=function(o,l){var u=a.createID(o);this.contains(u)||(this.map[u]=l,this.keys.push(o))},s.prototype.contains=function(o){return a.createID(o),this.map[o]!=null},s.prototype.get=function(o){var l=a.createID(o);return this.map[l]},s.prototype.keySet=function(){return this.keys},t.exports=s},function(t,r,i){var a=i(14);function s(){this.set={}}s.prototype.add=function(o){var l=a.createID(o);this.contains(l)||(this.set[l]=o)},s.prototype.remove=function(o){delete this.set[a.createID(o)]},s.prototype.clear=function(){this.set={}},s.prototype.contains=function(o){return this.set[a.createID(o)]==o},s.prototype.isEmpty=function(){return this.size()===0},s.prototype.size=function(){return Object.keys(this.set).length},s.prototype.addAllTo=function(o){for(var l=Object.keys(this.set),u=l.length,c=0;c<u;c++)o.push(this.set[l[c]])},s.prototype.size=function(){return Object.keys(this.set).length},s.prototype.addAll=function(o){for(var l=o.length,u=0;u<l;u++){var c=o[u];this.add(c)}},t.exports=s},function(t,r,i){function a(){}a.multMat=function(s,o){for(var l=[],u=0;u<s.length;u++){l[u]=[];for(var c=0;c<o[0].length;c++){l[u][c]=0;for(var f=0;f<s[0].length;f++)l[u][c]+=s[u][f]*o[f][c]}}return l},a.transpose=function(s){for(var o=[],l=0;l<s[0].length;l++){o[l]=[];for(var u=0;u<s.length;u++)o[l][u]=s[u][l]}return o},a.multCons=function(s,o){for(var l=[],u=0;u<s.length;u++)l[u]=s[u]*o;return l},a.minusOp=function(s,o){for(var l=[],u=0;u<s.length;u++)l[u]=s[u]-o[u];return l},a.dotProduct=function(s,o){for(var l=0,u=0;u<s.length;u++)l+=s[u]*o[u];return l},a.mag=function(s){return Math.sqrt(this.dotProduct(s,s))},a.normalize=function(s){for(var o=[],l=this.mag(s),u=0;u<s.length;u++)o[u]=s[u]/l;return o},a.multGamma=function(s){for(var o=[],l=0,u=0;u<s.length;u++)l+=s[u];l*=-1/s.length;for(var c=0;c<s.length;c++)o[c]=l+s[c];return o},a.multL=function(s,o,l){for(var u=[],c=[],f=[],d=0;d<o[0].length;d++){for(var h=0,v=0;v<o.length;v++)h+=-.5*o[v][d]*s[v];c[d]=h}for(var m=0;m<l.length;m++){for(var g=0,p=0;p<l.length;p++)g+=l[m][p]*c[p];f[m]=g}for(var x=0;x<o.length;x++){for(var y=0,E=0;E<o[0].length;E++)y+=o[x][E]*f[E];u[x]=y}return u},t.exports=a},function(t,r,i){var a=function(){function u(c,f){for(var d=0;d<f.length;d++){var h=f[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}return function(c,f,d){return f&&u(c.prototype,f),d&&u(c,d),c}}();function s(u,c){if(!(u instanceof c))throw new TypeError("Cannot call a class as a function")}var o=i(11),l=function(){function u(c,f){s(this,u),(f!==null||f!==void 0)&&(this.compareFunction=this._defaultCompareFunction);var d=void 0;c instanceof o?d=c.size():d=c.length,this._quicksort(c,0,d-1)}return a(u,[{key:"_quicksort",value:function(f,d,h){if(d<h){var v=this._partition(f,d,h);this._quicksort(f,d,v),this._quicksort(f,v+1,h)}}},{key:"_partition",value:function(f,d,h){for(var v=this._get(f,d),m=d,g=h;;){for(;this.compareFunction(v,this._get(f,g));)g--;for(;this.compareFunction(this._get(f,m),v);)m++;if(m<g)this._swap(f,m,g),m++,g--;else return g}}},{key:"_get",value:function(f,d){return f instanceof o?f.get_object_at(d):f[d]}},{key:"_set",value:function(f,d,h){f instanceof o?f.set_object_at(d,h):f[d]=h}},{key:"_swap",value:function(f,d,h){var v=this._get(f,d);this._set(f,d,this._get(f,h)),this._set(f,h,v)}},{key:"_defaultCompareFunction",value:function(f,d){return d>f}}]),u}();t.exports=l},function(t,r,i){function a(){}a.svd=function(s){this.U=null,this.V=null,this.s=null,this.m=0,this.n=0,this.m=s.length,this.n=s[0].length;var o=Math.min(this.m,this.n);this.s=function(je){for(var Qe=[];je-- >0;)Qe.push(0);return Qe}(Math.min(this.m+1,this.n)),this.U=function(je){var Qe=function wt(st){if(st.length==0)return 0;for(var ut=[],tt=0;tt<st[0];tt++)ut.push(wt(st.slice(1)));return ut};return Qe(je)}([this.m,o]),this.V=function(je){var Qe=function wt(st){if(st.length==0)return 0;for(var ut=[],tt=0;tt<st[0];tt++)ut.push(wt(st.slice(1)));return ut};return Qe(je)}([this.n,this.n]);for(var l=function(je){for(var Qe=[];je-- >0;)Qe.push(0);return Qe}(this.n),u=function(je){for(var Qe=[];je-- >0;)Qe.push(0);return Qe}(this.m),c=!0,f=Math.min(this.m-1,this.n),d=Math.max(0,Math.min(this.n-2,this.m)),h=0;h<Math.max(f,d);h++){if(h<f){this.s[h]=0;for(var v=h;v<this.m;v++)this.s[h]=a.hypot(this.s[h],s[v][h]);if(this.s[h]!==0){s[h][h]<0&&(this.s[h]=-this.s[h]);for(var m=h;m<this.m;m++)s[m][h]/=this.s[h];s[h][h]+=1}this.s[h]=-this.s[h]}for(var g=h+1;g<this.n;g++){if(function(je,Qe){return je&&Qe}(h<f,this.s[h]!==0)){for(var p=0,x=h;x<this.m;x++)p+=s[x][h]*s[x][g];p=-p/s[h][h];for(var y=h;y<this.m;y++)s[y][g]+=p*s[y][h]}l[g]=s[h][g]}if(function(je,Qe){return Qe}(c,h<f))for(var E=h;E<this.m;E++)this.U[E][h]=s[E][h];if(h<d){l[h]=0;for(var M=h+1;M<this.n;M++)l[h]=a.hypot(l[h],l[M]);if(l[h]!==0){l[h+1]<0&&(l[h]=-l[h]);for(var w=h+1;w<this.n;w++)l[w]/=l[h];l[h+1]+=1}if(l[h]=-l[h],function(je,Qe){return je&&Qe}(h+1<this.m,l[h]!==0)){for(var b=h+1;b<this.m;b++)u[b]=0;for(var C=h+1;C<this.n;C++)for(var T=h+1;T<this.m;T++)u[T]+=l[C]*s[T][C];for(var S=h+1;S<this.n;S++)for(var L=-l[S]/l[h+1],N=h+1;N<this.m;N++)s[N][S]+=L*u[N]}for(var I=h+1;I<this.n;I++)this.V[I][h]=l[I]}}var _=Math.min(this.n,this.m+1);f<this.n&&(this.s[f]=s[f][f]),this.m<_&&(this.s[_-1]=0),d+1<_&&(l[d]=s[d][_-1]),l[_-1]=0;{for(var P=f;P<o;P++){for(var A=0;A<this.m;A++)this.U[A][P]=0;this.U[P][P]=1}for(var D=f-1;D>=0;D--)if(this.s[D]!==0){for(var R=D+1;R<o;R++){for(var B=0,k=D;k<this.m;k++)B+=this.U[k][D]*this.U[k][R];B=-B/this.U[D][D];for(var V=D;V<this.m;V++)this.U[V][R]+=B*this.U[V][D]}for(var Y=D;Y<this.m;Y++)this.U[Y][D]=-this.U[Y][D];this.U[D][D]=1+this.U[D][D];for(var Z=0;Z<D-1;Z++)this.U[Z][D]=0}else{for(var W=0;W<this.m;W++)this.U[W][D]=0;this.U[D][D]=1}}for(var K=this.n-1;K>=0;K--){if(function(je,Qe){return je&&Qe}(K<d,l[K]!==0))for(var Q=K+1;Q<o;Q++){for(var ne=0,ie=K+1;ie<this.n;ie++)ne+=this.V[ie][K]*this.V[ie][Q];ne=-ne/this.V[K+1][K];for(var H=K+1;H<this.n;H++)this.V[H][Q]+=ne*this.V[H][K]}for(var X=0;X<this.n;X++)this.V[X][K]=0;this.V[K][K]=1}for(var te=_-1,ue=Math.pow(2,-52),Se=Math.pow(2,-966);_>0;){var U=void 0,Ge=void 0;for(U=_-2;U>=-1&&U!==-1;U--)if(Math.abs(l[U])<=Se+ue*(Math.abs(this.s[U])+Math.abs(this.s[U+1]))){l[U]=0;break}if(U===_-2)Ge=4;else{var Le=void 0;for(Le=_-1;Le>=U&&Le!==U;Le--){var De=(Le!==_?Math.abs(l[Le]):0)+(Le!==U+1?Math.abs(l[Le-1]):0);if(Math.abs(this.s[Le])<=Se+ue*De){this.s[Le]=0;break}}Le===U?Ge=3:Le===_-1?Ge=1:(Ge=2,U=Le)}switch(U++,Ge){case 1:{var de=l[_-2];l[_-2]=0;for(var we=_-2;we>=U;we--){var Me=a.hypot(this.s[we],de),z=this.s[we]/Me,O=de/Me;this.s[we]=Me,we!==U&&(de=-O*l[we-1],l[we-1]=z*l[we-1]);for(var re=0;re<this.n;re++)Me=z*this.V[re][we]+O*this.V[re][_-1],this.V[re][_-1]=-O*this.V[re][we]+z*this.V[re][_-1],this.V[re][we]=Me}}break;case 2:{var ve=l[U-1];l[U-1]=0;for(var Ee=U;Ee<_;Ee++){var ae=a.hypot(this.s[Ee],ve),F=this.s[Ee]/ae,j=ve/ae;this.s[Ee]=ae,ve=-j*l[Ee],l[Ee]=F*l[Ee];for(var ce=0;ce<this.m;ce++)ae=F*this.U[ce][Ee]+j*this.U[ce][U-1],this.U[ce][U-1]=-j*this.U[ce][Ee]+F*this.U[ce][U-1],this.U[ce][Ee]=ae}}break;case 3:{var le=Math.max(Math.max(Math.max(Math.max(Math.abs(this.s[_-1]),Math.abs(this.s[_-2])),Math.abs(l[_-2])),Math.abs(this.s[U])),Math.abs(l[U])),ee=this.s[_-1]/le,J=this.s[_-2]/le,$=l[_-2]/le,oe=this.s[U]/le,fe=l[U]/le,ye=((J+ee)*(J-ee)+$*$)/2,xe=ee*$*(ee*$),Ce=0;(function(je,Qe){return je||Qe})(ye!==0,xe!==0)&&(Ce=Math.sqrt(ye*ye+xe),ye<0&&(Ce=-Ce),Ce=xe/(ye+Ce));for(var q=(oe+ee)*(oe-ee)+Ce,he=oe*fe,se=U;se<_-1;se++){var ge=a.hypot(q,he),Re=q/ge,Ae=he/ge;se!==U&&(l[se-1]=ge),q=Re*this.s[se]+Ae*l[se],l[se]=Re*l[se]-Ae*this.s[se],he=Ae*this.s[se+1],this.s[se+1]=Re*this.s[se+1];for(var Fe=0;Fe<this.n;Fe++)ge=Re*this.V[Fe][se]+Ae*this.V[Fe][se+1],this.V[Fe][se+1]=-Ae*this.V[Fe][se]+Re*this.V[Fe][se+1],this.V[Fe][se]=ge;if(ge=a.hypot(q,he),Re=q/ge,Ae=he/ge,this.s[se]=ge,q=Re*l[se]+Ae*this.s[se+1],this.s[se+1]=-Ae*l[se]+Re*this.s[se+1],he=Ae*l[se+1],l[se+1]=Re*l[se+1],se<this.m-1)for(var Ie=0;Ie<this.m;Ie++)ge=Re*this.U[Ie][se]+Ae*this.U[Ie][se+1],this.U[Ie][se+1]=-Ae*this.U[Ie][se]+Re*this.U[Ie][se+1],this.U[Ie][se]=ge}l[_-2]=q}break;case 4:{if(this.s[U]<=0){this.s[U]=this.s[U]<0?-this.s[U]:0;for(var Oe=0;Oe<=te;Oe++)this.V[Oe][U]=-this.V[Oe][U]}for(;U<te&&!(this.s[U]>=this.s[U+1]);){var Be=this.s[U];if(this.s[U]=this.s[U+1],this.s[U+1]=Be,U<this.n-1)for(var ze=0;ze<this.n;ze++)Be=this.V[ze][U+1],this.V[ze][U+1]=this.V[ze][U],this.V[ze][U]=Be;if(U<this.m-1)for(var We=0;We<this.m;We++)Be=this.U[We][U+1],this.U[We][U+1]=this.U[We][U],this.U[We][U]=Be;U++}_--}break}}var pt={U:this.U,V:this.V,S:this.s};return pt},a.hypot=function(s,o){var l=void 0;return Math.abs(s)>Math.abs(o)?(l=o/s,l=Math.abs(s)*Math.sqrt(1+l*l)):o!=0?(l=s/o,l=Math.abs(o)*Math.sqrt(1+l*l)):l=0,l},t.exports=a},function(t,r,i){var a=function(){function l(u,c){for(var f=0;f<c.length;f++){var d=c[f];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,d.key,d)}}return function(u,c,f){return c&&l(u.prototype,c),f&&l(u,f),u}}();function s(l,u){if(!(l instanceof u))throw new TypeError("Cannot call a class as a function")}var o=function(){function l(u,c){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:-1;s(this,l),this.sequence1=u,this.sequence2=c,this.match_score=f,this.mismatch_penalty=d,this.gap_penalty=h,this.iMax=u.length+1,this.jMax=c.length+1,this.grid=new Array(this.iMax);for(var v=0;v<this.iMax;v++){this.grid[v]=new Array(this.jMax);for(var m=0;m<this.jMax;m++)this.grid[v][m]=0}this.tracebackGrid=new Array(this.iMax);for(var g=0;g<this.iMax;g++){this.tracebackGrid[g]=new Array(this.jMax);for(var p=0;p<this.jMax;p++)this.tracebackGrid[g][p]=[null,null,null]}this.alignments=[],this.score=-1,this.computeGrids()}return a(l,[{key:"getScore",value:function(){return this.score}},{key:"getAlignments",value:function(){return this.alignments}},{key:"computeGrids",value:function(){for(var c=1;c<this.jMax;c++)this.grid[0][c]=this.grid[0][c-1]+this.gap_penalty,this.tracebackGrid[0][c]=[!1,!1,!0];for(var f=1;f<this.iMax;f++)this.grid[f][0]=this.grid[f-1][0]+this.gap_penalty,this.tracebackGrid[f][0]=[!1,!0,!1];for(var d=1;d<this.iMax;d++)for(var h=1;h<this.jMax;h++){var v=void 0;this.sequence1[d-1]===this.sequence2[h-1]?v=this.grid[d-1][h-1]+this.match_score:v=this.grid[d-1][h-1]+this.mismatch_penalty;var m=this.grid[d-1][h]+this.gap_penalty,g=this.grid[d][h-1]+this.gap_penalty,p=[v,m,g],x=this.arrayAllMaxIndexes(p);this.grid[d][h]=p[x[0]],this.tracebackGrid[d][h]=[x.includes(0),x.includes(1),x.includes(2)]}this.score=this.grid[this.iMax-1][this.jMax-1]}},{key:"alignmentTraceback",value:function(){var c=[];for(c.push({pos:[this.sequence1.length,this.sequence2.length],seq1:"",seq2:""});c[0];){var f=c[0],d=this.tracebackGrid[f.pos[0]][f.pos[1]];d[0]&&c.push({pos:[f.pos[0]-1,f.pos[1]-1],seq1:this.sequence1[f.pos[0]-1]+f.seq1,seq2:this.sequence2[f.pos[1]-1]+f.seq2}),d[1]&&c.push({pos:[f.pos[0]-1,f.pos[1]],seq1:this.sequence1[f.pos[0]-1]+f.seq1,seq2:"-"+f.seq2}),d[2]&&c.push({pos:[f.pos[0],f.pos[1]-1],seq1:"-"+f.seq1,seq2:this.sequence2[f.pos[1]-1]+f.seq2}),f.pos[0]===0&&f.pos[1]===0&&this.alignments.push({sequence1:f.seq1,sequence2:f.seq2}),c.shift()}return this.alignments}},{key:"getAllIndexes",value:function(c,f){for(var d=[],h=-1;(h=c.indexOf(f,h+1))!==-1;)d.push(h);return d}},{key:"arrayAllMaxIndexes",value:function(c){return this.getAllIndexes(c,Math.max.apply(null,c))}}]),l}();t.exports=o},function(t,r,i){var a=function(){};a.FDLayout=i(18),a.FDLayoutConstants=i(4),a.FDLayoutEdge=i(19),a.FDLayoutNode=i(20),a.DimensionD=i(21),a.HashMap=i(22),a.HashSet=i(23),a.IGeometry=i(8),a.IMath=i(9),a.Integer=i(10),a.Point=i(12),a.PointD=i(5),a.RandomSeed=i(16),a.RectangleD=i(13),a.Transform=i(17),a.UniqueIDGeneretor=i(14),a.Quicksort=i(25),a.LinkedList=i(11),a.LGraphObject=i(2),a.LGraph=i(6),a.LEdge=i(1),a.LGraphManager=i(7),a.LNode=i(3),a.Layout=i(15),a.LayoutConstants=i(0),a.NeedlemanWunsch=i(27),a.Matrix=i(24),a.SVD=i(26),t.exports=a},function(t,r,i){function a(){this.listeners=[]}var s=a.prototype;s.addListener=function(o,l){this.listeners.push({event:o,callback:l})},s.removeListener=function(o,l){for(var u=this.listeners.length;u>=0;u--){var c=this.listeners[u];c.event===o&&c.callback===l&&this.listeners.splice(u,1)}},s.emit=function(o,l){for(var u=0;u<this.listeners.length;u++){var c=this.listeners[u];o===c.event&&c.callback(l)}},t.exports=a}])})}(Wo)),Wo.exports}var JC=Ho.exports,wd;function jC(){return wd||(wd=1,function(n,e){(function(r,i){n.exports=i(QC())})(JC,function(t){return(()=>{var r={45:(o,l,u)=>{var c={};c.layoutBase=u(551),c.CoSEConstants=u(806),c.CoSEEdge=u(767),c.CoSEGraph=u(880),c.CoSEGraphManager=u(578),c.CoSELayout=u(765),c.CoSENode=u(991),c.ConstraintHandler=u(902),o.exports=c},806:(o,l,u)=>{var c=u(551).FDLayoutConstants;function f(){}for(var d in c)f[d]=c[d];f.DEFAULT_USE_MULTI_LEVEL_SCALING=!1,f.DEFAULT_RADIAL_SEPARATION=c.DEFAULT_EDGE_LENGTH,f.DEFAULT_COMPONENT_SEPERATION=60,f.TILE=!0,f.TILING_PADDING_VERTICAL=10,f.TILING_PADDING_HORIZONTAL=10,f.TRANSFORM_ON_CONSTRAINT_HANDLING=!0,f.ENFORCE_CONSTRAINTS=!0,f.APPLY_LAYOUT=!0,f.RELAX_MOVEMENT_ON_CONSTRAINTS=!0,f.TREE_REDUCTION_ON_INCREMENTAL=!0,f.PURE_INCREMENTAL=f.DEFAULT_INCREMENTAL,o.exports=f},767:(o,l,u)=>{var c=u(551).FDLayoutEdge;function f(h,v,m){c.call(this,h,v,m)}f.prototype=Object.create(c.prototype);for(var d in c)f[d]=c[d];o.exports=f},880:(o,l,u)=>{var c=u(551).LGraph;function f(h,v,m){c.call(this,h,v,m)}f.prototype=Object.create(c.prototype);for(var d in c)f[d]=c[d];o.exports=f},578:(o,l,u)=>{var c=u(551).LGraphManager;function f(h){c.call(this,h)}f.prototype=Object.create(c.prototype);for(var d in c)f[d]=c[d];o.exports=f},765:(o,l,u)=>{var c=u(551).FDLayout,f=u(578),d=u(880),h=u(991),v=u(767),m=u(806),g=u(902),p=u(551).FDLayoutConstants,x=u(551).LayoutConstants,y=u(551).Point,E=u(551).PointD,M=u(551).DimensionD,w=u(551).Layout,b=u(551).Integer,C=u(551).IGeometry,T=u(551).LGraph,S=u(551).Transform,L=u(551).LinkedList;function N(){c.call(this),this.toBeTiled={},this.constraints={}}N.prototype=Object.create(c.prototype);for(var I in c)N[I]=c[I];N.prototype.newGraphManager=function(){var _=new f(this);return this.graphManager=_,_},N.prototype.newGraph=function(_){return new d(null,this.graphManager,_)},N.prototype.newNode=function(_){return new h(this.graphManager,_)},N.prototype.newEdge=function(_){return new v(null,null,_)},N.prototype.initParameters=function(){c.prototype.initParameters.call(this,arguments),this.isSubLayout||(m.DEFAULT_EDGE_LENGTH<10?this.idealEdgeLength=10:this.idealEdgeLength=m.DEFAULT_EDGE_LENGTH,this.useSmartIdealEdgeLengthCalculation=m.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION,this.gravityConstant=p.DEFAULT_GRAVITY_STRENGTH,this.compoundGravityConstant=p.DEFAULT_COMPOUND_GRAVITY_STRENGTH,this.gravityRangeFactor=p.DEFAULT_GRAVITY_RANGE_FACTOR,this.compoundGravityRangeFactor=p.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR,this.prunedNodesAll=[],this.growTreeIterations=0,this.afterGrowthIterations=0,this.isTreeGrowing=!1,this.isGrowthFinished=!1)},N.prototype.initSpringEmbedder=function(){c.prototype.initSpringEmbedder.call(this),this.coolingCycle=0,this.maxCoolingCycle=this.maxIterations/p.CONVERGENCE_CHECK_PERIOD,this.finalTemperature=.04,this.coolingAdjuster=1},N.prototype.layout=function(){var _=x.DEFAULT_CREATE_BENDS_AS_NEEDED;return _&&(this.createBendpoints(),this.graphManager.resetAllEdges()),this.level=0,this.classicLayout()},N.prototype.classicLayout=function(){if(this.nodesWithGravity=this.calculateNodesToApplyGravitationTo(),this.graphManager.setAllNodesToApplyGravitation(this.nodesWithGravity),this.calcNoOfChildrenForAllNodes(),this.graphManager.calcLowestCommonAncestors(),this.graphManager.calcInclusionTreeDepths(),this.graphManager.getRoot().calcEstimatedSize(),this.calcIdealEdgeLengths(),this.incremental){if(m.TREE_REDUCTION_ON_INCREMENTAL){this.reduceTrees(),this.graphManager.resetAllNodesToApplyGravitation();var P=new Set(this.getAllNodes()),A=this.nodesWithGravity.filter(function(B){return P.has(B)});this.graphManager.setAllNodesToApplyGravitation(A)}}else{var _=this.getFlatForest();if(_.length>0)this.positionNodesRadially(_);else{this.reduceTrees(),this.graphManager.resetAllNodesToApplyGravitation();var P=new Set(this.getAllNodes()),A=this.nodesWithGravity.filter(function(D){return P.has(D)});this.graphManager.setAllNodesToApplyGravitation(A),this.positionNodesRandomly()}}return Object.keys(this.constraints).length>0&&(g.handleConstraints(this),this.initConstraintVariables()),this.initSpringEmbedder(),m.APPLY_LAYOUT&&this.runSpringEmbedder(),!0},N.prototype.tick=function(){if(this.totalIterations++,this.totalIterations===this.maxIterations&&!this.isTreeGrowing&&!this.isGrowthFinished)if(this.prunedNodesAll.length>0)this.isTreeGrowing=!0;else return!0;if(this.totalIterations%p.CONVERGENCE_CHECK_PERIOD==0&&!this.isTreeGrowing&&!this.isGrowthFinished){if(this.isConverged())if(this.prunedNodesAll.length>0)this.isTreeGrowing=!0;else return!0;this.coolingCycle++,this.layoutQuality==0?this.coolingAdjuster=this.coolingCycle:this.layoutQuality==1&&(this.coolingAdjuster=this.coolingCycle/3),this.coolingFactor=Math.max(this.initialCoolingFactor-Math.pow(this.coolingCycle,Math.log(100*(this.initialCoolingFactor-this.finalTemperature))/Math.log(this.maxCoolingCycle))/100*this.coolingAdjuster,this.finalTemperature),this.animationPeriod=Math.ceil(this.initialAnimationPeriod*Math.sqrt(this.coolingFactor))}if(this.isTreeGrowing){if(this.growTreeIterations%10==0)if(this.prunedNodesAll.length>0){this.graphManager.updateBounds(),this.updateGrid(),this.growTree(this.prunedNodesAll),this.graphManager.resetAllNodesToApplyGravitation();var _=new Set(this.getAllNodes()),P=this.nodesWithGravity.filter(function(R){return _.has(R)});this.graphManager.setAllNodesToApplyGravitation(P),this.graphManager.updateBounds(),this.updateGrid(),m.PURE_INCREMENTAL?this.coolingFactor=p.DEFAULT_COOLING_FACTOR_INCREMENTAL/2:this.coolingFactor=p.DEFAULT_COOLING_FACTOR_INCREMENTAL}else this.isTreeGrowing=!1,this.isGrowthFinished=!0;this.growTreeIterations++}if(this.isGrowthFinished){if(this.isConverged())return!0;this.afterGrowthIterations%10==0&&(this.graphManager.updateBounds(),this.updateGrid()),m.PURE_INCREMENTAL?this.coolingFactor=p.DEFAULT_COOLING_FACTOR_INCREMENTAL/2*((100-this.afterGrowthIterations)/100):this.coolingFactor=p.DEFAULT_COOLING_FACTOR_INCREMENTAL*((100-this.afterGrowthIterations)/100),this.afterGrowthIterations++}var A=!this.isTreeGrowing&&!this.isGrowthFinished,D=this.growTreeIterations%10==1&&this.isTreeGrowing||this.afterGrowthIterations%10==1&&this.isGrowthFinished;return this.totalDisplacement=0,this.graphManager.updateBounds(),this.calcSpringForces(),this.calcRepulsionForces(A,D),this.calcGravitationalForces(),this.moveNodes(),this.animate(),!1},N.prototype.getPositionsData=function(){for(var _=this.graphManager.getAllNodes(),P={},A=0;A<_.length;A++){var D=_[A].rect,R=_[A].id;P[R]={id:R,x:D.getCenterX(),y:D.getCenterY(),w:D.width,h:D.height}}return P},N.prototype.runSpringEmbedder=function(){this.initialAnimationPeriod=25,this.animationPeriod=this.initialAnimationPeriod;var _=!1;if(p.ANIMATE==="during")this.emit("layoutstarted");else{for(;!_;)_=this.tick();this.graphManager.updateBounds()}},N.prototype.moveNodes=function(){for(var _=this.getAllNodes(),P,A=0;A<_.length;A++)P=_[A],P.calculateDisplacement();Object.keys(this.constraints).length>0&&this.updateDisplacements();for(var A=0;A<_.length;A++)P=_[A],P.move()},N.prototype.initConstraintVariables=function(){var _=this;this.idToNodeMap=new Map,this.fixedNodeSet=new Set;for(var P=this.graphManager.getAllNodes(),A=0;A<P.length;A++){var D=P[A];this.idToNodeMap.set(D.id,D)}var R=function H(X){for(var te=X.getChild().getNodes(),ue,Se=0,U=0;U<te.length;U++)ue=te[U],ue.getChild()==null?_.fixedNodeSet.has(ue.id)&&(Se+=100):Se+=H(ue);return Se};if(this.constraints.fixedNodeConstraint){this.constraints.fixedNodeConstraint.forEach(function(te){_.fixedNodeSet.add(te.nodeId)});for(var P=this.graphManager.getAllNodes(),D,A=0;A<P.length;A++)if(D=P[A],D.getChild()!=null){var B=R(D);B>0&&(D.fixedNodeWeight=B)}}if(this.constraints.relativePlacementConstraint){var k=new Map,V=new Map;if(this.dummyToNodeForVerticalAlignment=new Map,this.dummyToNodeForHorizontalAlignment=new Map,this.fixedNodesOnHorizontal=new Set,this.fixedNodesOnVertical=new Set,this.fixedNodeSet.forEach(function(H){_.fixedNodesOnHorizontal.add(H),_.fixedNodesOnVertical.add(H)}),this.constraints.alignmentConstraint){if(this.constraints.alignmentConstraint.vertical)for(var Y=this.constraints.alignmentConstraint.vertical,A=0;A<Y.length;A++)this.dummyToNodeForVerticalAlignment.set("dummy"+A,[]),Y[A].forEach(function(X){k.set(X,"dummy"+A),_.dummyToNodeForVerticalAlignment.get("dummy"+A).push(X),_.fixedNodeSet.has(X)&&_.fixedNodesOnHorizontal.add("dummy"+A)});if(this.constraints.alignmentConstraint.horizontal)for(var Z=this.constraints.alignmentConstraint.horizontal,A=0;A<Z.length;A++)this.dummyToNodeForHorizontalAlignment.set("dummy"+A,[]),Z[A].forEach(function(X){V.set(X,"dummy"+A),_.dummyToNodeForHorizontalAlignment.get("dummy"+A).push(X),_.fixedNodeSet.has(X)&&_.fixedNodesOnVertical.add("dummy"+A)})}if(m.RELAX_MOVEMENT_ON_CONSTRAINTS)this.shuffle=function(H){var X,te,ue;for(ue=H.length-1;ue>=2*H.length/3;ue--)X=Math.floor(Math.random()*(ue+1)),te=H[ue],H[ue]=H[X],H[X]=te;return H},this.nodesInRelativeHorizontal=[],this.nodesInRelativeVertical=[],this.nodeToRelativeConstraintMapHorizontal=new Map,this.nodeToRelativeConstraintMapVertical=new Map,this.nodeToTempPositionMapHorizontal=new Map,this.nodeToTempPositionMapVertical=new Map,this.constraints.relativePlacementConstraint.forEach(function(H){if(H.left){var X=k.has(H.left)?k.get(H.left):H.left,te=k.has(H.right)?k.get(H.right):H.right;_.nodesInRelativeHorizontal.includes(X)||(_.nodesInRelativeHorizontal.push(X),_.nodeToRelativeConstraintMapHorizontal.set(X,[]),_.dummyToNodeForVerticalAlignment.has(X)?_.nodeToTempPositionMapHorizontal.set(X,_.idToNodeMap.get(_.dummyToNodeForVerticalAlignment.get(X)[0]).getCenterX()):_.nodeToTempPositionMapHorizontal.set(X,_.idToNodeMap.get(X).getCenterX())),_.nodesInRelativeHorizontal.includes(te)||(_.nodesInRelativeHorizontal.push(te),_.nodeToRelativeConstraintMapHorizontal.set(te,[]),_.dummyToNodeForVerticalAlignment.has(te)?_.nodeToTempPositionMapHorizontal.set(te,_.idToNodeMap.get(_.dummyToNodeForVerticalAlignment.get(te)[0]).getCenterX()):_.nodeToTempPositionMapHorizontal.set(te,_.idToNodeMap.get(te).getCenterX())),_.nodeToRelativeConstraintMapHorizontal.get(X).push({right:te,gap:H.gap}),_.nodeToRelativeConstraintMapHorizontal.get(te).push({left:X,gap:H.gap})}else{var ue=V.has(H.top)?V.get(H.top):H.top,Se=V.has(H.bottom)?V.get(H.bottom):H.bottom;_.nodesInRelativeVertical.includes(ue)||(_.nodesInRelativeVertical.push(ue),_.nodeToRelativeConstraintMapVertical.set(ue,[]),_.dummyToNodeForHorizontalAlignment.has(ue)?_.nodeToTempPositionMapVertical.set(ue,_.idToNodeMap.get(_.dummyToNodeForHorizontalAlignment.get(ue)[0]).getCenterY()):_.nodeToTempPositionMapVertical.set(ue,_.idToNodeMap.get(ue).getCenterY())),_.nodesInRelativeVertical.includes(Se)||(_.nodesInRelativeVertical.push(Se),_.nodeToRelativeConstraintMapVertical.set(Se,[]),_.dummyToNodeForHorizontalAlignment.has(Se)?_.nodeToTempPositionMapVertical.set(Se,_.idToNodeMap.get(_.dummyToNodeForHorizontalAlignment.get(Se)[0]).getCenterY()):_.nodeToTempPositionMapVertical.set(Se,_.idToNodeMap.get(Se).getCenterY())),_.nodeToRelativeConstraintMapVertical.get(ue).push({bottom:Se,gap:H.gap}),_.nodeToRelativeConstraintMapVertical.get(Se).push({top:ue,gap:H.gap})}});else{var W=new Map,K=new Map;this.constraints.relativePlacementConstraint.forEach(function(H){if(H.left){var X=k.has(H.left)?k.get(H.left):H.left,te=k.has(H.right)?k.get(H.right):H.right;W.has(X)?W.get(X).push(te):W.set(X,[te]),W.has(te)?W.get(te).push(X):W.set(te,[X])}else{var ue=V.has(H.top)?V.get(H.top):H.top,Se=V.has(H.bottom)?V.get(H.bottom):H.bottom;K.has(ue)?K.get(ue).push(Se):K.set(ue,[Se]),K.has(Se)?K.get(Se).push(ue):K.set(Se,[ue])}});var Q=function(X,te){var ue=[],Se=[],U=new L,Ge=new Set,Le=0;return X.forEach(function(De,de){if(!Ge.has(de)){ue[Le]=[],Se[Le]=!1;var we=de;for(U.push(we),Ge.add(we),ue[Le].push(we);U.length!=0;){we=U.shift(),te.has(we)&&(Se[Le]=!0);var Me=X.get(we);Me.forEach(function(z){Ge.has(z)||(U.push(z),Ge.add(z),ue[Le].push(z))})}Le++}}),{components:ue,isFixed:Se}},ne=Q(W,_.fixedNodesOnHorizontal);this.componentsOnHorizontal=ne.components,this.fixedComponentsOnHorizontal=ne.isFixed;var ie=Q(K,_.fixedNodesOnVertical);this.componentsOnVertical=ie.components,this.fixedComponentsOnVertical=ie.isFixed}}},N.prototype.updateDisplacements=function(){var _=this;if(this.constraints.fixedNodeConstraint&&this.constraints.fixedNodeConstraint.forEach(function(ie){var H=_.idToNodeMap.get(ie.nodeId);H.displacementX=0,H.displacementY=0}),this.constraints.alignmentConstraint){if(this.constraints.alignmentConstraint.vertical)for(var P=this.constraints.alignmentConstraint.vertical,A=0;A<P.length;A++){for(var D=0,R=0;R<P[A].length;R++){if(this.fixedNodeSet.has(P[A][R])){D=0;break}D+=this.idToNodeMap.get(P[A][R]).displacementX}for(var B=D/P[A].length,R=0;R<P[A].length;R++)this.idToNodeMap.get(P[A][R]).displacementX=B}if(this.constraints.alignmentConstraint.horizontal)for(var k=this.constraints.alignmentConstraint.horizontal,A=0;A<k.length;A++){for(var V=0,R=0;R<k[A].length;R++){if(this.fixedNodeSet.has(k[A][R])){V=0;break}V+=this.idToNodeMap.get(k[A][R]).displacementY}for(var Y=V/k[A].length,R=0;R<k[A].length;R++)this.idToNodeMap.get(k[A][R]).displacementY=Y}}if(this.constraints.relativePlacementConstraint)if(m.RELAX_MOVEMENT_ON_CONSTRAINTS)this.totalIterations%10==0&&(this.shuffle(this.nodesInRelativeHorizontal),this.shuffle(this.nodesInRelativeVertical)),this.nodesInRelativeHorizontal.forEach(function(ie){if(!_.fixedNodesOnHorizontal.has(ie)){var H=0;_.dummyToNodeForVerticalAlignment.has(ie)?H=_.idToNodeMap.get(_.dummyToNodeForVerticalAlignment.get(ie)[0]).displacementX:H=_.idToNodeMap.get(ie).displacementX,_.nodeToRelativeConstraintMapHorizontal.get(ie).forEach(function(X){if(X.right){var te=_.nodeToTempPositionMapHorizontal.get(X.right)-_.nodeToTempPositionMapHorizontal.get(ie)-H;te<X.gap&&(H-=X.gap-te)}else{var te=_.nodeToTempPositionMapHorizontal.get(ie)-_.nodeToTempPositionMapHorizontal.get(X.left)+H;te<X.gap&&(H+=X.gap-te)}}),_.nodeToTempPositionMapHorizontal.set(ie,_.nodeToTempPositionMapHorizontal.get(ie)+H),_.dummyToNodeForVerticalAlignment.has(ie)?_.dummyToNodeForVerticalAlignment.get(ie).forEach(function(X){_.idToNodeMap.get(X).displacementX=H}):_.idToNodeMap.get(ie).displacementX=H}}),this.nodesInRelativeVertical.forEach(function(ie){if(!_.fixedNodesOnHorizontal.has(ie)){var H=0;_.dummyToNodeForHorizontalAlignment.has(ie)?H=_.idToNodeMap.get(_.dummyToNodeForHorizontalAlignment.get(ie)[0]).displacementY:H=_.idToNodeMap.get(ie).displacementY,_.nodeToRelativeConstraintMapVertical.get(ie).forEach(function(X){if(X.bottom){var te=_.nodeToTempPositionMapVertical.get(X.bottom)-_.nodeToTempPositionMapVertical.get(ie)-H;te<X.gap&&(H-=X.gap-te)}else{var te=_.nodeToTempPositionMapVertical.get(ie)-_.nodeToTempPositionMapVertical.get(X.top)+H;te<X.gap&&(H+=X.gap-te)}}),_.nodeToTempPositionMapVertical.set(ie,_.nodeToTempPositionMapVertical.get(ie)+H),_.dummyToNodeForHorizontalAlignment.has(ie)?_.dummyToNodeForHorizontalAlignment.get(ie).forEach(function(X){_.idToNodeMap.get(X).displacementY=H}):_.idToNodeMap.get(ie).displacementY=H}});else{for(var A=0;A<this.componentsOnHorizontal.length;A++){var Z=this.componentsOnHorizontal[A];if(this.fixedComponentsOnHorizontal[A])for(var R=0;R<Z.length;R++)this.dummyToNodeForVerticalAlignment.has(Z[R])?this.dummyToNodeForVerticalAlignment.get(Z[R]).forEach(function(X){_.idToNodeMap.get(X).displacementX=0}):this.idToNodeMap.get(Z[R]).displacementX=0;else{for(var W=0,K=0,R=0;R<Z.length;R++)if(this.dummyToNodeForVerticalAlignment.has(Z[R])){var Q=this.dummyToNodeForVerticalAlignment.get(Z[R]);W+=Q.length*this.idToNodeMap.get(Q[0]).displacementX,K+=Q.length}else W+=this.idToNodeMap.get(Z[R]).displacementX,K++;for(var ne=W/K,R=0;R<Z.length;R++)this.dummyToNodeForVerticalAlignment.has(Z[R])?this.dummyToNodeForVerticalAlignment.get(Z[R]).forEach(function(X){_.idToNodeMap.get(X).displacementX=ne}):this.idToNodeMap.get(Z[R]).displacementX=ne}}for(var A=0;A<this.componentsOnVertical.length;A++){var Z=this.componentsOnVertical[A];if(this.fixedComponentsOnVertical[A])for(var R=0;R<Z.length;R++)this.dummyToNodeForHorizontalAlignment.has(Z[R])?this.dummyToNodeForHorizontalAlignment.get(Z[R]).forEach(function(te){_.idToNodeMap.get(te).displacementY=0}):this.idToNodeMap.get(Z[R]).displacementY=0;else{for(var W=0,K=0,R=0;R<Z.length;R++)if(this.dummyToNodeForHorizontalAlignment.has(Z[R])){var Q=this.dummyToNodeForHorizontalAlignment.get(Z[R]);W+=Q.length*this.idToNodeMap.get(Q[0]).displacementY,K+=Q.length}else W+=this.idToNodeMap.get(Z[R]).displacementY,K++;for(var ne=W/K,R=0;R<Z.length;R++)this.dummyToNodeForHorizontalAlignment.has(Z[R])?this.dummyToNodeForHorizontalAlignment.get(Z[R]).forEach(function(U){_.idToNodeMap.get(U).displacementY=ne}):this.idToNodeMap.get(Z[R]).displacementY=ne}}}},N.prototype.calculateNodesToApplyGravitationTo=function(){var _=[],P,A=this.graphManager.getGraphs(),D=A.length,R;for(R=0;R<D;R++)P=A[R],P.updateConnected(),P.isConnected||(_=_.concat(P.getNodes()));return _},N.prototype.createBendpoints=function(){var _=[];_=_.concat(this.graphManager.getAllEdges());var P=new Set,A;for(A=0;A<_.length;A++){var D=_[A];if(!P.has(D)){var R=D.getSource(),B=D.getTarget();if(R==B)D.getBendpoints().push(new E),D.getBendpoints().push(new E),this.createDummyNodesForBendpoints(D),P.add(D);else{var k=[];if(k=k.concat(R.getEdgeListToNode(B)),k=k.concat(B.getEdgeListToNode(R)),!P.has(k[0])){if(k.length>1){var V;for(V=0;V<k.length;V++){var Y=k[V];Y.getBendpoints().push(new E),this.createDummyNodesForBendpoints(Y)}}k.forEach(function(Z){P.add(Z)})}}}if(P.size==_.length)break}},N.prototype.positionNodesRadially=function(_){for(var P=new y(0,0),A=Math.ceil(Math.sqrt(_.length)),D=0,R=0,B=0,k=new E(0,0),V=0;V<_.length;V++){V%A==0&&(B=0,R=D,V!=0&&(R+=m.DEFAULT_COMPONENT_SEPERATION),D=0);var Y=_[V],Z=w.findCenterOfTree(Y);P.x=B,P.y=R,k=N.radialLayout(Y,Z,P),k.y>D&&(D=Math.floor(k.y)),B=Math.floor(k.x+m.DEFAULT_COMPONENT_SEPERATION)}this.transform(new E(x.WORLD_CENTER_X-k.x/2,x.WORLD_CENTER_Y-k.y/2))},N.radialLayout=function(_,P,A){var D=Math.max(this.maxDiagonalInTree(_),m.DEFAULT_RADIAL_SEPARATION);N.branchRadialLayout(P,null,0,359,0,D);var R=T.calculateBounds(_),B=new S;B.setDeviceOrgX(R.getMinX()),B.setDeviceOrgY(R.getMinY()),B.setWorldOrgX(A.x),B.setWorldOrgY(A.y);for(var k=0;k<_.length;k++){var V=_[k];V.transform(B)}var Y=new E(R.getMaxX(),R.getMaxY());return B.inverseTransformPoint(Y)},N.branchRadialLayout=function(_,P,A,D,R,B){var k=(D-A+1)/2;k<0&&(k+=180);var V=(k+A)%360,Y=V*C.TWO_PI/360,Z=R*Math.cos(Y),W=R*Math.sin(Y);_.setCenter(Z,W);var K=[];K=K.concat(_.getEdges());var Q=K.length;P!=null&&Q--;for(var ne=0,ie=K.length,H,X=_.getEdgesBetween(P);X.length>1;){var te=X[0];X.splice(0,1);var ue=K.indexOf(te);ue>=0&&K.splice(ue,1),ie--,Q--}P!=null?H=(K.indexOf(X[0])+1)%ie:H=0;for(var Se=Math.abs(D-A)/Q,U=H;ne!=Q;U=++U%ie){var Ge=K[U].getOtherEnd(_);if(Ge!=P){var Le=(A+ne*Se)%360,De=(Le+Se)%360;N.branchRadialLayout(Ge,_,Le,De,R+B,B),ne++}}},N.maxDiagonalInTree=function(_){for(var P=b.MIN_VALUE,A=0;A<_.length;A++){var D=_[A],R=D.getDiagonal();R>P&&(P=R)}return P},N.prototype.calcRepulsionRange=function(){return 2*(this.level+1)*this.idealEdgeLength},N.prototype.groupZeroDegreeMembers=function(){var _=this,P={};this.memberGroups={},this.idToDummyNode={};for(var A=[],D=this.graphManager.getAllNodes(),R=0;R<D.length;R++){var B=D[R],k=B.getParent();this.getNodeDegreeWithChildren(B)===0&&(k.id==null||!this.getToBeTiled(k))&&A.push(B)}for(var R=0;R<A.length;R++){var B=A[R],V=B.getParent().id;typeof P[V]>"u"&&(P[V]=[]),P[V]=P[V].concat(B)}Object.keys(P).forEach(function(Y){if(P[Y].length>1){var Z="DummyCompound_"+Y;_.memberGroups[Z]=P[Y];var W=P[Y][0].getParent(),K=new h(_.graphManager);K.id=Z,K.paddingLeft=W.paddingLeft||0,K.paddingRight=W.paddingRight||0,K.paddingBottom=W.paddingBottom||0,K.paddingTop=W.paddingTop||0,_.idToDummyNode[Z]=K;var Q=_.getGraphManager().add(_.newGraph(),K),ne=W.getChild();ne.add(K);for(var ie=0;ie<P[Y].length;ie++){var H=P[Y][ie];ne.remove(H),Q.add(H)}}})},N.prototype.clearCompounds=function(){var _={},P={};this.performDFSOnCompounds();for(var A=0;A<this.compoundOrder.length;A++)P[this.compoundOrder[A].id]=this.compoundOrder[A],_[this.compoundOrder[A].id]=[].concat(this.compoundOrder[A].getChild().getNodes()),this.graphManager.remove(this.compoundOrder[A].getChild()),this.compoundOrder[A].child=null;this.graphManager.resetAllNodes(),this.tileCompoundMembers(_,P)},N.prototype.clearZeroDegreeMembers=function(){var _=this,P=this.tiledZeroDegreePack=[];Object.keys(this.memberGroups).forEach(function(A){var D=_.idToDummyNode[A];if(P[A]=_.tileNodes(_.memberGroups[A],D.paddingLeft+D.paddingRight),D.rect.width=P[A].width,D.rect.height=P[A].height,D.setCenter(P[A].centerX,P[A].centerY),D.labelMarginLeft=0,D.labelMarginTop=0,m.NODE_DIMENSIONS_INCLUDE_LABELS){var R=D.rect.width,B=D.rect.height;D.labelWidth&&(D.labelPosHorizontal=="left"?(D.rect.x-=D.labelWidth,D.setWidth(R+D.labelWidth),D.labelMarginLeft=D.labelWidth):D.labelPosHorizontal=="center"&&D.labelWidth>R?(D.rect.x-=(D.labelWidth-R)/2,D.setWidth(D.labelWidth),D.labelMarginLeft=(D.labelWidth-R)/2):D.labelPosHorizontal=="right"&&D.setWidth(R+D.labelWidth)),D.labelHeight&&(D.labelPosVertical=="top"?(D.rect.y-=D.labelHeight,D.setHeight(B+D.labelHeight),D.labelMarginTop=D.labelHeight):D.labelPosVertical=="center"&&D.labelHeight>B?(D.rect.y-=(D.labelHeight-B)/2,D.setHeight(D.labelHeight),D.labelMarginTop=(D.labelHeight-B)/2):D.labelPosVertical=="bottom"&&D.setHeight(B+D.labelHeight))}})},N.prototype.repopulateCompounds=function(){for(var _=this.compoundOrder.length-1;_>=0;_--){var P=this.compoundOrder[_],A=P.id,D=P.paddingLeft,R=P.paddingTop,B=P.labelMarginLeft,k=P.labelMarginTop;this.adjustLocations(this.tiledMemberPack[A],P.rect.x,P.rect.y,D,R,B,k)}},N.prototype.repopulateZeroDegreeMembers=function(){var _=this,P=this.tiledZeroDegreePack;Object.keys(P).forEach(function(A){var D=_.idToDummyNode[A],R=D.paddingLeft,B=D.paddingTop,k=D.labelMarginLeft,V=D.labelMarginTop;_.adjustLocations(P[A],D.rect.x,D.rect.y,R,B,k,V)})},N.prototype.getToBeTiled=function(_){var P=_.id;if(this.toBeTiled[P]!=null)return this.toBeTiled[P];var A=_.getChild();if(A==null)return this.toBeTiled[P]=!1,!1;for(var D=A.getNodes(),R=0;R<D.length;R++){var B=D[R];if(this.getNodeDegree(B)>0)return this.toBeTiled[P]=!1,!1;if(B.getChild()==null){this.toBeTiled[B.id]=!1;continue}if(!this.getToBeTiled(B))return this.toBeTiled[P]=!1,!1}return this.toBeTiled[P]=!0,!0},N.prototype.getNodeDegree=function(_){_.id;for(var P=_.getEdges(),A=0,D=0;D<P.length;D++){var R=P[D];R.getSource().id!==R.getTarget().id&&(A=A+1)}return A},N.prototype.getNodeDegreeWithChildren=function(_){var P=this.getNodeDegree(_);if(_.getChild()==null)return P;for(var A=_.getChild().getNodes(),D=0;D<A.length;D++){var R=A[D];P+=this.getNodeDegreeWithChildren(R)}return P},N.prototype.performDFSOnCompounds=function(){this.compoundOrder=[],this.fillCompexOrderByDFS(this.graphManager.getRoot().getNodes())},N.prototype.fillCompexOrderByDFS=function(_){for(var P=0;P<_.length;P++){var A=_[P];A.getChild()!=null&&this.fillCompexOrderByDFS(A.getChild().getNodes()),this.getToBeTiled(A)&&this.compoundOrder.push(A)}},N.prototype.adjustLocations=function(_,P,A,D,R,B,k){P+=D+B,A+=R+k;for(var V=P,Y=0;Y<_.rows.length;Y++){var Z=_.rows[Y];P=V;for(var W=0,K=0;K<Z.length;K++){var Q=Z[K];Q.rect.x=P,Q.rect.y=A,P+=Q.rect.width+_.horizontalPadding,Q.rect.height>W&&(W=Q.rect.height)}A+=W+_.verticalPadding}},N.prototype.tileCompoundMembers=function(_,P){var A=this;this.tiledMemberPack=[],Object.keys(_).forEach(function(D){var R=P[D];if(A.tiledMemberPack[D]=A.tileNodes(_[D],R.paddingLeft+R.paddingRight),R.rect.width=A.tiledMemberPack[D].width,R.rect.height=A.tiledMemberPack[D].height,R.setCenter(A.tiledMemberPack[D].centerX,A.tiledMemberPack[D].centerY),R.labelMarginLeft=0,R.labelMarginTop=0,m.NODE_DIMENSIONS_INCLUDE_LABELS){var B=R.rect.width,k=R.rect.height;R.labelWidth&&(R.labelPosHorizontal=="left"?(R.rect.x-=R.labelWidth,R.setWidth(B+R.labelWidth),R.labelMarginLeft=R.labelWidth):R.labelPosHorizontal=="center"&&R.labelWidth>B?(R.rect.x-=(R.labelWidth-B)/2,R.setWidth(R.labelWidth),R.labelMarginLeft=(R.labelWidth-B)/2):R.labelPosHorizontal=="right"&&R.setWidth(B+R.labelWidth)),R.labelHeight&&(R.labelPosVertical=="top"?(R.rect.y-=R.labelHeight,R.setHeight(k+R.labelHeight),R.labelMarginTop=R.labelHeight):R.labelPosVertical=="center"&&R.labelHeight>k?(R.rect.y-=(R.labelHeight-k)/2,R.setHeight(R.labelHeight),R.labelMarginTop=(R.labelHeight-k)/2):R.labelPosVertical=="bottom"&&R.setHeight(k+R.labelHeight))}})},N.prototype.tileNodes=function(_,P){var A=this.tileNodesByFavoringDim(_,P,!0),D=this.tileNodesByFavoringDim(_,P,!1),R=this.getOrgRatio(A),B=this.getOrgRatio(D),k;return B<R?k=D:k=A,k},N.prototype.getOrgRatio=function(_){var P=_.width,A=_.height,D=P/A;return D<1&&(D=1/D),D},N.prototype.calcIdealRowWidth=function(_,P){var A=m.TILING_PADDING_VERTICAL,D=m.TILING_PADDING_HORIZONTAL,R=_.length,B=0,k=0,V=0;_.forEach(function(ie){B+=ie.getWidth(),k+=ie.getHeight(),ie.getWidth()>V&&(V=ie.getWidth())});var Y=B/R,Z=k/R,W=Math.pow(A-D,2)+4*(Y+D)*(Z+A)*R,K=(D-A+Math.sqrt(W))/(2*(Y+D)),Q;P?(Q=Math.ceil(K),Q==K&&Q++):Q=Math.floor(K);var ne=Q*(Y+D)-D;return V>ne&&(ne=V),ne+=D*2,ne},N.prototype.tileNodesByFavoringDim=function(_,P,A){var D=m.TILING_PADDING_VERTICAL,R=m.TILING_PADDING_HORIZONTAL,B=m.TILING_COMPARE_BY,k={rows:[],rowWidth:[],rowHeight:[],width:0,height:P,verticalPadding:D,horizontalPadding:R,centerX:0,centerY:0};B&&(k.idealRowWidth=this.calcIdealRowWidth(_,A));var V=function(H){return H.rect.width*H.rect.height},Y=function(H,X){return V(X)-V(H)};_.sort(function(ie,H){var X=Y;return k.idealRowWidth?(X=B,X(ie.id,H.id)):X(ie,H)});for(var Z=0,W=0,K=0;K<_.length;K++){var Q=_[K];Z+=Q.getCenterX(),W+=Q.getCenterY()}k.centerX=Z/_.length,k.centerY=W/_.length;for(var K=0;K<_.length;K++){var Q=_[K];if(k.rows.length==0)this.insertNodeToRow(k,Q,0,P);else if(this.canAddHorizontal(k,Q.rect.width,Q.rect.height)){var ne=k.rows.length-1;k.idealRowWidth||(ne=this.getShortestRowIndex(k)),this.insertNodeToRow(k,Q,ne,P)}else this.insertNodeToRow(k,Q,k.rows.length,P);this.shiftToLastRow(k)}return k},N.prototype.insertNodeToRow=function(_,P,A,D){var R=D;if(A==_.rows.length){var B=[];_.rows.push(B),_.rowWidth.push(R),_.rowHeight.push(0)}var k=_.rowWidth[A]+P.rect.width;_.rows[A].length>0&&(k+=_.horizontalPadding),_.rowWidth[A]=k,_.width<k&&(_.width=k);var V=P.rect.height;A>0&&(V+=_.verticalPadding);var Y=0;V>_.rowHeight[A]&&(Y=_.rowHeight[A],_.rowHeight[A]=V,Y=_.rowHeight[A]-Y),_.height+=Y,_.rows[A].push(P)},N.prototype.getShortestRowIndex=function(_){for(var P=-1,A=Number.MAX_VALUE,D=0;D<_.rows.length;D++)_.rowWidth[D]<A&&(P=D,A=_.rowWidth[D]);return P},N.prototype.getLongestRowIndex=function(_){for(var P=-1,A=Number.MIN_VALUE,D=0;D<_.rows.length;D++)_.rowWidth[D]>A&&(P=D,A=_.rowWidth[D]);return P},N.prototype.canAddHorizontal=function(_,P,A){if(_.idealRowWidth){var D=_.rows.length-1,R=_.rowWidth[D];return R+P+_.horizontalPadding<=_.idealRowWidth}var B=this.getShortestRowIndex(_);if(B<0)return!0;var k=_.rowWidth[B];if(k+_.horizontalPadding+P<=_.width)return!0;var V=0;_.rowHeight[B]<A&&B>0&&(V=A+_.verticalPadding-_.rowHeight[B]);var Y;_.width-k>=P+_.horizontalPadding?Y=(_.height+V)/(k+P+_.horizontalPadding):Y=(_.height+V)/_.width,V=A+_.verticalPadding;var Z;return _.width<P?Z=(_.height+V)/P:Z=(_.height+V)/_.width,Z<1&&(Z=1/Z),Y<1&&(Y=1/Y),Y<Z},N.prototype.shiftToLastRow=function(_){var P=this.getLongestRowIndex(_),A=_.rowWidth.length-1,D=_.rows[P],R=D[D.length-1],B=R.width+_.horizontalPadding;if(_.width-_.rowWidth[A]>B&&P!=A){D.splice(-1,1),_.rows[A].push(R),_.rowWidth[P]=_.rowWidth[P]-B,_.rowWidth[A]=_.rowWidth[A]+B,_.width=_.rowWidth[instance.getLongestRowIndex(_)];for(var k=Number.MIN_VALUE,V=0;V<D.length;V++)D[V].height>k&&(k=D[V].height);P>0&&(k+=_.verticalPadding);var Y=_.rowHeight[P]+_.rowHeight[A];_.rowHeight[P]=k,_.rowHeight[A]<R.height+_.verticalPadding&&(_.rowHeight[A]=R.height+_.verticalPadding);var Z=_.rowHeight[P]+_.rowHeight[A];_.height+=Z-Y,this.shiftToLastRow(_)}},N.prototype.tilingPreLayout=function(){m.TILE&&(this.groupZeroDegreeMembers(),this.clearCompounds(),this.clearZeroDegreeMembers())},N.prototype.tilingPostLayout=function(){m.TILE&&(this.repopulateZeroDegreeMembers(),this.repopulateCompounds())},N.prototype.reduceTrees=function(){for(var _=[],P=!0,A;P;){var D=this.graphManager.getAllNodes(),R=[];P=!1;for(var B=0;B<D.length;B++)if(A=D[B],A.getEdges().length==1&&!A.getEdges()[0].isInterGraph&&A.getChild()==null){if(m.PURE_INCREMENTAL){var k=A.getEdges()[0].getOtherEnd(A),V=new M(A.getCenterX()-k.getCenterX(),A.getCenterY()-k.getCenterY());R.push([A,A.getEdges()[0],A.getOwner(),V])}else R.push([A,A.getEdges()[0],A.getOwner()]);P=!0}if(P==!0){for(var Y=[],Z=0;Z<R.length;Z++)R[Z][0].getEdges().length==1&&(Y.push(R[Z]),R[Z][0].getOwner().remove(R[Z][0]));_.push(Y),this.graphManager.resetAllNodes(),this.graphManager.resetAllEdges()}}this.prunedNodesAll=_},N.prototype.growTree=function(_){for(var P=_.length,A=_[P-1],D,R=0;R<A.length;R++)D=A[R],this.findPlaceforPrunedNode(D),D[2].add(D[0]),D[2].add(D[1],D[1].source,D[1].target);_.splice(_.length-1,1),this.graphManager.resetAllNodes(),this.graphManager.resetAllEdges()},N.prototype.findPlaceforPrunedNode=function(_){var P,A,D=_[0];if(D==_[1].source?A=_[1].target:A=_[1].source,m.PURE_INCREMENTAL)D.setCenter(A.getCenterX()+_[3].getWidth(),A.getCenterY()+_[3].getHeight());else{var R=A.startX,B=A.finishX,k=A.startY,V=A.finishY,Y=0,Z=0,W=0,K=0,Q=[Y,W,Z,K];if(k>0)for(var ne=R;ne<=B;ne++)Q[0]+=this.grid[ne][k-1].length+this.grid[ne][k].length-1;if(B<this.grid.length-1)for(var ne=k;ne<=V;ne++)Q[1]+=this.grid[B+1][ne].length+this.grid[B][ne].length-1;if(V<this.grid[0].length-1)for(var ne=R;ne<=B;ne++)Q[2]+=this.grid[ne][V+1].length+this.grid[ne][V].length-1;if(R>0)for(var ne=k;ne<=V;ne++)Q[3]+=this.grid[R-1][ne].length+this.grid[R][ne].length-1;for(var ie=b.MAX_VALUE,H,X,te=0;te<Q.length;te++)Q[te]<ie?(ie=Q[te],H=1,X=te):Q[te]==ie&&H++;if(H==3&&ie==0)Q[0]==0&&Q[1]==0&&Q[2]==0?P=1:Q[0]==0&&Q[1]==0&&Q[3]==0?P=0:Q[0]==0&&Q[2]==0&&Q[3]==0?P=3:Q[1]==0&&Q[2]==0&&Q[3]==0&&(P=2);else if(H==2&&ie==0){var ue=Math.floor(Math.random()*2);Q[0]==0&&Q[1]==0?ue==0?P=0:P=1:Q[0]==0&&Q[2]==0?ue==0?P=0:P=2:Q[0]==0&&Q[3]==0?ue==0?P=0:P=3:Q[1]==0&&Q[2]==0?ue==0?P=1:P=2:Q[1]==0&&Q[3]==0?ue==0?P=1:P=3:ue==0?P=2:P=3}else if(H==4&&ie==0){var ue=Math.floor(Math.random()*4);P=ue}else P=X;P==0?D.setCenter(A.getCenterX(),A.getCenterY()-A.getHeight()/2-p.DEFAULT_EDGE_LENGTH-D.getHeight()/2):P==1?D.setCenter(A.getCenterX()+A.getWidth()/2+p.DEFAULT_EDGE_LENGTH+D.getWidth()/2,A.getCenterY()):P==2?D.setCenter(A.getCenterX(),A.getCenterY()+A.getHeight()/2+p.DEFAULT_EDGE_LENGTH+D.getHeight()/2):D.setCenter(A.getCenterX()-A.getWidth()/2-p.DEFAULT_EDGE_LENGTH-D.getWidth()/2,A.getCenterY())}},o.exports=N},991:(o,l,u)=>{var c=u(551).FDLayoutNode,f=u(551).IMath;function d(v,m,g,p){c.call(this,v,m,g,p)}d.prototype=Object.create(c.prototype);for(var h in c)d[h]=c[h];d.prototype.calculateDisplacement=function(){var v=this.graphManager.getLayout();this.getChild()!=null&&this.fixedNodeWeight?(this.displacementX+=v.coolingFactor*(this.springForceX+this.repulsionForceX+this.gravitationForceX)/this.fixedNodeWeight,this.displacementY+=v.coolingFactor*(this.springForceY+this.repulsionForceY+this.gravitationForceY)/this.fixedNodeWeight):(this.displacementX+=v.coolingFactor*(this.springForceX+this.repulsionForceX+this.gravitationForceX)/this.noOfChildren,this.displacementY+=v.coolingFactor*(this.springForceY+this.repulsionForceY+this.gravitationForceY)/this.noOfChildren),Math.abs(this.displacementX)>v.coolingFactor*v.maxNodeDisplacement&&(this.displacementX=v.coolingFactor*v.maxNodeDisplacement*f.sign(this.displacementX)),Math.abs(this.displacementY)>v.coolingFactor*v.maxNodeDisplacement&&(this.displacementY=v.coolingFactor*v.maxNodeDisplacement*f.sign(this.displacementY)),this.child&&this.child.getNodes().length>0&&this.propogateDisplacementToChildren(this.displacementX,this.displacementY)},d.prototype.propogateDisplacementToChildren=function(v,m){for(var g=this.getChild().getNodes(),p,x=0;x<g.length;x++)p=g[x],p.getChild()==null?(p.displacementX+=v,p.displacementY+=m):p.propogateDisplacementToChildren(v,m)},d.prototype.move=function(){var v=this.graphManager.getLayout();(this.child==null||this.child.getNodes().length==0)&&(this.moveBy(this.displacementX,this.displacementY),v.totalDisplacement+=Math.abs(this.displacementX)+Math.abs(this.displacementY)),this.springForceX=0,this.springForceY=0,this.repulsionForceX=0,this.repulsionForceY=0,this.gravitationForceX=0,this.gravitationForceY=0,this.displacementX=0,this.displacementY=0},d.prototype.setPred1=function(v){this.pred1=v},d.prototype.getPred1=function(){return pred1},d.prototype.getPred2=function(){return pred2},d.prototype.setNext=function(v){this.next=v},d.prototype.getNext=function(){return next},d.prototype.setProcessed=function(v){this.processed=v},d.prototype.isProcessed=function(){return processed},o.exports=d},902:(o,l,u)=>{function c(g){if(Array.isArray(g)){for(var p=0,x=Array(g.length);p<g.length;p++)x[p]=g[p];return x}else return Array.from(g)}var f=u(806),d=u(551).LinkedList,h=u(551).Matrix,v=u(551).SVD;function m(){}m.handleConstraints=function(g){var p={};p.fixedNodeConstraint=g.constraints.fixedNodeConstraint,p.alignmentConstraint=g.constraints.alignmentConstraint,p.relativePlacementConstraint=g.constraints.relativePlacementConstraint;for(var x=new Map,y=new Map,E=[],M=[],w=g.getAllNodes(),b=0,C=0;C<w.length;C++){var T=w[C];T.getChild()==null&&(y.set(T.id,b++),E.push(T.getCenterX()),M.push(T.getCenterY()),x.set(T.id,T))}p.relativePlacementConstraint&&p.relativePlacementConstraint.forEach(function(J){!J.gap&&J.gap!=0&&(J.left?J.gap=f.DEFAULT_EDGE_LENGTH+x.get(J.left).getWidth()/2+x.get(J.right).getWidth()/2:J.gap=f.DEFAULT_EDGE_LENGTH+x.get(J.top).getHeight()/2+x.get(J.bottom).getHeight()/2)});var S=function($,oe){return{x:$.x-oe.x,y:$.y-oe.y}},L=function($){var oe=0,fe=0;return $.forEach(function(ye){oe+=E[y.get(ye)],fe+=M[y.get(ye)]}),{x:oe/$.size,y:fe/$.size}},N=function($,oe,fe,ye,xe){function Ce(Ie,Oe){var Be=new Set(Ie),ze=!0,We=!1,pt=void 0;try{for(var je=Oe[Symbol.iterator](),Qe;!(ze=(Qe=je.next()).done);ze=!0){var wt=Qe.value;Be.add(wt)}}catch(st){We=!0,pt=st}finally{try{!ze&&je.return&&je.return()}finally{if(We)throw pt}}return Be}var q=new Map;$.forEach(function(Ie,Oe){q.set(Oe,0)}),$.forEach(function(Ie,Oe){Ie.forEach(function(Be){q.set(Be.id,q.get(Be.id)+1)})});var he=new Map,se=new Map,ge=new d;q.forEach(function(Ie,Oe){Ie==0?(ge.push(Oe),fe||(oe=="horizontal"?he.set(Oe,y.has(Oe)?E[y.get(Oe)]:ye.get(Oe)):he.set(Oe,y.has(Oe)?M[y.get(Oe)]:ye.get(Oe)))):he.set(Oe,Number.NEGATIVE_INFINITY),fe&&se.set(Oe,new Set([Oe]))}),fe&&xe.forEach(function(Ie){var Oe=[];if(Ie.forEach(function(We){fe.has(We)&&Oe.push(We)}),Oe.length>0){var Be=0;Oe.forEach(function(We){oe=="horizontal"?(he.set(We,y.has(We)?E[y.get(We)]:ye.get(We)),Be+=he.get(We)):(he.set(We,y.has(We)?M[y.get(We)]:ye.get(We)),Be+=he.get(We))}),Be=Be/Oe.length,Ie.forEach(function(We){fe.has(We)||he.set(We,Be)})}else{var ze=0;Ie.forEach(function(We){oe=="horizontal"?ze+=y.has(We)?E[y.get(We)]:ye.get(We):ze+=y.has(We)?M[y.get(We)]:ye.get(We)}),ze=ze/Ie.length,Ie.forEach(function(We){he.set(We,ze)})}});for(var Re=function(){var Oe=ge.shift(),Be=$.get(Oe);Be.forEach(function(ze){if(he.get(ze.id)<he.get(Oe)+ze.gap)if(fe&&fe.has(ze.id)){var We=void 0;if(oe=="horizontal"?We=y.has(ze.id)?E[y.get(ze.id)]:ye.get(ze.id):We=y.has(ze.id)?M[y.get(ze.id)]:ye.get(ze.id),he.set(ze.id,We),We<he.get(Oe)+ze.gap){var pt=he.get(Oe)+ze.gap-We;se.get(Oe).forEach(function(je){he.set(je,he.get(je)-pt)})}}else he.set(ze.id,he.get(Oe)+ze.gap);q.set(ze.id,q.get(ze.id)-1),q.get(ze.id)==0&&ge.push(ze.id),fe&&se.set(ze.id,Ce(se.get(Oe),se.get(ze.id)))})};ge.length!=0;)Re();if(fe){var Ae=new Set;$.forEach(function(Ie,Oe){Ie.length==0&&Ae.add(Oe)});var Fe=[];se.forEach(function(Ie,Oe){if(Ae.has(Oe)){var Be=!1,ze=!0,We=!1,pt=void 0;try{for(var je=Ie[Symbol.iterator](),Qe;!(ze=(Qe=je.next()).done);ze=!0){var wt=Qe.value;fe.has(wt)&&(Be=!0)}}catch(tt){We=!0,pt=tt}finally{try{!ze&&je.return&&je.return()}finally{if(We)throw pt}}if(!Be){var st=!1,ut=void 0;Fe.forEach(function(tt,Yt){tt.has([].concat(c(Ie))[0])&&(st=!0,ut=Yt)}),st?Ie.forEach(function(tt){Fe[ut].add(tt)}):Fe.push(new Set(Ie))}}}),Fe.forEach(function(Ie,Oe){var Be=Number.POSITIVE_INFINITY,ze=Number.POSITIVE_INFINITY,We=Number.NEGATIVE_INFINITY,pt=Number.NEGATIVE_INFINITY,je=!0,Qe=!1,wt=void 0;try{for(var st=Ie[Symbol.iterator](),ut;!(je=(ut=st.next()).done);je=!0){var tt=ut.value,Yt=void 0;oe=="horizontal"?Yt=y.has(tt)?E[y.get(tt)]:ye.get(tt):Yt=y.has(tt)?M[y.get(tt)]:ye.get(tt);var Nt=he.get(tt);Yt<Be&&(Be=Yt),Yt>We&&(We=Yt),Nt<ze&&(ze=Nt),Nt>pt&&(pt=Nt)}}catch(Jn){Qe=!0,wt=Jn}finally{try{!je&&st.return&&st.return()}finally{if(Qe)throw wt}}var fr=(Be+We)/2-(ze+pt)/2,Cn=!0,$n=!1,Zn=void 0;try{for(var Fn=Ie[Symbol.iterator](),Rr;!(Cn=(Rr=Fn.next()).done);Cn=!0){var Qn=Rr.value;he.set(Qn,he.get(Qn)+fr)}}catch(Jn){$n=!0,Zn=Jn}finally{try{!Cn&&Fn.return&&Fn.return()}finally{if($n)throw Zn}}})}return he},I=function($){var oe=0,fe=0,ye=0,xe=0;if($.forEach(function(se){se.left?E[y.get(se.left)]-E[y.get(se.right)]>=0?oe++:fe++:M[y.get(se.top)]-M[y.get(se.bottom)]>=0?ye++:xe++}),oe>fe&&ye>xe)for(var Ce=0;Ce<y.size;Ce++)E[Ce]=-1*E[Ce],M[Ce]=-1*M[Ce];else if(oe>fe)for(var q=0;q<y.size;q++)E[q]=-1*E[q];else if(ye>xe)for(var he=0;he<y.size;he++)M[he]=-1*M[he]},_=function($){var oe=[],fe=new d,ye=new Set,xe=0;return $.forEach(function(Ce,q){if(!ye.has(q)){oe[xe]=[];var he=q;for(fe.push(he),ye.add(he),oe[xe].push(he);fe.length!=0;){he=fe.shift();var se=$.get(he);se.forEach(function(ge){ye.has(ge.id)||(fe.push(ge.id),ye.add(ge.id),oe[xe].push(ge.id))})}xe++}}),oe},P=function($){var oe=new Map;return $.forEach(function(fe,ye){oe.set(ye,[])}),$.forEach(function(fe,ye){fe.forEach(function(xe){oe.get(ye).push(xe),oe.get(xe.id).push({id:ye,gap:xe.gap,direction:xe.direction})})}),oe},A=function($){var oe=new Map;return $.forEach(function(fe,ye){oe.set(ye,[])}),$.forEach(function(fe,ye){fe.forEach(function(xe){oe.get(xe.id).push({id:ye,gap:xe.gap,direction:xe.direction})})}),oe},D=[],R=[],B=!1,k=!1,V=new Set,Y=new Map,Z=new Map,W=[];if(p.fixedNodeConstraint&&p.fixedNodeConstraint.forEach(function(J){V.add(J.nodeId)}),p.relativePlacementConstraint&&(p.relativePlacementConstraint.forEach(function(J){J.left?(Y.has(J.left)?Y.get(J.left).push({id:J.right,gap:J.gap,direction:"horizontal"}):Y.set(J.left,[{id:J.right,gap:J.gap,direction:"horizontal"}]),Y.has(J.right)||Y.set(J.right,[])):(Y.has(J.top)?Y.get(J.top).push({id:J.bottom,gap:J.gap,direction:"vertical"}):Y.set(J.top,[{id:J.bottom,gap:J.gap,direction:"vertical"}]),Y.has(J.bottom)||Y.set(J.bottom,[]))}),Z=P(Y),W=_(Z)),f.TRANSFORM_ON_CONSTRAINT_HANDLING){if(p.fixedNodeConstraint&&p.fixedNodeConstraint.length>1)p.fixedNodeConstraint.forEach(function(J,$){D[$]=[J.position.x,J.position.y],R[$]=[E[y.get(J.nodeId)],M[y.get(J.nodeId)]]}),B=!0;else if(p.alignmentConstraint)(function(){var J=0;if(p.alignmentConstraint.vertical){for(var $=p.alignmentConstraint.vertical,oe=function(he){var se=new Set;$[he].forEach(function(Ae){se.add(Ae)});var ge=new Set([].concat(c(se)).filter(function(Ae){return V.has(Ae)})),Re=void 0;ge.size>0?Re=E[y.get(ge.values().next().value)]:Re=L(se).x,$[he].forEach(function(Ae){D[J]=[Re,M[y.get(Ae)]],R[J]=[E[y.get(Ae)],M[y.get(Ae)]],J++})},fe=0;fe<$.length;fe++)oe(fe);B=!0}if(p.alignmentConstraint.horizontal){for(var ye=p.alignmentConstraint.horizontal,xe=function(he){var se=new Set;ye[he].forEach(function(Ae){se.add(Ae)});var ge=new Set([].concat(c(se)).filter(function(Ae){return V.has(Ae)})),Re=void 0;ge.size>0?Re=E[y.get(ge.values().next().value)]:Re=L(se).y,ye[he].forEach(function(Ae){D[J]=[E[y.get(Ae)],Re],R[J]=[E[y.get(Ae)],M[y.get(Ae)]],J++})},Ce=0;Ce<ye.length;Ce++)xe(Ce);B=!0}p.relativePlacementConstraint&&(k=!0)})();else if(p.relativePlacementConstraint){for(var K=0,Q=0,ne=0;ne<W.length;ne++)W[ne].length>K&&(K=W[ne].length,Q=ne);if(K<Z.size/2)I(p.relativePlacementConstraint),B=!1,k=!1;else{var ie=new Map,H=new Map,X=[];W[Q].forEach(function(J){Y.get(J).forEach(function($){$.direction=="horizontal"?(ie.has(J)?ie.get(J).push($):ie.set(J,[$]),ie.has($.id)||ie.set($.id,[]),X.push({left:J,right:$.id})):(H.has(J)?H.get(J).push($):H.set(J,[$]),H.has($.id)||H.set($.id,[]),X.push({top:J,bottom:$.id}))})}),I(X),k=!1;var te=N(ie,"horizontal"),ue=N(H,"vertical");W[Q].forEach(function(J,$){R[$]=[E[y.get(J)],M[y.get(J)]],D[$]=[],te.has(J)?D[$][0]=te.get(J):D[$][0]=E[y.get(J)],ue.has(J)?D[$][1]=ue.get(J):D[$][1]=M[y.get(J)]}),B=!0}}if(B){for(var Se=void 0,U=h.transpose(D),Ge=h.transpose(R),Le=0;Le<U.length;Le++)U[Le]=h.multGamma(U[Le]),Ge[Le]=h.multGamma(Ge[Le]);var De=h.multMat(U,h.transpose(Ge)),de=v.svd(De);Se=h.multMat(de.V,h.transpose(de.U));for(var we=0;we<y.size;we++){var Me=[E[we],M[we]],z=[Se[0][0],Se[1][0]],O=[Se[0][1],Se[1][1]];E[we]=h.dotProduct(Me,z),M[we]=h.dotProduct(Me,O)}k&&I(p.relativePlacementConstraint)}}if(f.ENFORCE_CONSTRAINTS){if(p.fixedNodeConstraint&&p.fixedNodeConstraint.length>0){var re={x:0,y:0};p.fixedNodeConstraint.forEach(function(J,$){var oe={x:E[y.get(J.nodeId)],y:M[y.get(J.nodeId)]},fe=J.position,ye=S(fe,oe);re.x+=ye.x,re.y+=ye.y}),re.x/=p.fixedNodeConstraint.length,re.y/=p.fixedNodeConstraint.length,E.forEach(function(J,$){E[$]+=re.x}),M.forEach(function(J,$){M[$]+=re.y}),p.fixedNodeConstraint.forEach(function(J){E[y.get(J.nodeId)]=J.position.x,M[y.get(J.nodeId)]=J.position.y})}if(p.alignmentConstraint){if(p.alignmentConstraint.vertical)for(var ve=p.alignmentConstraint.vertical,Ee=function($){var oe=new Set;ve[$].forEach(function(xe){oe.add(xe)});var fe=new Set([].concat(c(oe)).filter(function(xe){return V.has(xe)})),ye=void 0;fe.size>0?ye=E[y.get(fe.values().next().value)]:ye=L(oe).x,oe.forEach(function(xe){V.has(xe)||(E[y.get(xe)]=ye)})},ae=0;ae<ve.length;ae++)Ee(ae);if(p.alignmentConstraint.horizontal)for(var F=p.alignmentConstraint.horizontal,j=function($){var oe=new Set;F[$].forEach(function(xe){oe.add(xe)});var fe=new Set([].concat(c(oe)).filter(function(xe){return V.has(xe)})),ye=void 0;fe.size>0?ye=M[y.get(fe.values().next().value)]:ye=L(oe).y,oe.forEach(function(xe){V.has(xe)||(M[y.get(xe)]=ye)})},ce=0;ce<F.length;ce++)j(ce)}p.relativePlacementConstraint&&function(){var J=new Map,$=new Map,oe=new Map,fe=new Map,ye=new Map,xe=new Map,Ce=new Set,q=new Set;if(V.forEach(function(He){Ce.add(He),q.add(He)}),p.alignmentConstraint){if(p.alignmentConstraint.vertical)for(var he=p.alignmentConstraint.vertical,se=function(Ne){oe.set("dummy"+Ne,[]),he[Ne].forEach(function(Ke){J.set(Ke,"dummy"+Ne),oe.get("dummy"+Ne).push(Ke),V.has(Ke)&&Ce.add("dummy"+Ne)}),ye.set("dummy"+Ne,E[y.get(he[Ne][0])])},ge=0;ge<he.length;ge++)se(ge);if(p.alignmentConstraint.horizontal)for(var Re=p.alignmentConstraint.horizontal,Ae=function(Ne){fe.set("dummy"+Ne,[]),Re[Ne].forEach(function(Ke){$.set(Ke,"dummy"+Ne),fe.get("dummy"+Ne).push(Ke),V.has(Ke)&&q.add("dummy"+Ne)}),xe.set("dummy"+Ne,M[y.get(Re[Ne][0])])},Fe=0;Fe<Re.length;Fe++)Ae(Fe)}var Ie=new Map,Oe=new Map,Be=function(Ne){Y.get(Ne).forEach(function(Ke){var it=void 0,ft=void 0;Ke.direction=="horizontal"?(it=J.get(Ne)?J.get(Ne):Ne,J.get(Ke.id)?ft={id:J.get(Ke.id),gap:Ke.gap,direction:Ke.direction}:ft=Ke,Ie.has(it)?Ie.get(it).push(ft):Ie.set(it,[ft]),Ie.has(ft.id)||Ie.set(ft.id,[])):(it=$.get(Ne)?$.get(Ne):Ne,$.get(Ke.id)?ft={id:$.get(Ke.id),gap:Ke.gap,direction:Ke.direction}:ft=Ke,Oe.has(it)?Oe.get(it).push(ft):Oe.set(it,[ft]),Oe.has(ft.id)||Oe.set(ft.id,[]))})},ze=!0,We=!1,pt=void 0;try{for(var je=Y.keys()[Symbol.iterator](),Qe;!(ze=(Qe=je.next()).done);ze=!0){var wt=Qe.value;Be(wt)}}catch(He){We=!0,pt=He}finally{try{!ze&&je.return&&je.return()}finally{if(We)throw pt}}var st=P(Ie),ut=P(Oe),tt=_(st),Yt=_(ut),Nt=A(Ie),fr=A(Oe),Cn=[],$n=[];tt.forEach(function(He,Ne){Cn[Ne]=[],He.forEach(function(Ke){Nt.get(Ke).length==0&&Cn[Ne].push(Ke)})}),Yt.forEach(function(He,Ne){$n[Ne]=[],He.forEach(function(Ke){fr.get(Ke).length==0&&$n[Ne].push(Ke)})});var Zn=N(Ie,"horizontal",Ce,ye,Cn),Fn=N(Oe,"vertical",q,xe,$n),Rr=function(Ne){oe.get(Ne)?oe.get(Ne).forEach(function(Ke){E[y.get(Ke)]=Zn.get(Ne)}):E[y.get(Ne)]=Zn.get(Ne)},Qn=!0,Jn=!1,G=void 0;try{for(var pe=Zn.keys()[Symbol.iterator](),_e;!(Qn=(_e=pe.next()).done);Qn=!0){var be=_e.value;Rr(be)}}catch(He){Jn=!0,G=He}finally{try{!Qn&&pe.return&&pe.return()}finally{if(Jn)throw G}}var me=function(Ne){fe.get(Ne)?fe.get(Ne).forEach(function(Ke){M[y.get(Ke)]=Fn.get(Ne)}):M[y.get(Ne)]=Fn.get(Ne)},Pe=!0,Ue=!1,Xe=void 0;try{for(var Ye=Fn.keys()[Symbol.iterator](),Ze;!(Pe=(Ze=Ye.next()).done);Pe=!0){var be=Ze.value;me(be)}}catch(He){Ue=!0,Xe=He}finally{try{!Pe&&Ye.return&&Ye.return()}finally{if(Ue)throw Xe}}}()}for(var le=0;le<w.length;le++){var ee=w[le];ee.getChild()==null&&ee.setCenter(E[y.get(ee.id)],M[y.get(ee.id)])}},o.exports=m},551:o=>{o.exports=t}},i={};function a(o){var l=i[o];if(l!==void 0)return l.exports;var u=i[o]={exports:{}};return r[o](u,u.exports,a),u.exports}var s=a(45);return s})()})}(Ho)),Ho.exports}var eR=Vo.exports,Ad;function tR(){return Ad||(Ad=1,function(n,e){(function(r,i){n.exports=i(jC())})(eR,function(t){return(()=>{var r={658:o=>{o.exports=Object.assign!=null?Object.assign.bind(Object):function(l){for(var u=arguments.length,c=Array(u>1?u-1:0),f=1;f<u;f++)c[f-1]=arguments[f];return c.forEach(function(d){Object.keys(d).forEach(function(h){return l[h]=d[h]})}),l}},548:(o,l,u)=>{var c=function(){function h(v,m){var g=[],p=!0,x=!1,y=void 0;try{for(var E=v[Symbol.iterator](),M;!(p=(M=E.next()).done)&&(g.push(M.value),!(m&&g.length===m));p=!0);}catch(w){x=!0,y=w}finally{try{!p&&E.return&&E.return()}finally{if(x)throw y}}return g}return function(v,m){if(Array.isArray(v))return v;if(Symbol.iterator in Object(v))return h(v,m);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=u(140).layoutBase.LinkedList,d={};d.getTopMostNodes=function(h){for(var v={},m=0;m<h.length;m++)v[h[m].id()]=!0;var g=h.filter(function(p,x){typeof p=="number"&&(p=x);for(var y=p.parent()[0];y!=null;){if(v[y.id()])return!1;y=y.parent()[0]}return!0});return g},d.connectComponents=function(h,v,m,g){var p=new f,x=new Set,y=[],E=void 0,M=void 0,w=void 0,b=!1,C=1,T=[],S=[],L=function(){var I=h.collection();S.push(I);var _=m[0],P=h.collection();P.merge(_).merge(_.descendants().intersection(v)),y.push(_),P.forEach(function(R){p.push(R),x.add(R),I.merge(R)});for(var A=function(){_=p.shift();var B=h.collection();_.neighborhood().nodes().forEach(function(Z){v.intersection(_.edgesWith(Z)).length>0&&B.merge(Z)});for(var k=0;k<B.length;k++){var V=B[k];if(E=m.intersection(V.union(V.ancestors())),E!=null&&!x.has(E[0])){var Y=E.union(E.descendants());Y.forEach(function(Z){p.push(Z),x.add(Z),I.merge(Z),m.has(Z)&&y.push(Z)})}}};p.length!=0;)A();if(I.forEach(function(R){v.intersection(R.connectedEdges()).forEach(function(B){I.has(B.source())&&I.has(B.target())&&I.merge(B)})}),y.length==m.length&&(b=!0),!b||b&&C>1){M=y[0],w=M.connectedEdges().length,y.forEach(function(R){R.connectedEdges().length<w&&(w=R.connectedEdges().length,M=R)}),T.push(M.id());var D=h.collection();D.merge(y[0]),y.forEach(function(R){D.merge(R)}),y=[],m=m.difference(D),C++}};do L();while(!b);return g&&T.length>0&&g.set("dummy"+(g.size+1),T),S},d.relocateComponent=function(h,v,m){if(!m.fixedNodeConstraint){var g=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,x=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY;if(m.quality=="draft"){var E=!0,M=!1,w=void 0;try{for(var b=v.nodeIndexes[Symbol.iterator](),C;!(E=(C=b.next()).done);E=!0){var T=C.value,S=c(T,2),L=S[0],N=S[1],I=m.cy.getElementById(L);if(I){var _=I.boundingBox(),P=v.xCoords[N]-_.w/2,A=v.xCoords[N]+_.w/2,D=v.yCoords[N]-_.h/2,R=v.yCoords[N]+_.h/2;P<g&&(g=P),A>p&&(p=A),D<x&&(x=D),R>y&&(y=R)}}}catch(Z){M=!0,w=Z}finally{try{!E&&b.return&&b.return()}finally{if(M)throw w}}var B=h.x-(p+g)/2,k=h.y-(y+x)/2;v.xCoords=v.xCoords.map(function(Z){return Z+B}),v.yCoords=v.yCoords.map(function(Z){return Z+k})}else{Object.keys(v).forEach(function(Z){var W=v[Z],K=W.getRect().x,Q=W.getRect().x+W.getRect().width,ne=W.getRect().y,ie=W.getRect().y+W.getRect().height;K<g&&(g=K),Q>p&&(p=Q),ne<x&&(x=ne),ie>y&&(y=ie)});var V=h.x-(p+g)/2,Y=h.y-(y+x)/2;Object.keys(v).forEach(function(Z){var W=v[Z];W.setCenter(W.getCenterX()+V,W.getCenterY()+Y)})}}},d.calcBoundingBox=function(h,v,m,g){for(var p=Number.MAX_SAFE_INTEGER,x=Number.MIN_SAFE_INTEGER,y=Number.MAX_SAFE_INTEGER,E=Number.MIN_SAFE_INTEGER,M=void 0,w=void 0,b=void 0,C=void 0,T=h.descendants().not(":parent"),S=T.length,L=0;L<S;L++){var N=T[L];M=v[g.get(N.id())]-N.width()/2,w=v[g.get(N.id())]+N.width()/2,b=m[g.get(N.id())]-N.height()/2,C=m[g.get(N.id())]+N.height()/2,p>M&&(p=M),x<w&&(x=w),y>b&&(y=b),E<C&&(E=C)}var I={};return I.topLeftX=p,I.topLeftY=y,I.width=x-p,I.height=E-y,I},d.calcParentsWithoutChildren=function(h,v){var m=h.collection();return v.nodes(":parent").forEach(function(g){var p=!1;g.children().forEach(function(x){x.css("display")!="none"&&(p=!0)}),p||m.merge(g)}),m},o.exports=d},816:(o,l,u)=>{var c=u(548),f=u(140).CoSELayout,d=u(140).CoSENode,h=u(140).layoutBase.PointD,v=u(140).layoutBase.DimensionD,m=u(140).layoutBase.LayoutConstants,g=u(140).layoutBase.FDLayoutConstants,p=u(140).CoSEConstants,x=function(E,M){var w=E.cy,b=E.eles,C=b.nodes(),T=b.edges(),S=void 0,L=void 0,N=void 0,I={};E.randomize&&(S=M.nodeIndexes,L=M.xCoords,N=M.yCoords);var _=function(Z){return typeof Z=="function"},P=function(Z,W){return _(Z)?Z(W):Z},A=c.calcParentsWithoutChildren(w,b),D=function Y(Z,W,K,Q){for(var ne=W.length,ie=0;ie<ne;ie++){var H=W[ie],X=null;H.intersection(A).length==0&&(X=H.children());var te=void 0,ue=H.layoutDimensions({nodeDimensionsIncludeLabels:Q.nodeDimensionsIncludeLabels});if(H.outerWidth()!=null&&H.outerHeight()!=null)if(Q.randomize)if(!H.isParent())te=Z.add(new d(K.graphManager,new h(L[S.get(H.id())]-ue.w/2,N[S.get(H.id())]-ue.h/2),new v(parseFloat(ue.w),parseFloat(ue.h))));else{var Se=c.calcBoundingBox(H,L,N,S);H.intersection(A).length==0?te=Z.add(new d(K.graphManager,new h(Se.topLeftX,Se.topLeftY),new v(Se.width,Se.height))):te=Z.add(new d(K.graphManager,new h(Se.topLeftX,Se.topLeftY),new v(parseFloat(ue.w),parseFloat(ue.h))))}else te=Z.add(new d(K.graphManager,new h(H.position("x")-ue.w/2,H.position("y")-ue.h/2),new v(parseFloat(ue.w),parseFloat(ue.h))));else te=Z.add(new d(this.graphManager));if(te.id=H.data("id"),te.nodeRepulsion=P(Q.nodeRepulsion,H),te.paddingLeft=parseInt(H.css("padding")),te.paddingTop=parseInt(H.css("padding")),te.paddingRight=parseInt(H.css("padding")),te.paddingBottom=parseInt(H.css("padding")),Q.nodeDimensionsIncludeLabels&&(te.labelWidth=H.boundingBox({includeLabels:!0,includeNodes:!1,includeOverlays:!1}).w,te.labelHeight=H.boundingBox({includeLabels:!0,includeNodes:!1,includeOverlays:!1}).h,te.labelPosVertical=H.css("text-valign"),te.labelPosHorizontal=H.css("text-halign")),I[H.data("id")]=te,isNaN(te.rect.x)&&(te.rect.x=0),isNaN(te.rect.y)&&(te.rect.y=0),X!=null&&X.length>0){var U=void 0;U=K.getGraphManager().add(K.newGraph(),te),Y(U,X,K,Q)}}},R=function(Z,W,K){for(var Q=0,ne=0,ie=0;ie<K.length;ie++){var H=K[ie],X=I[H.data("source")],te=I[H.data("target")];if(X&&te&&X!==te&&X.getEdgesBetween(te).length==0){var ue=W.add(Z.newEdge(),X,te);ue.id=H.id(),ue.idealLength=P(E.idealEdgeLength,H),ue.edgeElasticity=P(E.edgeElasticity,H),Q+=ue.idealLength,ne++}}E.idealEdgeLength!=null&&(ne>0?p.DEFAULT_EDGE_LENGTH=g.DEFAULT_EDGE_LENGTH=Q/ne:_(E.idealEdgeLength)?p.DEFAULT_EDGE_LENGTH=g.DEFAULT_EDGE_LENGTH=50:p.DEFAULT_EDGE_LENGTH=g.DEFAULT_EDGE_LENGTH=E.idealEdgeLength,p.MIN_REPULSION_DIST=g.MIN_REPULSION_DIST=g.DEFAULT_EDGE_LENGTH/10,p.DEFAULT_RADIAL_SEPARATION=g.DEFAULT_EDGE_LENGTH)},B=function(Z,W){W.fixedNodeConstraint&&(Z.constraints.fixedNodeConstraint=W.fixedNodeConstraint),W.alignmentConstraint&&(Z.constraints.alignmentConstraint=W.alignmentConstraint),W.relativePlacementConstraint&&(Z.constraints.relativePlacementConstraint=W.relativePlacementConstraint)};E.nestingFactor!=null&&(p.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=g.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=E.nestingFactor),E.gravity!=null&&(p.DEFAULT_GRAVITY_STRENGTH=g.DEFAULT_GRAVITY_STRENGTH=E.gravity),E.numIter!=null&&(p.MAX_ITERATIONS=g.MAX_ITERATIONS=E.numIter),E.gravityRange!=null&&(p.DEFAULT_GRAVITY_RANGE_FACTOR=g.DEFAULT_GRAVITY_RANGE_FACTOR=E.gravityRange),E.gravityCompound!=null&&(p.DEFAULT_COMPOUND_GRAVITY_STRENGTH=g.DEFAULT_COMPOUND_GRAVITY_STRENGTH=E.gravityCompound),E.gravityRangeCompound!=null&&(p.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=g.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=E.gravityRangeCompound),E.initialEnergyOnIncremental!=null&&(p.DEFAULT_COOLING_FACTOR_INCREMENTAL=g.DEFAULT_COOLING_FACTOR_INCREMENTAL=E.initialEnergyOnIncremental),E.tilingCompareBy!=null&&(p.TILING_COMPARE_BY=E.tilingCompareBy),E.quality=="proof"?m.QUALITY=2:m.QUALITY=0,p.NODE_DIMENSIONS_INCLUDE_LABELS=g.NODE_DIMENSIONS_INCLUDE_LABELS=m.NODE_DIMENSIONS_INCLUDE_LABELS=E.nodeDimensionsIncludeLabels,p.DEFAULT_INCREMENTAL=g.DEFAULT_INCREMENTAL=m.DEFAULT_INCREMENTAL=!E.randomize,p.ANIMATE=g.ANIMATE=m.ANIMATE=E.animate,p.TILE=E.tile,p.TILING_PADDING_VERTICAL=typeof E.tilingPaddingVertical=="function"?E.tilingPaddingVertical.call():E.tilingPaddingVertical,p.TILING_PADDING_HORIZONTAL=typeof E.tilingPaddingHorizontal=="function"?E.tilingPaddingHorizontal.call():E.tilingPaddingHorizontal,p.DEFAULT_INCREMENTAL=g.DEFAULT_INCREMENTAL=m.DEFAULT_INCREMENTAL=!0,p.PURE_INCREMENTAL=!E.randomize,m.DEFAULT_UNIFORM_LEAF_NODE_SIZES=E.uniformNodeDimensions,E.step=="transformed"&&(p.TRANSFORM_ON_CONSTRAINT_HANDLING=!0,p.ENFORCE_CONSTRAINTS=!1,p.APPLY_LAYOUT=!1),E.step=="enforced"&&(p.TRANSFORM_ON_CONSTRAINT_HANDLING=!1,p.ENFORCE_CONSTRAINTS=!0,p.APPLY_LAYOUT=!1),E.step=="cose"&&(p.TRANSFORM_ON_CONSTRAINT_HANDLING=!1,p.ENFORCE_CONSTRAINTS=!1,p.APPLY_LAYOUT=!0),E.step=="all"&&(E.randomize?p.TRANSFORM_ON_CONSTRAINT_HANDLING=!0:p.TRANSFORM_ON_CONSTRAINT_HANDLING=!1,p.ENFORCE_CONSTRAINTS=!0,p.APPLY_LAYOUT=!0),E.fixedNodeConstraint||E.alignmentConstraint||E.relativePlacementConstraint?p.TREE_REDUCTION_ON_INCREMENTAL=!1:p.TREE_REDUCTION_ON_INCREMENTAL=!0;var k=new f,V=k.newGraphManager();return D(V.addRoot(),c.getTopMostNodes(C),k,E),R(k,V,T),B(k,E),k.runLayout(),I};o.exports={coseLayout:x}},212:(o,l,u)=>{var c=function(){function E(M,w){for(var b=0;b<w.length;b++){var C=w[b];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(M,C.key,C)}}return function(M,w,b){return w&&E(M.prototype,w),b&&E(M,b),M}}();function f(E,M){if(!(E instanceof M))throw new TypeError("Cannot call a class as a function")}var d=u(658),h=u(548),v=u(657),m=v.spectralLayout,g=u(816),p=g.coseLayout,x=Object.freeze({quality:"default",randomize:!0,animate:!0,animationDuration:1e3,animationEasing:void 0,fit:!0,padding:30,nodeDimensionsIncludeLabels:!1,uniformNodeDimensions:!1,packComponents:!0,step:"all",samplingType:!0,sampleSize:25,nodeSeparation:75,piTol:1e-7,nodeRepulsion:function(M){return 4500},idealEdgeLength:function(M){return 50},edgeElasticity:function(M){return .45},nestingFactor:.1,gravity:.25,numIter:2500,tile:!0,tilingCompareBy:void 0,tilingPaddingVertical:10,tilingPaddingHorizontal:10,gravityRangeCompound:1.5,gravityCompound:1,gravityRange:3.8,initialEnergyOnIncremental:.3,fixedNodeConstraint:void 0,alignmentConstraint:void 0,relativePlacementConstraint:void 0,ready:function(){},stop:function(){}}),y=function(){function E(M){f(this,E),this.options=d({},x,M)}return c(E,[{key:"run",value:function(){var w=this,b=this.options,C=b.cy,T=b.eles,S=[],L=[],N=void 0,I=[];b.fixedNodeConstraint&&(!Array.isArray(b.fixedNodeConstraint)||b.fixedNodeConstraint.length==0)&&(b.fixedNodeConstraint=void 0),b.alignmentConstraint&&(b.alignmentConstraint.vertical&&(!Array.isArray(b.alignmentConstraint.vertical)||b.alignmentConstraint.vertical.length==0)&&(b.alignmentConstraint.vertical=void 0),b.alignmentConstraint.horizontal&&(!Array.isArray(b.alignmentConstraint.horizontal)||b.alignmentConstraint.horizontal.length==0)&&(b.alignmentConstraint.horizontal=void 0)),b.relativePlacementConstraint&&(!Array.isArray(b.relativePlacementConstraint)||b.relativePlacementConstraint.length==0)&&(b.relativePlacementConstraint=void 0);var _=b.fixedNodeConstraint||b.alignmentConstraint||b.relativePlacementConstraint;_&&(b.tile=!1,b.packComponents=!1);var P=void 0,A=!1;if(C.layoutUtilities&&b.packComponents&&(P=C.layoutUtilities("get"),P||(P=C.layoutUtilities()),A=!0),T.nodes().length>0)if(A){var B=h.getTopMostNodes(b.eles.nodes());if(N=h.connectComponents(C,b.eles,B),N.forEach(function(De){var de=De.boundingBox();I.push({x:de.x1+de.w/2,y:de.y1+de.h/2})}),b.randomize&&N.forEach(function(De){b.eles=De,S.push(m(b))}),b.quality=="default"||b.quality=="proof"){var k=C.collection();if(b.tile){var V=new Map,Y=[],Z=[],W=0,K={nodeIndexes:V,xCoords:Y,yCoords:Z},Q=[];if(N.forEach(function(De,de){De.edges().length==0&&(De.nodes().forEach(function(we,Me){k.merge(De.nodes()[Me]),we.isParent()||(K.nodeIndexes.set(De.nodes()[Me].id(),W++),K.xCoords.push(De.nodes()[0].position().x),K.yCoords.push(De.nodes()[0].position().y))}),Q.push(de))}),k.length>1){var ne=k.boundingBox();I.push({x:ne.x1+ne.w/2,y:ne.y1+ne.h/2}),N.push(k),S.push(K);for(var ie=Q.length-1;ie>=0;ie--)N.splice(Q[ie],1),S.splice(Q[ie],1),I.splice(Q[ie],1)}}N.forEach(function(De,de){b.eles=De,L.push(p(b,S[de])),h.relocateComponent(I[de],L[de],b)})}else N.forEach(function(De,de){h.relocateComponent(I[de],S[de],b)});var H=new Set;if(N.length>1){var X=[],te=T.filter(function(De){return De.css("display")=="none"});N.forEach(function(De,de){var we=void 0;if(b.quality=="draft"&&(we=S[de].nodeIndexes),De.nodes().not(te).length>0){var Me={};Me.edges=[],Me.nodes=[];var z=void 0;De.nodes().not(te).forEach(function(O){if(b.quality=="draft")if(!O.isParent())z=we.get(O.id()),Me.nodes.push({x:S[de].xCoords[z]-O.boundingbox().w/2,y:S[de].yCoords[z]-O.boundingbox().h/2,width:O.boundingbox().w,height:O.boundingbox().h});else{var re=h.calcBoundingBox(O,S[de].xCoords,S[de].yCoords,we);Me.nodes.push({x:re.topLeftX,y:re.topLeftY,width:re.width,height:re.height})}else L[de][O.id()]&&Me.nodes.push({x:L[de][O.id()].getLeft(),y:L[de][O.id()].getTop(),width:L[de][O.id()].getWidth(),height:L[de][O.id()].getHeight()})}),De.edges().forEach(function(O){var re=O.source(),ve=O.target();if(re.css("display")!="none"&&ve.css("display")!="none")if(b.quality=="draft"){var Ee=we.get(re.id()),ae=we.get(ve.id()),F=[],j=[];if(re.isParent()){var ce=h.calcBoundingBox(re,S[de].xCoords,S[de].yCoords,we);F.push(ce.topLeftX+ce.width/2),F.push(ce.topLeftY+ce.height/2)}else F.push(S[de].xCoords[Ee]),F.push(S[de].yCoords[Ee]);if(ve.isParent()){var le=h.calcBoundingBox(ve,S[de].xCoords,S[de].yCoords,we);j.push(le.topLeftX+le.width/2),j.push(le.topLeftY+le.height/2)}else j.push(S[de].xCoords[ae]),j.push(S[de].yCoords[ae]);Me.edges.push({startX:F[0],startY:F[1],endX:j[0],endY:j[1]})}else L[de][re.id()]&&L[de][ve.id()]&&Me.edges.push({startX:L[de][re.id()].getCenterX(),startY:L[de][re.id()].getCenterY(),endX:L[de][ve.id()].getCenterX(),endY:L[de][ve.id()].getCenterY()})}),Me.nodes.length>0&&(X.push(Me),H.add(de))}});var ue=P.packComponents(X,b.randomize).shifts;if(b.quality=="draft")S.forEach(function(De,de){var we=De.xCoords.map(function(z){return z+ue[de].dx}),Me=De.yCoords.map(function(z){return z+ue[de].dy});De.xCoords=we,De.yCoords=Me});else{var Se=0;H.forEach(function(De){Object.keys(L[De]).forEach(function(de){var we=L[De][de];we.setCenter(we.getCenterX()+ue[Se].dx,we.getCenterY()+ue[Se].dy)}),Se++})}}}else{var D=b.eles.boundingBox();if(I.push({x:D.x1+D.w/2,y:D.y1+D.h/2}),b.randomize){var R=m(b);S.push(R)}b.quality=="default"||b.quality=="proof"?(L.push(p(b,S[0])),h.relocateComponent(I[0],L[0],b)):h.relocateComponent(I[0],S[0],b)}var U=function(de,we){if(b.quality=="default"||b.quality=="proof"){typeof de=="number"&&(de=we);var Me=void 0,z=void 0,O=de.data("id");return L.forEach(function(ve){O in ve&&(Me={x:ve[O].getRect().getCenterX(),y:ve[O].getRect().getCenterY()},z=ve[O])}),b.nodeDimensionsIncludeLabels&&(z.labelWidth&&(z.labelPosHorizontal=="left"?Me.x+=z.labelWidth/2:z.labelPosHorizontal=="right"&&(Me.x-=z.labelWidth/2)),z.labelHeight&&(z.labelPosVertical=="top"?Me.y+=z.labelHeight/2:z.labelPosVertical=="bottom"&&(Me.y-=z.labelHeight/2))),Me==null&&(Me={x:de.position("x"),y:de.position("y")}),{x:Me.x,y:Me.y}}else{var re=void 0;return S.forEach(function(ve){var Ee=ve.nodeIndexes.get(de.id());Ee!=null&&(re={x:ve.xCoords[Ee],y:ve.yCoords[Ee]})}),re==null&&(re={x:de.position("x"),y:de.position("y")}),{x:re.x,y:re.y}}};if(b.quality=="default"||b.quality=="proof"||b.randomize){var Ge=h.calcParentsWithoutChildren(C,T),Le=T.filter(function(De){return De.css("display")=="none"});b.eles=T.not(Le),T.nodes().not(":parent").not(Le).layoutPositions(w,b,U),Ge.length>0&&Ge.forEach(function(De){De.position(U(De))})}else console.log("If randomize option is set to false, then quality option must be 'default' or 'proof'.")}}]),E}();o.exports=y},657:(o,l,u)=>{var c=u(548),f=u(140).layoutBase.Matrix,d=u(140).layoutBase.SVD,h=function(m){var g=m.cy,p=m.eles,x=p.nodes(),y=p.nodes(":parent"),E=new Map,M=new Map,w=new Map,b=[],C=[],T=[],S=[],L=[],N=[],I=[],_=[],P=void 0,A=1e8,D=1e-9,R=m.piTol,B=m.samplingType,k=m.nodeSeparation,V=void 0,Y=function(){for(var $=0,oe=0,fe=!1;oe<V;){$=Math.floor(Math.random()*P),fe=!1;for(var ye=0;ye<oe;ye++)if(S[ye]==$){fe=!0;break}if(!fe)S[oe]=$,oe++;else continue}},Z=function($,oe,fe){for(var ye=[],xe=0,Ce=0,q=0,he=void 0,se=[],ge=0,Re=1,Ae=0;Ae<P;Ae++)se[Ae]=A;for(ye[Ce]=$,se[$]=0;Ce>=xe;){q=ye[xe++];for(var Fe=b[q],Ie=0;Ie<Fe.length;Ie++)he=M.get(Fe[Ie]),se[he]==A&&(se[he]=se[q]+1,ye[++Ce]=he);N[q][oe]=se[q]*k}if(fe){for(var Oe=0;Oe<P;Oe++)N[Oe][oe]<L[Oe]&&(L[Oe]=N[Oe][oe]);for(var Be=0;Be<P;Be++)L[Be]>ge&&(ge=L[Be],Re=Be)}return Re},W=function($){var oe=void 0;if($){oe=Math.floor(Math.random()*P);for(var ye=0;ye<P;ye++)L[ye]=A;for(var xe=0;xe<V;xe++)S[xe]=oe,oe=Z(oe,xe,$)}else{Y();for(var fe=0;fe<V;fe++)Z(S[fe],fe,$)}for(var Ce=0;Ce<P;Ce++)for(var q=0;q<V;q++)N[Ce][q]*=N[Ce][q];for(var he=0;he<V;he++)I[he]=[];for(var se=0;se<V;se++)for(var ge=0;ge<V;ge++)I[se][ge]=N[S[ge]][se]},K=function(){for(var $=d.svd(I),oe=$.S,fe=$.U,ye=$.V,xe=oe[0]*oe[0]*oe[0],Ce=[],q=0;q<V;q++){Ce[q]=[];for(var he=0;he<V;he++)Ce[q][he]=0,q==he&&(Ce[q][he]=oe[q]/(oe[q]*oe[q]+xe/(oe[q]*oe[q])))}_=f.multMat(f.multMat(ye,Ce),f.transpose(fe))},Q=function(){for(var $=void 0,oe=void 0,fe=[],ye=[],xe=[],Ce=[],q=0;q<P;q++)fe[q]=Math.random(),ye[q]=Math.random();fe=f.normalize(fe),ye=f.normalize(ye);for(var he=D,se=D,ge=void 0;;){for(var Re=0;Re<P;Re++)xe[Re]=fe[Re];if(fe=f.multGamma(f.multL(f.multGamma(xe),N,_)),$=f.dotProduct(xe,fe),fe=f.normalize(fe),he=f.dotProduct(xe,fe),ge=Math.abs(he/se),ge<=1+R&&ge>=1)break;se=he}for(var Ae=0;Ae<P;Ae++)xe[Ae]=fe[Ae];for(se=D;;){for(var Fe=0;Fe<P;Fe++)Ce[Fe]=ye[Fe];if(Ce=f.minusOp(Ce,f.multCons(xe,f.dotProduct(xe,Ce))),ye=f.multGamma(f.multL(f.multGamma(Ce),N,_)),oe=f.dotProduct(Ce,ye),ye=f.normalize(ye),he=f.dotProduct(Ce,ye),ge=Math.abs(he/se),ge<=1+R&&ge>=1)break;se=he}for(var Ie=0;Ie<P;Ie++)Ce[Ie]=ye[Ie];C=f.multCons(xe,Math.sqrt(Math.abs($))),T=f.multCons(Ce,Math.sqrt(Math.abs(oe)))};c.connectComponents(g,p,c.getTopMostNodes(x),E),y.forEach(function(J){c.connectComponents(g,p,c.getTopMostNodes(J.descendants().intersection(p)),E)});for(var ne=0,ie=0;ie<x.length;ie++)x[ie].isParent()||M.set(x[ie].id(),ne++);var H=!0,X=!1,te=void 0;try{for(var ue=E.keys()[Symbol.iterator](),Se;!(H=(Se=ue.next()).done);H=!0){var U=Se.value;M.set(U,ne++)}}catch(J){X=!0,te=J}finally{try{!H&&ue.return&&ue.return()}finally{if(X)throw te}}for(var Ge=0;Ge<M.size;Ge++)b[Ge]=[];y.forEach(function(J){for(var $=J.children().intersection(p);$.nodes(":childless").length==0;)$=$.nodes()[0].children().intersection(p);var oe=0,fe=$.nodes(":childless")[0].connectedEdges().length;$.nodes(":childless").forEach(function(ye,xe){ye.connectedEdges().length<fe&&(fe=ye.connectedEdges().length,oe=xe)}),w.set(J.id(),$.nodes(":childless")[oe].id())}),x.forEach(function(J){var $=void 0;J.isParent()?$=M.get(w.get(J.id())):$=M.get(J.id()),J.neighborhood().nodes().forEach(function(oe){p.intersection(J.edgesWith(oe)).length>0&&(oe.isParent()?b[$].push(w.get(oe.id())):b[$].push(oe.id()))})});var Le=function($){var oe=M.get($),fe=void 0;E.get($).forEach(function(ye){g.getElementById(ye).isParent()?fe=w.get(ye):fe=ye,b[oe].push(fe),b[M.get(fe)].push($)})},De=!0,de=!1,we=void 0;try{for(var Me=E.keys()[Symbol.iterator](),z;!(De=(z=Me.next()).done);De=!0){var O=z.value;Le(O)}}catch(J){de=!0,we=J}finally{try{!De&&Me.return&&Me.return()}finally{if(de)throw we}}P=M.size;var re=void 0;if(P>2){V=P<m.sampleSize?P:m.sampleSize;for(var ve=0;ve<P;ve++)N[ve]=[];for(var Ee=0;Ee<V;Ee++)_[Ee]=[];return m.quality=="draft"||m.step=="all"?(W(B),K(),Q(),re={nodeIndexes:M,xCoords:C,yCoords:T}):(M.forEach(function(J,$){C.push(g.getElementById($).position("x")),T.push(g.getElementById($).position("y"))}),re={nodeIndexes:M,xCoords:C,yCoords:T}),re}else{var ae=M.keys(),F=g.getElementById(ae.next().value),j=F.position(),ce=F.outerWidth();if(C.push(j.x),T.push(j.y),P==2){var le=g.getElementById(ae.next().value),ee=le.outerWidth();C.push(j.x+ce/2+ee/2+m.idealEdgeLength),T.push(j.y)}return re={nodeIndexes:M,xCoords:C,yCoords:T},re}};o.exports={spectralLayout:h}},579:(o,l,u)=>{var c=u(212),f=function(h){h&&h("layout","fcose",c)};typeof cytoscape<"u"&&f(cytoscape),o.exports=f},140:o=>{o.exports=t}},i={};function a(o){var l=i[o];if(l!==void 0)return l.exports;var u=i[o]={exports:{}};return r[o](u,u.exports,a),u.exports}var s=a(579);return s})()})}(Vo)),Vo.exports}var nR=tR();const rR=$C(nR);ei.use(rR);async function iR(n){let e=new Set,t=[];for(const[s,o]of Object.entries(n)){for(const l of o.nodes)e.add(l);for(const l of o.edges)t.push(l)}e=Array.from(e);let r=[];for(let s of e)r.push({data:{id:s.id}});for(let s of t)r.push({data:{source:s.src,target:s.dst,weight:1-s.n}});const i=ei({headless:!0,styleEnabled:!0,elements:r});let a;i.layout({name:"fcose",ready:()=>{let s=i.nodes().map(f=>f.position());const o=Math.min(...s.map(f=>f.x))-ct.NODE_PADDING,l=Math.max(...s.map(f=>f.x))+ct.NODE_PADDING,u=Math.min(...s.map(f=>f.y))-ct.NODE_PADDING,c=Math.max(...s.map(f=>f.y))+ct.NODE_PADDING;a=i.nodes().map(f=>{const d=f.position();return{id:f.id(),x:(d.x-o)/(l-o),y:(d.y-u)/(c-u)}});for(const[f,d]of Object.entries(n))for(const[h,v]of d.nodes.entries()){const m=d.nodes[h].id,g=a.find(p=>p.id===m);d.nodes[h].x=g.x,d.nodes[h].y=g.y}console.log("Set layout.")}}).run()}class aR{constructor(){this.layers={}}addLayer(e,t){this.layers[e]=new sR(t),this.setLayout(),this.updateLayerPositions(),this.updateLayerTextures()}updateLayerPositions(){const e=Object.keys(this.layers).length;for(const[t,[r,i]]of Object.entries(Object.entries(this.layers)))i.updatePosition(t,e);console.log("Updated positions.")}updateLayerTextures(){for(const[e,t]of Object.entries(this.layers))t.updateTexture();console.log("Updated textures.")}removeLayer(e){this.layers[e].removeLayer(),delete this.layers[e],this.setLayout(),this.updateLayerPositions(),this.updateLayerTextures()}setLayout(){iR(this.layers)}}class sR{constructor(e){const t=oR(e);this.name=t.name,this.nodes=t.nodes,this.edges=t.edges,this.createLayer()}createLayer(){this.plane=H_(),this.texture=sh(this.nodes,this.edges),this.plane.material.map=this.texture,this.plane.material.transparent=!0,this.plane.material.needsUpdate=!0,Ec().add(this.plane)}updatePosition(e,t){this.plane.position.set(0,e*ct.LAYER_DISTANCE-t*ct.LAYER_DISTANCE/2,0)}updateTexture(){this.plane.material.map=sh(this.nodes,this.edges)}removeLayer(){Ec().remove(this.plane)}}function oR(n){const e=/digraph\s+(\w+)\s*\{/,t=/"(\w+)"\s*->\s*"(\w+)"\s*\[type="(\w+)"\]/g,r=n.match(e),i=r?r[1]:null,a=[],s=new Set;let o;for(;(o=t.exec(n))!==null;){const c=o[1],f=o[2],d=o[3];a.push({src:c,dst:f,type:d}),s.add(c),s.add(f)}let l=Array.from(s),u=[];for(const c of l){let f={id:c,x:Math.random(),y:Math.random()};u.push(f)}return{name:i,nodes:u,edges:a}}let ct={LAYER_WIDTH:1,LAYER_HEIGHT:.5,LAYER_DISTANCE:.2,TEXTURE_RES:1024,TEXTURE_FILL:"rgba(30, 30, 30, 0.05)",NODE_PADDING:20,COLORS:{sp:"rgba(171, 206, 48, 1.0)",sn:"rgba(250, 26, 13, 1.0)",s:"rgba(88, 180, 238, 1.0)",a:"rgba(255, 255, 255, 1.0)",m:"rgba(120, 120, 120, 1.0)"}};const As=document.getElementById("renderSpace"),Ha=new C_({alpha:!0});Ha.setSize(As.clientWidth,As.clientHeight);Ha.setAnimationLoop(fR);As.appendChild(Ha.domElement);function lR(){return Ha}const ig=new Bm;function Ec(){return ig}const Cd=As.clientWidth/500,Rd=As.clientHeight/500,Vs=new ip(Cd/-2,Cd/2,Rd/2,Rd/-2,1,1e3);Vs.position.set(1,.7,2);Vs.zoom=1.5;Vs.updateProjectionMatrix();const sf=new D_(Vs,Ha.domElement);sf.maxPolarAngle=Math.PI*.5;sf.minDistance=1;sf.maxDistance=8;const Ui=new aR;function uR(n,e){Ui.addLayer(n,e)}function cR(n){Ui.removeLayer(n)}function fR(){Ha.render(ig,Vs)}const Dd=document.getElementById("fileInput"),hR=document.getElementById("fileList"),_c=new Set;Dd.addEventListener("change",()=>{for(const n of Dd.files)_c.has(n.name)?alert(`The file "${n.name}" is already uploaded.`):ag(n)});function ag(n){dR(n),pR(n)}function dR(n){let e=document.createElement("li"),t=document.createElement("button");t.textContent="-",t.className="deleteButton",t.addEventListener("click",()=>{e.remove(),cR(n.name),_c.delete(n.name)});let r=document.createElement("span");r.textContent=n.name;let i=document.createElement("input");i.type="checkbox",i.checked=!0,i.id=`visibilityToggle-${n.name}`,e.appendChild(t),e.appendChild(r),e.appendChild(i),hR.appendChild(e),_c.add(n.name)}function pR(n){const e=new FileReader;e.addEventListener("load",()=>{uR(n.name,e.result)}),n&&e.readAsText(n)}document.addEventListener("DOMContentLoaded",async()=>{try{const n=await vR();ag(n)}catch(n){console.error("Failed to load the example file:",n)}});async function vR(){let n="../assets/example.dot";const e=await fetch(n);if(!e.ok)throw new Error(`Error fetching file: ${e.statusText}`);const t=await e.blob(),r=n.split("/").pop();return new File([t],r)}const gR=document.getElementById("checkbox-r"),mR=document.getElementById("checkbox-l"),yR=document.getElementById("checkbox-sp"),xR=document.getElementById("checkbox-sn"),ER=document.getElementById("checkbox-s"),_R=document.getElementById("checkbox-a"),bR=document.getElementById("checkbox-m");gR.addEventListener("change",function(){this.checked?console.log("References on."):console.log("References off.")});mR.addEventListener("change",function(){this.checked?console.log("Node Labels on."):console.log("Node Labels off.")});yR.addEventListener("change",function(){this.checked?ct.COLORS.sp=or(ct.COLORS.sp,1):ct.COLORS.sp=or(ct.COLORS.sp,0),Ui.updateLayerTextures()});xR.addEventListener("change",function(){this.checked?ct.COLORS.sn=or(ct.COLORS.sn,1):ct.COLORS.sn=or(ct.COLORS.sn,0),Ui.updateLayerTextures()});ER.addEventListener("change",function(){this.checked?ct.COLORS.s=or(ct.COLORS.s,1):ct.COLORS.s=or(ct.COLORS.s,0),Ui.updateLayerTextures()});_R.addEventListener("change",function(){this.checked?ct.COLORS.a=or(ct.COLORS.a,1):ct.COLORS.a=or(ct.COLORS.a,0),Ui.updateLayerTextures()});bR.addEventListener("change",function(){this.checked?ct.COLORS.m=or(ct.COLORS.m,1):ct.COLORS.m=or(ct.COLORS.m,0),Ui.updateLayerTextures()});
